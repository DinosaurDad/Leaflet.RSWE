(function(S,F,t){(function(){L.Map.addInitHook(function(){this.options.zoomControl||(this.zoomControl=new L.Control.Zoom({position:"bottomright"}),this.addControl(this.zoomControl))});L.Control.FullScreen=L.Control.extend({options:{position:"bottomright",title:"Full Screen",titleCancel:"Exit Full Screen",forceSeparateButton:!1,forcePseudoFullscreen:!1},onAdd:function(a){var b="leaflet-control-zoom-fullscreen",c="";a=a.zoomControl&&!this.options.forceSeparateButton?a.zoomControl._container:L.DomUtil.create("div",
"leaflet-bar");this.options.content?c=this.options.content:b+=" fullscreen-icon";this._createButton(this.options.title,b,c,a,this.toggleFullScreen,this);this._map.on("enterFullscreen exitFullscreen",this._toggleTitle,this);return a},_createButton:function(b,c,e,h,n,l){this.link=L.DomUtil.create("a",c,h);this.link.href="#";this.link.title=b;this.link.innerHTML=e;L.DomEvent.addListener(this.link,"click",L.DomEvent.stopPropagation).addListener(this.link,"click",L.DomEvent.preventDefault).addListener(this.link,
"click",n,l);L.DomEvent.addListener(h,a.fullScreenEventName,L.DomEvent.stopPropagation).addListener(h,a.fullScreenEventName,L.DomEvent.preventDefault).addListener(h,a.fullScreenEventName,this._handleEscKey,l);L.DomEvent.addListener(F,a.fullScreenEventName,L.DomEvent.stopPropagation).addListener(F,a.fullScreenEventName,L.DomEvent.preventDefault).addListener(F,a.fullScreenEventName,this._handleEscKey,l);return this.link},toggleFullScreen:function(){var b=this._map;b._exitFired=!1;b._isFullscreen?(a.supportsFullScreen&&
!this.options.forcePseudoFullscreen?a.cancelFullScreen(b._container):L.DomUtil.removeClass(b._container,"leaflet-pseudo-fullscreen"),setTimeout(L.bind(b.invalidateSize,b),200),b.fire("exitFullscreen"),b._exitFired=!0,b._isFullscreen=!1):(a.supportsFullScreen&&!this.options.forcePseudoFullscreen?a.requestFullScreen(b._container):L.DomUtil.addClass(b._container,"leaflet-pseudo-fullscreen"),setTimeout(L.bind(b.invalidateSize,b),200),b.fire("enterFullscreen"),b._isFullscreen=!0)},_toggleTitle:function(){this.link.title=
this._map._isFullscreen?this.options.title:this.options.titleCancel},_handleEscKey:function(){var b=this._map;a.isFullScreen(b)||b._exitFired||(b.fire("exitFullscreen"),b._exitFired=!0,b._isFullscreen=!1)}});L.control.fullscreen=function(a){return new L.Control.FullScreen(a)};L.Map.addInitHook(function(){L.extend(this.options,{fullscreenControl:!0});this.options.fullscreenControl&&(this.fullscreenControl=L.control.fullscreen(this.options.fullscreenControlOptions),this.addControl(this.fullscreenControl))});
var a={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},b=["webkit","moz","o","ms","khtml"];if("undefined"!==typeof F.exitFullscreen)a.supportsFullScreen=!0;else for(var c=0,e=b.length;c<e;c++)if(a.prefix=b[c],"undefined"!==typeof F[a.prefix+"CancelFullScreen"]){a.supportsFullScreen=!0;break}a.supportsFullScreen&&(a.fullScreenEventName=a.prefix+"fullscreenchange",a.isFullScreen=function(){switch(this.prefix){case "":return F.fullScreen;
case "webkit":return F.webkitIsFullScreen;default:return F[this.prefix+"FullScreen"]}},a.requestFullScreen=function(a){return""===this.prefix?a.requestFullscreen():a[this.prefix+"RequestFullScreen"]()},a.cancelFullScreen=function(){return""===this.prefix?F.exitFullscreen():F[this.prefix+"CancelFullScreen"]()});"undefined"!==typeof jQuery&&(jQuery.fn.requestFullScreen=function(){return this.each(function(){var b=jQuery(this);a.supportsFullScreen&&a.requestFullScreen(b)})});S.fullScreenApi=a})();L.Util=
L.extend(L.Util||{},{base64KeyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",base64Encode:function(a){var b="",c,e,d,f,g,h,n=0;for(a=this.base64Utf8Encode(a);n<a.length;)c=a.charCodeAt(n++),e=a.charCodeAt(n++),d=a.charCodeAt(n++),f=c>>2,c=(c&3)<<4|e>>4,g=(e&15)<<2|d>>6,h=d&63,isNaN(e)?g=h=64:isNaN(d)&&(h=64),b=b+this.base64KeyStr.charAt(f)+this.base64KeyStr.charAt(c)+this.base64KeyStr.charAt(g)+this.base64KeyStr.charAt(h);return b},base64Decode:function(a){var b="",c,e,d,
f,g,h=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<a.length;)c=this.base64KeyStr.indexOf(a.charAt(h++)),e=this.base64KeyStr.indexOf(a.charAt(h++)),f=this.base64KeyStr.indexOf(a.charAt(h++)),g=this.base64KeyStr.indexOf(a.charAt(h++)),c=c<<2|e>>4,e=(e&15)<<4|f>>2,d=(f&3)<<6|g,b+=String.fromCharCode(c),64!==f&&(b+=String.fromCharCode(e)),64!==g&&(b+=String.fromCharCode(d));return b=this.base64Utf8Decode(b)},base64Utf8Encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var e=
a.charCodeAt(c);128>e?b+=String.fromCharCode(e):(127<e&&2048>e?b+=String.fromCharCode(e>>6|192):(b+=String.fromCharCode(e>>12|224),b+=String.fromCharCode(e>>6&63|128)),b+=String.fromCharCode(e&63|128))}return b},base64Utf8Decode:function(a){for(var b="",c=0,e=0,d=0,f=0;c<a.length;)e=a.charCodeAt(c),128>e?(b+=String.fromCharCode(e),c++):191<e&&224>e?(d=a.charCodeAt(c+1),b+=String.fromCharCode((e&31)<<6|d&63),c+=2):(d=a.charCodeAt(c+1),f=a.charCodeAt(c+2),b+=String.fromCharCode((e&15)<<12|(d&63)<<6|
f&63),c+=3);return b}});L.Curve=L.Path.extend({options:{},initialize:function(a,b){L.setOptions(this,b);this._setPath(a)},getPath:function(){return this._coords},setPath:function(a){this._setPath(a);return this.redraw()},getBounds:function(){return this._bounds},_setPath:function(a){this._coords=a;this._bounds=this._computeBounds()},_computeBounds:function(){for(var a=new L.LatLngBounds,b,c,e,d,f,g,h=0;h<this._coords.length;h++)e=this._coords[h],"string"===typeof e||e instanceof String?c=e:"H"===
c?(a.extend([b.lat,e[0]]),b=new L.latLng(b.lat,e[0])):"V"===c?(a.extend([e[0],b.lng]),b=new L.latLng(e[0],b.lng)):"C"===c?(f=new L.latLng(e[0],e[1]),e=this._coords[++h],d=new L.latLng(e[0],e[1]),e=this._coords[++h],e=new L.latLng(e[0],e[1]),a.extend(f),a.extend(d),a.extend(e),e.controlPoint1=f,e.controlPoint2=d,b=e):"S"===c?(d=new L.latLng(e[0],e[1]),e=this._coords[++h],e=new L.latLng(e[0],e[1]),f=b,b.controlPoint2&&(f=b.lat-b.controlPoint2.lat,g=b.lng-b.controlPoint2.lng,f=new L.latLng(b.lat+f,b.lng+
g)),a.extend(f),a.extend(d),a.extend(e),e.controlPoint1=f,e.controlPoint2=d,b=e):"Q"===c?(d=new L.latLng(e[0],e[1]),e=this._coords[++h],e=new L.latLng(e[0],e[1]),a.extend(d),a.extend(e),e.controlPoint=d,b=e):"T"===c?(e=new L.latLng(e[0],e[1]),d=b,b.controlPoint&&(f=b.lat-b.controlPoint.lat,g=b.lng-b.controlPoint.lng,d=new L.latLng(b.lat+f,b.lng+g)),a.extend(d),a.extend(e),e.controlPoint=d,b=e):(a.extend(e),b=new L.latLng(e[0],e[1]));return a},getCenter:function(){return this._bounds.getCenter()},
_update:function(){this._map&&this._updatePath()},_project:function(){var a,b,c,e;this._points=[];for(var d=0;d<this._coords.length;d++)if(a=this._coords[d],"string"===typeof a||a instanceof String)this._points.push(a),c=a;else{switch(a.length){case 2:e=this._map.latLngToLayerPoint(a);b=a;break;case 1:"H"===c?(e=this._map.latLngToLayerPoint([b[0],a[0]]),b=[b[0],a[0]]):(e=this._map.latLngToLayerPoint([a[0],b[1]]),b=[a[0],b[1]])}this._points.push(e)}},getPathString:function(){this._project();return this._curvePointsToPath(this._points)},
_curvePointsToPath:function(a){var b,c,e="";if(a)for(var d=0;d<a.length;d++)if(b=a[d],"string"===typeof b||b instanceof String)c=b,e+=c;else switch(c){case "H":e+=b.x+" ";break;case "V":e+=b.y+" ";break;default:e+=b.x+" "+b.y+" "}return e||"M0 0"}});L.curve=function(a,b){return new L.Curve(a,b)};L.ScalableText=L.Path.extend({includes:L.Mixin.Events,initialize:function(a,b,c,e){var d;e&&e.attributes&&(d={},L.Util.extend(d,e.attributes),delete e.attributes);this.options={};L.Util.extend(this.options,
this.defaultOptions);e&&L.Util.extend(this.options,e);this.options.attributes={};L.Util.extend(this.options.attributes,this.defaultAttributes);d!==t&&(L.Util.extend(this.options.attributes,d),e.attributes={},L.Util.extend(e.attributes,d));L.Path.prototype.initialize.call(this,this.options);this._latlngs=this._convertLatLngs([b,c]);this._text=a},defaultAttributes:{fill:"white","text-anchor":"start","line-height":"15px","font-size":"12px","font-family":"Arial"},defaultOptions:{editable:!1,clickable:!0,
bgColor:"black",orientation:"normal",center:!0,below:!1},options:{},onAdd:function(a){L.Path.prototype.onAdd.call(this,a);this._map=a;this._textRedraw()},onRemove:function(a){(a=a||this._map)&&this._gNode&&this._textNode&&this._rectNode&&(this._gNode.removeChild(this._textNode),this._gNode.removeChild(this._rectNode),delete this._textNode,delete this._rectNode);a&&this._container&&(this._container.removeChild(this._gNode),delete this._gNode);L.Path.prototype.onRemove.call(this,a)},bringToFront:function(){this._map&&
(L.Path.prototype.bringToFront.call(this,this._map),this._textRedraw())},bringToBack:function(){this._map&&(L.Path.prototype.bringToBack.call(this,this._map),this._textRedraw())},_updatePath:function(){this._map&&(L.Path.prototype._updatePath.call(this),this._textRedraw())},redraw:function(){this._map&&(L.Path.prototype.redraw.call(this),this._textRedraw())},_textRedraw:function(){var a=this._text;a&&this.setText(a)},projectLatlngs:function(){this._originalPoints=[];for(var a=0,b=this._latlngs.length;a<
b;a++)this._originalPoints[a]=this._map.latLngToLayerPoint(this._latlngs[a])},getLatLngs:function(){return this._latlngs},getBounds:function(){return new L.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(a,b){var c,e,d=b?a:[];c=0;for(e=a.length;c<e;c++){if(L.Util.isArray(a[c])&&"number"!==typeof a[c][0])return;d[c]=L.latLng(a[c])}return d},_initEvents:function(){L.Path.prototype._initEvents.call(this)},setText:function(a){this._text=a;if(!L.Browser.svg||"undefined"===typeof this._map)return this;
if(!this._text)return this._map&&this._container&&this._gNode&&this._textNode&&this.rectNode&&(this._gNode.removeChild(this._textNode),this._gNode.removeChild(this._rectNode),delete this._textNode,delete this._rectNode),this._container&&this._gNode&&(this._container.removeChild(this._gNode),delete this._gNode),this;this._gNode||(this._gNode=L.Path.prototype._createElement("g"),this._rectNode||(this._rectNode=L.Path.prototype._createElement("rect"),this._gNode.appendChild(this._rectNode)),this._textNode||
(this._textNode=L.Path.prototype._createElement("text"),this._gNode.appendChild(this._textNode)),this._container.appendChild(this._gNode),!L.Browser.svg&&L.Browser.vml||!this.options.clickable||this._gNode.setAttribute("class","leaflet-clickable"));for(var b in this.options.attributes)this._textNode.setAttribute(b,this.options.attributes[b]);this._textNode.innerHTML=this._text.replace(/ /g,"\u00a0");if(this._latlngs[1]&&this._latlngs[0]){a=parseInt(this.options.attributes["line-height"].replace("px",
""),10);b=parseInt(this.options.attributes["font-size"].replace("px",""),10);var c=this._map.latLngToLayerPoint(this._latlngs[0]),e=c.distanceTo(this._map.latLngToLayerPoint(this._latlngs[1]))/a,d=Math.cos(this._latlngs[0].lat*Math.PI/180),d=180*Math.atan2(-this._latlngs[0].lat+this._latlngs[1].lat,(this._latlngs[0].lng-this._latlngs[1].lng)*d)/Math.PI-90,c="translate("+c.x+" "+c.y+") scale("+e+") rotate("+d+")";this.options.center&&(c=c+" translate("+-0.5*this._textNode.getComputedTextLength()+")");
this._textNode.setAttribute("x","0");this._textNode.setAttribute("y","-"+0.8*(a-b));this._rectNode.setAttribute("x","0");this._rectNode.setAttribute("y","-"+a);this._rectNode.setAttribute("height",""+a);this._rectNode.setAttribute("width",this._textNode.getComputedTextLength());this._rectNode.setAttribute("fill",this.options.bgColor);this._rectNode.setAttribute("transform",c);this._textNode.setAttribute("transform",c)}return this}});L.Edit=L.Edit||{};L.Edit.ScalableText=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(16,
16),className:"leaflet-div-icon leaflet-editing-icon"})},initialize:function(a,b){this._scalabletext=a;L.setOptions(this,b)},addHooks:function(){var a=this._scalabletext;a.setStyle(a.options.editing);this._scalabletext.options.editable&&this._scalabletext._map&&(this._markerGroup||this._initMarkers(),this._scalabletext._map.addLayer(this._markerGroup))},removeHooks:function(){var a=this._scalabletext;a.setStyle(a.options.original);this._scalabletext.options.editable&&this._scalabletext._map&&(a._map.removeLayer(this._markerGroup),
delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers();this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup);this._markers=[];var a=this._scalabletext._latlngs,a=this._scalabletext.options.markerOnTop?this._createMarker(a[1],1):this._createMarker(a[0],0);this._markers.push(a)},_createMarker:function(a,b){var c=new L.Marker(a,{draggable:!0,icon:this.options.icon});c._origLatLng=a;c._index=b;c.on("drag",
this._onMarkerDrag,this);c.on("dragend",this._fireEdit,this);this._markerGroup.addLayer(c);return c},_removeMarker:function(a){var b=a._index;this._markerGroup.removeLayer(a);this._markers.splice(b,1);this._scalabletext.spliceLatLngs(b,1);this._updateIndexes(b,-1);a.off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("click",this._onMarkerClick,this)},_fireEdit:function(){this._scalabletext.edited=!0;this._scalabletext.fire("edit");this._scalabletext._map.fire("edit",{layer:this._scalabletext})},
_onMarkerDrag:function(a){var b=a.target;L.DomEvent.preventDefault(a);a={lat:b._latlng.lat-b._origLatLng.lat,lng:b._latlng.lng-b._origLatLng.lng};this._scalabletext.options.editable&&this._scalabletext.options.onDrag&&this._scalabletext.options.onDrag.call(this,b,a);this._scalabletext.options.markerOnTop?(this._scalabletext._latlngs[0].lat+=b._latlng.lat-b._origLatLng.lat,this._scalabletext._latlngs[0].lng+=b._latlng.lng-b._origLatLng.lng):(this._scalabletext._latlngs[1].lat+=b._latlng.lat-b._origLatLng.lat,
this._scalabletext._latlngs[1].lng+=b._latlng.lng-b._origLatLng.lng);L.extend(b._origLatLng,b._latlng);this._scalabletext.redraw()},_updateIndexes:function(a,b){this._markerGroup.eachLayer(function(c){c._index>a&&(c._index+=b)})}});L.ScalableText.addInitHook(function(){this.editing||(L.Edit.ScalableText&&(this.editing=new L.Edit.ScalableText(this)),this.on("add",function(){this.editing&&this.editing.enabled()&&this.options.editable&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&
this.editing.enabled()&&this.options.editable&&this.editing.removeHooks()}))});L.drawVersion="0.2.4-dev";L.drawLocal={draw:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},undo:{title:"Delete last point drawn",text:"Delete last point"},buttons:{polyline:"Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",circle:"Draw a circle",marker:"Draw a marker",wall:"Draw a wall",window:"Draw a window",door:"Draw a door"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle."},
radius:"Radius"},marker:{tooltip:{start:"Click map to place marker."}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing line.",cont:"Click to continue drawing line.",end:"Click last point to finish line."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},simpleshape:{tooltip:{end:"Release mouse to finish drawing."}},
wall:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing wall.",cont:"Click to continue drawing wall.",end:"Click last point to finish wall."}},window:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing window.",cont:"Click to continue drawing window.",end:"Click last point to finish window."}},door:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing door.",cont:"Click to continue drawing door.",
end:"Click last point to finish door."}}}},edit:{toolbar:{actions:{save:{title:"Apply changes.",text:"Apply"},cancel:{title:"Cancel editing, discards all changes.",text:"Cancel"}},buttons:{edit:"Edit layers.",editDisabled:"No layers to edit.",remove:"Delete layers.",removeDisabled:"No layers to delete."}},handlers:{edit:{tooltip:{text:"Drag handles, or marker to edit feature.",subtext:"Click cancel to undo changes."}},remove:{tooltip:{text:"Click on a feature to remove"}}}}};L.Draw={};L.Draw.Feature=
L.Handler.extend({includes:L.Mixin.Events,initialize:function(a,b){this._map=a;this._container=a._container;this._overlayPane=a._panes.overlayPane;this._popupPane=a._panes.popupPane;b&&b.shapeOptions&&(b.shapeOptions=L.Util.extend({},this.options.shapeOptions,b.shapeOptions));L.setOptions(this,b)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire("draw:drawstart",{layerType:this.type,layer:this}))},disable:function(){this._enabled&&
(L.Handler.prototype.disable.call(this),this._map.fire("draw:drawstop",{layerType:this.type,layer:this}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var a=this._map;a&&(L.DomUtil.disableTextSelection(),a.getContainer().focus(),this._tooltip=new L.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",
this._cancelDrawing,this))},setOptions:function(a){L.setOptions(this,a)},_fireCreatedEvent:function(a){this._map.fire("draw:created",{layer:a,layerType:this.type})},_cancelDrawing:function(a){27===a.keyCode&&this.disable()}});L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,
maxGuideLineLength:4E3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!1},metric:!0,showLength:!0,zIndexOffset:2E3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(a,b){this._map=a;this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error;b&&b.drawError&&(b.drawError=L.Util.extend({},this.options.drawError,b.drawError));this.type=L.Draw.Polyline.TYPE;L.Draw.Feature.prototype.initialize.call(this,
a,b)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this);this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-div-icon leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40],draggable:!0}),opacity:0,zIndexOffset:this.options.zIndexOffset})),
this._mouseMarker.addTo(this._map),this._map.on("zoomend",this._onZoomEnd,this),L.DomEvent.addListener(this._map._container,"mousedown",this._onMouseDown,this),L.DomEvent.addListener(this._map._container,"mousemove",this._onMouseMove,this),L.DomEvent.addListener(this._map._container,"mouseup",this._onMouseUp,this),L.DomEvent.addListener(this._map._container,"touchstart",this._onMouseDown,this),L.DomEvent.addListener(this._map._container,"touchmove",this._onMouseMove,this),L.DomEvent.addListener(this._map._container,
"touchend",this._onMouseUp,this),this._map.dragging&&this._map.dragging.disable())},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this);this._clearHideErrorTimeout();this._cleanUpShape();this._map.removeLayer(this._markerGroup);delete this._markerGroup;delete this._markers;this._map.removeLayer(this._poly);delete this._poly;this._map.removeLayer(this._mouseMarker);delete this._mouseMarker;this._clearGuides();this._map.off("zoomend",this._onZoomEnd,this);L.DomEvent.removeListener(this._map._container,
"mousedown",this._onMouseDown);L.DomEvent.removeListener(this._map._container,"mousemove",this._onMouseMove);L.DomEvent.removeListener(this._map._container,"mouseup",this._onMouseUp);L.DomEvent.removeListener(this._map._container,"touchstart",this._onMouseDown);L.DomEvent.removeListener(this._map._container,"touchmove",this._onMouseMove);L.DomEvent.removeListener(this._map._container,"touchend",this._onMouseUp);this._map.dragging&&this._map.dragging.enable()},deleteLastVertex:function(){if(!(1>=this._markers.length)){var a=
this._markers.pop(),b=this._poly,c=this._poly.spliceLatLngs(b.getLatLngs().length-1,1)[0];this._markerGroup.removeLayer(a);2>b.getLatLngs().length&&this._map.removeLayer(b);this._vertexChanged(c,!1)}},addVertex:function(a){0<this._markers.length&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(a)?this._showErrorTooltip():(this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(a)),this._poly.addLatLng(a),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),
this._vertexChanged(a,!0))},_onMarkerMouseUp:function(a){a.preventDefault();this._finishShape()},_finishShape:function(){var a=this._poly.newLatLngIntersects(this._poly.getLatLngs()[0],!0);!this.options.allowIntersection&&a||!this._shapeIsValid()?this._showErrorTooltip():(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_shapeIsValid:function(){return!0},_onZoomEnd:function(){this._updateGuide()},_onMouseMove:function(a){a.preventDefault();a.originalEvent=a.originalEvent?
a.originalEvent:a;a.originalEvent.touches&&(a.originalEvent.clientX=a.originalEvent.clientX?a.originalEvent.clientX:a.originalEvent.touches[0].clientX,a.originalEvent.clientY=a.originalEvent.clientY?a.originalEvent.clientY:a.originalEvent.touches[0].clientY,this.startTouch=this.lastTouch=a.originalEvent.touches[0]);a.containerPoint=a.containerPoint?a.containerPoint:this._map.mouseEventToContainerPoint(a.originalEvent);a.layerPoint=a.layerPoint?a.layerPoint:this._map.containerPointToLayerPoint(a.containerPoint);
a.latlng=a.latlng?a.latlng:this._map.layerPointToLatLng(a.layerPoint);var b=a.layerPoint,c=a.latlng;this._currentLatLng=c;a.originalEvent.touches||this._updateTooltip(c);this._updateGuide(b);this._mouseMarker.setLatLng(c)},_vertexChanged:function(a,b){this._updateStartHandler();this._updateFinishHandler();this._updateRunningMeasure(a,b);this._clearGuides();this._updateTooltip()},_onMouseDown:function(a){a.preventDefault();a.originalEvent=a.originalEvent?a.originalEvent:a;a.originalEvent.touches&&
(a.originalEvent.clientX=a.originalEvent.clientX?a.originalEvent.clientX:a.originalEvent.touches[0].clientX,a.originalEvent.clientY=a.originalEvent.clientY?a.originalEvent.clientY:a.originalEvent.touches[0].clientY,this.startTouch=a.originalEvent.touches[0],this.lastTouch=a.originalEvent.touches[0]);a.containerPoint=a.containerPoint?a.containerPoint:this._map.mouseEventToContainerPoint(a.originalEvent);a.layerPoint=a.layerPoint?a.layerPoint:this._map.containerPointToLayerPoint(a.containerPoint);a.latlng=
a.latlng?a.latlng:this._map.layerPointToLatLng(a.layerPoint);var b=a.originalEvent;this._mouseDownOrigin=L.point(b.clientX,b.clientY);this._latlngOrigin=a.latlng},_onMouseUp:function(a){a.preventDefault();a.originalEvent=a.originalEvent?a.originalEvent:a;a.originalEvent.touches&&(a.originalEvent.clientX=a.originalEvent.clientX?a.originalEvent.clientX:this.lastTouch.clientX,a.originalEvent.clientY=a.originalEvent.clientY?a.originalEvent.clientY:this.lastTouch.clientY);a.containerPoint=a.containerPoint?
a.containerPoint:this._map.mouseEventToContainerPoint(a.originalEvent);a.layerPoint=a.layerPoint?a.layerPoint:this._map.containerPointToLayerPoint(a.containerPoint);a.latlng=a.latlng?a.latlng:this._map.layerPointToLatLng(a.layerPoint);if(this._mouseDownOrigin){this._latlngOrigin&&(a.latlng=this._latlngOrigin);var b=L.point(a.originalEvent.clientX,a.originalEvent.clientY).distanceTo(this._mouseDownOrigin);Math.abs(b)<9*(S.devicePixelRatio||1)&&this.addVertex(a.latlng)}this._latlngOrigin=this._mouseDownOrigin=
null},_updateStartHandler:function(){},_updateFinishHandler:function(){var a=0;this._markers!==t&&(a=this._markers.length);1<a&&(L.DomEvent.addListener(this._markers[a-1]._icon,"mouseup",this._onMarkerMouseUp,this),L.DomEvent.addListener(this._markers[a-1]._icon,"touchend",this._onMarkerMouseUp,this));2<a&&(L.DomEvent.removeListener(this._markers[a-2]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[a-2]._icon,"touchend",this._onMarkerMouseUp))},_createMarker:function(a){a=
new L.Marker(a,{icon:this.options.icon,className:"leaflet-div-icon leaflet-editing-icon",draggable:!1,clickable:!1,zIndexOffset:2*this.options.zIndexOffset});this._markerGroup.addLayer(a);this._map.fire("draw:createmarker",{marker:a,layer:this});return a},_updateGuide:function(a){var b=0;this._markers!==t&&(b=this._markers.length);0<b&&(a=a||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[b-1].getLatLng()),a))},_updateTooltip:function(a){if(this._tooltip){var b=
this._getTooltipText();a&&this._tooltip.updatePosition(a);this._errorShown||this._tooltip.updateContent(b)}},_drawGuide:function(a,b){var c=Math.floor(Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))),e=this.options.guidelineDistance,d=this.options.maxGuideLineLength,e=c>d?c-d:e,f;this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));for(;e<c;e+=this.options.guidelineDistance)d=e/c,d={x:Math.floor(a.x*(1-d)+d*b.x),y:Math.floor(a.y*(1-d)+d*
b.y)},f=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),f.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(f,d)},_updateGuideColor:function(a){if(this._guidesContainer)for(var b=0,c=this._guidesContainer.childNodes.length;b<c;b++)this._guidesContainer.childNodes[b].style.backgroundColor=a},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},
_getTooltipText:function(){var a=this.options.showLength,b=0;this._markers!==t&&(b=this._markers.length);0===b?a={text:L.drawLocal.draw.handlers.polyline.tooltip.start}:(a=a?this._getMeasurementString():"",a=1===this._markers.length?{text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:a}:{text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:a});return a},_updateRunningMeasure:function(a,b){var c=0;this._markers!==t&&(c=this._markers.length);1>=c?this._measurementRunningTotal=0:(c=
a.distanceTo(this._markers[c-(b?2:1)].getLatLng()),this._measurementRunningTotal+=c*(b?1:-1))},_getMeasurementString:function(){var a=0;if(this._currentLatLng&&0<this._markers.length)var a=this._currentLatLng,b=this._markers[this._markers.length-1].getLatLng(),a=this._measurementRunningTotal+a.distanceTo(b);return L.GeometryUtil.readableDistance(a,this.options.metric)},_showErrorTooltip:function(){this._errorShown=!0;this._tooltip.showAsError().updateContent({text:this.options.drawError.message});
this._updateGuideColor(this.options.drawError.color);this._poly.setStyle({color:this.options.drawError.color});this._clearHideErrorTimeout();this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1;this._clearHideErrorTimeout();this._tooltip.removeError().updateContent(this._getTooltipText());this._updateGuideColor(this.options.shapeOptions.color);this._poly.setStyle({color:this.options.shapeOptions.color})},
_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_cleanUpShape:function(){1<this._markers.length&&(L.DomEvent.removeListener(this._markers[this._markers.length-1]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[this._markers.length-1]._icon,"touchend",this._onMarkerMouseUp))},_fireCreatedEvent:function(){var a=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,
a)}});L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!1,fillColor:null,fillOpacity:0.2,clickable:!0},toolbarIcon:{className:"leaflet-draw-draw-polygon",tooltip:L.drawLocal.draw.toolbar.buttons.polygon}},initialize:function(a,b){L.Draw.Polyline.prototype.initialize.call(this,a,b);this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var a=this._markers.length;1===a&&(L.DomEvent.addListener(this._markers[0]._icon,
"mouseup",this._onMarkerMouseUp,this),L.DomEvent.addListener(this._markers[0]._icon,"touchend",this._onMarkerMouseUp,this));2<a&&(L.DomEvent.addListener(this._markers[a-1]._icon,"mouseup",this._onMarkerMouseUp,this),L.DomEvent.addListener(this._markers[a-1]._icon,"touchend",this._onMarkerMouseUp,this),3<a&&(L.DomEvent.removeListener(this._markers[a-2]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[a-2]._icon,"touchend",this._onMarkerMouseUp)))},_getTooltipText:function(){var a,
b;0===this._markers.length?a=L.drawLocal.draw.handlers.polygon.tooltip.start:3>this._markers.length?a=L.drawLocal.draw.handlers.polygon.tooltip.cont:(a=L.drawLocal.draw.handlers.polygon.tooltip.end,b=this._getMeasurementString());return{text:a,subtext:b}},_getMeasurementString:function(){var a=this._area;return a?L.GeometryUtil.readableArea(a,this.options.metric):null},_shapeIsValid:function(){return 3<=this._markers.length},_vertexChanged:function(a,b){var c;!this.options.allowIntersection&&this.options.showArea&&
(c=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(c));L.Draw.Polyline.prototype._vertexChanged.call(this,a,b)},_cleanUpShape:function(){var a=this._markers.length;0<a&&(L.DomEvent.removeListener(this._markers[0]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[0]._icon,"touchend",this._onMarkerMouseUp),2<a&&(L.DomEvent.removeListener(this._markers[a-1]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[a-1]._icon,"touchend",
this._onMarkerMouseUp)))}});L.SimpleShape={};L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:!1},initialize:function(a,b){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end;L.Draw.Feature.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this);this._map&&(this._map.dragging&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),L.DomEvent.addListener(this._map._container,
"mousedown",this._onMouseDown,this),L.DomEvent.addListener(this._map._container,"mousemove",this._onMouseMove,this),L.DomEvent.addListener(this._map._container,"mouseup",this._onMouseUp,this),L.DomEvent.addListener(this._map._container,"touchstart",this._onMouseDown,this),L.DomEvent.addListener(this._map._container,"touchmove",this._onMouseMove,this),L.DomEvent.addListener(this._map._container,"touchend",this._onMouseUp,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this);
this._map&&(this._map.dragging&&this._map.dragging.enable(),this._container.style.cursor="",L.DomEvent.removeListener(this._map._container,"mousedown",this._onMouseDown),L.DomEvent.removeListener(this._map._container,"mousemove",this._onMouseMove),L.DomEvent.removeListener(this._map._container,"mouseup",this._onMouseUp),L.DomEvent.removeListener(this._map._container,"touchstart",this._onMouseDown),L.DomEvent.removeListener(this._map._container,"touchmove",this._onMouseMove),L.DomEvent.removeListener(this._map._container,
"touchend",this._onMouseUp),this._shape&&(this._map.removeLayer(this._shape),delete this._shape));this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(a){a.originalEvent=a.originalEvent?a.originalEvent:a;a.originalEvent.touches&&(a.originalEvent.clientX=a.originalEvent.clientX?a.originalEvent.clientX:a.originalEvent.touches[0].clientX,a.originalEvent.clientY=a.originalEvent.clientY?a.originalEvent.clientY:a.originalEvent.touches[0].clientY,this.startTouch=
a.originalEvent.touches[0],this.lastTouch=a.originalEvent.touches[0]);a.containerPoint=a.containerPoint?a.containerPoint:this._map.mouseEventToContainerPoint(a.originalEvent);a.layerPoint=a.layerPoint?a.layerPoint:this._map.containerPointToLayerPoint(a.containerPoint);a.latlng=a.latlng?a.latlng:this._map.layerPointToLatLng(a.layerPoint);this._isDrawing=!0;var b=this._map,c;a.touches&&(a.clientX=a.touches[0].clientX,a.clientY=a.touches[0].clientY);b._container||new L.Point(a.clientX,a.clientY);c=b._container.getBoundingClientRect();
c=new L.Point(a.clientX-c.left-b._container.clientLeft,a.clientY-c.top-b._container.clientTop);c=b.containerPointToLayerPoint(c);this._startLatLng=b.layerPointToLatLng(c);a.preventDefault()},_onMouseMove:function(a){a.originalEvent=a.originalEvent?a.originalEvent:a;a.originalEvent.touches&&(a.originalEvent.clientX=a.originalEvent.clientX?a.originalEvent.clientX:a.originalEvent.touches[0].clientX,a.originalEvent.clientY=a.originalEvent.clientY?a.originalEvent.clientY:a.originalEvent.touches[0].clientY,
this.startTouch=a.originalEvent.touches[0],this.lastTouch=a.originalEvent.touches[0]);a.containerPoint=a.containerPoint?a.containerPoint:this._map.mouseEventToContainerPoint(a.originalEvent);a.layerPoint=a.layerPoint?a.layerPoint:this._map.containerPointToLayerPoint(a.containerPoint);a.latlng=a.latlng?a.latlng:this._map.layerPointToLatLng(a.layerPoint);var b=this._map;a.touches&&(a.clientX=a.touches[0].clientX,a.clientY=a.touches[0].clientY);b._container||new L.Point(a.clientX,a.clientY);var c=b._container.getBoundingClientRect();
a=new L.Point(a.clientX-c.left-b._container.clientLeft,a.clientY-c.top-b._container.clientTop);a=b.containerPointToLayerPoint(a);b=b.layerPointToLatLng(a);this._tooltip.updatePosition(b);this._isDrawing&&(this._tooltip.updateContent(this._getTooltipText()),this._drawShape(b))},_onMouseUp:function(a){a.originalEvent=a.originalEvent?a.originalEvent:a;a.originalEvent.touches&&(a.originalEvent.clientX=a.originalEvent.clientX?a.originalEvent.clientX:a.originalEvent.touches[0].clientX,a.originalEvent.clientY=
a.originalEvent.clientY?a.originalEvent.clientY:a.originalEvent.touches[0].clientY,this.startTouch=a.originalEvent.touches[0],this.lastTouch=a.originalEvent.touches[0]);a.containerPoint=a.containerPoint?a.containerPoint:this._map.mouseEventToContainerPoint(a.originalEvent);a.layerPoint=a.layerPoint?a.layerPoint:this._map.containerPointToLayerPoint(a.containerPoint);a.latlng=a.latlng?a.latlng:this._map.layerPointToLatLng(a.layerPoint);this._shape&&this._fireCreatedEvent();this.disable();this.options.repeatMode&&
this.enable()}});L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!1,fillColor:null,fillOpacity:0.5,clickable:!0},guidelineDistance:20,maxGuideLineLength:4E3,metric:!0},initialize:function(a,b){this.type=L.Draw.Rectangle.TYPE;this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start;L.Draw.SimpleShape.prototype.initialize.call(this,a,b)},_drawShape:function(a){this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,
a)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,a),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var a=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,a)},_getTooltipText:function(){var a=L.Draw.SimpleShape.prototype._getTooltipText.call(this),b;this._shape&&(b=this._shape.getLatLngs(),b=L.GeometryUtil.geodesicArea(b),b=L.GeometryUtil.readableArea(b,this.options.metric));
return{text:a.text,subtext:b}}});L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!0,fillColor:null,fillOpacity:0.2,clickable:!0},showRadius:!0,metric:!0,toolbarIcon:{className:"leaflet-draw-draw-circle",tooltip:L.drawLocal.draw.toolbar.buttons.circle}},initialize:function(a,b){this.type=L.Draw.Circle.TYPE;this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start;L.Draw.SimpleShape.prototype.initialize.call(this,
a,b)},_drawShape:function(a){this._shape?this._shape.setRadius(this._startLatLng.distanceTo(a)):(this._shape=new L.Circle(this._startLatLng,this._startLatLng.distanceTo(a),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var a=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,a)},_onMouseMove:function(a){a.originalEvent=a.originalEvent?a.originalEvent:a;a.originalEvent.touches&&
(a.originalEvent.clientX=a.originalEvent.clientX?a.originalEvent.clientX:a.originalEvent.touches[0].clientX,a.originalEvent.clientY=a.originalEvent.clientY?a.originalEvent.clientY:a.originalEvent.touches[0].clientY,this.startTouch=a.originalEvent.touches[0],this.lastTouch=a.originalEvent.touches[0]);a.containerPoint=a.containerPoint?a.containerPoint:this._map.mouseEventToContainerPoint(a.originalEvent);a.layerPoint=a.layerPoint?a.layerPoint:this._map.containerPointToLayerPoint(a.containerPoint);a.latlng=
a.latlng?a.latlng:this._map.layerPointToLatLng(a.layerPoint);a.originalEvent.preventDefault();var b=a.latlng;a=this.options.showRadius;var c=this.options.metric;this._tooltip.updatePosition(b);this._isDrawing&&(this._drawShape(b),b=this._shape.getRadius().toFixed(1),this._tooltip.updateContent({text:this._endLabelText,subtext:a?L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(b,c):""}))}});L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,
repeatMode:!1,zIndexOffset:2E3,toolbarIcon:{className:"leaflet-draw-draw-marker",tooltip:L.drawLocal.draw.toolbar.buttons.marker}},initialize:function(a,b){this.type=L.Draw.Marker.TYPE;L.Draw.Feature.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this);this._map&&(this._tooltip.updateContent({text:L.drawLocal.draw.handlers.marker.tooltip.start}),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",
iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this))},setStyle:function(a){L.setOptions(this,a);this._container&&this._updateStyle();return this},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this);this._map&&(this._marker&&(this._marker.off("click",this._onClick,this),this._map.off("click",this._onClick,this).removeLayer(this._marker),
delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(a){a.originalEvent=a.originalEvent?a.originalEvent:a;a.originalEvent.touches&&(a.originalEvent.clientX=a.originalEvent.clientX?a.originalEvent.clientX:a.originalEvent.touches[0].clientX,a.originalEvent.clientY=a.originalEvent.clientY?a.originalEvent.clientY:a.originalEvent.touches[0].clientY,
this.startTouch=a.originalEvent.touches[0],this.lastTouch=a.originalEvent.touches[0]);a.containerPoint=a.containerPoint?a.containerPoint:this._map.mouseEventToContainerPoint(a.originalEvent);a.layerPoint=a.layerPoint?a.layerPoint:this._map.containerPointToLayerPoint(a.containerPoint);a.latlng=a.latlng?a.latlng:this._map.layerPointToLatLng(a.layerPoint);a.originalEvent.preventDefault();a=a.latlng;this._tooltip.updatePosition(a);this._mouseMarker.setLatLng(a);this._marker?(a=this._mouseMarker.getLatLng(),
this._marker.setLatLng(a)):(this._marker=new L.Marker(a,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset}),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_onClick:function(a){a.originalEvent=a.originalEvent?a.originalEvent:a;a.originalEvent.touches&&(a.originalEvent.clientX=a.originalEvent.clientX?a.originalEvent.clientX:a.originalEvent.touches[0].clientX,a.originalEvent.clientY=a.originalEvent.clientY?a.originalEvent.clientY:
a.originalEvent.touches[0].clientY,this.startTouch=a.originalEvent.touches[0],this.lastTouch=a.originalEvent.touches[0]);a.containerPoint=a.containerPoint?a.containerPoint:this._map.mouseEventToContainerPoint(a.originalEvent);a.layerPoint=a.layerPoint?a.layerPoint:this._map.containerPointToLayerPoint(a.containerPoint);a.latlng=a.latlng?a.latlng:this._map.layerPointToLatLng(a.layerPoint);this._fireCreatedEvent();this.disable();this.options.repeatMode&&this.enable()},_fireCreatedEvent:function(){var a=
new L.Marker(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,a)}});L.Draw.Wall=L.Draw.Polyline.extend({statics:{TYPE:"wall"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4E3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!1,clickable:!0},
metric:!0,showLength:!0,zIndexOffset:2E3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(a,b){L.Draw.Polyline.prototype.initialize.call(this,a,b);this.type="wall"},_updateStartHandler:function(){var a=0;this._markers!==t&&(a=this._markers.length);3===a&&(L.DomEvent.addListener(this._markers[0]._icon,"mouseup",this._onMarkerMouseUp0,this),L.DomEvent.addListener(this._markers[0]._icon,"touchend",this._onMarkerMouseUp0,this))},
_onMarkerMouseUp0:function(a){a.preventDefault();this._closeShape()},_closeShape:function(){this.Poly=L.Polygon;this._finishShape();this.Poly=L.Polyline},_cleanUpShape:function(){1<this._markers.length&&(L.DomEvent.removeListener(this._markers[this._markers.length-1]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[this._markers.length-1]._icon,"touchend",this._onMarkerMouseUp));2<this._markers.length&&(L.DomEvent.removeListener(this._markers[0]._icon,"mouseup",this._onMarkerMouseUp0),
L.DomEvent.removeListener(this._markers[0]._icon,"touchend",this._onMarkerMouseUp0))}});L.Draw.Window=L.Draw.Polyline.extend({statics:{TYPE:"window"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4E3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!1,clickable:!0},metric:!0,showLength:!0,
zIndexOffset:2E3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(a,b){L.Draw.Polyline.prototype.initialize.call(this,a,b);this.type="window"},_updateFinishHandler:function(){var a=this._markers.length;1<a&&(L.DomEvent.addListener(this._markers[a-1]._icon,"mouseup",this._onMarkerMouseUp,this),L.DomEvent.addListener(this._markers[a-1]._icon,"touchend",this._onMarkerMouseUp,this),this._finishShape())}});L.Draw.Door=L.Draw.Polyline.extend({statics:{TYPE:"door"},
Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4E3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2E3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(a,b){L.Draw.Polyline.prototype.initialize.call(this,
a,b);this.type="door"},_updateFinishHandler:function(){var a=this._markers.length;1<a&&(L.DomEvent.addListener(this._markers[a-1]._icon,"mouseup",this._onMarkerMouseUp,this),L.DomEvent.addListener(this._markers[a-1]._icon,"touchend",this._onMarkerMouseUp,this),this._finishShape())}});L.Edit=L.Edit||{};L.Edit.Marker=L.Handler.extend({initialize:function(a,b){this._marker=a;L.setOptions(this,b)},addHooks:function(){var a=this._marker;a.dragging.enable();a.on("dragend",this._onDragEnd,a);this._toggleMarkerHighlight()},
removeHooks:function(){var a=this._marker;a.dragging.disable();a.off("dragend",this._onDragEnd,a);this._toggleMarkerHighlight()},_onDragEnd:function(a){a.target.edited=!0},_toggleMarkerHighlight:function(){if(this._icon){var a=this._icon;a.style.display="none";L.DomUtil.hasClass(a,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(a,"leaflet-edit-marker-selected"),this._offsetMarker(a,-4)):(L.DomUtil.addClass(a,"leaflet-edit-marker-selected"),this._offsetMarker(a,4));a.style.display=""}},_offsetMarker:function(a,
b){var c=parseInt(a.style.marginTop,10)-b,e=parseInt(a.style.marginLeft,10)-b;a.style.marginTop=c+"px";a.style.marginLeft=e+"px"}});L.Marker.addInitHook(function(){L.Edit.Marker&&(this.editing=new L.Edit.Marker(this),this.options.editable&&this.editing.enable())});L.Edit=L.Edit||{};L.Edit.Poly=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon"})},initialize:function(a,b){this._poly=a;L.setOptions(this,b)},addHooks:function(){var a=
this._poly;a.setStyle(a.options.editing);this._poly._map&&(this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){var a=this._poly;a.setStyle(a.options.original);a._map&&(a._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers();this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup);this._markers=[];var a=this._poly._latlngs,
b,c,e;b=0;for(c=a.length;b<c;b++)e=this._createMarker(a[b],b),e.on("click",this._onMarkerClick,this),this._markers.push(e);b=0;for(a=c-1;b<c;a=b++)if(0!==b||L.Polygon&&this._poly instanceof L.Polygon)a=this._markers[a],e=this._markers[b],"wall"===this._poly.options.layerType&&this._createMiddleMarker(a,e),this._updatePrevNext(a,e)},_createMarker:function(a,b){var c=new L.Marker(a,{draggable:!0,icon:this.options.icon});c._origLatLng=a;c._index=b;c.on("drag",this._onMarkerDrag,this);c.on("dragend",
this._fireEdit,this);this._markerGroup.addLayer(c);return c},_removeMarker:function(a){var b=a._index;this._markerGroup.removeLayer(a);this._markers.splice(b,1);this._poly.spliceLatLngs(b,1);this._updateIndexes(b,-1);a.off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("click",this._onMarkerClick,this)},_fireEdit:function(){this._poly.edited=!0;this._poly.fire("edit");this._poly._map.fire("edit",{layer:this._poly})},_onMarkerDrag:function(a){var b=a.target;L.DomEvent.preventDefault(a);
L.extend(b._origLatLng,b._latlng);b._middleLeft&&b._middleLeft.setLatLng(this._getMiddleLatLng(b._prev,b));b._middleRight&&b._middleRight.setLatLng(this._getMiddleLatLng(b,b._next));this._poly.redraw()},_onMarkerClick:function(a){a=a.target;this._poly._latlngs.length<(L.Polygon&&this._poly instanceof L.Polygon?4:3)||(this._removeMarker(a),this._updatePrevNext(a._prev,a._next),a._middleLeft&&this._markerGroup.removeLayer(a._middleLeft),a._middleRight&&this._markerGroup.removeLayer(a._middleRight),
a._prev&&a._next?this._createMiddleMarker(a._prev,a._next):a._prev?a._next||(a._prev._middleRight=null):a._next._middleLeft=null,this._fireEdit())},_updateIndexes:function(a,b){this._markerGroup.eachLayer(function(c){c._index>a&&(c._index+=b)})},_createMiddleMarker:function(a,b){var c=this._getMiddleLatLng(a,b),e=this._createMarker(c),d,f,g;e.setOpacity(0.6);a._middleRight=b._middleLeft=e;f=function(){var h=b._index;e._index=h;e.off("click",d,this).on("click",this._onMarkerClick,this);c.lat=e.getLatLng().lat;
c.lng=e.getLatLng().lng;this._poly.spliceLatLngs(h,0,c);this._markers.splice(h,0,e);e.setOpacity(1);this._updateIndexes(h,1);b._index++;this._updatePrevNext(a,e);this._updatePrevNext(e,b);this._poly.fire("editstart")};g=function(){e.off("dragstart",f,this);e.off("dragend",g,this);this._createMiddleMarker(a,e);this._createMiddleMarker(e,b)};d=function(){f.call(this);g.call(this);this._fireEdit()};e.on("click",d,this).on("dragstart",f,this).on("dragend",g,this);this._markerGroup.addLayer(e)},_updatePrevNext:function(a,
b){a&&(a._next=b);b&&(b._prev=a)},_getMiddleLatLng:function(a,b){var c=this._poly._map,e=c.project(a.getLatLng()),d=c.project(b.getLatLng());return c.unproject(e._add(d)._divideBy(2))}});L.Polyline.addInitHook(function(){this.editing||(L.Edit.Poly&&(this.editing=new L.Edit.Poly(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))});
L.Edit=L.Edit||{};L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"})},initialize:function(a,b){this._shape=a;L.Util.setOptions(this,b)},addHooks:function(){var a=this._shape;a.setStyle(a.options.editing);a._map&&(this._map=a._map,this._markerGroup||this._initMarkers(),
this._map.addLayer(this._markerGroup))},removeHooks:function(){var a=this._shape;a.setStyle(a.options.original);if(a._map){this._unbindMarker(this._moveMarker);for(var a=0,b=this._resizeMarkers.length;a<b;a++)this._unbindMarker(this._resizeMarkers[a]);this._resizeMarkers=null;this._map.removeLayer(this._markerGroup);delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers();this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup);
this._createMoveMarker();this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(a,b){var c=new L.Marker(a,{draggable:!0,icon:b,zIndexOffset:10});this._bindMarker(c);this._markerGroup.addLayer(c);return c},_bindMarker:function(a){a.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this)},_unbindMarker:function(a){a.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,
this).off("dragend",this._onMarkerDragEnd,this)},_onMarkerDragStart:function(a){a.target.setOpacity(0);this._shape.fire("editstart")},_fireEdit:function(){this._shape.edited=!0;this._shape.fire("edit");this._shape._map.fire("edit",{layer:this._shape})},_onMarkerDrag:function(a){a=a.target;var b=a.getLatLng();a===this._moveMarker?this._move(b):this._resize(b);this._shape.redraw()},_onMarkerDragEnd:function(a){a.target.setOpacity(1);this._fireEdit()},_move:function(){},_resize:function(){}});L.Edit=
L.Edit||{};L.Edit.Rectangle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var a=this._shape.getBounds().getCenter();this._moveMarker=this._createMarker(a,this.options.moveIcon)},_createResizeMarker:function(){var a=this._getCorners();this._resizeMarkers=[];for(var b=0,c=a.length;b<c;b++)this._resizeMarkers.push(this._createMarker(a[b],this.options.resizeIcon)),this._resizeMarkers[b]._cornerIndex=b},_onMarkerDragStart:function(a){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,
a);var b=this._getCorners();a=a.target._cornerIndex;this._oppositeCorner=b[(a+2)%4];this._toggleCornerMarkers(0,a)},_onMarkerDragEnd:function(a){var b=a.target,c;b===this._moveMarker&&(c=this._shape.getBounds(),c=c.getCenter(),b.setLatLng(c));this._toggleCornerMarkers(1);this._repositionCornerMarkers();L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,a)},_move:function(a){for(var b=this._shape.getLatLngs(),c=this._shape.getBounds().getCenter(),e,d=[],f=0,g=b.length;f<g;f++)e=[b[f].lat-c.lat,
b[f].lng-c.lng],d.push([a.lat+e[0],a.lng+e[1]]);this._shape.setLatLngs(d);this._repositionCornerMarkers()},_resize:function(a){this._shape.setBounds(L.latLngBounds(a,this._oppositeCorner));a=this._shape.getBounds();this._moveMarker.setLatLng(a.getCenter())},_getCorners:function(){var a=this._shape.getBounds(),b=a.getNorthWest(),c=a.getNorthEast(),e=a.getSouthEast(),a=a.getSouthWest();return[b,c,e,a]},_toggleCornerMarkers:function(a){for(var b=0,c=this._resizeMarkers.length;b<c;b++)this._resizeMarkers[b].setOpacity(a)},
_repositionCornerMarkers:function(){for(var a=this._getCorners(),b=0,c=this._resizeMarkers.length;b<c;b++)this._resizeMarkers[b].setLatLng(a[b])}});L.Rectangle.addInitHook(function(){L.Edit.Rectangle&&(this.editing=new L.Edit.Rectangle(this),this.options.editable&&this.editing.enable())});L.Edit=L.Edit||{};L.Edit.Circle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var a=this._shape.getLatLng();this._moveMarker=this._createMarker(a,this.options.moveIcon)},_createResizeMarker:function(){var a=
this._shape.getLatLng(),a=this._getResizeMarkerPoint(a);this._resizeMarkers=[];this._resizeMarkers.push(this._createMarker(a,this.options.resizeIcon))},_getResizeMarkerPoint:function(a){var b=this._shape._radius*Math.cos(Math.PI/4);a=this._map.project(a);return this._map.unproject([a.x+b,a.y-b])},_move:function(a){var b=this._getResizeMarkerPoint(a);this._resizeMarkers[0].setLatLng(b);this._shape.setLatLng(a)},_resize:function(a){a=this._moveMarker.getLatLng().distanceTo(a);this._shape.setRadius(a)}});
L.Circle.addInitHook(function(){L.Edit.Circle&&(this.editing=new L.Edit.Circle(this),this.options.editable&&this.editing.enable());this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()});this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()})});L.LatLngUtil={cloneLatLngs:function(a){for(var b=[],c=0,e=a.length;c<e;c++)b.push(this.cloneLatLng(a[c]));return b},cloneLatLng:function(a){return L.latLng(a.lat,a.lng)}};L.GeometryUtil=
L.extend(L.GeometryUtil||{},{geodesicArea:function(a){var b=a.length,c=0,e=L.LatLng.DEG_TO_RAD,d,f;if(2<b){for(var g=0;g<b;g++)d=a[g],f=a[(g+1)%b],c+=(f.lng-d.lng)*e*(2+Math.sin(d.lat*e)+Math.sin(f.lat*e));c=40680631590769*c/2}return Math.abs(c)},readableArea:function(a,b){var c;b?c=1E4<=a?(1E-4*a).toFixed(2)+" ha":a.toFixed(2)+" m&sup2;":(a/=0.836127,c=3097600<=a?(a/3097600).toFixed(2)+" mi&sup2;":4840<=a?(a/4840).toFixed(2)+" acres":Math.ceil(a)+" yd&sup2;");return c},distance:function(a,b,c){return a.latLngToLayerPoint(b).distanceTo(a.latLngToLayerPoint(c))},
distanceSegment:function(a,b,c,e){b=a.latLngToLayerPoint(b);c=a.latLngToLayerPoint(c);a=a.latLngToLayerPoint(e);return L.LineUtil.pointToSegmentDistance(b,c,a)},readableDistance:function(a,b){var c;"imperial"!==b?c=1E3<a?(a/1E3).toFixed(2)+" km":Math.round(100*a)/100+" m":(a*=1.09361,c=1760<a?(a/1760).toFixed(2)+" miles":Math.round(100*a)/100+" yd");return c},belongsSegment:function(a,b,c,e){e=e===t?0.2:e;var d=b.distanceTo(c);return(b.distanceTo(a)+a.distanceTo(c)-d)/d<e},length:function(a){a=L.GeometryUtil.accumulatedLengths(a);
return 0<a.length?a[a.length-1]:0},accumulatedLengths:function(a){"function"===typeof a.getLatLngs&&(a=a.getLatLngs());if(0===a.length)return[];for(var b=0,c=[0],e=0,d=a.length-1;e<d;e++)b+=a[e].distanceTo(a[e+1]),c.push(b);return c},closestOnSegment:function(a,b,c,e){var d=a.getMaxZoom();Infinity===d&&(d=a.getZoom());b=a.project(b,d);c=a.project(c,d);e=a.project(e,d);e=L.LineUtil.closestPointOnSegment(b,c,e);return a.unproject(e,d)},closest:function(a,b,c,e){"function"!==typeof b.getLatLngs&&(b=
L.polyline(b));var d=b.getLatLngs().slice(0),f=Infinity,g,h=null,n=Infinity;if(e){b=0;for(e=d.length;b<e;b++)g=d[b],n=L.GeometryUtil.distance(a,c,g),n<f&&(f=n,h=g);return h?{latlng:h,distance:n}:null}b instanceof L.Polygon&&d.push(d[0]);b=0;for(e=d.length;b<e-1;b++){g=d[b];var l=d[b+1],n=L.GeometryUtil.distanceSegment(a,c,g,l);n<=f&&(f=n,h=L.GeometryUtil.closestOnSegment(a,c,g,l))}return h?{latlng:h,distance:f}:null},closestLayer:function(a,b,c){for(var e=Infinity,d=null,f=null,g=Infinity,h=0,n=b.length;h<
n;h++){var l=b[h];if("function"===typeof l.getLatLng)f=l.getLatLng(),g=L.GeometryUtil.distance(a,c,f);else if(f=L.GeometryUtil.closest(a,l,c))g=f.distance;g<e&&(e=g,d={layer:l,latlng:f.latlng,distance:g})}return d},closestLayerSnap:function(a,b,c,e,d){e="number"===typeof e?e:Infinity;d="boolean"===typeof d?d:!0;b=L.GeometryUtil.closestLayer(a,b,c);if(!b||b.distance>e)return null;d&&"function"===typeof b.layer.getLatLngs&&(d=L.GeometryUtil.closest(a,b.layer,b.latlng,!0),d.distance<e&&(b.latlng=d.latlng,
b.distance=L.GeometryUtil.distance(a,d.latlng,c)));return b},interpolateOnPointSegment:function(a,b,c){return L.point(a.x*(1-c)+c*b.x,a.y*(1-c)+c*b.y)},interpolateOnLine:function(a,b,c){b=b instanceof L.Polyline?b.getLatLngs():b;var e=b.length;if(2>e)return null;if(0===c)return{latLng:b[0]instanceof L.LatLng?b[0]:L.latLng(b[0]),predecessor:-1};if(1===c)return{latLng:b[b.length-1]instanceof L.LatLng?b[b.length-1]:L.latLng(b[b.length-1]),predecessor:b.length-2};c=Math.max(Math.min(c,1),0);var d=a.getMaxZoom();
Infinity===d&&(d=a.getZoom());for(var f=[],g=0,h=0;h<e;h++)f[h]=a.project(b[h],d),0<h&&(g+=f[h-1].distanceTo(f[h]));c*=g;var g=f[0],h=f[1],n=0,l=g.distanceTo(h);for(b=1;b<e&&l<c;b++)g=h,n=l,h=f[b],l+=g.distanceTo(h);e=L.GeometryUtil.interpolateOnPointSegment(g,h,0!==l-n?(c-n)/(l-n):0);return{latLng:a.unproject(e,d),predecessor:b-2}},locateOnLine:function(a,b,c){var e=b.getLatLngs();if(c.equals(e[0]))return 0;if(c.equals(e[e.length-1]))return 1;a=L.GeometryUtil.closest(a,b,c,!1);for(var d=L.GeometryUtil.accumulatedLengths(e),
f=d[d.length-1],g=0,h=!1,n=0,l=e.length-1;n<l;n++){var q=e[n],v=e[n+1],g=d[n];if(L.GeometryUtil.belongsSegment(a,q,v)){g+=q.distanceTo(a);h=!0;break}}if(!h)throw"Could not interpolate "+c.toString()+" within "+b.toString();return g/f},reverse:function(a){return L.polyline(a.getLatLngs().slice(0).reverse())},extract:function(a,b,c,e){if(c>e)return L.GeometryUtil.extract(a,L.GeometryUtil.reverse(b),1-c,1-e);c=Math.max(Math.min(c,1),0);e=Math.max(Math.min(e,1),0);var d=b.getLatLngs(),f=L.GeometryUtil.interpolateOnLine(a,
b,c),g=L.GeometryUtil.interpolateOnLine(a,b,e);if(c===e)return[L.GeometryUtil.interpolateOnLine(a,b,e).latLng];-1===f.predecessor&&(f.predecessor=0);-1===g.predecessor&&(g.predecessor=0);a=d.slice(f.predecessor+1,g.predecessor+1);a.unshift(f.latLng);a.push(g.latLng);return a},isBefore:function(a,b){if(!b)return!1;var c=a.getLatLngs(),e=b.getLatLngs();return c[c.length-1].equals(e[0])},isAfter:function(a,b){if(!b)return!1;var c=a.getLatLngs(),e=b.getLatLngs();return c[0].equals(e[e.length-1])},startsAtExtremity:function(a,
b){if(!b)return!1;var c=a.getLatLngs(),e=b.getLatLngs(),c=c[0];return c.equals(e[0])||c.equals(e[e.length-1])},computeAngle:function(a,b){return 180*Math.atan2(b.y-a.y,b.x-a.x)/Math.PI},computeSlope:function(a,b){var c=(b.y-a.y)/(b.x-a.x);return{a:c,b:a.y-c*a.x}},rotatePoint:function(a,b,c,e){var d=a.getMaxZoom();Infinity===d&&(d=a.getZoom());c=c*Math.PI/180;b=a.project(b,d);var f=a.project(e,d);e=Math.cos(c)*(b.x-f.x)-Math.sin(c)*(b.y-f.y)+f.x;c=Math.sin(c)*(b.x-f.x)+Math.cos(c)*(b.y-f.y)+f.y;return a.unproject(new L.Point(e,
c),d)}});L.Util.extend(L.LineUtil,{segmentsIntersect:function(a,b,c,e){return this._checkCounterclockwise(a,c,e)!==this._checkCounterclockwise(b,c,e)&&this._checkCounterclockwise(a,b,c)!==this._checkCounterclockwise(a,b,e)},_checkCounterclockwise:function(a,b,c){return(c.y-a.y)*(b.x-a.x)>(b.y-a.y)*(c.x-a.x)}});L.Polyline.include({intersects:function(){var a=this._originalPoints,b=a?a.length:0,c,e;if(this._tooFewPointsForIntersection())return!1;for(b-=1;3<=b;b--)if(c=a[b-1],e=a[b],this._lineSegmentsIntersectsRange(c,
e,b-2))return!0;return!1},newLatLngIntersects:function(a,b){return this._map?this.newPointIntersects(this._map.latLngToLayerPoint(a),b):!1},newPointIntersects:function(a,b){var c=this._originalPoints,e=c?c.length:0,c=c?c[e-1]:null,e=e-2;return this._tooFewPointsForIntersection(1)?!1:this._lineSegmentsIntersectsRange(c,a,e,b?1:0)},_tooFewPointsForIntersection:function(a){var b=this._originalPoints,b=b?b.length:0;return!this._originalPoints||3>=b+(a||0)},_lineSegmentsIntersectsRange:function(a,b,c,
e){var d=this._originalPoints,f;e=e||0;for(var g=c;g>e;g--)if(c=d[g-1],f=d[g],L.LineUtil.segmentsIntersect(a,b,c,f))return!0;return!1},isConvex:function(){var a=this._originalPoints,b=a?a.length:0,c,e,d;if(3>b)return!1;for(var f=0,g=0;f<b-1;f++)for(var h=0;h<b-2;h++)if(c=a[f%b],e=a[(f+h+1)%b],d=a[(f+h+2)%b],0===g&&(g=(d.y-c.y)*(e.x-c.x)-(e.y-c.y)*(d.x-c.x)),0>g*((d.y-c.y)*(e.x-c.x)-(e.y-c.y)*(d.x-c.x)))return!1;return 0!==g?!0:!1}});L.Polygon.include({intersects:function(){var a=this._originalPoints,
b;if(this._tooFewPointsForIntersection())return!1;if(L.Polyline.prototype.intersects.call(this))return!0;b=a.length;return this._lineSegmentsIntersectsRange(a[b-1],a[0],b-2,1)}});L.GeometryUtil=L.extend(L.GeometryUtil||{},{closestGridSnap:function(a,b,c,e){if(c===t||1E-11>c)return null;e="number"===typeof e?e:Infinity;var d=Math.cos(b.lat*Math.PI/180),f=6378137*Math.PI,d=180*c/(f*d),g=180*c/f,f=Math.round((b.lat-Math.round(b.lat))/d)*d+Math.round(b.lat),d=Math.round(b.lng/g)*g,g={};g.latlng=new L.LatLng(f,
d);g.distance=a.latLngToLayerPoint(b).distanceTo(a.latLngToLayerPoint(g.latlng));g.GridStep=c;return!g||g.distance>e?null:g}});L.Control.Draw=L.Control.extend({options:{position:"topleft",draw:{},edit:!1},initialize:function(a){if("0.7">L.version)throw Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");L.Control.prototype.initialize.call(this,a);this._toolbars={};L.DrawToolbar&&this.options.draw&&(a=new L.DrawToolbar(this.options.draw),this._toolbars[L.DrawToolbar.TYPE]=
a,this._toolbars[L.DrawToolbar.TYPE].on("enable",this._toolbarEnabled,this));L.EditToolbar&&this.options.edit&&(a=new L.EditToolbar(this.options.edit),this._toolbars[L.EditToolbar.TYPE]=a,this._toolbars[L.EditToolbar.TYPE].on("enable",this._toolbarEnabled,this))},onAdd:function(a){var b=L.DomUtil.create("div","leaflet-draw"),c=!1,e,d;for(d in this._toolbars)this._toolbars.hasOwnProperty(d)&&(e=this._toolbars[d].addToolbar(a))&&(c||(L.DomUtil.hasClass(e,"leaflet-draw-toolbar-top")||L.DomUtil.addClass(e.childNodes[0],
"leaflet-draw-toolbar-top"),c=!0),b.appendChild(e));return b},onRemove:function(){for(var a in this._toolbars)this._toolbars.hasOwnProperty(a)&&this._toolbars[a].removeToolbar()},setDrawingOptions:function(a){for(var b in this._toolbars)this._toolbars[b]instanceof L.DrawToolbar&&this._toolbars[b].setOptions(a)},_toolbarEnabled:function(a){a=a.target;for(var b in this._toolbars)this._toolbars[b]!==a&&this._toolbars[b].disable()}});L.Map.mergeOptions({drawControlTooltips:!0,drawControl:!1});L.Map.addInitHook(function(){this.options.drawControl&&
(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))});L.Toolbar=L.Class.extend({includes:[L.Mixin.Events],initialize:function(a){L.setOptions(this,a);this._modes={};this._actionButtons=[];this._activeMode=null},enabled:function(){return null!==this._activeMode},disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(a){var b=L.DomUtil.create("div","leaflet-draw-section"),c=0,e=this._toolbarClass||"",d=this.getModeHandlers(a);this._toolbarContainer=
L.DomUtil.create("div","leaflet-draw-toolbar leaflet-bar");this._map=a;for(a=0;a<d.length;a++)d[a].enabled&&this._initModeHandler(d[a].handler,this._toolbarContainer,c++,e,d[a].title);if(c)return this._lastButtonIndex=--c,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),b.appendChild(this._toolbarContainer),b.appendChild(this._actionsContainer),b},removeToolbar:function(){for(var a in this._modes)this._modes.hasOwnProperty(a)&&(this._disposeButton(this._modes[a].button,this._modes[a].handler.enable,
this._modes[a].handler),this._modes[a].handler.disable(),this._modes[a].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};a=0;for(var b=this._actionButtons.length;a<b;a++)this._disposeButton(this._actionButtons[a].button,this._actionButtons[a].callback,this);this._actionButtons=[];this._actionsContainer=null},_initModeHandler:function(a,b,c,e,d){var f=a.type;this._modes[f]={};this._modes[f].handler=a;this._modes[f].button=this._createButton({title:d,
className:e+"-"+f,container:b,callback:this._modes[f].handler.enable,context:this._modes[f].handler});this._modes[f].buttonIndex=c;this._modes[f].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_createButton:function(a){var b=L.DomUtil.create("a",a.className||"",a.container);b.href="#";a.text&&(b.innerHTML=a.text);a.title&&(b.title=a.title);L.DomEvent.on(b,"click",L.DomEvent.stopPropagation).on(b,"mousedown",L.DomEvent.stopPropagation).on(b,"dblclick",
L.DomEvent.stopPropagation).on(b,"click",L.DomEvent.preventDefault).on(b,"click",a.callback,a.context);return b},_disposeButton:function(a,b){L.DomEvent.off(a,"click",L.DomEvent.stopPropagation).off(a,"mousedown",L.DomEvent.stopPropagation).off(a,"dblclick",L.DomEvent.stopPropagation).off(a,"click",L.DomEvent.preventDefault).off(a,"click",b)},_handlerActivated:function(a){this.disable();this._activeMode=this._modes[a.handler];L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled");
this._showActionsToolbar();this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar();L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled");this._activeMode=null;this.fire("disable")},_createActions:function(a){var b=this._actionsContainer;a=this.getActions(a);var c=a.length,e,d;d=0;for(e=this._actionButtons.length;d<e;d++)this._disposeButton(this._actionButtons[d].button,this._actionButtons[d].callback);for(this._actionButtons=[];b.firstChild;)b.removeChild(b.firstChild);
for(d=0;d<c;d++)"enabled"in a[d]&&!a[d].enabled||(e=L.DomUtil.create("li","",b),e=this._createButton({title:a[d].title,text:a[d].text,container:e,callback:a[d].callback,context:a[d].context}),this._actionButtons.push({button:e,callback:a[d].callback}))},_showActionsToolbar:function(){var a=this._activeMode.buttonIndex,b=this._lastButtonIndex,c=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler);this._actionsContainer.style.top=c+"px";0===a&&(L.DomUtil.addClass(this._toolbarContainer,
"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top"));a===b&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom"));this._actionsContainer.style.display="block"},_hideActionsToolbar:function(){this._actionsContainer.style.display="none";L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop");L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom");
L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top");L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom")}});L.Tooltip=L.Class.extend({initialize:function(a){this._map=a;this._popupPane=a._panes.popupPane;this._container=a.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null;this._singleLineLabel=!1},dispose:function(){this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(a){if(!this._container)return this;
a.subtext=a.subtext||"";0!==a.subtext.length||this._singleLineLabel?0<a.subtext.length&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0);this._container.innerHTML=(0<a.subtext.length?'<span class="leaflet-draw-tooltip-subtext">'+a.subtext+"</span><br />":"")+"<span>"+a.text+"</span>";return this},updatePosition:function(a){a=this._map.latLngToLayerPoint(a);
var b=this._container;this._container&&(b.style.visibility="inherit",L.DomUtil.setPosition(b,a));return this},showAsError:function(){this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip");return this},removeError:function(){this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip");return this}});L.DrawToolbar=L.Toolbar.extend({statics:{TYPE:"draw"},options:{wall:{},window:{},door:{},rectangle:{}},initialize:function(a){for(var b in this.options)this.options.hasOwnProperty(b)&&
a[b]&&(a[b]=L.extend({},this.options[b],a[b]));this._toolbarClass="leaflet-draw-draw";L.Toolbar.prototype.initialize.call(this,a)},getModeHandlers:function(a){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(a,this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(a,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.circle,handler:new L.Draw.Circle(a,this.options.circle),
title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(a,this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker},{enabled:this.options.wall,handler:new L.Draw.Wall(a,this.options.wall),title:L.drawLocal.draw.toolbar.buttons.wall},{enabled:this.options.window,handler:new L.Draw.Window(a,this.options.window),title:L.drawLocal.draw.toolbar.buttons.window},{enabled:this.options.door,handler:new L.Draw.Door(a,this.options.door),title:L.drawLocal.draw.toolbar.buttons.door},
{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(a,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle}]},getActions:function(){return[{title:L.drawLocal.draw.toolbar.actions.title,text:L.drawLocal.draw.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(a){L.setOptions(this,a);for(var b in this._modes)this._modes.hasOwnProperty(b)&&a.hasOwnProperty(b)&&this._modes[b].handler.setOptions(a[b])}});L.EditToolbar=L.Toolbar.extend({statics:{TYPE:"edit"},
options:{edit:{selectedPathOptions:{color:"#fe57a1",opacity:0.6,dashArray:"10, 10",fill:!1,fillColor:"#fe57a1",fillOpacity:0.1,maintainColor:!1}},remove:{},featureGroup:null},initialize:function(a){a.edit&&("undefined"===typeof a.edit.selectedPathOptions&&(a.edit.selectedPathOptions=this.options.edit.selectedPathOptions),a.edit.selectedPathOptions=L.extend({},this.options.edit.selectedPathOptions,a.edit.selectedPathOptions));a.remove&&(a.remove=L.extend({},this.options.remove,a.remove));this._toolbarClass=
"leaflet-draw-edit";L.Toolbar.prototype.initialize.call(this,a);this._selectedFeatureCount=0},getModeHandlers:function(a){var b=this.options.featureGroup;return[{enabled:this.options.edit,handler:new L.EditToolbar.Edit(a,{featureGroup:b,selectedPathOptions:this.options.edit.selectedPathOptions}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:this.options.remove,handler:new L.EditToolbar.Delete(a,{featureGroup:b}),title:L.drawLocal.edit.toolbar.buttons.remove}]},getActions:function(){return[{title:L.drawLocal.edit.toolbar.actions.save.title,
text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,callback:this.disable,context:this}]},addToolbar:function(a){a=L.Toolbar.prototype.addToolbar.call(this,a);this._checkDisabled();this.options.featureGroup.on("layeradd layerremove",this._checkDisabled,this);return a},removeToolbar:function(){this.options.featureGroup.off("layeradd layerremove",this._checkDisabled,this);
L.Toolbar.prototype.removeToolbar.call(this)},disable:function(){this.enabled()&&(this._activeMode.handler.revertLayers(),L.Toolbar.prototype.disable.call(this))},_save:function(){this._activeMode.handler.save();this._activeMode.handler.disable()},_checkDisabled:function(){var a=0!==this.options.featureGroup.getLayers().length,b;this.options.edit&&(b=this._modes[L.EditToolbar.Edit.TYPE].button,a?L.DomUtil.removeClass(b,"leaflet-disabled"):L.DomUtil.addClass(b,"leaflet-disabled"),b.setAttribute("title",
a?L.drawLocal.edit.toolbar.buttons.edit:L.drawLocal.edit.toolbar.buttons.editDisabled));this.options.remove&&(b=this._modes[L.EditToolbar.Delete.TYPE].button,a?L.DomUtil.removeClass(b,"leaflet-disabled"):L.DomUtil.addClass(b,"leaflet-disabled"),b.setAttribute("title",a?L.drawLocal.edit.toolbar.buttons.remove:L.drawLocal.edit.toolbar.buttons.removeDisabled))}});L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},includes:L.Mixin.Events,initialize:function(a,b){L.Handler.prototype.initialize.call(this,
a);L.setOptions(this,b);this._featureGroup=b.featureGroup;if(!(this._featureGroup instanceof L.FeatureGroup))throw Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={};this.type=L.EditToolbar.Edit.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:editstart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",
this._disableLayerEdit,this),this._map.fire("draw:editstart_after",{handler:this.type}))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),L.Handler.prototype.disable.call(this),this._map.fire("draw:editstop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var a=this._map;a&&(a.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._map.dragging&&
this._map.dragging.disable())},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._map.dragging&&this._map.dragging.enable())},revertLayers:function(){this._featureGroup.eachLayer(function(a){this._revertLayer(a)},this)},save:function(){var a=new L.LayerGroup;this._featureGroup.eachLayer(function(b){b.edited&&(a.addLayer(b),b.edited=!1)});this._map.fire("draw:edited",{layers:a})},_backupLayer:function(a){var b=L.Util.stamp(a);
this._uneditedLayerProps[b]||(a instanceof L.Polyline||a instanceof L.Polygon||a instanceof L.Rectangle?this._uneditedLayerProps[b]={latlngs:L.LatLngUtil.cloneLatLngs(a.getLatLngs())}:a instanceof L.Circle?this._uneditedLayerProps[b]={latlng:L.LatLngUtil.cloneLatLng(a.getLatLng()),radius:a.getRadius()}:a instanceof L.Marker&&(this._uneditedLayerProps[b]={latlng:L.LatLngUtil.cloneLatLng(a.getLatLng())}))},_revertLayer:function(a){var b=L.Util.stamp(a);a.edited=!1;this._uneditedLayerProps.hasOwnProperty(b)&&
(a instanceof L.Polyline||a instanceof L.Polygon||a instanceof L.Rectangle?a.setLatLngs(this._uneditedLayerProps[b].latlngs):a instanceof L.Circle?(a.setLatLng(this._uneditedLayerProps[b].latlng),a.setRadius(this._uneditedLayerProps[b].radius)):a instanceof L.Marker&&a.setLatLng(this._uneditedLayerProps[b].latlng),a.fire("revert-edited",{layer:a}),a._map&&a._map.fire("revert-edited",{layer:a}))},_enableLayerEdit:function(a){a=a.layer||a.target||a;var b;if(!a.editing)return!1;this._backupLayer(a);
this.options.selectedPathOptions&&(b=L.Util.extend({},this.options.selectedPathOptions),b.maintainColor&&(b.color=a.options.color,b.fillColor=a.options.fillColor),a.options.original=L.extend({},a.options),a.options.editing=b);a.editing.enable()},_disableLayerEdit:function(a){a=a.layer||a.target||a;if(!a.editing)return!1;a.edited=!1;a.editing.disable();delete a.options.editing;delete a.options.original},_hasAvailableLayers:function(){return 0!==this._featureGroup.getLayers().length}});L.EditToolbar.Delete=
L.Handler.extend({statics:{TYPE:"remove"},options:{icon:new L.DivIcon({iconSize:new L.Point(26,26),className:"leaflet-div-icon leaflet-delete-icon"})},includes:L.Mixin.Events,initialize:function(a,b){L.Handler.prototype.initialize.call(this,a);L.Util.setOptions(this,b);this._deletableLayers=this.options.featureGroup;if(!(this._deletableLayers instanceof L.FeatureGroup))throw Error("options.featureGroup must be a L.FeatureGroup");this.type=L.EditToolbar.Delete.TYPE},enable:function(){!this._enabled&&
this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:deletestart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disable:function(){this._enabled&&(this._deletableLayers.off("layeradd",this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this),L.Handler.prototype.disable.call(this),this._map.fire("draw:deletestop",
{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var a=this._map;a&&(a.getContainer().focus(),this._deletableLayers.eachLayer(this._enableLayerDelete,this),this._deletedLayers=new L.LayerGroup,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup))},removeHooks:function(){this._map&&(this._deletableLayers.eachLayer(this._disableLayerDelete,this),this._deletedLayers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},
revertLayers:function(){this._deletedLayers.eachLayer(function(a){this._deletableLayers.addLayer(a);a.fire("revert-deleted",{layer:a});this._map.fire("revert-edited",{layer:a})},this)},save:function(){this._map.fire("draw:deleted",{layers:this._deletedLayers})},_enableLayerDelete:function(a){(a.layer||a.target||a).on("click",this._removeLayer,this)},_disableLayerDelete:function(a){a=a.layer||a.target||a;a.off("click",this._removeLayer,this);this._deletedLayers.removeLayer(a)},_removeLayer:function(a){a=
a.layer||a.target||a;this._deletableLayers.removeLayer(a);this._deletedLayers.addLayer(a);a.fire("deleted")},_hasAvailableLayers:function(){return 0!==this._deletableLayers.getLayers().length},_initMarkers:function(){var a=this;this._markerGroup||(this._markerGroup=new L.LayerGroup);this._markers=[];var b,c,e,d;this._deletableLayers.eachLayer(function(f){if(f.editing._poly!==t||f.editing._shape!==t)if(f.editing._poly&&(d=f.editing._poly._latlngs),f.editing._shape&&(d=f.editing._shape._latlngs),d&&
!(2>d.length)){b=d[0];c=new L.LatLng(b.lat,b.lng);var g=new L.Marker(c,{draggable:!1,icon:a.options.icon});g.setOpacity(0.6);g._origLatLng=c;e=function(){a._removeLayer({layer:f});g.setOpacity(1)};g.on("click",e);a._markerGroup.addLayer(g)}})}});L.Handler.MarkerSnap=L.Handler.extend({options:{snapType:"undefined",gridStep:0.1,snapDistance:6,snapToGrid:!0,snapToObjects:!0,snapVertices:!0},initialize:function(a,b,c){function e(){this._buffer=a.layerPointToLatLng(new L.Point(0,0)).lat-a.layerPointToLatLng(new L.Point(this.options.snapDistance,
0)).lat}L.Handler.prototype.initialize.call(this,a);this._markers=[];this._guides=[];2!==arguments.length||b instanceof L.Class||(c=b,b=null);L.Util.setOptions(this,c||{});b&&(b.dragging||(b.dragging=new L.Handler.MarkerDrag(b)),b.dragging.enable(),this.watchMarker(b));a.on("zoomend",e,this);a.whenReady(e,this);e.call(this)},enable:function(){this.disable();for(var a=0;a<this._markers.length;a++)this.watchMarker(this._markers[a])},disable:function(){for(var a=0;a<this._markers.length;a++)this.unwatchMarker(this._markers[a])},
watchMarker:function(a){-1===this._markers.indexOf(a)&&this._markers.push(a);a.on("move",this._snapMarker,this)},unwatchMarker:function(a){a.off("move",this._snapMarker,this);delete a.snap},addGuideLayer:function(a){for(var b=0,c=this._guides.length;b<c&&L.stamp(a)!==L.stamp(this._guides[b]);b++);this._guides.push(a);return this._guides},addGuideLayersFromGroup:function(a){a.eachLayer(this.addGuideLayer,this);return this._guides},removeGuideLayer:function(a){for(var b=0,c=this._guides.length;b<c;b++)if(L.stamp(a)===
L.stamp(this._guides[b])){this._guides.splice(b,1);break}return this._guides},_snapMarker:function(a){function b(a){if(a._layers!==t&&"function"!==typeof a.searchBuffer)for(var d in a._layers)b(a._layers[d]);else"function"===typeof a.searchBuffer?e=e.concat(a.searchBuffer(c,this._buffer)):e.push(a)}a=a.target;var c=a.getLatLng(),e=[],d=null;if(this.options.snapToGrid&&(d=this._findClosestGridSnap(this._map,c,this.options.gridStep,this.options.snapDistance),null!==d)){this._updateSnap(a,a,d.latlng);
return}if(this.options.snapToObjects){for(var d=0,f=this._guides.length;d<f;d++){var g=this._guides[d];g.snapediting!==t&&a._leaflet_id in g.snapediting._markerGroup._layers||b.call(this,g)}d=this._findClosestLayerSnap(this._map,e,c,this.options.snapDistance,this.options.snapVertices)}d=d||{layer:null,latlng:null};this._updateSnap(a,d.layer,d.latlng)},_findClosestLayerSnap:function(a,b,c,e,d){return L.GeometryUtil.closestLayerSnap(a,b,c,e,d)},_findClosestGridSnap:function(a,b,c,e){return L.GeometryUtil.closestGridSnap(a,
b,c,e)},_updateSnap:function(a,b,c){b&&c?(a._latlng=L.latLng(c),a.update(),a.snap!==b&&(a.snap=b,a._icon&&L.DomUtil.addClass(a._icon,"marker-snapped"),a.fire("snap",{layer:b,latlng:c}))):(a.snap&&(a._icon&&L.DomUtil.removeClass(a._icon,"marker-snapped"),a.fire("unsnap",{layer:a.snap})),delete a.snap)}});L.Handler.PolylineSnap=L.Edit.Poly.extend({initialize:function(a,b,c){var e=this;L.Edit.Poly.prototype.initialize.call(this,b,c);this._snapper=new L.Handler.MarkerSnap(a,c);b.on("remove",function(){e._snapper.disable()})},
addGuideLayer:function(a){this._snapper.addGuideLayer(a);return this._snapper._guides},addGuideLayersFromGroup:function(a){a.eachLayer(this.addGuideLayer,this);return this._snapper._guides},removeGuideLayer:function(a){this._snapper.removeGuideLayer(a);return this._snapper._guides},_createMarker:function(a,b){var c=L.Edit.Poly.prototype._createMarker.call(this,a,b);if(b===t)c.on("dragstart",function(){this._snapper.watchMarker(c)},this);else this._snapper.watchMarker(c);return c}});L.Draw.Feature.SnapMixin=
{_snapInitialize:function(){this.on("enabled",this._snapOnEnabled,this);this.on("disabled",this._snapOnDisabled,this)},_snapOnEnabled:function(){if(this.options.guideLayers&&this._mouseMarker){this._snapper||(this._snapper=new L.Handler.MarkerSnap(this._map),L.Util.setOptions(this._snapper,this.options));for(var a=0,b=this.options.guideLayers.length;a<b;a++)this._snapper.addGuideLayer(this.options.guideLayers[a]);var c=this._mouseMarker;this._snapper.watchMarker(c);var e=c.options.icon;c.on("snap",
function(){c.setIcon(this.options.icon);c.setOpacity(1)},this);c.on("unsnap",function(){c.setIcon(e);c.setOpacity(0)},this);c.on("click",this._snapOnClick,this)}},_snapOnClick:function(a){if(this._markers){var b=this._markers[this._markers.length-1];this._mouseMarker.snap&&a&&b&&(b.setLatLng(a.target._latlng),this._poly&&(this._poly._latlngs[this._poly._latlngs.length-1]=a.target._latlng,this._poly.redraw()),b._icon&&L.DomUtil.addClass(b._icon,"marker-snapped"))}},_snapOnDisabled:function(){this._mouseMarker&&
this._mouseMarker.off("click",this._snapOnClick,this);delete this._snapper}};L.Draw.Feature.include(L.Draw.Feature.SnapMixin);L.Draw.Feature.addInitHook("_snapInitialize");L.Control.GraphicScale=L.Control.extend({options:{position:"bottomleft",updateWhenIdle:!1,minUnitWidth:30,maxUnitsWidth:240,fill:"fill",showSubunits:!1,doubleLine:!1,labelPlacement:"auto"},onAdd:function(a){this._map=a;this._possibleUnitsNum=[3,5,2,4];this._possibleUnitsNumLen=this._possibleUnitsNum.length;this._possibleDivisions=
[1,0.5,0.25,0.2];this._possibleDivisionsLen=this._possibleDivisions.length;this._possibleDivisionsSub={1:{num:2,division:0.5},"0.5":{num:5,division:0.1},"0.25":{num:5,division:0.05},"0.2":{num:2,division:0.1}};this._scaleInner=this._buildScale();this._scale=this._addScale(this._scaleInner);this._setStyle(this.options);a.on(this.options.updateWhenIdle?"moveend":"move",this._update,this);a.whenReady(this._update,this);return a.options.graphicScaleControl=this._scale},onRemove:function(a){a.off(this.options.updateWhenIdle?
"moveend":"move",this._update,this)},_addScale:function(a){var b=L.DomUtil.create("div");b.className="leaflet-control-graphicscale";b.appendChild(a);return b},_setStyle:function(a){var b=["leaflet-control-graphicscale-inner"];a.fill&&"nofill"!==a.fill&&(b.push("filled"),b.push("filled-"+a.fill));a.showSubunits&&b.push("showsubunits");a.doubleLine&&b.push("double");b.push("labelPlacement-"+a.labelPlacement);this._scaleInner.className=b.join(" ")},_buildScale:function(){var a=F.createElement("div");
a.className="leaflet-control-graphicscale-inner";var b=L.DomUtil.create("div","subunits",a),c=L.DomUtil.create("div","units",a);this._units=[];this._unitsLbls=[];this._subunits=[];for(var e=0;5>e;e++){var d=this._buildDivision(0===e%2);c.appendChild(d);this._units.push(d);var f=this._buildDivisionLbl();d.appendChild(f);this._unitsLbls.push(f);d=this._buildDivision(1===e%2);b.appendChild(d);this._subunits.unshift(d)}this._zeroLbl=L.DomUtil.create("div","label zeroLabel");this._zeroLbl.innerHTML="0";
this._units[0].appendChild(this._zeroLbl);this._subunitsLbl=L.DomUtil.create("div","label subunitsLabel");this._subunitsLbl.innerHTML="?";this._subunits[4].appendChild(this._subunitsLbl);return a},_buildDivision:function(a){var b=L.DomUtil.create("div","division"),c=L.DomUtil.create("div","line");b.appendChild(c);var e=L.DomUtil.create("div","line2");b.appendChild(e);a&&c.appendChild(L.DomUtil.create("div","fill"));a||e.appendChild(L.DomUtil.create("div","fill"));return b},_buildDivisionLbl:function(){return L.DomUtil.create("div",
"label divisionLabel")},_update:function(){var a=this._map.getBounds(),b=a.getCenter().lat,a=6378137*Math.PI*Math.cos(b*Math.PI/180)*(a.getNorthEast().lng-a.getSouthWest().lng)/180;0<this._map.getSize().x&&this._updateScale(a,this.options)},_updateScale:function(a,b){var c=this._getBestScale(a,b.minUnitWidth,b.maxUnitsWidth);this._render(c)},_getBestScale:function(a,b,c){a=this._getPossibleUnits(a,b,this._map.getSize().x);c=this._getPossibleScales(a,c);c.sort(function(a,b){return b.score-a.score});
c=c[0];c.subunits=this._getSubunits(c);return c},_getSubunits:function(a){var b=this._possibleDivisionsSub[a.unit.unitDivision],c={};c.subunitDivision=b.division;c.subunitMeters=a.unit.unitMeters/a.unit.unitDivision*b.division;c.subunitPx=a.unit.unitPx/a.unit.unitDivision*b.division;return{subunit:c,numSubunits:b.num,total:b.num*c.subunitMeters}},_getPossibleScales:function(a,b){for(var c=[],e=Number.POSITIVE_INFINITY,d,f=0;f<this._possibleUnitsNumLen;f++)for(var g=this._possibleUnitsNum[f],h=0.5*
(this._possibleUnitsNumLen-f),n=0;n<a.length;n++){var l=a[n],q=l.unitPx*g,v={unit:l,totalWidthPx:q,numUnits:g,score:0},u=1-(b-q)/b,u=3*u,u=l.unitScore+h+u;if(0.25===l.unitDivision&&3===g||0.5===l.unitDivision&&3===g||0.25===l.unitDivision&&5===g)u-=2;v.score=u;q<b&&c.push(v);q<e&&(e=q,d=v)}c.length||c.push(d);return c},_getPossibleUnits:function(a,b,c){for(var e,d=[],f=(Math.floor(a)+"").length;-2<f;f--){e=Math.pow(10,f);for(var g=0;g<this._possibleDivisionsLen;g++){var h=e*this._possibleDivisions[g],
n=h/a*c;if(n<b)return d;d.push({unitMeters:h,unitPx:n,unitDivision:this._possibleDivisions[g],unitScore:this._possibleDivisionsLen-g})}}return d},_render:function(a){this._renderPart(a.unit.unitPx,a.unit.unitMeters,a.numUnits,this._units,this._unitsLbls);this._renderPart(a.subunits.subunit.subunitPx,a.subunits.subunit.subunitMeters,a.subunits.numSubunits,this._subunits);a=this._getDisplayUnit(a.subunits.total);this._subunitsLbl.innerHTML=""+a.amount+a.unit},_renderPart:function(a,b,c,e,d){b=this._getDisplayUnit(b);
for(var f=0;f<this._units.length;f++){var g=e[f];f<c?(g.style.width=a+"px",g.className="division"):(g.style.width=0,g.className="division hidden");if(d){var g=d[f],h=["label","divisionLabel"];if(f<c){var n;n=1>b.amount?((f+1)*b.amount).toFixed(2):((f+1)*b.amount).toFixed(0);f===c-1?(n+=b.unit,h.push("labelLast")):h.push("labelSub");g.innerHTML=n}g.className=h.join(" ")}}},_getDisplayUnit:function(a){1>a&&(a=a.toFixed(2));var b=1E3>a?"m":"km";return{unit:b,amount:"km"===b?a/1E3:a}}});L.Map.mergeOptions({graphicScaleControl:!1});
L.control.graphicScale=function(a){return new L.Control.GraphicScale(a)};L.Map.addInitHook(function(){this.options.graphicScaleControl&&(this.graphicScaleControl=L.control.graphicScale({doubleLine:!1,fill:"fill",showSubunits:!0}).addTo(this))});L.SimpleGraticule=L.LayerGroup.extend({options:{interval:20,showOriginLabel:!1,redraw:"move",hidden:!1,zoomIntervals:[{start:0,end:3,interval:5E6},{start:4,end:5,interval:5E5},{start:6,end:7,interval:2E5},{start:8,end:9,interval:1E5},{start:10,end:10,interval:3E4},
{start:11,end:11,interval:1E4},{start:12,end:12,interval:6E3},{start:13,end:13,interval:3E3},{start:14,end:14,interval:2E3},{start:15,end:15,interval:1E3},{start:16,end:16,interval:500},{start:17,end:17,interval:250},{start:18,end:19,interval:100},{start:20,end:20,interval:30},{start:21,end:21,interval:10},{start:22,end:22,interval:6},{start:23,end:23,interval:3},{start:24,end:24,interval:2},{start:25,end:25,interval:1},{start:26,end:26,interval:0.5},{start:27,end:27,interval:0.2},{start:28,end:28,
interval:0.1},{start:29,end:29,interval:0.06},{start:30,end:31,interval:0.04},{start:32,end:41,interval:0.02}]},lineStyle:{stroke:!0,color:"#111",opacity:0.6,weight:1,clickable:!1},initialize:function(a){L.LayerGroup.prototype.initialize.call(this);L.Util.setOptions(this,a)},onAdd:function(a){this._map=a;var b=this.redraw();this._map.on("viewreset "+this.options.redraw,b.redraw,b);this.eachLayer(a.addLayer,a)},onRemove:function(a){a.off("viewreset "+this.options.redraw,this.map);this.eachLayer(this.removeLayer,
this);this.options.simpleGraticule=!1},hide:function(){this.options.hidden=!0;this.redraw()},show:function(){this.options.hidden=!1;this.redraw()},redraw:function(){this._bounds=this._map.getBounds().pad(0);this.clearLayers();if(!this.options.hidden){for(var a=this._map.getZoom(),b=0;b<this.options.zoomIntervals.length;b++)if(a>=this.options.zoomIntervals[b].start&&a<=this.options.zoomIntervals[b].end){this.options.interval=this.options.zoomIntervals[b].interval;break}this.constructLines(this.getMins(),
this.getLineCounts());this.options.showOriginLabel&&this.addLayer(this.addOriginLabel())}return this},getLineCounts:function(){var a=Math.cos(this._bounds.getCenter().lat*Math.PI/180),b=6378137*Math.PI,c=this.options.interval,a=180*c/(b*a),b=180*c/b;return{x:Math.ceil((this._bounds.getEast()-this._bounds.getWest())/a),y:Math.ceil((this._bounds.getNorth()-this._bounds.getSouth())/b)}},getMins:function(){var a=Math.cos(this._bounds.getCenter().lat*Math.PI/180),b=6378137*Math.PI,c=this.options.interval,
a=180*c/(b*a),b=180*c/b;return{x:Math.round((this._bounds.getWest()-Math.round(this._bounds.getWest()))/a)*a+Math.round(this._bounds.getWest()),y:Math.round(this._bounds.getSouth()/b)*b}},constructLines:function(a,b){for(var c=Array(b.x+b.y),e=Array(b.x+b.y),d=Math.cos(this._bounds.getCenter().lat*Math.PI/180),f=6378137*Math.PI,g=this.options.interval,d=180*g/(f*d),f=180*g/f,g=0;g<=b.x;g++){var h=a.x+g*d;c[g]=this.buildXLine(h);this.options.showOriginLabel&&(e[g]=this.buildLabel("gridlabel-horiz",
h))}for(d=0;d<=b.y;d++)h=a.y+d*f,c[d+g]=this.buildYLine(h),this.options.showOriginLabel&&(e[d+g]=this.buildLabel("gridlabel-vert",h));c.forEach(this.addLayer,this);this.options.showOriginLabel&&e.forEach(this.addLayer,this);this.eachLayer(function(a){a.bringToBack()})},buildXLine:function(a){var b=new L.LatLng(this._bounds.getSouth(),a);a=new L.LatLng(this._bounds.getNorth(),a);return new L.Polyline([b,a],this.lineStyle)},buildYLine:function(a){var b=new L.LatLng(a,this._bounds.getWest());a=new L.LatLng(a,
this._bounds.getEast());return new L.Polyline([b,a],this.lineStyle)},buildLabel:function(a,b){var c=this._map.getBounds().pad(-0),c="gridlabel-horiz"===a?new L.LatLng(c.getCenter().lng,b):new L.LatLng(b,c.getCenter().lat);return L.marker(c,{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-grid-label",html:'<div class="'+a+'">'+b+"</div>"})})},addOriginLabel:function(){return L.marker([0,0],{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-grid-label",html:'<div class="gridlabel-horiz">(0,0)</div>'})})}});
L.simpleGraticule=function(a){return new L.SimpleGraticule(a)};L.Map.addInitHook(function(){this.options.simpleGraticule&&(this.options.simpleGraticule=(new L.simpleGraticule).addTo(this))});L.SnapGrid=L.LayerGroup.extend({options:{interval:20,showOriginLabel:!1,redraw:"move",hidden:!1,zoomIntervals:[]},lineStyle:{stroke:!0,color:"red",opacity:0.3,weight:1,clickable:!1,dashArray:"8,2"},initialize:function(a){L.LayerGroup.prototype.initialize.call(this);L.Util.setOptions(this,a)},onAdd:function(a){this._map=
a;var b=this.redraw();this._map.on("viewreset "+this.options.redraw,b.redraw,b);this.eachLayer(a.addLayer,a)},onRemove:function(a){a.off("viewreset "+this.options.redraw,this.map);this.eachLayer(this.removeLayer,this);this.options.simpleGraticule=!1},hide:function(){this.options.hidden=!0;this.redraw()},show:function(){this.options.hidden=!1;this.redraw()},redraw:function(){this._bounds=this._map.getBounds().pad(0);this.clearLayers();if(!this.options.hidden){var a=this.getLineCounts();300>a.x+a.y&&
this.constructLines(this.getMins(),this.getLineCounts());this.options.showOriginLabel&&this.addLayer(this.addOriginLabel())}return this},getLineCounts:function(){var a=Math.cos(this._bounds.getCenter().lat*Math.PI/180),b=6378137*Math.PI,c=this.options.interval,a=180*c/(b*a),b=180*c/b;return{x:Math.ceil((this._bounds.getEast()-this._bounds.getWest())/a),y:Math.ceil((this._bounds.getNorth()-this._bounds.getSouth())/b)}},getMins:function(){var a=Math.cos(this._bounds.getCenter().lat*Math.PI/180),b=6378137*
Math.PI,c=this.options.interval,a=180*c/(b*a),b=180*c/b;return{x:Math.round((this._bounds.getWest()-Math.round(this._bounds.getWest()))/a)*a+Math.round(this._bounds.getWest()),y:Math.round(this._bounds.getSouth()/b)*b}},constructLines:function(a,b){for(var c=Array(b.x+b.y),e=Array(b.x+b.y),d=Math.cos(this._bounds.getCenter().lat*Math.PI/180),f=6378137*Math.PI,g=this.options.interval,d=180*g/(f*d),f=180*g/f,g=0;g<=b.x;g++){var h=a.x+g*d;c[g]=this.buildXLine(h);this.options.showOriginLabel&&(e[g]=this.buildLabel("gridlabel-horiz",
h))}for(d=0;d<=b.y;d++)h=a.y+d*f,c[d+g]=this.buildYLine(h),this.options.showOriginLabel&&(e[d+g]=this.buildLabel("gridlabel-vert",h));c.forEach(this.addLayer,this);this.options.showOriginLabel&&e.forEach(this.addLayer,this);this.eachLayer(function(a){a.bringToBack()})},buildXLine:function(a){var b=new L.LatLng(this._bounds.getSouth(),a);a=new L.LatLng(this._bounds.getNorth(),a);return new L.Polyline([b,a],this.lineStyle)},buildYLine:function(a){var b=new L.LatLng(a,this._bounds.getWest());a=new L.LatLng(a,
this._bounds.getEast());return new L.Polyline([b,a],this.lineStyle)},buildLabel:function(a,b){var c=this._map.getBounds().pad(-0),c="gridlabel-horiz"===a?new L.LatLng(c.getCenter().lng,b):new L.LatLng(b,c.getCenter().lat);return L.marker(c,{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-snap-grid-label",html:'<div class="'+a+'">'+b+"</div>"})})},addOriginLabel:function(){return L.marker([0,0],{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-snap-grid-label",html:'<div class="gridlabel-horiz">(0,0)</div>'})})}});
L.snapGrid=function(a){return new L.SnapGrid(a)};L.Map.addInitHook(function(){this.options.snapGrid&&(this.options.snapGrid=(new L.snapGrid).addTo(this))});(function(a){var b;if("function"===typeof define&&define.amd)define(["leaflet"],a);else if("undefined"!==typeof module)b=require("leaflet"),module.exports=a(b);else{if("undefined"===typeof S.L)throw Error("Leaflet must be loaded first");a(S.L)}})(function(a){a.Map.mergeOptions({contextmenu:!0,contextmenuWidth:150,contextmenuItems:[{text:"Center map here",
callback:function(a){this.panTo(a.latlng)}},{text:"Show all squares",callback:function(){this.fire("redraw:showAllSquareLabels")}}]});a.Map.ContextMenu=a.Handler.extend({_touchstart:a.Browser.msPointer?"MSPointerDown":a.Browser.pointer?"pointerdown":"touchstart",statics:{BASE_CLS:"leaflet-contextmenu"},initialize:function(b){a.Handler.prototype.initialize.call(this,b);this._map=b;this._items=[];this._visible=!1;var c=this._container=a.DomUtil.create("div",a.Map.ContextMenu.BASE_CLS,b._container);
c.style.zIndex=1E4;c.style.position="absolute";b.options.contextmenuWidth&&(c.style.width=b.options.contextmenuWidth+"px");this._createItems();a.DomEvent.on(c,"click",a.DomEvent.stop).on(c,"mousedown",a.DomEvent.stop).on(c,"dblclick",a.DomEvent.stop).on(c,"contextmenu",a.DomEvent.stop)},addHooks:function(){a.DomEvent.on(F,a.Browser.touch?this._touchstart:"mousedown",this._onMouseDown,this).on(F,"keydown",this._onKeyDown,this);this._map.on({contextmenu:this._show,mousedown:this._hide,movestart:this._hide,
zoomstart:this._hide,click:this._hide},this);this._map.on({"popups:hide":this._onPopupsHide},this);a.DomEvent.on(this._map.getContainer(),"mouseleave",this._hide,this)},_onPopupsHide:function(a){a.caller&&a.caller!==this&&this._hide()},removeHooks:function(){a.DomEvent.off(F,a.Browser.touch?this._touchstart:"mousedown",this._onMouseDown,this).off(F,"keydown",this._onKeyDown,this);this._map.off({contextmenu:this._show,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide,click:this._hide},
this);this._map.off({"popups:hide":this._onPopupsHide},this);a.DomEvent.off(this._map.getContainer(),"mouseleave",this._hide,this)},showAt:function(b,c){b instanceof a.LatLng&&(b=this._map.latLngToContainerPoint(b));this._showAtPoint(b,c)},hide:function(){this._hide()},addItem:function(a){return this.insertItem(a)},insertItem:function(a,b){b=b!==t?b:this._items.length;var c=this._createItem(this._container,a,b);this._items.push(c);this._sizeChanged=!0;this._map.fire("contextmenu.additem",{contextmenu:this,
el:c.el,index:b});return c.el},removeItem:function(b){var c=this._container;isNaN(b)||(b=c.children[b]);b&&(this._removeItem(a.Util.stamp(b)),this._sizeChanged=!0,this._map.fire("contextmenu.removeitem",{contextmenu:this,el:b}))},removeAllItems:function(){for(var b;this._container.children.length;)b=this._container.children[0],this._removeItem(a.Util.stamp(b))},hideAllItems:function(){var a,b,c;b=0;for(c=this._items.length;b<c;b++)a=this._items[b],a.el.style.display="none"},showAllItems:function(){var a,
b,c;b=0;for(c=this._items.length;b<c;b++)a=this._items[b],a.el.style.display=""},setDisabled:function(b,c){var d=this._container,e=a.Map.ContextMenu.BASE_CLS+"-item";isNaN(b)||(b=d.children[b]);b&&a.DomUtil.hasClass(b,e)&&(c?(a.DomUtil.addClass(b,e+"-disabled"),this._map.fire("contextmenu.disableitem",{contextmenu:this,el:b})):(a.DomUtil.removeClass(b,e+"-disabled"),this._map.fire("contextmenu.enableitem",{contextmenu:this,el:b})))},isVisible:function(){return this._visible},_createItems:function(){var a=
this._map.options.contextmenuItems,b,c;b=0;for(c=a.length;b<c;b++)this._items.push(this._createItem(this._container,a[b]))},_createItem:function(b,c,d){if(c.separator||"-"===c)return this._createSeparator(b,d);var e=a.Map.ContextMenu.BASE_CLS+"-item";b=this._insertElementAt("a",c.disabled?e+" "+e+"-disabled":e,b,d);d=this._createEventHandler(b,c.callback,c.context,c.hideOnSelect);e="";c.icon?e='<img class="'+a.Map.ContextMenu.BASE_CLS+'-icon" src="'+c.icon+'"/>':c.iconCls&&(e='<span class="'+a.Map.ContextMenu.BASE_CLS+
"-icon "+c.iconCls+'"></span>');b.innerHTML=e+c.text;b.href="#";a.DomEvent.on(b,"mouseover",this._onItemMouseOver,this).on(b,"mouseout",this._onItemMouseOut,this).on(b,"mousedown",a.DomEvent.stopPropagation).on(b,"click",d);return{id:a.Util.stamp(b),el:b,callback:d}},_removeItem:function(b){var c,d,e;d=0;for(e=this._items.length;d<e;d++)if(c=this._items[d],c.id===b)return b=c.el,c.callback&&a.DomEvent.off(b,"mouseover",this._onItemMouseOver,this).off(b,"mouseover",this._onItemMouseOut,this).off(b,
"mousedown",a.DomEvent.stopPropagation).off(b,"click",c.callback),this._container.removeChild(b),this._items.splice(d,1),c;return null},_createSeparator:function(b,c){var d=this._insertElementAt("div",a.Map.ContextMenu.BASE_CLS+"-separator",b,c);return{id:a.Util.stamp(d),el:d}},_createEventHandler:function(b,c,d,e){var f=this,g=this._map,y=a.Map.ContextMenu.BASE_CLS+"-item-disabled";e=e!==t?e:!0;return function(){a.DomUtil.hasClass(b,y)||(e&&f._hide(),c&&c.call(d||g,f._showLocation),f._map.fire("contextmenu:select",
{contextmenu:f,el:b}))}},_insertElementAt:function(a,b,c,d){var e;a=F.createElement(a);a.className=b;d!==t&&(e=c.children[d]);e?c.insertBefore(a,e):c.appendChild(a);return a},_show:function(a){this._map.fire("popups:hide",{caller:this});this._showAtPoint(a.containerPoint)},_showAtPoint:function(b,c){if(this._items.length){var d=this._map,e=d.containerPointToLayerPoint(b),d=d.layerPointToLatLng(e),f={contextmenu:this};c&&(f=a.extend(c,f));this._showLocation={latlng:d,layerPoint:e,containerPoint:b};
this._setPosition(b);this._visible?this._setPosition(b):(this._container.style.display="block",this._visible=!0);this._map.fire("contextmenu.show",f)}},_hide:function(){this._visible&&(this._visible=!1,this._container.style.display="none",this._map.fire("contextmenu.hide",{contextmenu:this}))},_setPosition:function(b){var c=this._map.getSize(),d=this._container,e=this._getElementSize(d),f;this._map.options.contextmenuAnchor&&(f=a.point(this._map.options.contextmenuAnchor),b=b.add(f));d._leaflet_pos=
b;b.x+e.x>c.x?(d.style.left="auto",d.style.right=Math.max(c.x-b.x,0)+"px"):(d.style.left=Math.max(b.x,0)+"px",d.style.right="auto");b.y+e.y>c.y?(d.style.top="auto",d.style.bottom=Math.max(c.y-b.y,0)+"px"):(d.style.top=Math.max(b.y,0)+"px",d.style.bottom="auto")},_getElementSize:function(a){var b=this._size,c=a.style.display;if(!b||this._sizeChanged)b={},a.style.left="-999999px",a.style.right="auto",a.style.display="block",b.x=a.offsetWidth,b.y=a.offsetHeight,a.style.left="auto",a.style.display=c,
this._sizeChanged=!1;return b},_onMouseDown:function(){this._hide()},_onKeyDown:function(a){27===a.keyCode&&this._hide()},_onItemMouseOver:function(b){a.DomUtil.addClass(b.target||b.srcElement,"over")},_onItemMouseOut:function(b){a.DomUtil.removeClass(b.target||b.srcElement,"over")}});a.Map.addInitHook("addHandler","contextmenu",a.Map.ContextMenu);a.Mixin.ContextMenu={bindContextMenu:function(b){a.setOptions(this,b);this._initContextMenu();return this},unbindContextMenu:function(){this.off("contextmenu",
this._showContextMenu,this);return this},_initContextMenu:function(){this._items=[];this.on("contextmenu",this._showContextMenu,this)},_showContextMenu:function(a){var b,c,d;if(this._map.contextmenu){b=this._map.mouseEventToContainerPoint(a.originalEvent);this.options.contextmenuInheritItems||this._map.contextmenu.hideAllItems();c=0;for(d=this.options.contextmenuItems.length;c<d;c++)a=this.options.contextmenuItems[c],this._items.push(this._map.contextmenu.insertItem(a,a.index));this._map.once("contextmenu.hide",
this._hideContextMenu,this);this._map.contextmenu.showAt(b,{relatedTarget:this})}},_hideContextMenu:function(){var a,b;a=0;for(b=this._items.length;a<b;a++)this._map.contextmenu.removeItem(this._items[a]);this._items.length=0;this.options.contextmenuInheritItems||this._map.contextmenu.showAllItems()}};var b=[a.Marker,a.Path],c={contextmenu:!1,contextmenuItems:[],contextmenuInheritItems:!0},e,d,f,g=function(){this.options.contextmenu&&this._initContextMenu()};d=0;for(f=b.length;d<f;d++)e=b[d],e.prototype.options?
e.mergeOptions(c):e.prototype.options=c,e.addInitHook(g),e.include(a.Mixin.ContextMenu);return a.Map.ContextMenu});L.Control.SlideMenu=L.Control.extend({options:{isOpen:!1,position:"topright",width:"100%",height:"40px",delay:"0",closeButtonIcon:"fa-angle-double-up",menuButtonIcon:"fa-angle-double-down"},contents:'<span class="leaflet-top-menu-spacer">&nbsp;</span>,<a class="leaflet-top-menu-link"><b> Load </b></a>,<a class="leaflet-top-menu-link"><b> Save </b></a>,<a class="leaflet-top-menu-link"><b> SVG </b></a>,<a class="leaflet-top-menu-link"><b> PNG </b></a>,<a class="leaflet-top-menu-link"><b> JPG </b></a>,<a class="leaflet-top-menu-link"><b> Options </b></a>'.split(","),
initialize:function(a,b){b&&L.Util.setOptions(this,b);this._innerHTML=a?a:this.contents.join("");this._startPosition=0;this._isLeftPosition="topleft"===this.options.position||"buttomleft"===this.options.position?!0:!1},onAdd:function(a){this._map=a;this._startPosition=-parseInt(this.options.width,10);this.options.width.indexOf("%")+1&&(this._startPosition=this._startPosition*a.getSize().x*0.01);this._container=L.DomUtil.create("div","leaflet-control-slidemenu leaflet-bar leaflet-control");this.showlink=
L.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",this._container);this.showlink.title="Menu";0<this.options.menuButtonIcon.length?L.DomUtil.create("span","fa "+this.options.menuButtonIcon,this.showlink):L.DomUtil.create("span","fa fa-bars",this.showlink);this._menu=L.DomUtil.create("div","leaflet-menu",F.getElementsByClassName("leaflet-container")[0]);this._menu.style.width=this.options.width;this._menu.style.height=this.options.height;this.closeButton=L.DomUtil.create("span","leaflet-menu-close-button fa",
this._menu);0<this.options.closeButtonIcon.length?(this._isLeftPosition=!0,this._menu.style.left="-"+this.options.width,this.closeButton.style["float"]="right",L.DomUtil.addClass(this.closeButton,this.options.closeButtonIcon)):this._isLeftPosition?(this._menu.style.left="-"+this.options.width,this.closeButton.style["float"]="right",L.DomUtil.addClass(this.closeButton,"fa-chevron-left")):(this.closeButton.style["float"]="left",this._menu.style.right="-"+this.options.width,L.DomUtil.addClass(this.closeButton,
"fa-chevron-right"));this._contents=L.DomUtil.create("div","leaflet-menu-contents",this._menu);this._contents.innerHTML=this._innerHTML;L.DomEvent.addListener(this._contents.getElementsByTagName("A")[0],"click",function(){this.menuClose();var a=this._map.RSWEIndoor.options.dialogs.loadDialog._isOpen;this._map.RSWEIndoor.options.dialogs.loadDialog.open();a&&this._map.RSWEIndoor.options.dialogs.loadDialog.close()},this);L.DomEvent.addListener(this._contents.getElementsByTagName("A")[1],"click",function(){this.menuClose();
var a=this._map.RSWEIndoor.options.dialogs.saveDialog._isOpen;this._map.RSWEIndoor.options.dialogs.saveDialog.open();a&&this._map.RSWEIndoor.options.dialogs.saveDialog.close()},this);L.DomEvent.addListener(this._contents.getElementsByTagName("A")[2],"click",function(){this.menuClose();var a=this._map.RSWEIndoor.options.dialogs.saveSVGDialog._isOpen;this._map.RSWEIndoor.options.dialogs.saveSVGDialog.open();a&&this._map.RSWEIndoor.options.dialogs.saveSVGDialog.close()},this);L.DomEvent.addListener(this._contents.getElementsByTagName("A")[3],
"click",function(){this.menuClose();var a=this._map.RSWEIndoor.options.dialogs.savePNGDialog._isOpen;this._map.RSWEIndoor.options.dialogs.savePNGDialog.open();a&&this._map.RSWEIndoor.options.dialogs.savePNGDialog.close()},this);L.DomEvent.addListener(this._contents.getElementsByTagName("A")[4],"click",function(){this.menuClose();var a=this._map.RSWEIndoor.options.dialogs.saveJPGDialog._isOpen;this._map.RSWEIndoor.options.dialogs.saveJPGDialog.open();a&&this._map.RSWEIndoor.options.dialogs.saveJPGDialog.close()},
this);L.DomEvent.addListener(this._contents.getElementsByTagName("A")[5],"click",function(){this.menuClose();var a=this._map.RSWEIndoor.options.dialogs.optionsDialog._isOpen;this._map.RSWEIndoor.options.dialogs.optionsDialog.open();a&&this._map.RSWEIndoor.options.dialogs.optionsDialog.close()},this);L.DomEvent.disableClickPropagation(this._menu);L.DomEvent.on(this.showlink,"click",function(){this.menuOpen()},this).on(this.closeButton,"click",function(){this.menuClose()},this);this.options.isOpen?
this._animate(this._menu,this._startPosition,0,!0):this._animate(this._menu,0,this._startPosition,!1);return this._container},menuOpen:function(){this.showlink.style.display="none";this.closeButton.style.display="block";this._animate(this._menu,this._startPosition,0,!0)},menuClose:function(){this.showlink.style.display="block";this.closeButton.style.display="none";this._animate(this._menu,0,this._startPosition,!1)},setContents:function(a){this._innerHTML=a},_animate:function(a,b,c,e){this.options.isOpen=
e;e||(this._startPosition=-parseInt(this.options.width,10),this.options.width.indexOf("%")+1&&(this._startPosition=this._startPosition*this._map.getSize().x*0.01),this._menu.style.width=this.options.width,b=0,c=this._startPosition);0<this.options.delay?(e?b>c:b<c)||(this._isLeftPosition?a.style.left=b+"px":a.style.right=b+"px",setTimeout(function(a){var f=e?b+10:b-10;b.indexOf("%")+1&&(f+="%");a._animate(a._menu,f,c,e)},this.options.delay,this)):(this._isLeftPosition?a.style.left=c+"px":a.style.right=
c+"px",this._map.getSize().x===-c&&(this._isLeftPosition?a.style.left="-100%":a.style.right="100%"))}});L.control.slideMenu=function(a,b){return new L.Control.SlideMenu(a,b)};L.Control.RSWEIndoor=L.Control.extend({options:{position:"topleft",contextmenu:!0,contextmenuWidth:140,contextmenuItems:[{text:"Center map here",callback:function(a){this._map.panTo(a.latlng)}}],layers:[],roomProps:[],roomWallsProps:[],controlLayerGrp:{},drawnWallsLayerGrp:{},labelsLayerGrp:{},fitBondsAfterLoad:!0,showSizeArrows:!0,
dontShowSmallSizeLabels:0.5,showSquareLabels:!0,dontShowSquaresLessThan:1,considerWallThikness:!0,wallWidth:0.1,pixelsPerMeter:100,snapOptions:{displaySnapGrid:!0,gridStep:0.1,snapWallsToGrid:!0,snapWindowsToGrid:!1,snapDoorsToGrid:!1,snapWallsToObjects:!1,snapWindowsToObjects:!0,snapDoorsToObjects:!0,snapLayersArray:[]},dialogs:{optionsDialog:function(){return new L.Control.Dialog.Options},saveDialog:function(){return new L.Control.Dialog.Save},loadDialog:function(){return new L.Control.Dialog.Load},
saveSVGDialog:function(){return new L.Control.Dialog.SaveSVG},savePNGDialog:function(){return new L.Control.Dialog.SavePNG},saveJPGDialog:function(){return new L.Control.Dialog.SaveJPG}}},DeleteRoom:function(a){var b,c,e;for(c=0;c<this.options.layers.length&&a!==this.options.layers[c].controlLayer;c++);for(e=0;e<this.options.roomWallsProps[c].length;e++)delete this.options.roomWallsProps[c][e];for(e=0;e<this.options.layers[c].roomWalls.length;e++)b=this.options.layers[c].roomWalls[e],this.options.drawnWallsLayerGrp.removeLayer(L.stamp(b));
this.options.labelsLayerGrp.eachLayer(function(b){b.options.relatedToLayer===a&&b._map.RSWEIndoor.options.labelsLayerGrp.removeLayer(L.stamp(b))});this.options.controlLayerGrp.removeLayer(L.stamp(a));this.options.layers[c].roomWalls.length=0;this.options.layers.splice(c,1);this.options.roomProps.splice(c,1);this.options.roomWallsProps.splice(c,1);b=0;for(c=this.options.snapOptions.snapLayersArray.length;b<c;b++)if(L.stamp(a)===L.stamp(this.options.snapOptions.snapLayersArray[b])){this.options.snapOptions.snapLayersArray.splice(b,
1);break}},RedrawRoom:function(a,b){var c="undefined";if("square"!==a.options.layerType&&"roomname"!==a.options.layerType)if(a instanceof L.Rectangle?c="rectangle":a instanceof L.Polygon?c="polygon":a instanceof L.Polyline?c="polyline":a instanceof L.Circle?c="circle":a instanceof L.Marker&&(c="marker"),b&&(a.options.layerType=b),"circle"===c)this.options.controlLayerGrp.addLayer(a);else if("marker"===c)a.bindPopup("A popup!"),this.options.controlLayerGrp.addLayer(a);else{this.options.labelsLayerGrp.eachLayer(function(b){b.options.relatedToLayer===
a&&b._map.RSWEIndoor.options.labelsLayerGrp.removeLayer(L.stamp(b))});for(var e=this.options.dontShowSmallSizeLabels,d,f,g=0,h=0,n,l,q,v,g=0;g<this.options.layers.length;g++)if(a===this.options.layers[g].controlLayer){for(n=0;n<this.options.layers[g].roomWalls.length;n++)d=this.options.layers[g].roomWalls[n],this.options.drawnWallsLayerGrp.removeLayer(d._leaflet_id);this.options.layers[g].roomWalls.length=0;break}var u=a._latlngs,y=u.length,M,r,H,x,p,G,B,w,m,k,E,C,D,z,A,F,W,I,X,J,T,O,Y,U,s,P,Q,R,
S,$,ba,aa,ca,da,N,V,K,Z,ga=function(a,b){return function(c){(new L.WallToolbarPopup(a,b,c.latlng)).addTo(map,f)}},ea=function(a){return function(b){(new L.SquareToolbarPopup(a,b.latlng)).addTo(map,f)}};if(1<u.length){n=0;for(y=u.length;n<y;n++)m=new L.LatLng(u[n%y].lat,u[n%y].lng),k=new L.LatLng(u[(n+1)%y].lat,u[(n+1)%y].lng),r=k.distanceTo(m),k=m=t,1E-12>Math.abs(r)&&(u.splice(),u.splice(n+1,1),n--,y--);V=new L.LatLng(0,0);for(n=h=0;n<=y-1;n++)h+=2.03403157953845E13*(u[(n+1)%y].lng*u[n%y].lat-u[n%
y].lng*u[(n+1)%y].lat)*Math.PI*Math.PI/(32400*Math.cos(u[n%y].lat*Math.PI/180)),V.lat+=u[n%y].lat/y,V.lng+=u[n%y].lng/y;l=[];for(h=0;h<y;h++)this.options.layers[g]===t&&(this.options.layers[g]={}),this.options.roomProps[g]===t&&this.options.roomProps.push({}),v=this.options.roomProps[g],v.layerClass=c,v.layerClassOptions=a.options,v.layerLatlngs=a.getLatLngs(),this.options.roomWallsProps[g]===t&&this.options.roomWallsProps.push([]),q=this.options.roomWallsProps[g],q[h]||(q[h]={}),q[h]={wallType:q[h].wallType?
q[h].wallType:"wall",wallWidth:q[h].wallWidth?q[h].wallWidth:this.options.wallWidth},"rectangle"===b&&(q[h].wallType="rectangle"),"wall"===b&&(q[h].wallType="wall"),"window"===b&&(q[h].wallType="window"),"door"===b&&(q[h].wallType="door1");n=0;for(y=u.length;n<y;n++)if(h=n,d=q[n].wallType,I=0.5*q[(n+y-1)%y].wallWidth,s=0.5*q[n%y].wallWidth,J=0.5*q[(n+1)%y].wallWidth,m=new L.LatLng(u[n%y].lat,u[n%y].lng),k=new L.LatLng(u[(n+1)%y].lat,u[(n+1)%y].lng),!(n>y-2&&"polyline"===c||n===y&&"rectangle"===c)){w=
0===n&&"polyline"===c?new L.LatLng(m.lat+m.lat-k.lat,m.lng+m.lng-k.lng):new L.LatLng(u[(n-1+y)%y].lat,u[(n-1+y)%y].lng);E=n===y-2&&"polyline"===c?new L.LatLng(k.lat+k.lat-m.lat,k.lng+k.lng-m.lng):new L.LatLng(u[(n+2)%y].lat,u[(n+2)%y].lng);x=Math.cos(m.lat*Math.PI/180);B=Math.cos(k.lat*Math.PI/180);M=w.distanceTo(m);r=k.distanceTo(m);H=k.distanceTo(E);C=new L.LatLng(m.lat+s/r*(k.lng-m.lng)*x,m.lng-s/r/x*(k.lat-m.lat));D=new L.LatLng(m.lat-s/r*(k.lng-m.lng)*x,m.lng+s/r/x*(k.lat-m.lat));z=new L.LatLng(k.lat+
s/r*(k.lng-m.lng)*B,k.lng-s/r/B*(k.lat-m.lat));A=new L.LatLng(k.lat-s/r*(k.lng-m.lng)*B,k.lng+s/r/B*(k.lat-m.lat));z=new L.LatLng(k.lat+s/r*(k.lng-m.lng)*B,k.lng-s/r/B*(k.lat-m.lat));A=new L.LatLng(k.lat-s/r*(k.lng-m.lng)*B,k.lng+s/r/B*(k.lat-m.lat));new L.LatLng(E.lat+J/H*(E.lng-k.lng)*B,E.lng-J/H/B*(E.lat-k.lat));new L.LatLng(E.lat-J/H*(E.lng-k.lng)*B,E.lng+J/H/B*(E.lat-k.lat));new L.LatLng(w.lat+I/M*(m.lng-w.lng)*x,w.lng-I/M/x*(m.lat-w.lat));new L.LatLng(w.lat-I/M*(m.lng-w.lng)*x,w.lng+I/M/x*(m.lat-
w.lat));T=new L.LatLng(m.lat+I/M*(m.lng-w.lng)*x,m.lng-I/M/x*(m.lat-w.lat));O=new L.LatLng(m.lat-I/M*(m.lng-w.lng)*x,m.lng+I/M/x*(m.lat-w.lat));Y=new L.LatLng(k.lat+J/H*(E.lng-k.lng)*B,k.lng-J/H/B*(E.lat-k.lat));U=new L.LatLng(k.lat-J/H*(E.lng-k.lng)*B,k.lng+J/H/B*(E.lat-k.lat));p=(k.lng-m.lng)*(E.lat-k.lat)-(E.lng-k.lng)*(k.lat-m.lat);G=(Y.lng-z.lng)*(E.lat-k.lat)-(E.lng-k.lng)*(Y.lat-z.lat);1E-12<Math.abs(p)?(W=new L.LatLng(G/p*(k.lat-m.lat)+z.lat,G/p*(k.lng-m.lng)+z.lng),p=Math.max(s,J),X=L.GeometryUtil.closestOnSegment(map,
W,new L.LatLng(z.lat-(k.lat-m.lat)*p/r,z.lng-(k.lng-m.lng)*p/r),new L.LatLng(z.lat+(k.lat-m.lat)*p/r,z.lng+(k.lng-m.lng)*p/r)),Y=L.GeometryUtil.closestOnSegment(map,W,new L.LatLng(Y.lat+(E.lat-k.lat)*p/H,Y.lng+(E.lng-k.lng)*p/H),new L.LatLng(Y.lat-(E.lat-k.lat)*p/H,Y.lng-(E.lng-k.lng)*p/H))):(X=new L.LatLng(z.lat,z.lng),Y=new L.LatLng(Y.lat,Y.lng));W=new L.LatLng(X.lat+0.5*(A.lat-z.lat),X.lng+0.5*(A.lng-z.lng));p=(k.lng-m.lng)*(E.lat-k.lat)-(E.lng-k.lng)*(k.lat-m.lat);G=(U.lng-A.lng)*(E.lat-k.lat)-
(E.lng-k.lng)*(U.lat-A.lat);1E-12<Math.abs(p)?(F=new L.LatLng(G/p*(k.lat-m.lat)+A.lat,G/p*(k.lng-m.lng)+A.lng),p=Math.max(s,J),J=L.GeometryUtil.closestOnSegment(map,F,new L.LatLng(A.lat-(k.lat-m.lat)*p/r,A.lng-(k.lng-m.lng)*p/r),new L.LatLng(A.lat+(k.lat-m.lat)*p/r,A.lng+(k.lng-m.lng)*p/r)),E=L.GeometryUtil.closestOnSegment(map,F,new L.LatLng(U.lat+(E.lat-k.lat)*p/H,U.lng+(E.lng-k.lng)*p/H),new L.LatLng(U.lat-(E.lat-k.lat)*p/H,U.lng-(E.lng-k.lng)*p/H))):(J=new L.LatLng(A.lat,A.lng),E=new L.LatLng(U.lat,
U.lng));U=new L.LatLng(J.lat-0.5*(A.lat-z.lat),J.lng-0.5*(A.lng-z.lng));p=(m.lng-w.lng)*(k.lat-m.lat)-(k.lng-m.lng)*(m.lat-w.lat);G=(C.lng-T.lng)*(k.lat-m.lat)-(k.lng-m.lng)*(C.lat-T.lat);1E-12<Math.abs(p)?(F=new L.LatLng(G/p*(m.lat-w.lat)+T.lat,G/p*(m.lng-w.lng)+T.lng),p=Math.max(s,I),H=L.GeometryUtil.closestOnSegment(map,F,new L.LatLng(C.lat+(k.lat-m.lat)*p/r,C.lng+(k.lng-m.lng)*p/r),new L.LatLng(C.lat-(k.lat-m.lat)*p/r,C.lng-(k.lng-m.lng)*p/r)),T=L.GeometryUtil.closestOnSegment(map,F,new L.LatLng(T.lat+
(w.lat-m.lat)*p/M,T.lng+(w.lng-m.lng)*p/M),new L.LatLng(T.lat-(w.lat-m.lat)*p/M,T.lng-(w.lng-m.lng)*p/M))):(H=new L.LatLng(C.lat,C.lng),T=new L.LatLng(T.lat,T.lng));F=new L.LatLng(H.lat+0.5*(D.lat-C.lat),H.lng+0.5*(D.lng-C.lng));p=(m.lng-w.lng)*(k.lat-m.lat)-(k.lng-m.lng)*(m.lat-w.lat);G=(D.lng-O.lng)*(k.lat-m.lat)-(k.lng-m.lng)*(D.lat-O.lat);1E-12<Math.abs(p)?(G=new L.LatLng(G/p*(m.lat-w.lat)+O.lat,G/p*(m.lng-w.lng)+O.lng),p=Math.max(s,I),I=L.GeometryUtil.closestOnSegment(map,G,new L.LatLng(D.lat+
(k.lat-m.lat)*p/r,D.lng+(k.lng-m.lng)*p/r),new L.LatLng(D.lat-(k.lat-m.lat)*p/r,D.lng-(k.lng-m.lng)*p/r)),M=L.GeometryUtil.closestOnSegment(map,G,new L.LatLng(O.lat+(w.lat-m.lat)*p/M,O.lng+(w.lng-m.lng)*p/M),new L.LatLng(O.lat-(w.lat-m.lat)*p/M,O.lng-(w.lng-m.lng)*p/M))):(I=new L.LatLng(D.lat,D.lng),M=new L.LatLng(O.lat,O.lng));O=new L.LatLng(I.lat+0.5*(C.lat-D.lat),I.lng+0.5*(C.lng-D.lng));s=new L.LatLng(1*m.lat+0*k.lat,1*m.lng+0*k.lng);p=new L.LatLng(0*m.lat+1*k.lat,0*m.lng+1*k.lng);G=new L.LatLng(1*
C.lat+0*z.lat,1*C.lng+0*z.lng);P=new L.LatLng(1*D.lat+0*A.lat,1*D.lng+0*A.lng);Q=new L.LatLng(0*C.lat+1*z.lat,0*C.lng+1*z.lng);R=new L.LatLng(0*D.lat+1*A.lat,0*D.lng+1*A.lng);$=new L.LatLng(s.lat+0.5*(p.lng-s.lng)*x,s.lng-0.5/x*(p.lat-s.lat));ba=new L.LatLng(s.lat-0.5*(p.lng-s.lng)*x,s.lng+0.5/x*(p.lat-s.lat));ca=new L.LatLng(p.lat+0.5*(p.lng-s.lng)*B,p.lng-0.5/B*(p.lat-s.lat));da=new L.LatLng(p.lat-0.5*(p.lng-s.lng)*B,p.lng+0.5/B*(p.lat-s.lat));S=new L.LatLng(s.lat+0.5*(p.lng-s.lng)*Math.sqrt(3)*
x+0.5*(p.lat-s.lat),s.lng-(p.lat-s.lat)*(0.5*Math.sqrt(3)/x)+0.5*(p.lng-s.lng));aa=new L.LatLng(s.lat-0.5*(p.lng-s.lng)*Math.sqrt(3)*x+0.5*(p.lat-s.lat),s.lng+(p.lat-s.lat)*(0.5*Math.sqrt(3)/x)+0.5*(p.lng-s.lng));B=L.GeometryUtil.closestOnSegment(map,m,m,k);w=L.GeometryUtil.closestOnSegment(map,k,m,k);this._map.RSWEIndoor.options.considerWallThikness&&(B=L.GeometryUtil.closestOnSegment(map,F,new L.LatLng(B.lat,B.lng),w),B=L.GeometryUtil.closestOnSegment(map,O,new L.LatLng(B.lat,B.lng),w),w=L.GeometryUtil.closestOnSegment(map,
W,B,new L.LatLng(w.lat,w.lng)),w=L.GeometryUtil.closestOnSegment(map,U,B,new L.LatLng(w.lat,w.lng)));W=new L.LatLng(0.5*(m.lat+k.lat),0.5*(m.lng+k.lng));N=new L.LatLng(W.lat+this.options.wallWidth/r*(k.lng-m.lng)*0.5*x,W.lng-this.options.wallWidth/r*0.5/x*(k.lat-m.lat));r=new L.LatLng(W.lat-this.options.wallWidth/r*(k.lng-m.lng)*0.5*x,W.lng+this.options.wallWidth/r*0.5/x*(k.lat-m.lat));F=new L.LatLng(B.lat+0.5*(r.lng-N.lng)*Math.sqrt(3)*x+0.25*(r.lat-N.lat),B.lng-(r.lat-N.lat)*(0.5*Math.sqrt(3)/x)+
0.25*(r.lng-N.lng));O=new L.LatLng(B.lat-0.5*(N.lng-r.lng)*Math.sqrt(3)*x+0.25*(N.lat-r.lat),B.lng+(N.lat-r.lat)*(0.5*Math.sqrt(3)/x)+0.25*(N.lng-r.lng));W=new L.LatLng(w.lat-0.5*(r.lng-N.lng)*Math.sqrt(3)*x-0.25*(r.lat-N.lat),w.lng+(r.lat-N.lat)*(0.5*Math.sqrt(3)/x)-0.25*(r.lng-N.lng));U=new L.LatLng(w.lat+0.5*(N.lng-r.lng)*Math.sqrt(3)*x-0.25*(N.lat-r.lat),w.lng-(N.lat-r.lat)*(0.5*Math.sqrt(3)/x)-0.25*(N.lng-r.lng));this.options.controlLayerGrp.addLayer(a);x=0;for(var fa=this.options.snapOptions.snapLayersArray.length;x<
fa&&L.stamp(a)!==L.stamp(this.options.snapOptions.snapLayersArray[x]);x++);x===fa&&this.options.snapOptions.snapLayersArray.push(a);"wall"===d?(this._map.RSWEIndoor.options.showSizeArrows&&(x=w.distanceTo(B),x>e&&(d=new L.Polyline([B,w],{color:"#FFFFFF",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="size-arrows",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([F,O,B],{color:"#FFFFFF",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="size-arrows",this.options.drawnWallsLayerGrp.addLayer(d),
l.push(d),d=new L.Polygon([W,U,w],{color:"#FFFFFF",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="size-arrows",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=N.lat>r.lat?(new L.ScalableText(" "+(x+1E-4).toFixed(2)+" m ",r,N)).addTo(map):(new L.ScalableText(" "+(x+1E-4).toFixed(2)+" m ",N,r)).addTo(map),d.options.layerType="size-text",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d))),d=new L.Polygon([m,H,X,k,J,I],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType=
"wall",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([m,T,H,m,M,I],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([k,Y,X,k,E,J],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),f=new L.Polygon([C,z,A,D],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),f.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(f),
l.push(f)):"gap"===d?(d=new L.Polygon([D,P,G,C],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([A,R,Q,z],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([G,P,R,Q],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=
new L.Polygon([k,X,z],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([k,J,A],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([m,H,C],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([m,I,D],{color:"#000000",
weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),f=new L.Polygon([C,z,A,D],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),f.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(f),l.push(f)):"window"===d?(d=new L.Polygon([C,G,P,D],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([A,R,Q,z],{color:"#000000",weight:1,
opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([k,X,z],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([k,J,A],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([m,H,C],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),
d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([m,I,D],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([G,P,R,Q],{fillColor:"#ffffff",color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Curve(["M",[G.lat,G.lng],"L",[Q.lat,Q.lng]],{color:"#000000",weight:1,
opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Curve(["M",[P.lat,P.lng],"L",[R.lat,R.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Curve(["M",[s.lat,s.lng],"L",[p.lat,p.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),f=new L.Polygon([C,
z,A,D],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),f.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(f),l.push(f)):"door1"===d?(d=new L.Polygon([C,G,P,D],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([A,R,Q,z],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([k,X,z],{color:"#000000",
weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([k,J,A],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([m,H,C],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([m,I,D],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),
d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([G,P,R,Q],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Curve(["M",[s.lat,s.lng],"L",[S.lat,S.lng],"Q",[ca.lat,ca.lng],[p.lat,p.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),f=new L.Polygon([C,z,A,D],{color:"#000000",
weight:1,opacity:0,fillOpacity:0}),f.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(f),l.push(f)):"door2"===d?(d=new L.Polygon([C,G,P,D],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([A,R,Q,z],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([k,X,z],{color:"#000000",weight:1,
opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([k,J,A],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([m,H,C],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([m,I,D],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType=
"door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([G,P,R,Q],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Curve(["M",[s.lat,s.lng],"L",[aa.lat,aa.lng],"Q",[da.lat,da.lng],[p.lat,p.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),f=new L.Polygon([C,z,A,D],{color:"#000000",weight:1,opacity:0,
fillOpacity:0}),f.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(f),l.push(f)):"door3"===d?(d=new L.Polygon([C,G,P,D],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([A,R,Q,z],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([k,X,z],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),
d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([k,J,A],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([m,H,C],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([m,I,D],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),
l.push(d),d=new L.Polygon([G,P,R,Q],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Curve(["M",[p.lat,p.lng],"L",[S.lat,S.lng],"Q",[$.lat,$.lng],[s.lat,s.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),f=new L.Polygon([C,z,A,D],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),this.options.drawnWallsLayerGrp.addLayer(f),
f.options.layerType="control",l.push(f)):"door4"===d?(d=new L.Polygon([C,G,P,D],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([A,R,Q,z],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([k,X,z],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),
l.push(d),d=new L.Polygon([k,J,A],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([m,H,C],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([m,I,D],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Polygon([G,P,
R,Q],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Curve(["M",[p.lat,p.lng],"L",[aa.lat,aa.lng],"Q",[ba.lat,ba.lng],[s.lat,s.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),f=new L.Polygon([C,z,A,D],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),f.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(f)):
"rectangle"===d&&(d=new L.Polygon([m,k,V],{fillColor:"#ffffff",color:"#ffffff",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="rectangle",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Curve(["M",[m.lat,m.lng],"L",[k.lat,k.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="rectangle",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d),d=new L.Curve(["M",[(m.lat+V.lat)/2,(m.lng+V.lng)/2],"Q",[(8*m.lat+8*k.lat+1*V.lat)/17,(8*m.lng+8*k.lng+1*V.lng)/
17],[(k.lat+V.lat)/2,(k.lng+V.lng)/2]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="rectangle",this.options.drawnWallsLayerGrp.addLayer(d),l.push(d));if(f)f.on("contextmenu",ga(g,h),this)}this.options.roomWallsProps[g]=q;this.options.roomProps[g]=v;this.options.layers[g]={controlLayer:a,roomWalls:l};this.options.roomProps[g].freezeSquare||this.calcRoomSquare(g);this.options.roomProps[g].freezeLabel&&(K=new L.LatLng(parseFloat(this.options.roomProps[g].bindLabelPoint.lat),
parseFloat(this.options.roomProps[g].bindLabelPoint.lng)));K||(K=L.LatLngUtil.cloneLatLng(V));c=new L.LatLng(K.lat+0.01,K.lng);x=K.distanceTo(c);c.lat=K.lat+this.options.wallWidth/x*(c.lat-K.lat)*2;c.lng=K.lng+this.options.wallWidth/x*(c.lng-K.lng)*2;e=new L.LatLng(K.lat-(c.lat-K.lat),K.lng-(c.lng-K.lng));this.options.roomProps[g].roomName&&0<this.options.roomProps[g].roomName.length&&(Z=(new L.ScalableText(this.options.roomProps[g].roomName,L.LatLngUtil.cloneLatLng(K),L.LatLngUtil.cloneLatLng(c),
{bgColor:"transparent",attributes:{fill:"white"},editable:!0,onDrag:function(b,c){this._scalabletext._map.RSWEIndoor.options.roomProps[g].freezeLabel=!0;this._scalabletext._map.RSWEIndoor.options.labelsLayerGrp.eachLayer(function(b){b.options.relatedToLayer===a&&(b._latlngs[0].lat+=parseFloat(c.lat),b._latlngs[0].lng+=parseFloat(c.lng),b._latlngs[1].lat+=parseFloat(c.lat),b._latlngs[1].lng+=parseFloat(c.lng),b.redraw())});this._scalabletext._map.RSWEIndoor.options.roomProps[g].freezeLabel=!0;this._scalabletext._map.RSWEIndoor.options.roomProps[g].bindLabelPoint=
L.LatLngUtil.cloneLatLng(b._latlng)}})).addTo(map),Z.options.layerType="roomname",Z.options.relatedToLayer=a,this.options.controlLayerGrp.addLayer(Z),this.options.labelsLayerGrp.addLayer(Z),Z.on("contextmenu",ea(g),this));this._map.RSWEIndoor.options.showSquareLabels&&(h=this.options.roomProps[g].roomSquare,"wall"===a.options.layerType&&(h>this._map.RSWEIndoor.options.dontShowSquaresLessThan||this.options.roomProps[g].freezeSquare)&&!this.options.roomProps[g].hideSquare&&(K=(new L.ScalableText(" "+
(Number(h)+1E-4).toFixed(1)+" m\u00b2 ",L.LatLngUtil.cloneLatLng(e),L.LatLngUtil.cloneLatLng(K),{bgColor:"transparent",attributes:{fill:"white"},editable:Z?!1:!0,markerOnTop:!0,onDrag:function(b,c){this._scalabletext._map.RSWEIndoor.options.roomProps[g].freezeLabel=!0;this._scalabletext._map.RSWEIndoor.options.labelsLayerGrp.eachLayer(function(b){b.options.relatedToLayer===a&&(b._latlngs[0].lat+=parseFloat(c.lat),b._latlngs[0].lng+=parseFloat(c.lng),b._latlngs[1].lat+=parseFloat(c.lat),b._latlngs[1].lng+=
parseFloat(c.lng),b.redraw())});this._scalabletext._map.RSWEIndoor.options.roomProps[g].freezeLabel=!0;this._scalabletext._map.RSWEIndoor.options.roomProps[g].bindLabelPoint=L.LatLngUtil.cloneLatLng(b._latlng)}})).addTo(map),K.options.layerType="square",K.options.relatedToLayer=a,this.options.controlLayerGrp.addLayer(K),this.options.labelsLayerGrp.addLayer(K),K.on("contextmenu",ea(g),this)))}this.options.controlLayerGrp.bringToBack();this.options.drawnWallsLayerGrp.eachLayer(function(a){"square"===
a.options.layerType&&a.bringToFront()});this.options.drawnWallsLayerGrp.eachLayer(function(a){"rectangle"===a.options.layerType&&a.bringToFront()});this.options.drawnWallsLayerGrp.eachLayer(function(a){"wall"===a.options.layerType&&a.bringToFront()});this.options.drawnWallsLayerGrp.eachLayer(function(a){"size-arrows"===a.options.layerType&&a.bringToFront()});this.options.drawnWallsLayerGrp.eachLayer(function(a){"size-text"===a.options.layerType&&a.bringToFront()});this.options.drawnWallsLayerGrp.eachLayer(function(a){"window"===
a.options.layerType&&a.bringToFront()});this.options.drawnWallsLayerGrp.eachLayer(function(a){"door"===a.options.layerType&&a.bringToFront()});this.options.drawnWallsLayerGrp.eachLayer(function(a){"control"===a.options.layerType&&a.bringToFront()})}},ChangeWallType:function(a,b){if(this.options.layers[a].controlLayer&&this.options.roomWallsProps[a]){var c=this.options.roomWallsProps[a];if("wall"===c[b].wallType)c[b].wallType="gap";else if("gap"===c[b].wallType)c[b].wallType="wall";else if("door1"===
c[b].wallType)c[b].wallType="door2";else if("door2"===c[b].wallType)c[b].wallType="door4";else if("door4"===c[b].wallType)c[b].wallType="door3";else if("door3"===c[b].wallType)c[b].wallType="door1";else return;this.RedrawRoom(this.options.layers[a].controlLayer)}},SetSnapOptions:function(){this._map.drawControl.setDrawingOptions({wall:{snapType:"wall",gridStep:this.options.snapOptions.gridStep,snapToGrid:this.options.snapOptions.snapWallsToGrid,snapToObjects:this.options.snapOptions.snapWallsToObjects,
guideLayers:this.options.snapOptions.snapLayersArray,snapDistance:6},window:{snapType:"window",gridStep:this.options.snapOptions.gridStep,snapToGrid:this.options.snapOptions.snapWindowsToGrid,snapToObjects:this.options.snapOptions.snapWindowsToObjects,guideLayers:this.options.snapOptions.snapLayersArray,snapDistance:6},door:{snapType:"door",gridStep:this.options.snapOptions.gridStep,snapToGrid:this.options.snapOptions.snapDoorsToGrid,snapToObjects:this.options.snapOptions.snapDoorsToObjects,guideLayers:this.options.snapOptions.snapLayersArray,
snapDistance:6}})},showAllSquareLabels:function(){for(var a=0,b=this.options.roomProps.length;a<b;a++)this.options.roomProps[a].hideSquare=!1;this._map.fire("redraw:all")},calcRoomSquare:function(a){if(this.options.layers[a].controlLayer){var b=this.options.layers[a].controlLayer,c;b instanceof L.Polygon?c="polygon":b instanceof L.Polyline&&(c="polyline");if(c&&b._latlngs&&(b=b._latlngs,!(1>b.length))){var e=b.length;if(this.options.roomWallsProps[a]){var d=this.options.roomWallsProps[a];if(this.options.roomProps[a]){a=
this.options.roomProps[a];for(var f,g,h,n=0,l=0,q=0,v=0;v<e;v++)if(f=0.5*d[(v+e-1)%e].wallWidth,g=0.5*d[v%e].wallWidth,h=0.5*d[(v+1)%e].wallWidth,0===v&&"polyline"===c&&(f=0),v===e-1&&"polyline"===c&&(h=0),n+=2.03403157953845E13*(b[(v+1)%e].lng*b[v%e].lat-b[v%e].lng*b[(v+1)%e].lat)*Math.PI*Math.PI/(32400*Math.cos(b[v%e].lat*Math.PI/180)),v!==e-1||"polyline"!==c)l+=b[(v+1)%e].distanceTo(b[v%e])*g,q+=0.5*(f*g+g*h)/e;a.roomSquare=Math.abs(n)-l+q}}}}},getPNGData:function(a){var b=new Image;b.w=this.getSVGSize().x;
b.h=this.getSVGSize().y;if(0===b.w&&0===b.h)return a("");var c=L.Util.base64Encode(this.getSVGData());b.onload=function(){var c=F.createElement("canvas");c.width=b.w;c.height=b.h;var d=c.getContext("2d");d.beginPath();d.rect(0,0,b.w,b.h);d.fillStyle="white";d.fill();d.drawImage(b,0,0);c=c.toDataURL("image/png");return a(c.replace(/^data:image\/(png|jpg|jpeg);base64,/,""))};b.src="data:image/svg+xml;base64,"+c},getJPGData:function(a){var b=new Image;b.w=this.getSVGSize().x;b.h=this.getSVGSize().y;
if(0===b.w&&0===b.h)return a("");var c=L.Util.base64Encode(this.getSVGData());b.onload=function(){var c=F.createElement("canvas");c.width=b.w;c.height=b.h;var d=c.getContext("2d");d.beginPath();d.rect(0,0,b.w,b.h);d.fillStyle="white";d.fill();d.drawImage(b,0,0);c=c.toDataURL("image/jpeg",1);return a(c.replace(/^data:image\/(png|jpg|jpeg);base64,/,""))};b.src="data:image/svg+xml;base64,"+c},getSVGSize:function(){var a=!0,b;for(b in this.options.drawnWallsLayerGrp._layers)if(this.options.drawnWallsLayerGrp._layers.hasOwnProperty(b)){a=
!1;break}if(a)return{x:0,y:0};var a=this.options.drawnWallsLayerGrp.getBounds(),c=Math.cos(a.getCenter().lat*Math.PI/180);b=6378137*Math.PI;var e=1/this.options.pixelsPerMeter,c=180*e/(b*c);b=180*e/b;return{x:Math.round((a.getEast()-a.getWest())/c+1),y:Math.round((-a.getSouth()+a.getNorth())/b)+1}},getSVGData:function(){var a=!0,b;for(b in this.options.drawnWallsLayerGrp._layers)if(this.options.drawnWallsLayerGrp._layers.hasOwnProperty(b)){a=!1;break}if(a)return"";var c=this.options.drawnWallsLayerGrp.getBounds(),
a=Math.cos(c.getCenter().lat*Math.PI/180);b=6378137*Math.PI;var e=1/this.options.pixelsPerMeter,d=180*e/(b*a),f=180*e/b,g=this,h="",h=h+('<svg width="'+(function(a){return Math.round((a-c.getWest())/d)}(c.getEast())+1)+'" height="'+(function(a){return Math.round((-a+c.getNorth())/f)}(c.getSouth())+1)+'" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">\r\n');this.options.labelsLayerGrp.eachLayer(function(a){"square"===a.options.layerType&&(h+=g.layerToSVG(a))});this.options.labelsLayerGrp.eachLayer(function(a){"roomname"===
a.options.layerType&&(h+=g.layerToSVG(a))});this.options.drawnWallsLayerGrp.eachLayer(function(a){"rectangle"===a.options.layerType&&(h+=g.layerToSVG(a))});this.options.drawnWallsLayerGrp.eachLayer(function(a){"wall"===a.options.layerType&&(h+=g.layerToSVG(a))});this.options.drawnWallsLayerGrp.eachLayer(function(a){"size-arrows"===a.options.layerType&&(h+=g.layerToSVG(a))});this.options.drawnWallsLayerGrp.eachLayer(function(a){"size-text"===a.options.layerType&&(h+=g.layerToSVG(a))});this.options.drawnWallsLayerGrp.eachLayer(function(a){"window"===
a.options.layerType&&(h+=g.layerToSVG(a))});this.options.drawnWallsLayerGrp.eachLayer(function(a){"door"===a.options.layerType&&(h+=g.layerToSVG(a))});return h+="</svg>"},layerToSVG:function(a){var b=this.options.drawnWallsLayerGrp.getBounds(),c=Math.cos(b.getCenter().lat*Math.PI/180),e=6378137*Math.PI,d=1/this.options.pixelsPerMeter,f=180*d/(e*c),g=180*d/e,c=function(a){return Math.round((a-b.getWest())/f)},e=function(a){return Math.round((-a+b.getNorth())/g)},h,n,l,q="",v="";if(0!==a.options.opacity&&
"control"!==a.options.layerType){var u=d="";for(h in a._path.attributes)if(a._path.attributes.hasOwnProperty(h)){l=a._path.attributes[h].name;var t=a._path.attributes[h].value;"fill"===l&&a instanceof L.Polygon&&"door"===a.options.layerType&&(t="#ffffff");"fill"===l&&a instanceof L.Polygon&&"rectangle"===a.options.layerType&&(t="#dddddd");"stroke-opacity"===l&&a instanceof L.Polygon&&(t="0");"class"!==l&&"d"!==l&&(u+=" "+l+'="'+t+'"')}if(a instanceof L.Polygon&&("wall"===a.options.layerType||"window"===
a.options.layerType||"door"===a.options.layerType||"rectangle"===a.options.layerType)){h=0;for(n=a._latlngs.length;h<n;h++)l=a._latlngs[h],q+=(h?" L":"M")+c(l.lng)+" "+e(l.lat),v+=(h?" L":"M")+(c(l.lng)+1)+" "+(e(l.lat)+1);d+="<g><path "+u+' d="'+(q+" Z")+'"/></g>\r\n';return d+="<g><path "+u+' d="'+(v+" Z")+'"/></g>\r\n'}if(a instanceof L.Polygon&&"size-arrows"===a.options.layerType){h=0;for(n=a._latlngs.length;h<n;h++)l=a._latlngs[h],q+=(h?" L":"M")+c(l.lng)+".5 "+e(l.lat)+".5";q+=" Z";return d+=
"<g><path "+u+' d="'+q+'"/></g>\r\n'}if(!(a instanceof L.Polygon)&&a instanceof L.Polyline){h=0;for(n=a._latlngs.length;h<n;h++)l=a._latlngs[h],q+=(h?" L":"M")+c(l.lng)+".5 "+e(l.lat)+".5";return d="<g><path "+u+' d="'+q+'"/></g>\r\n'}if(a instanceof L.Curve){for(h=0;h<a._coords.length;h++)if(l=a._coords[h],"string"===typeof l||l instanceof String)n=l,q+=" "+n;else switch(n){case "H":q+=""+e(l[0])+".5 ";break;case "V":q+=c(l[1])+".5 ";break;default:q+=c(l[1])+".5 "+e(l[0])+".5 "}return d="<g><path "+
u+' d="'+q+'"/></g>\r\n'}a instanceof L.ScalableText&&(n=a._textNode.getAttribute("font-size").replace("px",""),q=1,v="",u=a._textNode.getComputedTextLength(),h=Math.cos(a._latlngs[0].lat*Math.PI/180),h=180*Math.atan2(-a._latlngs[0].lat+a._latlngs[1].lat,(a._latlngs[0].lng-a._latlngs[1].lng)*h)/Math.PI-90,a.options.center&&(v=v+" translate("+-0.5*u+")"),"size-text"===a.options.layerType&&(q*=1,v="translate("+c(a._latlngs[0].lng)+".5 "+e(a._latlngs[0].lat)+".5) scale("+q.toFixed(3)+")  rotate("+h+
")",a.options.center&&(v=v+" translate("+-0.5*u+")"),d='<g><g transform="'+v+'"><rect x="-2" y="-10" height="10" fill="black" width="'+12*u/n+'"/><text fill="white" text-anchor="start" y="-1" font-size="12px" font-family="Arial">'+a._text+"</text></g></g>\r\n"),"roomname"===a.options.layerType&&(q=16*q/10,v="translate("+c(a._latlngs[0].lng)+".5 "+e(a._latlngs[0].lat)+".5) scale("+q.toFixed(3)+")  rotate("+h+")",a.options.center&&(v=v+" translate("+-0.5*u+")"),d='<g><g transform="'+v+'"><text fill="#dddddd" text-anchor="start" y="-5" font-size="18px" font-family="Arial">'+
a._text+"</text></g></g>\r\n"),"square"===a.options.layerType&&(q=16*q/10,v="translate("+c(a._latlngs[0].lng)+".5 "+e(a._latlngs[0].lat)+".5) scale("+q.toFixed(3)+")  rotate("+h+")",a.options.center&&(v=v+" translate("+-0.5*u+")"),d='<g><g transform="'+v+'"><text fill="#dddddd" text-anchor="start" y="-1" font-size="18px" font-family="Arial">'+a._text+"</text></g></g>\r\n"));return d}},getData:function(){return JSON.stringify({roomProps:this.options.roomProps,roomWallsProps:this.options.roomWallsProps})},
loadData:function(a){a||(a='{"roomProps":[],"roomWallsProps":[]}');var b;try{b=JSON.parse(a)}catch(c){return!1}this.options.roomProps=[];this.options.roomWallsProps=[];this.options.layers=[];this.options.drawnWallsLayerGrp.clearLayers();this.options.controlLayerGrp.clearLayers();this.options.labelsLayerGrp.clearLayers();this.options.roomProps=b.roomProps;this.options.roomWallsProps=b.roomWallsProps;this.options.roomProps.forEach(function(a){var b;"rectangle"===a.layerClass&&(b=new L.Rectangle(a.layerLatlngs,
a.layerClassOptions));"polyline"===a.layerClass&&(b=new L.Polyline(a.layerLatlngs,a.layerClassOptions));"polygon"===a.layerClass&&(b=new L.Polygon(a.layerLatlngs,a.layerClassOptions));b&&(b.addTo(this._map),b.setStyle&&b.setStyle({opacity:0}),this.options.controlLayerGrp.addLayer(b),this.RedrawRoom(b))},this);this.options.fitBondsAfterLoad&&this.fitBounds();this._map.fire("close_all_dialogs");return!0},fitBounds:function(){var a;this.options.controlLayerGrp.eachLayer(function(b){a=a?a.extend(b.getBounds()):
b.getBounds()});a&&this._map.fitBounds(a)},RSWEinit:function(){var a=this._map;if(!a)throw Error("Leaflet has not properly initialized");var b;a.doubleClickZoom.disable();a.RSWEIndoor.options.controlLayerGrp=a.drawControl._toolbars.edit.options.featureGroup;a.RSWEIndoor.options.drawnWallsLayerGrp=new L.FeatureGroup;a.addLayer(a.RSWEIndoor.options.drawnWallsLayerGrp);a.RSWEIndoor.options.labelsLayerGrp=new L.FeatureGroup;a.addLayer(a.RSWEIndoor.options.labelsLayerGrp);a.options.snapGrid.options.interval=
a.RSWEIndoor.options.snapOptions.gridStep;a.RSWEIndoor.options.snapOptions.displaySnapGrid?a.options.snapGrid.show():a.options.snapGrid.hide();a.RSWEIndoor.SetSnapOptions();for(var c in this.options.dialogs)this.options.dialogs[c]=this.options.dialogs[c](),this._map.addControl(this.options.dialogs[c]);a.on("close_all_dialogs",function(){for(var b in this.RSWEIndoor.options.dialogs)this.RSWEIndoor.options.dialogs[b].close(),this.addControl(this.RSWEIndoor.options.dialogs[b]);a.drawControl._toolbars.draw.disable();
a.drawControl._toolbars.edit.disable()});a.on("draw:drawstart",function(c){b=c.layer;if("wall"===c.layerType||"window"===c.layerType||"door"===c.layerType)if(a.RSWEIndoor.SetSnapOptions(),b._poly!==t||b._poly.snapediting!==t)b._poly.snapediting=new L.Handler.PolylineSnap(a,b._poly),b._poly.snapediting._snapper._guides=a.RSWEIndoor.options.snapOptions.snapLayersArray,b._poly.snapediting._snapper.options.gridStep=a.RSWEIndoor.options.snapOptions.gridStep,"wall"===c.layerType&&(b._poly.snapediting._snapper.options.snapToGrid=
a.RSWEIndoor.options.snapOptions.snapWallsToGrid,b._poly.snapediting._snapper.options.snapToObjects=a.RSWEIndoor.options.snapOptions.snapWallsToObjects),"window"===c.layerType&&(b._poly.snapediting._snapper.options.snapToGrid=a.RSWEIndoor.options.snapOptions.snapWindowsToGrid,b._poly.snapediting._snapper.options.snapToObjects=a.RSWEIndoor.options.snapOptions.snapWindowsToObjects),"door"===c.layerType&&(b._poly.snapediting._snapper.options.snapToGrid=a.RSWEIndoor.options.snapOptions.snapDoorsToGrid,
b._poly.snapediting._snapper.options.snapToObjects=a.RSWEIndoor.options.snapOptions.snapDoorsToObjects),b._poly.snapediting.enable()});a.on("draw:editstart_after",function(){a.RSWEIndoor.options.controlLayerGrp.eachLayer(function(b){b.setStyle&&b.setStyle({opacity:0.6});b.editing._poly!==t&&b.snapediting===t&&(a.removeLayer(b.editing._markerGroup),b.snapediting=new L.Handler.PolylineSnap(a,b),b.snapediting._snapper._guides=a.RSWEIndoor.options.snapOptions.snapLayersArray,b.snapediting._snapper.options.gridStep=
a.RSWEIndoor.options.snapOptions.gridStep,"wall"===b.options.layerType&&(b.snapediting._snapper.options.snapToGrid=a.RSWEIndoor.options.snapOptions.snapWallsToGrid,b.snapediting._snapper.options.snapToObjects=a.RSWEIndoor.options.snapOptions.snapWallsToObjects),"window"===b.options.layerType&&(b.snapediting._snapper.options.snapToGrid=a.RSWEIndoor.options.snapOptions.snapWindowsToGrid,b.snapediting._snapper.options.snapToObjects=a.RSWEIndoor.options.snapOptions.snapWindowsToObjects),"door"===b.options.layerType&&
(b.snapediting._snapper.options.snapToGrid=a.RSWEIndoor.options.snapOptions.snapDoorsToGrid,b.snapediting._snapper.options.snapToObjects=a.RSWEIndoor.options.snapOptions.snapDoorsToObjects),b.snapediting.enable())},a)});a.on("draw:editstop",function(){a.RSWEIndoor.options.controlLayerGrp.eachLayer(function(a){a.setStyle&&a.setStyle({opacity:0});a.editing._poly!==t&&a.snapediting!==t&&(a.snapediting.disable(),delete a.snapediting);a._mouseMarker&&a._mouseMarker._snapper&&(a._mouseMarker._snapper.disable(),
delete a._mouseMarker._snapper)},a)});a.on("revert-edited",function(b){a.RSWEIndoor.RedrawRoom(b.layer)});a.on("edit",function(b){a.RSWEIndoor.RedrawRoom(b.layer)});a.on("draw:deleted",function(a){a=a.layers._layers;for(var b in a)this.RSWEIndoor.DeleteRoom(a[b])});a.on("draw:created",function(b){b.layer.setStyle&&b.layer.setStyle({opacity:0});a.RSWEIndoor.RedrawRoom(b.layer,b.layerType)});a.on("redraw:all",function(){a.RSWEIndoor.options.labelsLayerGrp.clearLayers();a.RSWEIndoor.options.controlLayerGrp.eachLayer(function(b){a.RSWEIndoor.RedrawRoom(b)})});
a.on("redraw:showAllSquareLabels",function(){a.RSWEIndoor.showAllSquareLabels()})}});L.Map.addInitHook(function(){if(this.options.RSWEIndoor){var a=new L.FeatureGroup;this.addLayer(a);this.drawControl=new L.Control.Draw({edit:{featureGroup:a}});this.addControl(this.drawControl);this.RSWEIndoor=new L.Control.RSWEIndoor;this.RSWEIndoor._map=this;this.slideMenu=L.control.slideMenu("",{});this.addControl(this.slideMenu);this.graphicScaleControl=L.control.graphicScale().addTo(this);this.options.simpleGraticule=
(new L.simpleGraticule).addTo(this);this.options.snapGrid=(new L.snapGrid).addTo(this);this.RSWEIndoor.RSWEinit()}});L.CustomToolbar=(L.Layer||L.Class).extend({statics:{baseClass:"leaflet-toolbar"},includes:L.Mixin.Events,options:{className:"",filter:function(){return!0},actions:[]},initialize:function(a){L.setOptions(this,a);this._toolbarType=this.constructor._toolbarClassId},addTo:function(a){this._arguments=[].slice.call(arguments);a.addLayer(this);return this},onAdd:function(a){var b=a._customtoolbars[this._toolbarType];
0===this._calculateDepth()&&(b&&a.removeLayer(b),a._customtoolbars[this._toolbarType]=this)},onRemove:function(a){0===this._calculateDepth()&&delete a._customtoolbars[this._toolbarType]},remove:function(){this._map.removeLayer(this)},appendToContainer:function(a){var b=this.constructor.baseClass+"-"+this._calculateDepth()+" "+this.options.className,c;this._container=a;this._ul=L.DomUtil.create("ul",b,a);this._disabledEvents=["click","mousemove","dblclick"];a=0;for(b=this._disabledEvents.length;a<
b;a++)L.DomEvent.on(this._ul,this._disabledEvents[a],L.DomEvent.stopPropagation);a=0;for(b=this.options.actions.length;a<b;a++)c=this._getActionConstructor(this.options.actions[a]),c=new c,c._createIcon(this,this._ul,this._arguments)},_getActionConstructor:function(a){var b=this._arguments,c=this;return a.extend({initialize:function(){a.prototype.initialize.apply(this,b)},enable:function(b){c._active&&c._active.disable();c._active=this;a.prototype.enable.call(this,b)}})},_hide:function(){this._ul.style.display=
"none"},_show:function(){this._ul.style.display="block"},_calculateDepth:function(){for(var a=0,b=this.parentToolbar;b;)a+=1,b=b.parentToolbar;return a}});L.customtoolbar={};var $=0;L.CustomToolbar.extend=function(a){var b=L.extend({},a.statics,{_toolbarClassId:$});$+=1;L.extend(a,{statics:b});return L.Class.extend.call(this,a)};L.Map.addInitHook(function(){this._customtoolbars={}});L.ToolbarAction=L.Handler.extend({statics:{baseClass:"leaflet-toolbar-icon"},options:{toolbarIcon:{html:"",className:"",
tooltip:""},isHidden:function(){return!1},separator:!1,subToolbar:new L.CustomToolbar},initialize:function(a){var b=L.ToolbarAction.prototype.options.toolbarIcon;L.setOptions(this,a);this.options.toolbarIcon=L.extend({},b,this.options.toolbarIcon)},enable:function(a){a&&L.DomEvent.preventDefault(a);this._enabled||(this._enabled=!0,this.addHooks&&this.addHooks(),this._map&&this.toolbar&&("function"===typeof this.options.callback&&this.options.callback.call(this,this._map),0===this.options.subToolbar.options.actions.length&&
this._map.removeLayer(this.toolbar)))},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks&&this.removeHooks())},_createIcon:function(a,b,c){var e=this.options.toolbarIcon;this.toolbar=a;this._map=a._map;this.options.isHidden.call(this,this._map)||(this._icon=L.DomUtil.create("li","",b),this._link=L.DomUtil.create("a","",this._icon),this.options.separator&&L.DomUtil.addClass(this._link,"leaflet-toolbar-icon-separator"),this._link.innerHTML="<div>"+e.html+"</div>",this._link.setAttribute("href",
"#"),this._link.setAttribute("title",e.tooltip),L.DomUtil.addClass(this._link,this.constructor.baseClass),e.className&&L.DomUtil.addClass(this._link,e.className),L.DomEvent.on(this._link,"click",this.enable,this),this._addSubToolbar(a,this._icon,c))},_addSubToolbar:function(a,b,c){var e=this.options.subToolbar,d=this.addHooks,f=this.removeHooks;e.parentToolbar=a;0<e.options.actions.length&&(c=[].slice.call(c),c.push(this),e.addTo.apply(e,c),e.appendToContainer(b),this.addHooks=function(a){"function"===
typeof d&&d.call(this,a);e._show()},this.removeHooks=function(a){"function"===typeof f&&f.call(this,a);e._hide()})}});L.ToolbarAction.extendOptions=function(a){return this.extend({options:a})};L.ToolbarActionInput=L.ToolbarAction.extend({statics:{baseClass:"leaflet-toolbar-icon"},options:{toolbarIcon:{html:"",className:"",tooltip:""},isHidden:function(){return!1},separator:!1,placeholder:"",setInitValue:function(){return""}},enable:function(a){var b=!1;a&&L.DomEvent.preventDefault(a);this._enabled||
(this._enabled=!0,this.addHooks&&this.addHooks(),this._map&&this.toolbar&&("function"===typeof this.options.callback&&(b=this.options.callback.call(this,this._map,this._input)),b&&this._map.removeLayer(this.toolbar)))},enableOnEnter:function(a){13===a.which&&(this._input.blur(),this.enable(a))},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks&&this.removeHooks())},_createIcon:function(a,b){var c=this.options.toolbarIcon;this.toolbar=a;this._map=a._map;this.options.isHidden.call(this,
this._map)||(this._icon=L.DomUtil.create("li","",b),this._link=L.DomUtil.create("a","leaflet-toolbar-icon-input",this._icon),this.options.separator&&L.DomUtil.addClass(this._link,"leaflet-toolbar-icon-separator"),this._link.setAttribute("href","#"),this._link.setAttribute("title",c.tooltip),L.DomUtil.addClass(this._link,this.constructor.baseClass),c.className&&L.DomUtil.addClass(this._link,c.className),L.DomEvent.on(this._link,"click",this.enable,this),this._div=L.DomUtil.create("div","leaflet-toolbar-div-input",
this._icon),this.options.separator&&L.DomUtil.addClass(this._div,"leaflet-toolbar-icon-separator"),this._input=L.DomUtil.create("input","",this._div),this._input.setAttribute("onclick","this.select();"),L.DomEvent.on(this._input,"keypress",this.enableOnEnter,this),this._input.setAttribute("type","text"),"function"===typeof this.options.setInitValue&&this._input.setAttribute("value",this.options.setInitValue.call(this,this._map,this._input)),this.options.placeholder&&this._input.setAttribute("placeholder",
this.options.placeholder))}});L.ToolbarActionInput.extendOptions=function(a){return this.extend({options:a})};L.ToolbarActionLabel=L.ToolbarAction.extend({statics:{baseClass:"leaflet-toolbar-icon"},options:{toolbarIcon:{html:"",className:"",tooltip:""},isHidden:function(){return!1},separator:!1,label:""},enable:function(a){a&&L.DomEvent.preventDefault(a);this._enabled=!1},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks&&this.removeHooks())},_createIcon:function(a,b){var c=this.options.toolbarIcon;
this.toolbar=a;this._map=a._map;this.options.isHidden.call(this,this._map)||(this._icon=L.DomUtil.create("li","",b),this._link=L.DomUtil.create("a","leaflet-toolbar-noicon leaflet-toolbar-label",this._icon),this.options.separator&&L.DomUtil.addClass(this._link,"leaflet-toolbar-icon-separator"),this._link.setAttribute("href","#"),this._link.setAttribute("title",c.tooltip),L.DomUtil.addClass(this._link,this.constructor.baseClass),c.className&&L.DomUtil.addClass(this._link,c.className),L.DomEvent.on(this._link,
"click",this.enable,this),this._div=L.DomUtil.create("div","leaflet-toolbar-div-label",this._link),this.options.label&&(this._div.innerHTML=this.options.label))}});L.ToolbarActionLabel.extendOptions=function(a){return this.extend({options:a})};L.ToolbarPopup=L.CustomToolbar.extend({statics:{baseClass:"leaflet-popup-toolbar "+L.CustomToolbar.baseClass},options:{anchor:[0,0]},initialize:function(a,b){L.CustomToolbar.prototype.initialize.call(this,b);this._marker=new L.Marker(a,{icon:new L.DivIcon({className:this.options.className,
iconSize:[0,0],iconAnchor:[0,0]})})},onAdd:function(a){this._map=a;this._marker.addTo(a);this._map.fire("popups:hide",{caller:this});L.CustomToolbar.prototype.onAdd.call(this,a);this.appendToContainer(this._marker._icon);this._setStyles();L.DomEvent.on(this._map.getContainer(),"mouseleave",this.remove,this);L.DomEvent.on(this._container,"click",L.DomEvent.stop).on(this._container,"mousedown",L.DomEvent.stop).on(this._container,"dblclick",L.DomEvent.stop).on(this._container,"contextmenu",L.DomEvent.stop);
this._map.on({mousedown:this.remove,click:this.remove,movestart:this.remove,zoomstart:this.remove},this);this._map.on({"popups:hide":this._onPopupsHide},this)},_onPopupsHide:function(a){a.caller&&a.caller!==this&&this.remove()},onRemove:function(a){L.DomEvent.off(this._container,"click",L.DomEvent.stop).off(this._container,"mousedown",L.DomEvent.stop).off(this._container,"dblclick",L.DomEvent.stop).off(this._container,"contextmenu",L.DomEvent.stop);L.DomEvent.off(this._map.getContainer(),"mouseleave",
this.remove,this);this._map.off({mousedown:this.remove,click:this.remove,movestart:this.remove,zoomstart:this.remove},this);this._map.off({"popups:hide":this._onPopupsHide},this);a.removeLayer(this._marker);L.CustomToolbar.prototype.onRemove.call(this,a);delete this._map},setLatLng:function(a){this._marker.setLatLng(a);return this},_setStyles:function(){for(var a=this._container,b=this._ul,c=L.point(this.options.anchor),e=b.querySelectorAll(".leaflet-toolbar-icon"),d=[],f=[],g=0,g=0,h=e.length;g<
h;g++)e[g].parentNode.parentNode===b&&(d.push(parseInt(L.DomUtil.getStyle(e[g],"height"),10)),f.push(parseInt(L.DomUtil.getStyle(e[g],"width"),10)));g=f.reduce(function(a,b){return Math.max(a,b)},0);d.reduce(function(a,b){return a+b},0);b.style.width=g+"px";this._tipContainer=L.DomUtil.create("div","leaflet-toolbar-tip-container",a);this._tipContainer.style.width=g+"px";this._tip=L.DomUtil.create("div","leaflet-toolbar-tip",this._tipContainer);b=parseInt(L.DomUtil.getStyle(this._tip,"width"),10);
b=new L.Point(0,0.7071*b);a.style.marginLeft=c.x-b.x+"px";a.style.marginTop=c.y-b.y+"px"}});L.SquareToolbarPopup=L.ToolbarPopup.extend({options:{className:"leaflet-draw-toolbar",actions:[L.ToolbarActionInput.extendOptions({toolbarIcon:{html:"Input",className:"leaflet-draw-edit-edit"},setInitValue:function(a){return(a=a.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].roomName)?a:""},separator:!0,placeholder:"Room name",callback:function(a,b){var c=b.value;if(20>=c.length)return a.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].roomName=
c,a.RSWEIndoor.RedrawRoom(a.RSWEIndoor.options.layers[this.toolbar.options.roomId].controlLayer),!0;b.value=c?c.substr(0,20):"";b.select();return!1}}),L.ToolbarActionInput.extendOptions({toolbarIcon:{html:"Input",className:"leaflet-draw-edit-edit"},isHidden:function(a){return a.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].hideSquare?!0:!1},setInitValue:function(a){return Number(a.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].roomSquare).toFixed(1)},placeholder:"Enter decimal",
callback:function(a,b){var c=b.value.replace(RegExp(",","g"),".");if(isNaN(c))return b.value=Number(Number(a.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].roomSquare).toFixed(1)),b.select(),!1;a.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].roomSquare=Number(Number(c).toFixed(1));a.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].freezeSquare=!0;a.RSWEIndoor.RedrawRoom(a.RSWEIndoor.options.layers[this.toolbar.options.roomId].controlLayer);return!0}}),L.ToolbarAction.extendOptions({toolbarIcon:{html:"Recalculate",
className:"leaflet-toolbar-noicon"},isHidden:function(a){return a.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].hideSquare?!0:!1},callback:function(a){a.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].freezeLabel=!1;a.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].freezeSquare=!1;a.RSWEIndoor.RedrawRoom(a.RSWEIndoor.options.layers[this.toolbar.options.roomId].controlLayer)}}),L.ToolbarAction.extendOptions({toolbarIcon:{html:"Hide square",className:"leaflet-toolbar-noicon"},
isHidden:function(a){return a.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].hideSquare?!0:!1},callback:function(a){a.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].hideSquare=!0;a.RSWEIndoor.RedrawRoom(a.RSWEIndoor.options.layers[this.toolbar.options.roomId].controlLayer)}}),L.ToolbarAction.extendOptions({toolbarIcon:{html:"Show square",className:"leaflet-toolbar-noicon"},isHidden:function(a){return a.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].hideSquare?!1:!0},
callback:function(a){a.RSWEIndoor.options.roomProps[this.toolbar.options.roomId].hideSquare=!1;a.RSWEIndoor.RedrawRoom(a.RSWEIndoor.options.layers[this.toolbar.options.roomId].controlLayer)}})]},initialize:function(a,b,c){this.options.roomId=a;L.setOptions(this,c);L.ToolbarPopup.prototype.initialize.call(this,b,c)}});L.WallToolbarPopup=L.ToolbarPopup.extend({options:{className:"leaflet-draw-toolbar",actions:[L.ToolbarActionLabel.extendOptions({toolbarIcon:{html:"",className:"leaflet-toolbar-noicon"},
label:"Wall width (cm):"}),L.ToolbarActionInput.extendOptions({toolbarIcon:{html:"Input",className:"leaflet-draw-edit-edit"},setInitValue:function(a){return parseInt(100*a.RSWEIndoor.options.roomWallsProps[this.toolbar.options.roomId][this.toolbar.options.wallId].wallWidth,10)},separator:!0,placeholder:"Wall width",callback:function(a,b){var c=this.toolbar.options.roomId,e=this.toolbar.options.wallId,d=a.RSWEIndoor.options.roomWallsProps[c][e].wallWidth,f=parseInt(b.value,10);if(!isNaN(f)&&0<f&&101>
f)return a.RSWEIndoor.options.roomWallsProps[c][e].wallWidth=0.01*f,a.RSWEIndoor.RedrawRoom(a.RSWEIndoor.options.layers[c].controlLayer),!0;b.value=parseInt(100*d,10)}}),L.ToolbarAction.extendOptions({toolbarIcon:{html:"Hide wall",className:"leaflet-toolbar-noicon"},isHidden:function(a){return"wall"===a.RSWEIndoor.options.roomWallsProps[this.toolbar.options.roomId][this.toolbar.options.wallId].wallType?!1:!0},callback:function(a){a.RSWEIndoor.ChangeWallType(this.toolbar.options.roomId,this.toolbar.options.wallId)}}),
L.ToolbarAction.extendOptions({toolbarIcon:{html:"Show wall",className:"leaflet-toolbar-noicon"},isHidden:function(a){return"gap"===a.RSWEIndoor.options.roomWallsProps[this.toolbar.options.roomId][this.toolbar.options.wallId].wallType?!1:!0},callback:function(a){a.RSWEIndoor.ChangeWallType(this.toolbar.options.roomId,this.toolbar.options.wallId)}}),L.ToolbarAction.extendOptions({toolbarIcon:{html:"Rotate",className:"leaflet-toolbar-noicon"},isHidden:function(a){a=a.RSWEIndoor.options.roomWallsProps[this.toolbar.options.roomId][this.toolbar.options.wallId].wallType;
return"door1"===a||"door2"===a||"door3"===a||"door4"===a?!1:!0},callback:function(a){a.RSWEIndoor.ChangeWallType(this.toolbar.options.roomId,this.toolbar.options.wallId);return!0}})]},initialize:function(a,b,c,e){this.options.roomId=a;this.options.wallId=b;L.setOptions(this,e);L.ToolbarPopup.prototype.initialize.call(this,c,e)}});L.Control.Dialog=L.Control.extend({options:{size:[300,300],minSize:[100,100],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},initialize:function(a){L.setOptions(this,
a);this._attributions={}},onAdd:function(a){this._initLayout();this._map=a;this.update();this.options.initOpen||this.close();return this._container},open:function(){if(this._map)return this._container.style.visibility="",this._map.fire("dialog:opened",this),this},close:function(){this._container.style.visibility="hidden";this._map.fire("dialog:closed",this);return this},destroy:function(){if(!this._map)return this;this.removeFrom(this._map);if(this.onRemove)this.onRemove(this._map);this._map.fire("dialog:destroyed",
this);return this},setLocation:function(a){a=a||[250,250];this.options.anchor[0]=0;this.options.anchor[1]=0;this._oldMousePos.x=0;this._oldMousePos.y=0;this._move(a[0],a[1]);return this},setSize:function(a){a=a||[300,300];this.options.size[0]=0;this.options.size[1]=0;this._oldMousePos.x=0;this._oldMousePos.y=0;this._resize(a[0],a[1]);return this},lock:function(){this._resizerNode.style.visibility="hidden";this._grabberNode.style.visibility="hidden";this._closeNode.style.visibility="hidden";this._map.fire("dialog:locked",
this);return this},unlock:function(){this._resizerNode.style.visibility="";this._grabberNode.style.visibility="";this._closeNode.style.visibility="";this._map.fire("dialog:unlocked",this);return this},freeze:function(){this._resizerNode.style.visibility="hidden";this._grabberNode.style.visibility="hidden";this._map.fire("dialog:frozen",this);return this},unfreeze:function(){this._resizerNode.style.visibility="";this._grabberNode.style.visibility="";this._map.fire("dialog:unfrozen",this);return this},
setContent:function(a){this._content=a;this.update();return this},getContent:function(){return this._content},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._container.style.visibility="",this._map.fire("dialog:updated",this))},_initLayout:function(){var a=this._container=L.DomUtil.create("div","leaflet-control-dialog");a.style.width=this.options.size[0]+"px";a.style.height=this.options.size[1]+
"px";a.style.left=this.options.anchor[0]+"px";a.style.top=this.options.anchor[1]+"px";var b=L.DomEvent.stopPropagation;L.DomEvent.on(a,"click",b).on(a,"mousedown",b).on(a,"touchstart",b).on(a,"dblclick",b).on(a,"mousewheel",b).on(a,"contextmenu",b).on(a,"MozMousePixelScroll",b);var b=this._innerContainer=L.DomUtil.create("div","leaflet-control-dialog-inner"),c=this._grabberNode=L.DomUtil.create("div","leaflet-control-dialog-grabber");c.innerHTML="<b>&#8689;</b>";L.DomEvent.on(c,"mousedown",this._handleMoveStart,
this);var e=this._closeNode=L.DomUtil.create("div","leaflet-control-dialog-close");e.innerHTML="<b>X</b>";L.DomEvent.on(e,"click",this._handleClose,this);var d=this._resizerNode=L.DomUtil.create("div","leaflet-control-dialog-resizer");d.innerHTML="<b>&#8690;</b>";L.DomEvent.on(d,"mousedown",this._handleResizeStart,this);var f=this._contentNode=L.DomUtil.create("div","leaflet-control-dialog-contents");a.appendChild(b);b.appendChild(f);b.appendChild(c);b.appendChild(e);b.appendChild(d);this._oldMousePos=
{x:0,y:0}},_handleClose:function(){this.close()},_handleResizeStart:function(a){this._oldMousePos.x=a.clientX;this._oldMousePos.y=a.clientY;L.DomEvent.on(this._map,"mousemove",this._handleMouseMove,this);L.DomEvent.on(this._map,"mouseup",this._handleMouseUp,this);this._map.fire("dialog:resizestart",this);this._resizing=!0},_handleMoveStart:function(a){this._oldMousePos.x=a.clientX;this._oldMousePos.y=a.clientY;L.DomEvent.on(this._map,"mousemove",this._handleMouseMove,this);L.DomEvent.on(this._map,
"mouseup",this._handleMouseUp,this);this._map.fire("dialog:movestart",this);this._moving=!0},_handleMouseMove:function(a){var b=a.originalEvent.clientX-this._oldMousePos.x,c=a.originalEvent.clientY-this._oldMousePos.y;a.originalEvent.stopPropagation&&a.originalEvent.stopPropagation();a.originalEvent.preventDefault&&a.originalEvent.preventDefault();this._resizing&&this._resize(b,c);this._moving&&this._move(b,c)},_handleMouseUp:function(){L.DomEvent.off(this._map,"mousemove",this._handleMouseMove,this);
L.DomEvent.off(this._map,"mouseup",this._handleMouseUp,this);this._resizing&&(this._resizing=!1,this._map.fire("dialog:resizeend",this));this._moving&&(this._moving=!1,this._map.fire("dialog:moveend",this))},_move:function(a,b){var c=this.options.anchor[1]+b;this.options.anchor[0]+=a;this.options.anchor[1]=c;this._container.style.left=this.options.anchor[0]+"px";this._container.style.top=this.options.anchor[1]+"px";this._map.fire("dialog:moving",this);this._oldMousePos.y+=b;this._oldMousePos.x+=a},
_resize:function(a,b){var c=this.options.size[0]+a,e=this.options.size[1]+b;c<=this.options.maxSize[0]&&c>=this.options.minSize[0]&&(this.options.size[0]=c,this._container.style.width=this.options.size[0]+"px",this._oldMousePos.x+=a);e<=this.options.maxSize[1]&&e>=this.options.minSize[1]&&(this.options.size[1]=e,this._container.style.height=this.options.size[1]+"px",this._oldMousePos.y+=b);this._map.fire("dialog:resizing",this)},_updateContent:function(){if(this._content){var a=this._contentNode,
b="function"===typeof this._content?this._content(this):this._content;if("string"===typeof b)a.innerHTML=b;else{for(;a.hasChildNodes();)a.removeChild(a.firstChild);a.appendChild(b)}}},_updateLayout:function(){this._container.style.width=this.options.size[0]+"px";this._container.style.height=this.options.size[1]+"px";this._container.style.left=this.options.anchor[0]+"px";this._container.style.top=this.options.anchor[1]+"px"}});L.control.dialog=function(a){return new L.Control.Dialog(a)};L.Control.Dialog.WallProps=
L.Control.Dialog.extend({options:{size:[320,200],minSize:[320,200],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,_innerHTML:{},_curRoomId:0,_curWallId:0,initialize:function(){L.setOptions(this,this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},
_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},_selectTab:function(a){for(var b=this._getTabCount(),c=0;c<b;c++){var e=this._getTab(c),d=this._getTabTitle(c);a!==c?(e.setAttribute("class","dialog-tab"),d.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),d.setAttribute("class",
"dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.size=[Math.max(this.options.size[0],this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])];this.options.anchor=[Math.floor(0.5*(a.x-this.options.size[0])),Math.floor(0.5*(a.y-this.options.size[1]))];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");
this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),c=0;c<b;c++)L.DomEvent.addListener(this._getTabTitle(c),"click",a(c),this);this._dlgCreateControls();this.options.initOpen?this.open():this.close();return this._container},close:function(){this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">Wall options</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Wall options</h3></div></div>;</div>;</div>;'.split(";"),
saveAsText:function(){var a=this.options.saveALink,b="RSWE.json";this.options.InputName.value&&(b=this.options.InputName.value);a.download=b;b=this._map.RSWEIndoor.getData();a.href="data:text/plain;base64,"+L.Util.base64Encode(b);a.click();this.close()},_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))b=L.DomUtil.create("div","innerHTML"),a.appendChild(b),b.innerHTML='<label><span> Wall width (cm)</span> <input type="text" name="wallWidth" placeholder="Wall width"/></label>',this._innerHTML=
b,a=b.getElementsByTagName("INPUT")[0],L.DomEvent.addListener(a,"change",this.setWallWidth,this)},setDlgInputs:function(a,b){this._curRoomId=a;this._curWallId=b;this._curWallWidth=this._map.RSWEIndoor.options.roomWallsProps[a][this._curWallId].wallWidth;this._innerHTML.getElementsByTagName("INPUT")[0].value=parseInt(100*this._curWallWidth,10);return this},setWallWidth:function(a){if(a.target.value){var b=parseInt(a.target.value,10);!isNaN(b)&&0<b&&101>b?(this._map.RSWEIndoor.options.roomWallsProps[this._curRoomId][this._curWallId].wallWidth=
0.01*b,this.close(),this._map.RSWEIndoor.RedrawRoom(this._map.RSWEIndoor.options.layers[this._curRoomId].controlLayer)):a.target.value=parseInt(100*this._curWallWidth,10)}}});L.control.dialog.wallprops=function(a){return new L.Control.Dialog.WallProps(a)};L.Control.Dialog.Options=L.Control.Dialog.extend({options:{size:[320,190],minSize:[320,190],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,this.options);L.Control.Dialog.prototype.initialize.call(this,
this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},_selectTab:function(a){for(var b=
this._getTabCount(),c=0;c<b;c++){var e=this._getTab(c),d=this._getTabTitle(c);a!==c?(e.setAttribute("class","dialog-tab"),d.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),d.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.6*a.x),Math.floor(0.6*a.y)];this.options.size=[Math.max(this.options.size[0],this.options.minSize[0]),
Math.max(this.options.size[1],this.options.minSize[1])];this.options.anchor=[Math.floor(0.5*(a.x-this.options.size[0])),Math.floor(0.5*(a.y-this.options.size[1]))];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),c=0;c<b;c++)L.DomEvent.addListener(this._getTabTitle(c),"click",a(c),this);this._dlgCreateControls();this.options.initOpen?this.open():this.close();return this._container},
close:function(){this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">View Options</li>;<li class="dialog-tab-title">Edit Options</li>;<li class="dialog-tab-title">Snap Options</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>View Options</h3></div></div>;<div class="dialog-tab"><div class="dialog-tab-content"><h3>Edit Options</h3></div></div>;<div class="dialog-tab"><div class="dialog-tab-content"><h3>Snap Options</h3></div></div>;</div>;</div>;'.split(";"),
_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))this._map.options.simpleGraticule!==t&&(b=L.DomUtil.create("div","display-grid-control"),a.appendChild(b),b.innerHTML=!1===this._map.options.simpleGraticule.options.hidden?'<label><input type="checkbox" checked name="simpleGraticule" value="1" />Display Measure Grid</label>':'<label><input type="checkbox" name="simpleGraticule" value="1" />Display Measure Grid</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",
function(a){a.target.checked?this._map.options.simpleGraticule.show():this._map.options.simpleGraticule.hide()},this)),this._map.options.graphicScaleControl!==t&&(b=L.DomUtil.create("div","display-graphicscale-control"),a.appendChild(b),b.innerHTML="none"===this._map.options.graphicScaleControl.style.display?'<label><input type="checkbox" name="graphicScaleControl" value="1" />Display Ruler</label>':'<label><input type="checkbox" checked name="graphicScaleControl" value="1" />Display Ruler</label>',
L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.options.graphicScaleControl.style.display=a.target.checked?"block":"none"},this)),this._map.RSWEIndoor.options.fitBondsAfterLoad!==t&&(b=L.DomUtil.create("div","display-fitbonds-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.fitBondsAfterLoad?'<label><input type="checkbox" checked name="fitBondsAfterLoad" value="1" />Fit Bonds After Load</label>':'<label><input type="checkbox" name="fitBondsAfterLoad" value="1" />Fit Bonds After Load</label>',
L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.fitBondsAfterLoad=a.target.checked?!0:!1},this)),this._map.RSWEIndoor.options.showSizeArrows!==t&&(b=L.DomUtil.create("div","display-showSizeArrows-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.showSizeArrows?'<label><input type="checkbox" checked name="showSizeArrows" value="1" />Show Size Arrows</label>':'<label><input type="checkbox" name="showSizeArrows" value="1" />Show Size Arrows</label>',
L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.showSizeArrows=a.target.checked?!0:!1;this._map.fire("redraw:all")},this)),this._map.RSWEIndoor.options.dontShowSmallSizeLabels!==t&&(b=L.DomUtil.create("div","dontShowSmallSizeLabels-control"),a.appendChild(b),b.innerHTML='<label><input type="text" name="dontShowSmallSizeLabels" /> Dont Show Wall Size Labels Smaller Than(meters)</label>',b.firstChild.firstElementChild.setAttribute("value",this._map.RSWEIndoor.options.dontShowSmallSizeLabels),
L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){if(a.target.value){var b=a.target.value.replace(RegExp(",","g"),".");isNaN(b)?a.target.value=this._map.RSWEIndoor.options.dontShowSmallSizeLabels:(this._map.RSWEIndoor.options.dontShowSmallSizeLabels=b,a.target.value=b,this._map.fire("redraw:all"))}},this)),this._map.RSWEIndoor.options.considerWallThikness!==t&&(b=L.DomUtil.create("div","considerWallThikness-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.considerWallThikness?
'<label><input type="checkbox" checked name="considerWallThikness" value="1" />Consider Wall Thikness</label>':'<label><input type="checkbox" name="considerWallThikness" value="1" />Consider Wall Thikness</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.considerWallThikness=a.target.checked?!0:!1;this._map.fire("redraw:all")},this)),this._map.RSWEIndoor.options.showSquareLabels!==t&&(b=L.DomUtil.create("div","display-showSquareLabels-control"),
a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.showSquareLabels?'<label><input type="checkbox" checked name="showSquareLabels" value="1" />Show Square Labels</label>':'<label><input type="checkbox" name="showSquareLabels" value="1" />Show Square Labels</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.showSquareLabels=a.target.checked?!0:!1;this._map.fire("redraw:all")},this)),this._map.RSWEIndoor.options.dontShowSquaresLessThan!==
t&&(b=L.DomUtil.create("div","dontShowSquaresLessThan-control"),a.appendChild(b),b.innerHTML='<label><input type="text" name="dontShowSquaresLessThan" /> Dont Show Squares Less Than (m\u00b2)</label>',b.firstChild.firstElementChild.setAttribute("value",this._map.RSWEIndoor.options.dontShowSquaresLessThan),L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){if(a.target.value){var b=a.target.value.replace(RegExp(",","g"),".");isNaN(b)?a.target.value=this._map.RSWEIndoor.options.dontShowSquaresLessThan:
(this._map.RSWEIndoor.options.dontShowSquaresLessThan=b,a.target.value=b,this._map.fire("redraw:all"))}},this));(a=this._getTabContainer(1))&&this._map.RSWEIndoor.options.wallWidth!==t&&(b=L.DomUtil.create("div","wallwidth-control"),a.appendChild(b),b.innerHTML='<label><input type="text" name="wallWidthControl" /> Wall Width (meters)</label>',b.firstChild.firstElementChild.setAttribute("value",this._map.RSWEIndoor.options.wallWidth),L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){if(a.target.value){var b=
a.target.value.replace(RegExp(",","g"),".");isNaN(b)?a.target.value=this._map.RSWEIndoor.options.wallWidth:(this._map.RSWEIndoor.options.wallWidth=b,a.target.value=b,this._map.fire("redraw:all"))}},this));if(a=this._getTabContainer(2))this._map.RSWEIndoor.options.snapOptions.displaySnapGrid!==t&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.options.snapGrid.options.hidden?'<label><input type="checkbox" name="displaySnapGrid" value="1" /> Display Snap Grid</label>':
'<label><input type="checkbox" checked name="displaySnapGrid" value="1" /> Display Snap Grid</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){a.target.checked?(this._map.options.snapGrid.show(),this._map.RSWEIndoor.options.snapOptions.displaySnapGrid=!0):(this._map.options.snapGrid.hide(),this._map.RSWEIndoor.options.snapOptions.displaySnapGrid=!1)},this)),this._map.RSWEIndoor.options.snapOptions.gridStep!==t&&(b=L.DomUtil.create("div","snap-grid-step-options-control"),
a.appendChild(b),b.innerHTML='<label><input type="text" name=snapgridstep" />Snap Grid Step (meters)</label>',b.firstChild.firstElementChild.setAttribute("value",this._map.RSWEIndoor.options.snapOptions.gridStep),L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){if(a.target.value){var b=this.value.replace(RegExp(",","g"),".");isNaN(b)?a.target.value=this._map.RSWEIndoor.options.snapOptions.gridStep:(b=+b,this._map.RSWEIndoor.options.snapOptions.gridStep=b,a.target.value=b,
this._map.options.snapGrid.options.interval=b,this._map.RSWEIndoor.SetSnapOptions(),this._map.options.snapGrid.redraw(),this._map.RSWEIndoor.options.controlLayer.eachLayer(function(a){a.snapediting!==t&&a.snapediting._snapper!==t&&(a.snapediting._snapper.options.gridStep=b)}))}},this)),this._map.RSWEIndoor.options.snapOptions.snapWallsToGrid!==t&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapWallsToGrid?
'<label><input type="checkbox" checked name="snapWallsToGrid" value="1" /> Snap Walls To Grid</label>':'<label><input type="checkbox" name="snapWallsToGrid" value="1" /> Snap Walls To Grid</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapWallsToGrid=a.target.checked?!0:!1;this._map.RSWEIndoor.SetSnapOptions()},this)),this._map.RSWEIndoor.options.snapOptions.snapWallsToObjects!==t&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),
a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapWallsToObjects?'<label><input type="checkbox" checked name="snapWallsToObjects" value="1" /> Snap Walls To Objects</label>':'<label><input type="checkbox" name="snapWallsToObjects" value="1" /> Snap Walls To Objects</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapWallsToObjects=a.target.checked?!0:!1;this._map.RSWEIndoor.SetSnapOptions()},
this)),this._map.RSWEIndoor.options.snapOptions.snapWindowsToGrid!==t&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapWindowsToGrid?'<label><input type="checkbox" checked name="snapWindowsToGrid" value="1" /> Snap Windows To Grid</label>':'<label><input type="checkbox" name="snapWindowsToGrid" value="1" /> Snap Windows To Grid</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapWindowsToGrid=
a.target.checked?!0:!1;this._map.RSWEIndoor.SetSnapOptions()},this)),this._map.RSWEIndoor.options.snapOptions.snapWindowsToObjects!==t&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapWindowsToObjects?'<label><input type="checkbox" checked name="snapWindowsToObjects" value="1" /> Snap Windows To Objects</label>':'<label><input type="checkbox" name="snapWindowsToObjects" value="1" /> Snap Windows To Objects</label>',
L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapWindowsToObjects=a.target.checked?!0:!1;this._map.RSWEIndoor.SetSnapOptions()},this)),this._map.RSWEIndoor.options.snapOptions.snapDoorsToGrid!==t&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapDoorsToGrid?'<label><input type="checkbox" checked name="snapDoorsToGrid" value="1" /> Snap Doors To Grid</label>':
'<label><input type="checkbox" name="snapDoorsToGrid" value="1" /> Snap Doors To Grid</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapDoorsToGrid=a.target.checked?!0:!1;this._map.RSWEIndoor.SetSnapOptions()},this)),this._map.RSWEIndoor.options.snapOptions.snapDoorsToObjects!==t&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapDoorsToObjects?
'<label><input type="checkbox" checked name="snapDoorsToObjects" value="1" /> Snap Doors To Objects</label>':'<label><input type="checkbox" name="snapDoorsToObjects" value="1" /> Snap Doors To Objects</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapDoorsToObjects=a.target.checked?!0:!1;this._map.RSWEIndoor.SetSnapOptions()},this))}});L.control.dialog.options=function(a){return new L.Control.Dialog.Options(a)};L.Control.Dialog.Load=
L.Control.Dialog.extend({options:{size:[300,150],minSize:[300,150],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},msgDiv:{},_isOpen:!1,initialize:function(){L.setOptions(this,this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},
_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},_selectTab:function(a){for(var b=this._getTabCount(),c=0;c<b;c++){var e=this._getTab(c),d=this._getTabTitle(c);a!==c?(e.setAttribute("class","dialog-tab"),d.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),d.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,
a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.size=[Math.max(this.options.size[0],this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])];this.options.anchor=[Math.floor(0.5*(a.x-this.options.size[0])),Math.floor(0.5*(a.y-this.options.size[1]))];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),
c=0;c<b;c++)L.DomEvent.addListener(this._getTabTitle(c),"click",a(c),this);this._dlgCreateControls();this.options.initOpen?this.open():this.close();return this._container},close:function(){this.msgDiv.innerHTML="";this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">Load Drawing From File</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content" ><h3>Load Drawing From File</h3></div></div>;</div>;</div>;'.split(";"),
_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))b=L.DomUtil.create("div","save-file-name"),a.appendChild(b),S.File&&S.FileReader&&S.FileList&&S.Blob?(b.innerHTML='<div></div><input type="file" name="file" /><output id="list"></output>',this.msgDiv=b.getElementsByTagName("DIV")[0],this.InputName=b.getElementsByTagName("INPUT")[0],L.DomEvent.addListener(this.InputName,"change",function(a){this.handleFileSelect(a)},this)):b.innerHTML="<div>Sorry. The File APIs are not fully supported in this browser.</div>"},
handleFileSelect:function(a){var b=a.target.files;b.length?(a=new FileReader,a.thisDlg=this,a.onloadend=function(a){a.target.readyState===FileReader.DONE&&(a.target.thisDlg.InputName.value="",a.target.thisDlg._map.RSWEIndoor.loadData(L.Util.base64Utf8Decode(a.target.result))?a.target.thisDlg.close():a.target.thisDlg.msgDiv.innerHTML="ERROR loading data!  Please check file contents.")},b=b[0].slice(0,b[0].size),a.readAsBinaryString(b)):this.msgDiv.innerHTML="Please select a file!"}});L.control.dialog.load=
function(a){return new L.Control.Dialog.Load(a)};L.Control.Dialog.Save=L.Control.Dialog.extend({options:{size:[320,200],minSize:[320,200],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},
_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},_selectTab:function(a){for(var b=this._getTabCount(),c=0;c<b;c++){var e=this._getTab(c),d=this._getTabTitle(c);a!==c?(e.setAttribute("class","dialog-tab"),d.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),d.setAttribute("class",
"dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.size=[Math.max(this.options.size[0],this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])];this.options.anchor=[Math.floor(0.5*(a.x-this.options.size[0])),Math.floor(0.5*(a.y-this.options.size[1]))];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");
this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),c=0;c<b;c++)L.DomEvent.addListener(this._getTabTitle(c),"click",a(c),this);this._dlgCreateControls();this.options.initOpen?this.open():this.close();return this._container},close:function(){this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">Save Drawing As</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Save Drawing As</h3></div></div>;</div>;</div>;'.split(";"),
saveAsText:function(){var a=this.options.saveALink,b="RSWE.json";this.options.InputName.value&&(b=this.options.InputName.value);a.download=b;b=this._map.RSWEIndoor.getData();a.href="data:text/plain;base64,"+L.Util.base64Encode(b);a.click();this.close()},_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))b=L.DomUtil.create("div","save-file-name"),a.appendChild(b),b.innerHTML='<a href="" download="" style="display:none;"></a><label><input type="text" name="saveFileName" placeholder="Enter file name"/></label>&nbsp;<input type="button" value="Save drawing to file"/><br><br><i>Your drawing will be saved into system "Download" folder.</i>',
this.options.saveALink=b.firstChild,this.options.InputName=b.getElementsByTagName("INPUT")[0],this.options.InputButton=b.getElementsByTagName("INPUT")[1],L.DomEvent.addListener(this.options.InputButton,"click",function(){this.saveAsText()},this)}});L.control.dialog.save=function(a){return new L.Control.Dialog.Save(a)};L.Control.Dialog.SaveSVG=L.Control.Dialog.extend({options:{size:[320,200],minSize:[320,200],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,
this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},
_selectTab:function(a){for(var b=this._getTabCount(),c=0;c<b;c++){var e=this._getTab(c),d=this._getTabTitle(c);a!==c?(e.setAttribute("class","dialog-tab"),d.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),d.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.size=[Math.max(this.options.size[0],
this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])];this.options.anchor=[Math.floor(0.5*(a.x-this.options.size[0])),Math.floor(0.5*(a.y-this.options.size[1]))];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),c=0;c<b;c++)L.DomEvent.addListener(this._getTabTitle(c),"click",a(c),this);this._dlgCreateControls();this.options.initOpen?this.open():this.close();
return this._container},close:function(){this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">Save Data As SVG</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Save Data As SVG</h3></div></div>;</div>;</div>;'.split(";"),
saveAsSVG:function(){var a=this.options.saveALink,b="RSWE.svg";this.options.InputName.value&&(b=this.options.InputName.value);a.download=b;b=this._map.RSWEIndoor.getSVGData();a.href="data:image/svg+xml;base64,"+L.Util.base64Encode(b);a.click();this.close()},_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))b=L.DomUtil.create("div","save-file-name"),a.appendChild(b),b.innerHTML='<a href="" download="" style="display:none;"></a><label><input type="text" name="saveFileName" placeholder="Enter file name"/></label>&nbsp;<input type="button" value="Save data to SVG file"/><br><br><i>Your drawing will be saved into system "Download" folder.</i>',
this.options.saveALink=b.firstChild,this.options.InputName=b.getElementsByTagName("INPUT")[0],this.options.InputButton=b.getElementsByTagName("INPUT")[1],L.DomEvent.addListener(this.options.InputButton,"click",function(){this.saveAsSVG()},this)}});L.control.dialog.save=function(a){return new L.Control.Dialog.Save(a)};L.Control.Dialog.SavePNG=L.Control.Dialog.extend({options:{size:[320,200],minSize:[320,200],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,
this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},
_selectTab:function(a){for(var b=this._getTabCount(),c=0;c<b;c++){var e=this._getTab(c),d=this._getTabTitle(c);a!==c?(e.setAttribute("class","dialog-tab"),d.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),d.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.size=[Math.max(this.options.size[0],
this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])];this.options.anchor=[Math.floor(0.5*(a.x-this.options.size[0])),Math.floor(0.5*(a.y-this.options.size[1]))];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),c=0;c<b;c++)L.DomEvent.addListener(this._getTabTitle(c),"click",a(c),this);this._dlgCreateControls();this.options.initOpen?this.open():this.close();
return this._container},close:function(){this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">Save Data As PNG</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Save SVG Data As</h3></div></div>;</div>;</div>;'.split(";"),
saveAsPNG:function(){var a=this.options.saveALink,b="RSWE.png";this.options.InputName.value&&(b=this.options.InputName.value);a.download=b;var c=this;this._map.RSWEIndoor.getPNGData(function(b){a.href="data:image/png;base64,"+b;a.click();c.close()})},_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))b=L.DomUtil.create("div","save-file-name"),a.appendChild(b),b.innerHTML='<a href="" download="" style="display:none;"></a><label><input type="text" name="saveFileName" placeholder="Enter file name"/></label>&nbsp;<input type="button" value="Save data to PNG file"/><br><br><i>Your drawing will be saved into system "Download" folder.</i>',
this.options.saveALink=b.firstChild,this.options.InputName=b.getElementsByTagName("INPUT")[0],this.options.InputButton=b.getElementsByTagName("INPUT")[1],L.DomEvent.addListener(this.options.InputButton,"click",function(){this.saveAsPNG()},this)}});L.control.dialog.save=function(a){return new L.Control.Dialog.Save(a)};L.Control.Dialog.SaveJPG=L.Control.Dialog.extend({options:{size:[320,200],minSize:[320,200],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,
this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},
_selectTab:function(a){for(var b=this._getTabCount(),c=0;c<b;c++){var e=this._getTab(c),d=this._getTabTitle(c);a!==c?(e.setAttribute("class","dialog-tab"),d.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),d.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.size=[Math.max(this.options.size[0],
this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])];this.options.anchor=[Math.floor(0.5*(a.x-this.options.size[0])),Math.floor(0.5*(a.y-this.options.size[1]))];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),c=0;c<b;c++)L.DomEvent.addListener(this._getTabTitle(c),"click",a(c),this);this._dlgCreateControls();this.options.initOpen?this.open():this.close();
return this._container},close:function(){this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">Save Data As JPG</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Save Data As JPG</h3></div></div>;</div>;</div>;'.split(";"),
saveAsJPG:function(){var a=this.options.saveALink,b="RSWE.jpg";this.options.InputName.value&&(b=this.options.InputName.value);a.download=b;var c=this;this._map.RSWEIndoor.getJPGData(function(b){a.href="data:image/jpeg;base64,"+b;a.click();c.close()})},_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))b=L.DomUtil.create("div","save-file-name"),a.appendChild(b),b.innerHTML='<a href="" download="" style="display:none;"></a><label><input type="text" name="saveFileName" placeholder="Enter file name"/></label>&nbsp;<input type="button" value="Save data to JPG file"/><br><br><i>Your drawing will be saved into system "Download" folder.</i>',
this.options.saveALink=b.firstChild,this.options.InputName=b.getElementsByTagName("INPUT")[0],this.options.InputButton=b.getElementsByTagName("INPUT")[1],L.DomEvent.addListener(this.options.InputButton,"click",function(){this.saveAsJPG()},this)}});L.control.dialog.save=function(a){return new L.Control.Dialog.Save(a)}})(window,document);
