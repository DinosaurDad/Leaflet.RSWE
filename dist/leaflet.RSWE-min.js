(function(G,r,t){(function(){L.Map.addInitHook(function(){this.options.zoomControl||(this.zoomControl=new L.Control.Zoom({position:"bottomright"}),this.addControl(this.zoomControl))});L.Control.FullScreen=L.Control.extend({options:{position:"bottomright",title:"Full Screen",titleCancel:"Exit Full Screen",forceSeparateButton:!1,forcePseudoFullscreen:!1},onAdd:function(a){var b="leaflet-control-zoom-fullscreen",c="";a=a.zoomControl&&!this.options.forceSeparateButton?a.zoomControl._container:L.DomUtil.create("div",
"leaflet-bar");this.options.content?c=this.options.content:b+=" fullscreen-icon";this._createButton(this.options.title,b,c,a,this.toggleFullScreen,this);this._map.on("enterFullscreen exitFullscreen",this._toggleTitle,this);return a},_createButton:function(b,c,e,h,q,n){this.link=L.DomUtil.create("a",c,h);this.link.href="#";this.link.title=b;this.link.innerHTML=e;L.DomEvent.addListener(this.link,"click",L.DomEvent.stopPropagation).addListener(this.link,"click",L.DomEvent.preventDefault).addListener(this.link,
"click",q,n);L.DomEvent.addListener(h,a.fullScreenEventName,L.DomEvent.stopPropagation).addListener(h,a.fullScreenEventName,L.DomEvent.preventDefault).addListener(h,a.fullScreenEventName,this._handleEscKey,n);L.DomEvent.addListener(r,a.fullScreenEventName,L.DomEvent.stopPropagation).addListener(r,a.fullScreenEventName,L.DomEvent.preventDefault).addListener(r,a.fullScreenEventName,this._handleEscKey,n);return this.link},toggleFullScreen:function(){var b=this._map;b._exitFired=!1;b._isFullscreen?(a.supportsFullScreen&&
!this.options.forcePseudoFullscreen?a.cancelFullScreen(b._container):L.DomUtil.removeClass(b._container,"leaflet-pseudo-fullscreen"),setTimeout(L.bind(b.invalidateSize,b),200),b.fire("exitFullscreen"),b._exitFired=!0,b._isFullscreen=!1):(a.supportsFullScreen&&!this.options.forcePseudoFullscreen?a.requestFullScreen(b._container):L.DomUtil.addClass(b._container,"leaflet-pseudo-fullscreen"),setTimeout(L.bind(b.invalidateSize,b),200),b.fire("enterFullscreen"),b._isFullscreen=!0)},_toggleTitle:function(){this.link.title=
this._map._isFullscreen?this.options.title:this.options.titleCancel},_handleEscKey:function(){var b=this._map;a.isFullScreen(b)||b._exitFired||(b.fire("exitFullscreen"),b._exitFired=!0,b._isFullscreen=!1)}});L.control.fullscreen=function(a){return new L.Control.FullScreen(a)};L.Map.addInitHook(function(){L.extend(this.options,{fullscreenControl:!0});this.options.fullscreenControl&&(this.fullscreenControl=L.control.fullscreen(this.options.fullscreenControlOptions),this.addControl(this.fullscreenControl))});
var a={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},b=["webkit","moz","o","ms","khtml"];if("undefined"!==typeof r.exitFullscreen)a.supportsFullScreen=!0;else for(var c=0,e=b.length;c<e;c++)if(a.prefix=b[c],"undefined"!==typeof r[a.prefix+"CancelFullScreen"]){a.supportsFullScreen=!0;break}a.supportsFullScreen&&(a.fullScreenEventName=a.prefix+"fullscreenchange",a.isFullScreen=function(){switch(this.prefix){case "":return r.fullScreen;
case "webkit":return r.webkitIsFullScreen;default:return r[this.prefix+"FullScreen"]}},a.requestFullScreen=function(a){return""===this.prefix?a.requestFullscreen():a[this.prefix+"RequestFullScreen"]()},a.cancelFullScreen=function(){return""===this.prefix?r.exitFullscreen():r[this.prefix+"CancelFullScreen"]()});"undefined"!==typeof jQuery&&(jQuery.fn.requestFullScreen=function(){return this.each(function(){var b=jQuery(this);a.supportsFullScreen&&a.requestFullScreen(b)})});G.fullScreenApi=a})();L.Util=
L.extend(L.Util||{},{base64Encode:function(a){var b,c,e,f,d=0,g="";do b=a.charCodeAt(d++),c=a.charCodeAt(d++),e=a.charCodeAt(d++),f=b<<16|c<<8|e,b=f>>18&63,c=f>>12&63,e=f>>6&63,f&=63,g+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f);while(d<
a.length);switch(a.length%3){case 1:g=g.slice(0,-2)+"==";break;case 2:g=g.slice(0,-1)+"="}return g}});L.Curve=L.Path.extend({options:{},initialize:function(a,b){L.setOptions(this,b);this._setPath(a)},getPath:function(){return this._coords},setPath:function(a){this._setPath(a);return this.redraw()},getBounds:function(){return this._bounds},_setPath:function(a){this._coords=a;this._bounds=this._computeBounds()},_computeBounds:function(){for(var a=new L.LatLngBounds,b,c,e,f,d,g,h=0;h<this._coords.length;h++)e=
this._coords[h],"string"===typeof e||e instanceof String?c=e:"H"===c?(a.extend([b.lat,e[0]]),b=new L.latLng(b.lat,e[0])):"V"===c?(a.extend([e[0],b.lng]),b=new L.latLng(e[0],b.lng)):"C"===c?(d=new L.latLng(e[0],e[1]),e=this._coords[++h],f=new L.latLng(e[0],e[1]),e=this._coords[++h],e=new L.latLng(e[0],e[1]),a.extend(d),a.extend(f),a.extend(e),e.controlPoint1=d,e.controlPoint2=f,b=e):"S"===c?(f=new L.latLng(e[0],e[1]),e=this._coords[++h],e=new L.latLng(e[0],e[1]),d=b,b.controlPoint2&&(d=b.lat-b.controlPoint2.lat,
g=b.lng-b.controlPoint2.lng,d=new L.latLng(b.lat+d,b.lng+g)),a.extend(d),a.extend(f),a.extend(e),e.controlPoint1=d,e.controlPoint2=f,b=e):"Q"===c?(f=new L.latLng(e[0],e[1]),e=this._coords[++h],e=new L.latLng(e[0],e[1]),a.extend(f),a.extend(e),e.controlPoint=f,b=e):"T"===c?(e=new L.latLng(e[0],e[1]),f=b,b.controlPoint&&(d=b.lat-b.controlPoint.lat,g=b.lng-b.controlPoint.lng,f=new L.latLng(b.lat+d,b.lng+g)),a.extend(f),a.extend(e),e.controlPoint=f,b=e):(a.extend(e),b=new L.latLng(e[0],e[1]));return a},
getCenter:function(){return this._bounds.getCenter()},_update:function(){this._map&&this._updatePath()},_project:function(){var a,b,c,e;this._points=[];for(var f=0;f<this._coords.length;f++)if(a=this._coords[f],"string"===typeof a||a instanceof String)this._points.push(a),c=a;else{switch(a.length){case 2:e=this._map.latLngToLayerPoint(a);b=a;break;case 1:"H"===c?(e=this._map.latLngToLayerPoint([b[0],a[0]]),b=[b[0],a[0]]):(e=this._map.latLngToLayerPoint([a[0],b[1]]),b=[a[0],b[1]])}this._points.push(e)}},
getPathString:function(){this._project();return this._curvePointsToPath(this._points)},_curvePointsToPath:function(a){var b,c,e="";if(a)for(var f=0;f<a.length;f++)if(b=a[f],"string"===typeof b||b instanceof String)c=b,e+=c;else switch(c){case "H":e+=b.x+" ";break;case "V":e+=b.y+" ";break;default:e+=b.x+" "+b.y+" "}return e||"M0 0"}});L.curve=function(a,b){return new L.Curve(a,b)};(function(){L.ScalableText=L.Path.extend({initialize:function(a,b,c,e){L.Path.prototype.initialize.call(this,e);this._latlngs=
this._convertLatLngs([b,c]);this._text=a;this.bindPoint=this._latlngs[0];this.heightPoint=this._latlngs[1]},options:{bgColor:"black",attributes:{fill:"white","text-anchor":"start","line-height":"15px","font-size":"12px","font-family":"Arial"},orientation:"normal",center:!0,below:!1},onAdd:function(a){L.Path.prototype.onAdd.call(this,a);this._textRedraw()},onRemove:function(a){(a=a||this._map)&&this._gNode&&this._textNode&&this._rectNode&&(this._gNode.removeChild(this._textNode),this._gNode.removeChild(this._rectNode),
delete this._textNode,delete this._rectNode);a&&this._container&&(this._container.removeChild(this._gNode),delete this._gNode);L.Path.prototype.onRemove.call(this,a)},bringToFront:function(){L.Path.prototype.bringToFront.call(this,map);this._textRedraw()},bringToBack:function(){L.Path.prototype.bringToBack.call(this,map);this._textRedraw()},_updatePath:function(){this._map&&(L.Path.prototype._updatePath.call(this),this._textRedraw())},redraw:function(){this._map&&(L.Path.prototype.redraw.call(this),
this._textRedraw())},_textRedraw:function(){var a=this._text,b=this.options;a&&this.setText(a,b)},projectLatlngs:function(){this._originalPoints=[];for(var a=0,b=this._latlngs.length;a<b;a++)this._originalPoints[a]=this._map.latLngToLayerPoint(this._latlngs[a])},getLatLngs:function(){return this._latlngs},getBounds:function(){return new L.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(a,b){var c,e,f=b?a:[];c=0;for(e=a.length;c<e;c++){if(L.Util.isArray(a[c])&&"number"!==typeof a[c][0])return;
f[c]=L.latLng(a[c])}return f},_initEvents:function(){L.Path.prototype._initEvents.call(this)},setText:function(a,b){this._text=a;this.options=L.Util.extend(this.options,b);if(!L.Browser.svg||"undefined"===typeof this._map)return this;if(!this._text)return this._map&&this._container&&this._gNode&&this._textNode&&this.rectNode&&(this._gNode.removeChild(this._textNode),this._gNode.removeChild(this._rectNode),delete this._textNode,delete this._rectNode),this._container&&this._gNode&&(this._container.removeChild(this._gNode),
delete this._gNode),this;this._gNode||(this._gNode=L.Path.prototype._createElement("g"),this._rectNode||(this._rectNode=L.Path.prototype._createElement("rect"),this._gNode.appendChild(this._rectNode)),this._textNode||(this._textNode=L.Path.prototype._createElement("text"),this._gNode.appendChild(this._textNode)),this._container.appendChild(this._gNode));for(var c in b.attributes)this._textNode.setAttribute(c,b.attributes[c]);this._textNode.innerHTML=this._text.replace(/ /g,"\u00a0");if(this.heightPoint&&
this.bindPoint){c=parseInt(b.attributes["line-height"].replace("px",""),10);var e=parseInt(b.attributes["font-size"].replace("px",""),10),f=this._map.latLngToLayerPoint(this.bindPoint),d=f.distanceTo(this._map.latLngToLayerPoint(this.heightPoint))/c,g=Math.cos(this.bindPoint.lat*Math.PI/180),g=180*Math.atan2(-this.bindPoint.lat+this.heightPoint.lat,(this.bindPoint.lng-this.heightPoint.lng)*g)/Math.PI-90,f="translate("+f.x+" "+f.y+") scale("+d+") rotate("+g+")";this.options.center&&(f=f+" translate("+
-0.5*this._textNode.getComputedTextLength()+")");this._textNode.setAttribute("x","0");this._textNode.setAttribute("y","-"+0.8*(c-e));this._rectNode.setAttribute("x","0");this._rectNode.setAttribute("y","-"+c);this._rectNode.setAttribute("height",""+c);this._rectNode.setAttribute("width",this._textNode.getComputedTextLength());this._rectNode.setAttribute("fill",this.options.bgColor);this._rectNode.setAttribute("transform",f);this._textNode.setAttribute("transform",f)}return this}});L.scalabletext=
function(a,b){return new L.ScalableText(a,b)}})();L.drawVersion="0.2.4-dev";L.drawLocal={draw:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},undo:{title:"Delete last point drawn",text:"Delete last point"},buttons:{polyline:"Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",circle:"Draw a circle",marker:"Draw a marker",wall:"Draw a wall",window:"Draw a window",door:"Draw a door"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle."},radius:"Radius"},marker:{tooltip:{start:"Click map to place marker."}},
polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing line.",cont:"Click to continue drawing line.",end:"Click last point to finish line."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},simpleshape:{tooltip:{end:"Release mouse to finish drawing."}},wall:{error:"<strong>Error:</strong> shape edges cannot cross!",
tooltip:{start:"Click to start drawing wall.",cont:"Click to continue drawing wall.",end:"Click last point to finish wall."}},window:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing window.",cont:"Click to continue drawing window.",end:"Click last point to finish window."}},door:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing door.",cont:"Click to continue drawing door.",end:"Click last point to finish door."}}}},
edit:{toolbar:{actions:{save:{title:"Apply changes.",text:"Apply"},cancel:{title:"Cancel editing, discards all changes.",text:"Cancel"}},buttons:{edit:"Edit layers.",editDisabled:"No layers to edit.",remove:"Delete layers.",removeDisabled:"No layers to delete."}},handlers:{edit:{tooltip:{text:"Drag handles, or marker to edit feature.",subtext:"Click cancel to undo changes."}},remove:{tooltip:{text:"Click on a feature to remove"}}}}};L.Draw={};L.Draw.Feature=L.Handler.extend({includes:L.Mixin.Events,
initialize:function(a,b){this._map=a;this._container=a._container;this._overlayPane=a._panes.overlayPane;this._popupPane=a._panes.popupPane;b&&b.shapeOptions&&(b.shapeOptions=L.Util.extend({},this.options.shapeOptions,b.shapeOptions));L.setOptions(this,b)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire("draw:drawstart",{layerType:this.type,layer:this}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),
this._map.fire("draw:drawstop",{layerType:this.type,layer:this}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var a=this._map;a&&(L.DomUtil.disableTextSelection(),a.getContainer().focus(),this._tooltip=new L.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(a){L.setOptions(this,
a)},_fireCreatedEvent:function(a){this._map.fire("draw:created",{layer:a,layerType:this.type})},_cancelDrawing:function(a){27===a.keyCode&&this.disable()}});L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4E3,shapeOptions:{stroke:!0,color:"#bbbbbb",
weight:4,opacity:0.5,fill:!1},metric:!0,showLength:!0,zIndexOffset:2E3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(a,b){this._map=a;this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error;b&&b.drawError&&(b.drawError=L.Util.extend({},this.options.drawError,b.drawError));this.type=L.Draw.Polyline.TYPE;L.Draw.Feature.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this);
this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-div-icon leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40],draggable:!0}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.addTo(this._map),this._map.on("zoomend",
this._onZoomEnd,this),L.DomEvent.addListener(this._map._container,"mousedown",this._onMouseDown,this),L.DomEvent.addListener(this._map._container,"mousemove",this._onMouseMove,this),L.DomEvent.addListener(this._map._container,"mouseup",this._onMouseUp,this),L.DomEvent.addListener(this._map._container,"touchstart",this._onMouseDown,this),L.DomEvent.addListener(this._map._container,"touchmove",this._onMouseMove,this),L.DomEvent.addListener(this._map._container,"touchend",this._onMouseUp,this),this._map.dragging.disable())},
removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this);this._clearHideErrorTimeout();this._cleanUpShape();this._map.removeLayer(this._markerGroup);delete this._markerGroup;delete this._markers;this._map.removeLayer(this._poly);delete this._poly;this._map.removeLayer(this._mouseMarker);delete this._mouseMarker;this._clearGuides();this._map.off("zoomend",this._onZoomEnd,this);L.DomEvent.removeListener(this._map._container,"mousedown",this._onMouseDown);L.DomEvent.removeListener(this._map._container,
"mousemove",this._onMouseMove);L.DomEvent.removeListener(this._map._container,"mouseup",this._onMouseUp);L.DomEvent.removeListener(this._map._container,"touchstart",this._onMouseDown);L.DomEvent.removeListener(this._map._container,"touchmove",this._onMouseMove);L.DomEvent.removeListener(this._map._container,"touchend",this._onMouseUp);this._map.options.dragging&&this._map.dragging.enable()},deleteLastVertex:function(){if(!(1>=this._markers.length)){var a=this._markers.pop(),b=this._poly,c=this._poly.spliceLatLngs(b.getLatLngs().length-
1,1)[0];this._markerGroup.removeLayer(a);2>b.getLatLngs().length&&this._map.removeLayer(b);this._vertexChanged(c,!1)}},addVertex:function(a){0<this._markers.length&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(a)?this._showErrorTooltip():(this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(a)),this._poly.addLatLng(a),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._vertexChanged(a,!0))},_onMarkerMouseUp:function(a){a.preventDefault();
this._finishShape()},_finishShape:function(){var a=this._poly.newLatLngIntersects(this._poly.getLatLngs()[0],!0);!this.options.allowIntersection&&a||!this._shapeIsValid()?this._showErrorTooltip():(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_shapeIsValid:function(){return!0},_onZoomEnd:function(){this._updateGuide()},_onMouseMove:function(a){a.preventDefault();a.originalEvent=a.originalEvent?a.originalEvent:a;a.originalEvent.touches&&(a.originalEvent.clientX=a.originalEvent.clientX?
a.originalEvent.clientX:a.originalEvent.touches[0].clientX,a.originalEvent.clientY=a.originalEvent.clientY?a.originalEvent.clientY:a.originalEvent.touches[0].clientY,this.startTouch=this.lastTouch=a.originalEvent.touches[0]);a.containerPoint=a.containerPoint?a.containerPoint:this._map.mouseEventToContainerPoint(a.originalEvent);a.layerPoint=a.layerPoint?a.layerPoint:this._map.containerPointToLayerPoint(a.containerPoint);a.latlng=a.latlng?a.latlng:this._map.layerPointToLatLng(a.layerPoint);var b=a.layerPoint,
c=a.latlng;this._currentLatLng=c;a.originalEvent.touches||this._updateTooltip(c);this._updateGuide(b);this._mouseMarker.setLatLng(c)},_vertexChanged:function(a,b){this._updateStartHandler();this._updateFinishHandler();this._updateRunningMeasure(a,b);this._clearGuides();this._updateTooltip()},_onMouseDown:function(a){a.preventDefault();a.originalEvent=a.originalEvent?a.originalEvent:a;a.originalEvent.touches&&(a.originalEvent.clientX=a.originalEvent.clientX?a.originalEvent.clientX:a.originalEvent.touches[0].clientX,
a.originalEvent.clientY=a.originalEvent.clientY?a.originalEvent.clientY:a.originalEvent.touches[0].clientY,this.startTouch=a.originalEvent.touches[0],this.lastTouch=a.originalEvent.touches[0]);a.containerPoint=a.containerPoint?a.containerPoint:this._map.mouseEventToContainerPoint(a.originalEvent);a.layerPoint=a.layerPoint?a.layerPoint:this._map.containerPointToLayerPoint(a.containerPoint);a.latlng=a.latlng?a.latlng:this._map.layerPointToLatLng(a.layerPoint);var b=a.originalEvent;this._mouseDownOrigin=
L.point(b.clientX,b.clientY);this._latlngOrigin=a.latlng},_onMouseUp:function(a){a.preventDefault();a.originalEvent=a.originalEvent?a.originalEvent:a;a.originalEvent.touches&&(a.originalEvent.clientX=a.originalEvent.clientX?a.originalEvent.clientX:this.lastTouch.clientX,a.originalEvent.clientY=a.originalEvent.clientY?a.originalEvent.clientY:this.lastTouch.clientY);a.containerPoint=a.containerPoint?a.containerPoint:this._map.mouseEventToContainerPoint(a.originalEvent);a.layerPoint=a.layerPoint?a.layerPoint:
this._map.containerPointToLayerPoint(a.containerPoint);a.latlng=a.latlng?a.latlng:this._map.layerPointToLatLng(a.layerPoint);if(this._mouseDownOrigin){this._latlngOrigin&&(a.latlng=this._latlngOrigin);var b=L.point(a.originalEvent.clientX,a.originalEvent.clientY).distanceTo(this._mouseDownOrigin);Math.abs(b)<9*(G.devicePixelRatio||1)&&this.addVertex(a.latlng)}this._latlngOrigin=this._mouseDownOrigin=null},_updateStartHandler:function(){},_updateFinishHandler:function(){var a=0;this._markers!==t&&
(a=this._markers.length);1<a&&(L.DomEvent.addListener(this._markers[a-1]._icon,"mouseup",this._onMarkerMouseUp,this),L.DomEvent.addListener(this._markers[a-1]._icon,"touchend",this._onMarkerMouseUp,this));2<a&&(L.DomEvent.removeListener(this._markers[a-2]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[a-2]._icon,"touchend",this._onMarkerMouseUp))},_createMarker:function(a){a=new L.Marker(a,{icon:this.options.icon,className:"leaflet-div-icon leaflet-editing-icon",draggable:!1,
clickable:!0,zIndexOffset:2*this.options.zIndexOffset});this._markerGroup.addLayer(a);this._map.fire("draw:createmarker",{marker:a,layer:this});return a},_updateGuide:function(a){var b=0;this._markers!==t&&(b=this._markers.length);0<b&&(a=a||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[b-1].getLatLng()),a))},_updateTooltip:function(a){if(this._tooltip){var b=this._getTooltipText();a&&this._tooltip.updatePosition(a);
this._errorShown||this._tooltip.updateContent(b)}},_drawGuide:function(a,b){var c=Math.floor(Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))),e=this.options.guidelineDistance,f=this.options.maxGuideLineLength,e=c>f?c-f:e,d;this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));for(;e<c;e+=this.options.guidelineDistance)f=e/c,f={x:Math.floor(a.x*(1-f)+f*b.x),y:Math.floor(a.y*(1-f)+f*b.y)},d=L.DomUtil.create("div","leaflet-draw-guide-dash",
this._guidesContainer),d.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(d,f)},_updateGuideColor:function(a){if(this._guidesContainer)for(var b=0,c=this._guidesContainer.childNodes.length;b<c;b++)this._guidesContainer.childNodes[b].style.backgroundColor=a},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var a=
this.options.showLength,b=0;this._markers!==t&&(b=this._markers.length);0===b?a={text:L.drawLocal.draw.handlers.polyline.tooltip.start}:(a=a?this._getMeasurementString():"",a=1===this._markers.length?{text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:a}:{text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:a});return a},_updateRunningMeasure:function(a,b){var c=0;this._markers!==t&&(c=this._markers.length);1>=c?this._measurementRunningTotal=0:(c=a.distanceTo(this._markers[c-(b?2:
1)].getLatLng()),this._measurementRunningTotal+=c*(b?1:-1))},_getMeasurementString:function(){var a=0;if(this._currentLatLng&&0<this._markers.length)var a=this._currentLatLng,b=this._markers[this._markers.length-1].getLatLng(),a=this._measurementRunningTotal+a.distanceTo(b);return L.GeometryUtil.readableDistance(a,this.options.metric)},_showErrorTooltip:function(){this._errorShown=!0;this._tooltip.showAsError().updateContent({text:this.options.drawError.message});this._updateGuideColor(this.options.drawError.color);
this._poly.setStyle({color:this.options.drawError.color});this._clearHideErrorTimeout();this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1;this._clearHideErrorTimeout();this._tooltip.removeError().updateContent(this._getTooltipText());this._updateGuideColor(this.options.shapeOptions.color);this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&
(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_cleanUpShape:function(){1<this._markers.length&&(L.DomEvent.removeListener(this._markers[this._markers.length-1]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[this._markers.length-1]._icon,"touchend",this._onMarkerMouseUp))},_fireCreatedEvent:function(){var a=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,a)}});L.Draw.Polygon=
L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!1,fillColor:null,fillOpacity:0.2,clickable:!0},toolbarIcon:{className:"leaflet-draw-draw-polygon",tooltip:L.drawLocal.draw.toolbar.buttons.polygon}},initialize:function(a,b){L.Draw.Polyline.prototype.initialize.call(this,a,b);this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var a=this._markers.length;1===a&&(L.DomEvent.addListener(this._markers[0]._icon,
"mouseup",this._onMarkerMouseUp,this),L.DomEvent.addListener(this._markers[0]._icon,"touchend",this._onMarkerMouseUp,this));2<a&&(L.DomEvent.addListener(this._markers[a-1]._icon,"mouseup",this._onMarkerMouseUp,this),L.DomEvent.addListener(this._markers[a-1]._icon,"touchend",this._onMarkerMouseUp,this),3<a&&(L.DomEvent.removeListener(this._markers[a-2]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[a-2]._icon,"touchend",this._onMarkerMouseUp)))},_getTooltipText:function(){var a,
b;0===this._markers.length?a=L.drawLocal.draw.handlers.polygon.tooltip.start:3>this._markers.length?a=L.drawLocal.draw.handlers.polygon.tooltip.cont:(a=L.drawLocal.draw.handlers.polygon.tooltip.end,b=this._getMeasurementString());return{text:a,subtext:b}},_getMeasurementString:function(){var a=this._area;return a?L.GeometryUtil.readableArea(a,this.options.metric):null},_shapeIsValid:function(){return 3<=this._markers.length},_vertexChanged:function(a,b){var c;!this.options.allowIntersection&&this.options.showArea&&
(c=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(c));L.Draw.Polyline.prototype._vertexChanged.call(this,a,b)},_cleanUpShape:function(){var a=this._markers.length;0<a&&(L.DomEvent.removeListener(this._markers[0]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[0]._icon,"touchend",this._onMarkerMouseUp),2<a&&(L.DomEvent.removeListener(this._markers[a-1]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[a-1]._icon,"touchend",
this._onMarkerMouseUp)))}});L.SimpleShape={};L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:!1},initialize:function(a,b){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end;L.Draw.Feature.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this);this._map&&((this._mapDraggable=this._map.dragging.enabled())&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),
this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this);this._map&&(this._mapDraggable&&this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this),L.DomEvent.off(r,"mouseup",this._onMouseUp,this),this._shape&&(this._map.removeLayer(this._shape),delete this._shape));this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},
_onMouseDown:function(a){this._isDrawing=!0;this._startLatLng=a.latlng;L.DomEvent.on(r,"mouseup",this._onMouseUp,this).preventDefault(a.originalEvent)},_onMouseMove:function(a){a=a.latlng;this._tooltip.updatePosition(a);this._isDrawing&&(this._tooltip.updateContent(this._getTooltipText()),this._drawShape(a))},_onMouseUp:function(){this._shape&&this._fireCreatedEvent();this.disable();this.options.repeatMode&&this.enable()}});L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,
color:"#bbbbbb",weight:4,opacity:0.5,fill:!1,fillColor:null,fillOpacity:0.5,clickable:!0},metric:!0},initialize:function(a,b){this.type=L.Draw.Rectangle.TYPE;this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start;L.Draw.SimpleShape.prototype.initialize.call(this,a,b)},_drawShape:function(a){this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,a)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,a),this.options.shapeOptions),this._map.addLayer(this._shape))},
_fireCreatedEvent:function(){var a=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,a)},_getTooltipText:function(){var a=L.Draw.SimpleShape.prototype._getTooltipText.call(this),b;this._shape&&(b=this._shape.getLatLngs(),b=L.GeometryUtil.geodesicArea(b),b=L.GeometryUtil.readableArea(b,this.options.metric));return{text:a.text,subtext:b}}});L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,
color:"#bbbbbb",weight:4,opacity:0.5,fill:!0,fillColor:null,fillOpacity:0.2,clickable:!0},showRadius:!0,metric:!0,toolbarIcon:{className:"leaflet-draw-draw-circle",tooltip:L.drawLocal.draw.toolbar.buttons.circle}},initialize:function(a,b){this.type=L.Draw.Circle.TYPE;this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start;L.Draw.SimpleShape.prototype.initialize.call(this,a,b)},_drawShape:function(a){this._shape?this._shape.setRadius(this._startLatLng.distanceTo(a)):(this._shape=new L.Circle(this._startLatLng,
this._startLatLng.distanceTo(a),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var a=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,a)},_onMouseMove:function(a){a.preventDefault();var b=a.latlng;a=this.options.showRadius;var c=this.options.metric;this._tooltip.updatePosition(b);this._isDrawing&&(this._drawShape(b),b=this._shape.getRadius().toFixed(1),this._tooltip.updateContent({text:this._endLabelText,
subtext:a?L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(b,c):""}))}});L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2E3,toolbarIcon:{className:"leaflet-draw-draw-marker",tooltip:L.drawLocal.draw.toolbar.buttons.marker}},initialize:function(a,b){this.type=L.Draw.Marker.TYPE;L.Draw.Feature.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this);this._map&&
(this._tooltip.updateContent({text:L.drawLocal.draw.handlers.marker.tooltip.start}),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this);this._map&&(this._marker&&
(this._marker.off("click",this._onClick,this),this._map.off("click",this._onClick,this).removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(a){a.preventDefault();a=a.latlng;this._tooltip.updatePosition(a);this._mouseMarker.setLatLng(a);this._marker?(a=this._mouseMarker.getLatLng(),this._marker.setLatLng(a)):(this._marker=
new L.Marker(a,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset}),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_onClick:function(){this._fireCreatedEvent();this.disable();this.options.repeatMode&&this.enable()},_fireCreatedEvent:function(){var a=new L.Marker(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,a)}});L.Draw.Wall=L.Draw.Polyline.extend({statics:{TYPE:"wall"},
Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4E3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2E3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(a,b){L.Draw.Polyline.prototype.initialize.call(this,
a,b);this.type="wall"},_updateStartHandler:function(){var a=0;this._markers!==t&&(a=this._markers.length);3===a&&(L.DomEvent.addListener(this._markers[0]._icon,"mouseup",this._onMarkerMouseUp0,this),L.DomEvent.addListener(this._markers[0]._icon,"touchend",this._onMarkerMouseUp0,this))},_onMarkerMouseUp0:function(a){a.preventDefault();this._closeShape()},_closeShape:function(){this.Poly=L.Polygon;this._finishShape();this.Poly=L.Polyline},_cleanUpShape:function(){1<this._markers.length&&(L.DomEvent.removeListener(this._markers[this._markers.length-
1]._icon,"mouseup",this._onMarkerMouseUp),L.DomEvent.removeListener(this._markers[this._markers.length-1]._icon,"touchend",this._onMarkerMouseUp));2<this._markers.length&&(L.DomEvent.removeListener(this._markers[0]._icon,"mouseup",this._onMarkerMouseUp0),L.DomEvent.removeListener(this._markers[0]._icon,"touchend",this._onMarkerMouseUp0))}});L.Draw.Window=L.Draw.Polyline.extend({statics:{TYPE:"window"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},
icon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4E3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2E3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(a,b){L.Draw.Polyline.prototype.initialize.call(this,a,b);this.type="window"},_updateFinishHandler:function(){var a=
this._markers.length;1<a&&(L.DomEvent.addListener(this._markers[a-1]._icon,"mouseup",this._onMarkerMouseUp,this),L.DomEvent.addListener(this._markers[a-1]._icon,"touchend",this._onMarkerMouseUp,this),this._finishShape())}});L.Draw.Door=L.Draw.Polyline.extend({statics:{TYPE:"door"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,
maxGuideLineLength:4E3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2E3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(a,b){L.Draw.Polyline.prototype.initialize.call(this,a,b);this.type="door"},_updateFinishHandler:function(){var a=this._markers.length;1<a&&(L.DomEvent.addListener(this._markers[a-1]._icon,"mouseup",this._onMarkerMouseUp,this),L.DomEvent.addListener(this._markers[a-
1]._icon,"touchend",this._onMarkerMouseUp,this),this._finishShape())}});L.Edit=L.Edit||{};L.Edit.Marker=L.Handler.extend({initialize:function(a,b){this._marker=a;L.setOptions(this,b)},addHooks:function(){var a=this._marker;a.dragging.enable();a.on("dragend",this._onDragEnd,a);this._toggleMarkerHighlight()},removeHooks:function(){var a=this._marker;a.dragging.disable();a.off("dragend",this._onDragEnd,a);this._toggleMarkerHighlight()},_onDragEnd:function(a){a.target.edited=!0},_toggleMarkerHighlight:function(){if(this._icon){var a=
this._icon;a.style.display="none";L.DomUtil.hasClass(a,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(a,"leaflet-edit-marker-selected"),this._offsetMarker(a,-4)):(L.DomUtil.addClass(a,"leaflet-edit-marker-selected"),this._offsetMarker(a,4));a.style.display=""}},_offsetMarker:function(a,b){var c=parseInt(a.style.marginTop,10)-b,e=parseInt(a.style.marginLeft,10)-b;a.style.marginTop=c+"px";a.style.marginLeft=e+"px"}});L.Marker.addInitHook(function(){L.Edit.Marker&&(this.editing=new L.Edit.Marker(this),
this.options.editable&&this.editing.enable())});L.Edit=L.Edit||{};L.Edit.Poly=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(16,16),className:"leaflet-div-icon leaflet-editing-icon"})},initialize:function(a,b){this._poly=a;L.setOptions(this,b)},addHooks:function(){var a=this._poly;a.setStyle(a.options.editing);this._poly._map&&(this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){var a=this._poly;a.setStyle(a.options.original);
a._map&&(a._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers();this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup);this._markers=[];var a=this._poly._latlngs,b,c,e;b=0;for(c=a.length;b<c;b++)e=this._createMarker(a[b],b),e.on("click",this._onMarkerClick,this),this._markers.push(e);b=0;for(a=c-1;b<c;a=b++)if(0!==b||L.Polygon&&this._poly instanceof L.Polygon)a=this._markers[a],
e=this._markers[b],"wall"===this._poly.options.layerType&&this._createMiddleMarker(a,e),this._updatePrevNext(a,e)},_createMarker:function(a,b){var c=new L.Marker(a,{draggable:!0,icon:this.options.icon});c._origLatLng=a;c._index=b;c.on("drag",this._onMarkerDrag,this);c.on("dragend",this._fireEdit,this);this._markerGroup.addLayer(c);return c},_removeMarker:function(a){var b=a._index;this._markerGroup.removeLayer(a);this._markers.splice(b,1);this._poly.spliceLatLngs(b,1);this._updateIndexes(b,-1);a.off("drag",
this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("click",this._onMarkerClick,this)},_fireEdit:function(){this._poly.edited=!0;this._poly.fire("edit");this._poly._map.fire("edit",{layer:this._poly})},_onMarkerDrag:function(a){a=a.target;L.extend(a._origLatLng,a._latlng);a._middleLeft&&a._middleLeft.setLatLng(this._getMiddleLatLng(a._prev,a));a._middleRight&&a._middleRight.setLatLng(this._getMiddleLatLng(a,a._next));this._poly.redraw()},_onMarkerClick:function(a){a=a.target;this._poly._latlngs.length<
(L.Polygon&&this._poly instanceof L.Polygon?4:3)||(this._removeMarker(a),this._updatePrevNext(a._prev,a._next),a._middleLeft&&this._markerGroup.removeLayer(a._middleLeft),a._middleRight&&this._markerGroup.removeLayer(a._middleRight),a._prev&&a._next?this._createMiddleMarker(a._prev,a._next):a._prev?a._next||(a._prev._middleRight=null):a._next._middleLeft=null,this._fireEdit())},_updateIndexes:function(a,b){this._markerGroup.eachLayer(function(c){c._index>a&&(c._index+=b)})},_createMiddleMarker:function(a,
b){var c=this._getMiddleLatLng(a,b),e=this._createMarker(c),f,d,g;e.setOpacity(0.6);a._middleRight=b._middleLeft=e;d=function(){var d=b._index;e._index=d;e.off("click",f,this).on("click",this._onMarkerClick,this);c.lat=e.getLatLng().lat;c.lng=e.getLatLng().lng;this._poly.spliceLatLngs(d,0,c);this._markers.splice(d,0,e);e.setOpacity(1);this._updateIndexes(d,1);b._index++;this._updatePrevNext(a,e);this._updatePrevNext(e,b);this._poly.fire("editstart")};g=function(){e.off("dragstart",d,this);e.off("dragend",
g,this);this._createMiddleMarker(a,e);this._createMiddleMarker(e,b)};f=function(){d.call(this);g.call(this);this._fireEdit()};e.on("click",f,this).on("dragstart",d,this).on("dragend",g,this);this._markerGroup.addLayer(e)},_updatePrevNext:function(a,b){a&&(a._next=b);b&&(b._prev=a)},_getMiddleLatLng:function(a,b){var c=this._poly._map,e=c.project(a.getLatLng()),f=c.project(b.getLatLng());return c.unproject(e._add(f)._divideBy(2))}});L.Polyline.addInitHook(function(){this.editing||(L.Edit.Poly&&(this.editing=
new L.Edit.Poly(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))});L.Edit=L.Edit||{};L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"})},
initialize:function(a,b){this._shape=a;L.Util.setOptions(this,b)},addHooks:function(){var a=this._shape;a.setStyle(a.options.editing);a._map&&(this._map=a._map,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup))},removeHooks:function(){var a=this._shape;a.setStyle(a.options.original);if(a._map){this._unbindMarker(this._moveMarker);for(var a=0,b=this._resizeMarkers.length;a<b;a++)this._unbindMarker(this._resizeMarkers[a]);this._resizeMarkers=null;this._map.removeLayer(this._markerGroup);
delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers();this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup);this._createMoveMarker();this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(a,b){var c=new L.Marker(a,{draggable:!0,icon:b,zIndexOffset:10});this._bindMarker(c);this._markerGroup.addLayer(c);return c},_bindMarker:function(a){a.on("dragstart",
this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this)},_unbindMarker:function(a){a.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._onMarkerDragEnd,this)},_onMarkerDragStart:function(a){a.target.setOpacity(0);this._shape.fire("editstart")},_fireEdit:function(){this._shape.edited=!0;this._shape.fire("edit");this._shape._map.fire("edit",{layer:this._shape})},_onMarkerDrag:function(a){a=a.target;
var b=a.getLatLng();a===this._moveMarker?this._move(b):this._resize(b);this._shape.redraw()},_onMarkerDragEnd:function(a){a.target.setOpacity(1);this._fireEdit()},_move:function(){},_resize:function(){}});L.Edit=L.Edit||{};L.Edit.Rectangle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var a=this._shape.getBounds().getCenter();this._moveMarker=this._createMarker(a,this.options.moveIcon)},_createResizeMarker:function(){var a=this._getCorners();this._resizeMarkers=[];for(var b=0,c=a.length;b<
c;b++)this._resizeMarkers.push(this._createMarker(a[b],this.options.resizeIcon)),this._resizeMarkers[b]._cornerIndex=b},_onMarkerDragStart:function(a){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,a);var b=this._getCorners();a=a.target._cornerIndex;this._oppositeCorner=b[(a+2)%4];this._toggleCornerMarkers(0,a)},_onMarkerDragEnd:function(a){var b=a.target,c;b===this._moveMarker&&(c=this._shape.getBounds(),c=c.getCenter(),b.setLatLng(c));this._toggleCornerMarkers(1);this._repositionCornerMarkers();
L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,a)},_move:function(a){for(var b=this._shape.getLatLngs(),c=this._shape.getBounds().getCenter(),e,f=[],d=0,g=b.length;d<g;d++)e=[b[d].lat-c.lat,b[d].lng-c.lng],f.push([a.lat+e[0],a.lng+e[1]]);this._shape.setLatLngs(f);this._repositionCornerMarkers()},_resize:function(a){this._shape.setBounds(L.latLngBounds(a,this._oppositeCorner));a=this._shape.getBounds();this._moveMarker.setLatLng(a.getCenter())},_getCorners:function(){var a=this._shape.getBounds(),
b=a.getNorthWest(),c=a.getNorthEast(),e=a.getSouthEast(),a=a.getSouthWest();return[b,c,e,a]},_toggleCornerMarkers:function(a){for(var b=0,c=this._resizeMarkers.length;b<c;b++)this._resizeMarkers[b].setOpacity(a)},_repositionCornerMarkers:function(){for(var a=this._getCorners(),b=0,c=this._resizeMarkers.length;b<c;b++)this._resizeMarkers[b].setLatLng(a[b])}});L.Rectangle.addInitHook(function(){L.Edit.Rectangle&&(this.editing=new L.Edit.Rectangle(this),this.options.editable&&this.editing.enable())});
L.Edit=L.Edit||{};L.Edit.Circle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var a=this._shape.getLatLng();this._moveMarker=this._createMarker(a,this.options.moveIcon)},_createResizeMarker:function(){var a=this._shape.getLatLng(),a=this._getResizeMarkerPoint(a);this._resizeMarkers=[];this._resizeMarkers.push(this._createMarker(a,this.options.resizeIcon))},_getResizeMarkerPoint:function(a){var b=this._shape._radius*Math.cos(Math.PI/4);a=this._map.project(a);return this._map.unproject([a.x+
b,a.y-b])},_move:function(a){var b=this._getResizeMarkerPoint(a);this._resizeMarkers[0].setLatLng(b);this._shape.setLatLng(a)},_resize:function(a){a=this._moveMarker.getLatLng().distanceTo(a);this._shape.setRadius(a)}});L.Circle.addInitHook(function(){L.Edit.Circle&&(this.editing=new L.Edit.Circle(this),this.options.editable&&this.editing.enable());this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()});this.on("remove",function(){this.editing&&this.editing.enabled()&&
this.editing.removeHooks()})});L.LatLngUtil={cloneLatLngs:function(a){for(var b=[],c=0,e=a.length;c<e;c++)b.push(this.cloneLatLng(a[c]));return b},cloneLatLng:function(a){return L.latLng(a.lat,a.lng)}};L.GeometryUtil=L.extend(L.GeometryUtil||{},{geodesicArea:function(a){var b=a.length,c=0,e=L.LatLng.DEG_TO_RAD,f,d;if(2<b){for(var g=0;g<b;g++)f=a[g],d=a[(g+1)%b],c+=(d.lng-f.lng)*e*(2+Math.sin(f.lat*e)+Math.sin(d.lat*e));c=40680631590769*c/2}return Math.abs(c)},readableArea:function(a,b){var c;b?c=
1E4<=a?(1E-4*a).toFixed(2)+" ha":a.toFixed(2)+" m&sup2;":(a/=0.836127,c=3097600<=a?(a/3097600).toFixed(2)+" mi&sup2;":4840<=a?(a/4840).toFixed(2)+" acres":Math.ceil(a)+" yd&sup2;");return c},distance:function(a,b,c){return a.latLngToLayerPoint(b).distanceTo(a.latLngToLayerPoint(c))},distanceSegment:function(a,b,c,e){b=a.latLngToLayerPoint(b);c=a.latLngToLayerPoint(c);a=a.latLngToLayerPoint(e);return L.LineUtil.pointToSegmentDistance(b,c,a)},readableDistance:function(a,b){var c;"imperial"!==b?c=1E3<
a?(a/1E3).toFixed(2)+" km":Math.round(100*a)/100+" m":(a*=1.09361,c=1760<a?(a/1760).toFixed(2)+" miles":Math.round(100*a)/100+" yd");return c},belongsSegment:function(a,b,c,e){e=e===t?0.2:e;var f=b.distanceTo(c);return(b.distanceTo(a)+a.distanceTo(c)-f)/f<e},length:function(a){a=L.GeometryUtil.accumulatedLengths(a);return 0<a.length?a[a.length-1]:0},accumulatedLengths:function(a){"function"===typeof a.getLatLngs&&(a=a.getLatLngs());if(0===a.length)return[];for(var b=0,c=[0],e=0,f=a.length-1;e<f;e++)b+=
a[e].distanceTo(a[e+1]),c.push(b);return c},closestOnSegment:function(a,b,c,e){var f=a.getMaxZoom();Infinity===f&&(f=a.getZoom());b=a.project(b,f);c=a.project(c,f);e=a.project(e,f);e=L.LineUtil.closestPointOnSegment(b,c,e);return a.unproject(e,f)},closest:function(a,b,c,e){"function"!==typeof b.getLatLngs&&(b=L.polyline(b));var f=b.getLatLngs().slice(0),d=Infinity,g,h=null,q=Infinity;if(e){b=0;for(e=f.length;b<e;b++)g=f[b],q=L.GeometryUtil.distance(a,c,g),q<d&&(d=q,h=g);return h?{latlng:h,distance:q}:
null}b instanceof L.Polygon&&f.push(f[0]);b=0;for(e=f.length;b<e-1;b++){g=f[b];var n=f[b+1],q=L.GeometryUtil.distanceSegment(a,c,g,n);q<=d&&(d=q,h=L.GeometryUtil.closestOnSegment(a,c,g,n))}return h?{latlng:h,distance:d}:null},closestLayer:function(a,b,c){for(var e=Infinity,f=null,d=null,g=Infinity,h=0,q=b.length;h<q;h++){var n=b[h];if("function"===typeof n.getLatLng)d=n.getLatLng(),g=L.GeometryUtil.distance(a,c,d);else if(d=L.GeometryUtil.closest(a,n,c))g=d.distance;g<e&&(e=g,f={layer:n,latlng:d.latlng,
distance:g})}return f},closestLayerSnap:function(a,b,c,e,f){e="number"===typeof e?e:Infinity;f="boolean"===typeof f?f:!0;b=L.GeometryUtil.closestLayer(a,b,c);if(!b||b.distance>e)return null;f&&"function"===typeof b.layer.getLatLngs&&(f=L.GeometryUtil.closest(a,b.layer,b.latlng,!0),f.distance<e&&(b.latlng=f.latlng,b.distance=L.GeometryUtil.distance(a,f.latlng,c)));return b},interpolateOnPointSegment:function(a,b,c){return L.point(a.x*(1-c)+c*b.x,a.y*(1-c)+c*b.y)},interpolateOnLine:function(a,b,c){b=
b instanceof L.Polyline?b.getLatLngs():b;var e=b.length;if(2>e)return null;if(0===c)return{latLng:b[0]instanceof L.LatLng?b[0]:L.latLng(b[0]),predecessor:-1};if(1===c)return{latLng:b[b.length-1]instanceof L.LatLng?b[b.length-1]:L.latLng(b[b.length-1]),predecessor:b.length-2};c=Math.max(Math.min(c,1),0);var f=a.getMaxZoom();Infinity===f&&(f=a.getZoom());for(var d=[],g=0,h=0;h<e;h++)d[h]=a.project(b[h],f),0<h&&(g+=d[h-1].distanceTo(d[h]));c*=g;var g=d[0],h=d[1],q=0,n=g.distanceTo(h);for(b=1;b<e&&n<
c;b++)g=h,q=n,h=d[b],n+=g.distanceTo(h);e=L.GeometryUtil.interpolateOnPointSegment(g,h,0!==n-q?(c-q)/(n-q):0);return{latLng:a.unproject(e,f),predecessor:b-2}},locateOnLine:function(a,b,c){var e=b.getLatLngs();if(c.equals(e[0]))return 0;if(c.equals(e[e.length-1]))return 1;a=L.GeometryUtil.closest(a,b,c,!1);for(var f=L.GeometryUtil.accumulatedLengths(e),d=f[f.length-1],g=0,h=!1,q=0,n=e.length-1;q<n;q++){var m=e[q],z=e[q+1],g=f[q];if(L.GeometryUtil.belongsSegment(a,m,z)){g+=m.distanceTo(a);h=!0;break}}if(!h)throw"Could not interpolate "+
c.toString()+" within "+b.toString();return g/d},reverse:function(a){return L.polyline(a.getLatLngs().slice(0).reverse())},extract:function(a,b,c,e){if(c>e)return L.GeometryUtil.extract(a,L.GeometryUtil.reverse(b),1-c,1-e);c=Math.max(Math.min(c,1),0);e=Math.max(Math.min(e,1),0);var f=b.getLatLngs(),d=L.GeometryUtil.interpolateOnLine(a,b,c),g=L.GeometryUtil.interpolateOnLine(a,b,e);if(c===e)return[L.GeometryUtil.interpolateOnLine(a,b,e).latLng];-1===d.predecessor&&(d.predecessor=0);-1===g.predecessor&&
(g.predecessor=0);a=f.slice(d.predecessor+1,g.predecessor+1);a.unshift(d.latLng);a.push(g.latLng);return a},isBefore:function(a,b){if(!b)return!1;var c=a.getLatLngs(),e=b.getLatLngs();return c[c.length-1].equals(e[0])},isAfter:function(a,b){if(!b)return!1;var c=a.getLatLngs(),e=b.getLatLngs();return c[0].equals(e[e.length-1])},startsAtExtremity:function(a,b){if(!b)return!1;var c=a.getLatLngs(),e=b.getLatLngs(),c=c[0];return c.equals(e[0])||c.equals(e[e.length-1])},computeAngle:function(a,b){return 180*
Math.atan2(b.y-a.y,b.x-a.x)/Math.PI},computeSlope:function(a,b){var c=(b.y-a.y)/(b.x-a.x);return{a:c,b:a.y-c*a.x}},rotatePoint:function(a,b,c,e){var f=a.getMaxZoom();Infinity===f&&(f=a.getZoom());c=c*Math.PI/180;b=a.project(b,f);var d=a.project(e,f);e=Math.cos(c)*(b.x-d.x)-Math.sin(c)*(b.y-d.y)+d.x;c=Math.sin(c)*(b.x-d.x)+Math.cos(c)*(b.y-d.y)+d.y;return a.unproject(new L.Point(e,c),f)}});L.Util.extend(L.LineUtil,{segmentsIntersect:function(a,b,c,e){return this._checkCounterclockwise(a,c,e)!==this._checkCounterclockwise(b,
c,e)&&this._checkCounterclockwise(a,b,c)!==this._checkCounterclockwise(a,b,e)},_checkCounterclockwise:function(a,b,c){return(c.y-a.y)*(b.x-a.x)>(b.y-a.y)*(c.x-a.x)}});L.Polyline.include({intersects:function(){var a=this._originalPoints,b=a?a.length:0,c,e;if(this._tooFewPointsForIntersection())return!1;for(b-=1;3<=b;b--)if(c=a[b-1],e=a[b],this._lineSegmentsIntersectsRange(c,e,b-2))return!0;return!1},newLatLngIntersects:function(a,b){return this._map?this.newPointIntersects(this._map.latLngToLayerPoint(a),
b):!1},newPointIntersects:function(a,b){var c=this._originalPoints,e=c?c.length:0,c=c?c[e-1]:null,e=e-2;return this._tooFewPointsForIntersection(1)?!1:this._lineSegmentsIntersectsRange(c,a,e,b?1:0)},_tooFewPointsForIntersection:function(a){var b=this._originalPoints,b=b?b.length:0;return!this._originalPoints||3>=b+(a||0)},_lineSegmentsIntersectsRange:function(a,b,c,e){var f=this._originalPoints,d;e=e||0;for(var g=c;g>e;g--)if(c=f[g-1],d=f[g],L.LineUtil.segmentsIntersect(a,b,c,d))return!0;return!1}});
L.Polygon.include({intersects:function(){var a=this._originalPoints,b;if(this._tooFewPointsForIntersection())return!1;if(L.Polyline.prototype.intersects.call(this))return!0;b=a.length;return this._lineSegmentsIntersectsRange(a[b-1],a[0],b-2,1)}});L.GeometryUtil=L.extend(L.GeometryUtil||{},{closestGridSnap:function(a,b,c,e){if(c===t||1E-11>c)return null;e="number"===typeof e?e:Infinity;var f=Math.cos(b.lat*Math.PI/180),d=6378137*Math.PI,f=180*c/(d*f),g=180*c/d,d=Math.round((b.lat-Math.round(b.lat))/
f)*f+Math.round(b.lat),f=Math.round(b.lng/g)*g,g={};g.latlng=new L.LatLng(d,f);g.distance=a.latLngToLayerPoint(b).distanceTo(a.latLngToLayerPoint(g.latlng));g.GridStep=c;return!g||g.distance>e?null:g}});L.Control.Draw=L.Control.extend({options:{position:"topleft",draw:{},edit:!1},initialize:function(a){if("0.7">L.version)throw Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");L.Control.prototype.initialize.call(this,a);this._toolbars={};
L.DrawToolbar&&this.options.draw&&(a=new L.DrawToolbar(this.options.draw),this._toolbars[L.DrawToolbar.TYPE]=a,this._toolbars[L.DrawToolbar.TYPE].on("enable",this._toolbarEnabled,this));L.EditToolbar&&this.options.edit&&(a=new L.EditToolbar(this.options.edit),this._toolbars[L.EditToolbar.TYPE]=a,this._toolbars[L.EditToolbar.TYPE].on("enable",this._toolbarEnabled,this))},onAdd:function(a){var b=L.DomUtil.create("div","leaflet-draw"),c=!1,e,f;for(f in this._toolbars)this._toolbars.hasOwnProperty(f)&&
(e=this._toolbars[f].addToolbar(a))&&(c||(L.DomUtil.hasClass(e,"leaflet-draw-toolbar-top")||L.DomUtil.addClass(e.childNodes[0],"leaflet-draw-toolbar-top"),c=!0),b.appendChild(e));return b},onRemove:function(){for(var a in this._toolbars)this._toolbars.hasOwnProperty(a)&&this._toolbars[a].removeToolbar()},setDrawingOptions:function(a){for(var b in this._toolbars)this._toolbars[b]instanceof L.DrawToolbar&&this._toolbars[b].setOptions(a)},_toolbarEnabled:function(a){a=a.target;for(var b in this._toolbars)this._toolbars[b]!==
a&&this._toolbars[b].disable()}});L.Map.mergeOptions({drawControlTooltips:!0,drawControl:!1});L.Map.addInitHook(function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))});L.Toolbar=L.Class.extend({includes:[L.Mixin.Events],initialize:function(a){L.setOptions(this,a);this._modes={};this._actionButtons=[];this._activeMode=null},enabled:function(){return null!==this._activeMode},disable:function(){this.enabled()&&this._activeMode.handler.disable()},
addToolbar:function(a){var b=L.DomUtil.create("div","leaflet-draw-section"),c=0,e=this._toolbarClass||"",f=this.getModeHandlers(a);this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-bar");this._map=a;for(a=0;a<f.length;a++)f[a].enabled&&this._initModeHandler(f[a].handler,this._toolbarContainer,c++,e,f[a].title);if(c)return this._lastButtonIndex=--c,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),b.appendChild(this._toolbarContainer),b.appendChild(this._actionsContainer),
b},removeToolbar:function(){for(var a in this._modes)this._modes.hasOwnProperty(a)&&(this._disposeButton(this._modes[a].button,this._modes[a].handler.enable,this._modes[a].handler),this._modes[a].handler.disable(),this._modes[a].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};a=0;for(var b=this._actionButtons.length;a<b;a++)this._disposeButton(this._actionButtons[a].button,this._actionButtons[a].callback,this);this._actionButtons=[];
this._actionsContainer=null},_initModeHandler:function(a,b,c,e,f){var d=a.type;this._modes[d]={};this._modes[d].handler=a;this._modes[d].button=this._createButton({title:f,className:e+"-"+d,container:b,callback:this._modes[d].handler.enable,context:this._modes[d].handler});this._modes[d].buttonIndex=c;this._modes[d].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_createButton:function(a){var b=L.DomUtil.create("a",a.className||"",a.container);b.href=
"#";a.text&&(b.innerHTML=a.text);a.title&&(b.title=a.title);L.DomEvent.on(b,"click",L.DomEvent.stopPropagation).on(b,"mousedown",L.DomEvent.stopPropagation).on(b,"dblclick",L.DomEvent.stopPropagation).on(b,"click",L.DomEvent.preventDefault).on(b,"click",a.callback,a.context);return b},_disposeButton:function(a,b){L.DomEvent.off(a,"click",L.DomEvent.stopPropagation).off(a,"mousedown",L.DomEvent.stopPropagation).off(a,"dblclick",L.DomEvent.stopPropagation).off(a,"click",L.DomEvent.preventDefault).off(a,
"click",b)},_handlerActivated:function(a){this.disable();this._activeMode=this._modes[a.handler];L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled");this._showActionsToolbar();this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar();L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled");this._activeMode=null;this.fire("disable")},_createActions:function(a){var b=this._actionsContainer;a=this.getActions(a);var c=a.length,
e,f;f=0;for(e=this._actionButtons.length;f<e;f++)this._disposeButton(this._actionButtons[f].button,this._actionButtons[f].callback);for(this._actionButtons=[];b.firstChild;)b.removeChild(b.firstChild);for(f=0;f<c;f++)"enabled"in a[f]&&!a[f].enabled||(e=L.DomUtil.create("li","",b),e=this._createButton({title:a[f].title,text:a[f].text,container:e,callback:a[f].callback,context:a[f].context}),this._actionButtons.push({button:e,callback:a[f].callback}))},_showActionsToolbar:function(){var a=this._activeMode.buttonIndex,
b=this._lastButtonIndex,c=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler);this._actionsContainer.style.top=c+"px";0===a&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top"));a===b&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom"));this._actionsContainer.style.display="block"},
_hideActionsToolbar:function(){this._actionsContainer.style.display="none";L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop");L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom");L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top");L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom")}});L.Tooltip=L.Class.extend({initialize:function(a){this._map=a;this._popupPane=a._panes.popupPane;this._container=a.options.drawControlTooltips?
L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null;this._singleLineLabel=!1},dispose:function(){this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(a){if(!this._container)return this;a.subtext=a.subtext||"";0!==a.subtext.length||this._singleLineLabel?0<a.subtext.length&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),
this._singleLineLabel=!0);this._container.innerHTML=(0<a.subtext.length?'<span class="leaflet-draw-tooltip-subtext">'+a.subtext+"</span><br />":"")+"<span>"+a.text+"</span>";return this},updatePosition:function(a){a=this._map.latLngToLayerPoint(a);var b=this._container;this._container&&(b.style.visibility="inherit",L.DomUtil.setPosition(b,a));return this},showAsError:function(){this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip");return this},removeError:function(){this._container&&
L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip");return this}});L.DrawToolbar=L.Toolbar.extend({statics:{TYPE:"draw"},options:{wall:{},window:{},door:{}},initialize:function(a){for(var b in this.options)this.options.hasOwnProperty(b)&&a[b]&&(a[b]=L.extend({},this.options[b],a[b]));this._toolbarClass="leaflet-draw-draw";L.Toolbar.prototype.initialize.call(this,a)},getModeHandlers:function(a){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(a,this.options.polyline),
title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(a,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(a,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Draw.Circle(a,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(a,this.options.marker),
title:L.drawLocal.draw.toolbar.buttons.marker},{enabled:this.options.wall,handler:new L.Draw.Wall(a,this.options.wall),title:L.drawLocal.draw.toolbar.buttons.wall},{enabled:this.options.window,handler:new L.Draw.Window(a,this.options.window),title:L.drawLocal.draw.toolbar.buttons.window},{enabled:this.options.door,handler:new L.Draw.Door(a,this.options.door),title:L.drawLocal.draw.toolbar.buttons.door}]},getActions:function(){return[{title:L.drawLocal.draw.toolbar.actions.title,text:L.drawLocal.draw.toolbar.actions.text,
callback:this.disable,context:this}]},setOptions:function(a){L.setOptions(this,a);for(var b in this._modes)this._modes.hasOwnProperty(b)&&a.hasOwnProperty(b)&&this._modes[b].handler.setOptions(a[b])}});L.EditToolbar=L.Toolbar.extend({statics:{TYPE:"edit"},options:{edit:{selectedPathOptions:{color:"#fe57a1",opacity:0.6,dashArray:"10, 10",fill:!1,fillColor:"#fe57a1",fillOpacity:0.1,maintainColor:!1}},remove:{},featureGroup:null},initialize:function(a){a.edit&&("undefined"===typeof a.edit.selectedPathOptions&&
(a.edit.selectedPathOptions=this.options.edit.selectedPathOptions),a.edit.selectedPathOptions=L.extend({},this.options.edit.selectedPathOptions,a.edit.selectedPathOptions));a.remove&&(a.remove=L.extend({},this.options.remove,a.remove));this._toolbarClass="leaflet-draw-edit";L.Toolbar.prototype.initialize.call(this,a);this._selectedFeatureCount=0},getModeHandlers:function(a){var b=this.options.featureGroup;return[{enabled:this.options.edit,handler:new L.EditToolbar.Edit(a,{featureGroup:b,selectedPathOptions:this.options.edit.selectedPathOptions}),
title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:this.options.remove,handler:new L.EditToolbar.Delete(a,{featureGroup:b}),title:L.drawLocal.edit.toolbar.buttons.remove}]},getActions:function(){return[{title:L.drawLocal.edit.toolbar.actions.save.title,text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,callback:this.disable,context:this}]},addToolbar:function(a){a=
L.Toolbar.prototype.addToolbar.call(this,a);this._checkDisabled();this.options.featureGroup.on("layeradd layerremove",this._checkDisabled,this);return a},removeToolbar:function(){this.options.featureGroup.off("layeradd layerremove",this._checkDisabled,this);L.Toolbar.prototype.removeToolbar.call(this)},disable:function(){this.enabled()&&(this._activeMode.handler.revertLayers(),L.Toolbar.prototype.disable.call(this))},_save:function(){this._activeMode.handler.save();this._activeMode.handler.disable()},
_checkDisabled:function(){var a=0!==this.options.featureGroup.getLayers().length,b;this.options.edit&&(b=this._modes[L.EditToolbar.Edit.TYPE].button,a?L.DomUtil.removeClass(b,"leaflet-disabled"):L.DomUtil.addClass(b,"leaflet-disabled"),b.setAttribute("title",a?L.drawLocal.edit.toolbar.buttons.edit:L.drawLocal.edit.toolbar.buttons.editDisabled));this.options.remove&&(b=this._modes[L.EditToolbar.Delete.TYPE].button,a?L.DomUtil.removeClass(b,"leaflet-disabled"):L.DomUtil.addClass(b,"leaflet-disabled"),
b.setAttribute("title",a?L.drawLocal.edit.toolbar.buttons.remove:L.drawLocal.edit.toolbar.buttons.removeDisabled))}});L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},includes:L.Mixin.Events,initialize:function(a,b){L.Handler.prototype.initialize.call(this,a);L.setOptions(this,b);this._featureGroup=b.featureGroup;if(!(this._featureGroup instanceof L.FeatureGroup))throw Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={};this.type=L.EditToolbar.Edit.TYPE},enable:function(){!this._enabled&&
this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:editstart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this),this._map.fire("draw:editstart_after",{handler:this.type}))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),L.Handler.prototype.disable.call(this),
this._map.fire("draw:editstop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var a=this._map;a&&(a.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._map.dragging.disable())},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._map.options.dragging&&this._map.dragging.enable())},revertLayers:function(){this._featureGroup.eachLayer(function(a){this._revertLayer(a)},
this)},save:function(){var a=new L.LayerGroup;this._featureGroup.eachLayer(function(b){b.edited&&(a.addLayer(b),b.edited=!1)});this._map.fire("draw:edited",{layers:a})},_backupLayer:function(a){var b=L.Util.stamp(a);this._uneditedLayerProps[b]||(a instanceof L.Polyline||a instanceof L.Polygon||a instanceof L.Rectangle?this._uneditedLayerProps[b]={latlngs:L.LatLngUtil.cloneLatLngs(a.getLatLngs())}:a instanceof L.Circle?this._uneditedLayerProps[b]={latlng:L.LatLngUtil.cloneLatLng(a.getLatLng()),radius:a.getRadius()}:
a instanceof L.Marker&&(this._uneditedLayerProps[b]={latlng:L.LatLngUtil.cloneLatLng(a.getLatLng())}))},_revertLayer:function(a){var b=L.Util.stamp(a);a.edited=!1;this._uneditedLayerProps.hasOwnProperty(b)&&(a instanceof L.Polyline||a instanceof L.Polygon||a instanceof L.Rectangle?a.setLatLngs(this._uneditedLayerProps[b].latlngs):a instanceof L.Circle?(a.setLatLng(this._uneditedLayerProps[b].latlng),a.setRadius(this._uneditedLayerProps[b].radius)):a instanceof L.Marker&&a.setLatLng(this._uneditedLayerProps[b].latlng),
a.fire("revert-edited",{layer:a}),a._map&&a._map.fire("revert-edited",{layer:a}))},_enableLayerEdit:function(a){a=a.layer||a.target||a;var b;if(!a.editing)return!1;this._backupLayer(a);this.options.selectedPathOptions&&(b=L.Util.extend({},this.options.selectedPathOptions),b.maintainColor&&(b.color=a.options.color,b.fillColor=a.options.fillColor),a.options.original=L.extend({},a.options),a.options.editing=b);a.editing.enable()},_disableLayerEdit:function(a){a=a.layer||a.target||a;if(!a.editing)return!1;
a.edited=!1;a.editing.disable();delete a.options.editing;delete a.options.original},_hasAvailableLayers:function(){return 0!==this._featureGroup.getLayers().length}});L.EditToolbar.Delete=L.Handler.extend({statics:{TYPE:"remove"},options:{icon:new L.DivIcon({iconSize:new L.Point(26,26),className:"leaflet-div-icon leaflet-delete-icon"})},includes:L.Mixin.Events,initialize:function(a,b){L.Handler.prototype.initialize.call(this,a);L.Util.setOptions(this,b);this._deletableLayers=this.options.featureGroup;
if(!(this._deletableLayers instanceof L.FeatureGroup))throw Error("options.featureGroup must be a L.FeatureGroup");this.type=L.EditToolbar.Delete.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:deletestart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disable:function(){this._enabled&&(this._deletableLayers.off("layeradd",
this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this),L.Handler.prototype.disable.call(this),this._map.fire("draw:deletestop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var a=this._map;a&&(a.getContainer().focus(),this._deletableLayers.eachLayer(this._enableLayerDelete,this),this._deletedLayers=new L.LayerGroup,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup))},removeHooks:function(){this._map&&(this._deletableLayers.eachLayer(this._disableLayerDelete,
this),this._deletedLayers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},revertLayers:function(){this._deletedLayers.eachLayer(function(a){this._deletableLayers.addLayer(a);a.fire("revert-deleted",{layer:a});this._map.fire("revert-edited",{layer:a})},this)},save:function(){this._map.fire("draw:deleted",{layers:this._deletedLayers})},_enableLayerDelete:function(a){(a.layer||a.target||a).on("click",this._removeLayer,this)},_disableLayerDelete:function(a){a=
a.layer||a.target||a;a.off("click",this._removeLayer,this);this._deletedLayers.removeLayer(a)},_removeLayer:function(a){a=a.layer||a.target||a;this._deletableLayers.removeLayer(a);this._deletedLayers.addLayer(a);a.fire("deleted")},_hasAvailableLayers:function(){return 0!==this._deletableLayers.getLayers().length},_initMarkers:function(){var a=this;this._markerGroup||(this._markerGroup=new L.LayerGroup);this._markers=[];var b,c,e;this._deletableLayers.eachLayer(function(f){if(f.editing._poly!==t&&
!(2>f.editing._poly._latlngs.length)){b=f.editing._poly._latlngs[0];c=new L.LatLng(b.lat,b.lng);var d=new L.Marker(c,{draggable:!1,icon:a.options.icon});d.setOpacity(0.6);d._origLatLng=c;e=function(){a._removeLayer({layer:f});d.setOpacity(1)};d.on("click",e);a._markerGroup.addLayer(d)}})}});L.Handler.MarkerSnap=L.Handler.extend({options:{snapType:"undefined",gridStep:0.1,snapDistance:6,snapToGrid:!0,snapToObjects:!0,snapVertices:!0},initialize:function(a,b,c){function e(){this._buffer=a.layerPointToLatLng(new L.Point(0,
0)).lat-a.layerPointToLatLng(new L.Point(this.options.snapDistance,0)).lat}L.Handler.prototype.initialize.call(this,a);this._markers=[];this._guides=[];2!==arguments.length||b instanceof L.Class||(c=b,b=null);L.Util.setOptions(this,c||{});b&&(b.dragging||(b.dragging=new L.Handler.MarkerDrag(b)),b.dragging.enable(),this.watchMarker(b));a.on("zoomend",e,this);a.whenReady(e,this);e.call(this)},enable:function(){this.disable();for(var a=0;a<this._markers.length;a++)this.watchMarker(this._markers[a])},
disable:function(){for(var a=0;a<this._markers.length;a++)this.unwatchMarker(this._markers[a])},watchMarker:function(a){-1===this._markers.indexOf(a)&&this._markers.push(a);a.on("move",this._snapMarker,this)},unwatchMarker:function(a){a.off("move",this._snapMarker,this);delete a.snap},addGuideLayer:function(a){for(var b=0,c=this._guides.length;b<c&&L.stamp(a)!==L.stamp(this._guides[b]);b++);this._guides.push(a);return this._guides},addGuideLayersFromGroup:function(a){a.eachLayer(this.addGuideLayer,
this);return this._guides},removeGuideLayer:function(a){for(var b=0,c=this._guides.length;b<c;b++)if(L.stamp(a)===L.stamp(this._guides[b])){this._guides.splice(b,1);break}return this._guides},_snapMarker:function(a){function b(a){if(a._layers!==t&&"function"!==typeof a.searchBuffer)for(var d in a._layers)b(a._layers[d]);else"function"===typeof a.searchBuffer?e=e.concat(a.searchBuffer(c,this._buffer)):e.push(a)}a=a.target;var c=a.getLatLng(),e=[],f=null;if(this.options.snapToGrid&&(f=this._findClosestGridSnap(this._map,
c,this.options.gridStep,this.options.snapDistance),null!==f)){this._updateSnap(a,a,f.latlng);return}if(this.options.snapToObjects){for(var f=0,d=this._guides.length;f<d;f++){var g=this._guides[f];g.snapediting!==t&&a._leaflet_id in g.snapediting._markerGroup._layers||b.call(this,g)}f=this._findClosestLayerSnap(this._map,e,c,this.options.snapDistance,this.options.snapVertices)}f=f||{layer:null,latlng:null};this._updateSnap(a,f.layer,f.latlng)},_findClosestLayerSnap:function(a,b,c,e,f){return L.GeometryUtil.closestLayerSnap(a,
b,c,e,f)},_findClosestGridSnap:function(a,b,c,e){return L.GeometryUtil.closestGridSnap(a,b,c,e)},_updateSnap:function(a,b,c){b&&c?(a._latlng=L.latLng(c),a.update(),a.snap!==b&&(a.snap=b,a._icon&&L.DomUtil.addClass(a._icon,"marker-snapped"),a.fire("snap",{layer:b,latlng:c}))):(a.snap&&(a._icon&&L.DomUtil.removeClass(a._icon,"marker-snapped"),a.fire("unsnap",{layer:a.snap})),delete a.snap)}});L.Handler.PolylineSnap=L.Edit.Poly.extend({initialize:function(a,b,c){var e=this;L.Edit.Poly.prototype.initialize.call(this,
b,c);this._snapper=new L.Handler.MarkerSnap(a,c);b.on("remove",function(){e._snapper.disable()})},addGuideLayer:function(a){this._snapper.addGuideLayer(a);return this._snapper._guides},addGuideLayersFromGroup:function(a){a.eachLayer(this.addGuideLayer,this);return this._snapper._guides},removeGuideLayer:function(a){this._snapper.removeGuideLayer(a);return this._snapper._guides},_createMarker:function(a,b){var c=L.Edit.Poly.prototype._createMarker.call(this,a,b);if(b===t)c.on("dragstart",function(){this._snapper.watchMarker(c)},
this);else this._snapper.watchMarker(c);return c}});L.Draw.Feature.SnapMixin={_snapInitialize:function(){this.on("enabled",this._snapOnEnabled,this);this.on("disabled",this._snapOnDisabled,this)},_snapOnEnabled:function(){if(this.options.guideLayers)if(this._mouseMarker){this._map.off("layeradd",this._snapOnEnabled,this);this._snapper||(this._snapper=new L.Handler.MarkerSnap(this._map),L.Util.setOptions(this._snapper,this.options));for(var a=0,b=this.options.guideLayers.length;a<b;a++)this._snapper.addGuideLayer(this.options.guideLayers[a]);
var c=this._mouseMarker;this._snapper.watchMarker(c);var e=c.options.icon;c.on("snap",function(){c.setIcon(this.options.icon);c.setOpacity(1)},this);c.on("unsnap",function(){c.setIcon(e);c.setOpacity(0)},this);c.on("click",this._snapOnClick,this)}else this._map.on("layeradd",this._snapOnEnabled,this)},_snapOnClick:function(a){if(this._markers){var b=this._markers[this._markers.length-1];this._mouseMarker.snap&&a&&b&&(b.setLatLng(a.target._latlng),this._poly&&(this._poly._latlngs[this._poly._latlngs.length-
1]=a.target._latlng,this._poly.redraw()),b._icon&&L.DomUtil.addClass(b._icon,"marker-snapped"))}},_snapOnDisabled:function(){delete this._snapper}};L.Draw.Feature.include(L.Draw.Feature.SnapMixin);L.Draw.Feature.addInitHook("_snapInitialize");L.Control.GraphicScale=L.Control.extend({options:{position:"bottomleft",updateWhenIdle:!1,minUnitWidth:30,maxUnitsWidth:240,fill:"fill",showSubunits:!1,doubleLine:!1,labelPlacement:"auto"},onAdd:function(a){this._map=a;this._possibleUnitsNum=[3,5,2,4];this._possibleUnitsNumLen=
this._possibleUnitsNum.length;this._possibleDivisions=[1,0.5,0.25,0.2];this._possibleDivisionsLen=this._possibleDivisions.length;this._possibleDivisionsSub={1:{num:2,division:0.5},"0.5":{num:5,division:0.1},"0.25":{num:5,division:0.05},"0.2":{num:2,division:0.1}};this._scaleInner=this._buildScale();this._scale=this._addScale(this._scaleInner);this._setStyle(this.options);a.on(this.options.updateWhenIdle?"moveend":"move",this._update,this);a.whenReady(this._update,this);return a.options.graphicScaleControl=
this._scale},onRemove:function(a){a.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScale:function(a){var b=L.DomUtil.create("div");b.className="leaflet-control-graphicscale";b.appendChild(a);return b},_setStyle:function(a){var b=["leaflet-control-graphicscale-inner"];a.fill&&"nofill"!==a.fill&&(b.push("filled"),b.push("filled-"+a.fill));a.showSubunits&&b.push("showsubunits");a.doubleLine&&b.push("double");b.push("labelPlacement-"+a.labelPlacement);this._scaleInner.className=
b.join(" ")},_buildScale:function(){var a=r.createElement("div");a.className="leaflet-control-graphicscale-inner";var b=L.DomUtil.create("div","subunits",a),c=L.DomUtil.create("div","units",a);this._units=[];this._unitsLbls=[];this._subunits=[];for(var e=0;5>e;e++){var f=this._buildDivision(0===e%2);c.appendChild(f);this._units.push(f);var d=this._buildDivisionLbl();f.appendChild(d);this._unitsLbls.push(d);f=this._buildDivision(1===e%2);b.appendChild(f);this._subunits.unshift(f)}this._zeroLbl=L.DomUtil.create("div",
"label zeroLabel");this._zeroLbl.innerHTML="0";this._units[0].appendChild(this._zeroLbl);this._subunitsLbl=L.DomUtil.create("div","label subunitsLabel");this._subunitsLbl.innerHTML="?";this._subunits[4].appendChild(this._subunitsLbl);return a},_buildDivision:function(a){var b=L.DomUtil.create("div","division"),c=L.DomUtil.create("div","line");b.appendChild(c);var e=L.DomUtil.create("div","line2");b.appendChild(e);a&&c.appendChild(L.DomUtil.create("div","fill"));a||e.appendChild(L.DomUtil.create("div",
"fill"));return b},_buildDivisionLbl:function(){return L.DomUtil.create("div","label divisionLabel")},_update:function(){var a=this._map.getBounds(),b=a.getCenter().lat,a=6378137*Math.PI*Math.cos(b*Math.PI/180)*(a.getNorthEast().lng-a.getSouthWest().lng)/180;0<this._map.getSize().x&&this._updateScale(a,this.options)},_updateScale:function(a,b){var c=this._getBestScale(a,b.minUnitWidth,b.maxUnitsWidth);this._render(c)},_getBestScale:function(a,b,c){a=this._getPossibleUnits(a,b,this._map.getSize().x);
c=this._getPossibleScales(a,c);c.sort(function(a,b){return b.score-a.score});c=c[0];c.subunits=this._getSubunits(c);return c},_getSubunits:function(a){var b=this._possibleDivisionsSub[a.unit.unitDivision],c={};c.subunitDivision=b.division;c.subunitMeters=a.unit.unitMeters/a.unit.unitDivision*b.division;c.subunitPx=a.unit.unitPx/a.unit.unitDivision*b.division;return{subunit:c,numSubunits:b.num,total:b.num*c.subunitMeters}},_getPossibleScales:function(a,b){for(var c=[],e=Number.POSITIVE_INFINITY,f,
d=0;d<this._possibleUnitsNumLen;d++)for(var g=this._possibleUnitsNum[d],h=0.5*(this._possibleUnitsNumLen-d),q=0;q<a.length;q++){var n=a[q],m=n.unitPx*g,z={unit:n,totalWidthPx:m,numUnits:g,score:0},y=1-(b-m)/b,y=3*y,y=n.unitScore+h+y;if(0.25===n.unitDivision&&3===g||0.5===n.unitDivision&&3===g||0.25===n.unitDivision&&5===g)y-=2;z.score=y;m<b&&c.push(z);m<e&&(e=m,f=z)}c.length||c.push(f);return c},_getPossibleUnits:function(a,b,c){for(var e,f=[],d=(Math.floor(a)+"").length;-2<d;d--){e=Math.pow(10,d);
for(var g=0;g<this._possibleDivisionsLen;g++){var h=e*this._possibleDivisions[g],q=h/a*c;if(q<b)return f;f.push({unitMeters:h,unitPx:q,unitDivision:this._possibleDivisions[g],unitScore:this._possibleDivisionsLen-g})}}return f},_render:function(a){this._renderPart(a.unit.unitPx,a.unit.unitMeters,a.numUnits,this._units,this._unitsLbls);this._renderPart(a.subunits.subunit.subunitPx,a.subunits.subunit.subunitMeters,a.subunits.numSubunits,this._subunits);a=this._getDisplayUnit(a.subunits.total);this._subunitsLbl.innerHTML=
""+a.amount+a.unit},_renderPart:function(a,b,c,e,f){b=this._getDisplayUnit(b);for(var d=0;d<this._units.length;d++){var g=e[d];d<c?(g.style.width=a+"px",g.className="division"):(g.style.width=0,g.className="division hidden");if(f){var g=f[d],h=["label","divisionLabel"];if(d<c){var q;q=1>b.amount?((d+1)*b.amount).toFixed(2):((d+1)*b.amount).toFixed(0);d===c-1?(q+=b.unit,h.push("labelLast")):h.push("labelSub");g.innerHTML=q}g.className=h.join(" ")}}},_getDisplayUnit:function(a){1>a&&(a=a.toFixed(2));
var b=1E3>a?"m":"km";return{unit:b,amount:"km"===b?a/1E3:a}}});L.Map.mergeOptions({graphicScaleControl:!1});L.control.graphicScale=function(a){return new L.Control.GraphicScale(a)};L.Map.addInitHook(function(){this.options.graphicScaleControl&&(this.graphicScaleControl=L.control.graphicScale({doubleLine:!1,fill:"fill",showSubunits:!0}).addTo(this))});L.SimpleGraticule=L.LayerGroup.extend({options:{interval:20,showOriginLabel:!1,redraw:"move",hidden:!1,zoomIntervals:[{start:0,end:3,interval:5E6},{start:4,
end:5,interval:5E5},{start:6,end:7,interval:2E5},{start:8,end:9,interval:1E5},{start:10,end:10,interval:3E4},{start:11,end:11,interval:1E4},{start:12,end:12,interval:6E3},{start:13,end:13,interval:3E3},{start:14,end:14,interval:2E3},{start:15,end:15,interval:1E3},{start:16,end:16,interval:500},{start:17,end:17,interval:250},{start:18,end:19,interval:100},{start:20,end:20,interval:30},{start:21,end:21,interval:10},{start:22,end:22,interval:6},{start:23,end:23,interval:3},{start:24,end:24,interval:2},
{start:25,end:25,interval:1},{start:26,end:26,interval:0.5},{start:27,end:27,interval:0.2},{start:28,end:28,interval:0.1},{start:29,end:29,interval:0.06},{start:30,end:31,interval:0.04},{start:32,end:41,interval:0.02}]},lineStyle:{stroke:!0,color:"#111",opacity:0.6,weight:1,clickable:!1},initialize:function(a){L.LayerGroup.prototype.initialize.call(this);L.Util.setOptions(this,a)},onAdd:function(a){this._map=a;var b=this.redraw();this._map.on("viewreset "+this.options.redraw,b.redraw,b);this.eachLayer(a.addLayer,
a)},onRemove:function(a){a.off("viewreset "+this.options.redraw,this.map);this.eachLayer(this.removeLayer,this);this.options.simpleGraticule=!1},hide:function(){this.options.hidden=!0;this.redraw()},show:function(){this.options.hidden=!1;this.redraw()},redraw:function(){this._bounds=this._map.getBounds().pad(0);this.clearLayers();if(!this.options.hidden){for(var a=this._map.getZoom(),b=0;b<this.options.zoomIntervals.length;b++)if(a>=this.options.zoomIntervals[b].start&&a<=this.options.zoomIntervals[b].end){this.options.interval=
this.options.zoomIntervals[b].interval;break}this.constructLines(this.getMins(),this.getLineCounts());this.options.showOriginLabel&&this.addLayer(this.addOriginLabel())}return this},getLineCounts:function(){var a=Math.cos(this._bounds.getCenter().lat*Math.PI/180),b=6378137*Math.PI,c=this.options.interval,a=180*c/(b*a),b=180*c/b;return{x:Math.ceil((this._bounds.getEast()-this._bounds.getWest())/a),y:Math.ceil((this._bounds.getNorth()-this._bounds.getSouth())/b)}},getMins:function(){var a=Math.cos(this._bounds.getCenter().lat*
Math.PI/180),b=6378137*Math.PI,c=this.options.interval,a=180*c/(b*a),b=180*c/b;return{x:Math.round((this._bounds.getWest()-Math.round(this._bounds.getWest()))/a)*a+Math.round(this._bounds.getWest()),y:Math.round(this._bounds.getSouth()/b)*b}},constructLines:function(a,b){for(var c=Array(b.x+b.y),e=Array(b.x+b.y),f=Math.cos(this._bounds.getCenter().lat*Math.PI/180),d=6378137*Math.PI,g=this.options.interval,f=180*g/(d*f),d=180*g/d,g=0;g<=b.x;g++){var h=a.x+g*f;c[g]=this.buildXLine(h);this.options.showOriginLabel&&
(e[g]=this.buildLabel("gridlabel-horiz",h))}for(f=0;f<=b.y;f++)h=a.y+f*d,c[f+g]=this.buildYLine(h),this.options.showOriginLabel&&(e[f+g]=this.buildLabel("gridlabel-vert",h));c.forEach(this.addLayer,this);this.options.showOriginLabel&&e.forEach(this.addLayer,this);this.eachLayer(function(a){a.bringToBack()})},buildXLine:function(a){var b=new L.LatLng(this._bounds.getSouth(),a);a=new L.LatLng(this._bounds.getNorth(),a);return new L.Polyline([b,a],this.lineStyle)},buildYLine:function(a){var b=new L.LatLng(a,
this._bounds.getWest());a=new L.LatLng(a,this._bounds.getEast());return new L.Polyline([b,a],this.lineStyle)},buildLabel:function(a,b){var c=this._map.getBounds().pad(-0),c="gridlabel-horiz"===a?new L.LatLng(c.getCenter().lng,b):new L.LatLng(b,c.getCenter().lat);return L.marker(c,{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-grid-label",html:'<div class="'+a+'">'+b+"</div>"})})},addOriginLabel:function(){return L.marker([0,0],{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-grid-label",
html:'<div class="gridlabel-horiz">(0,0)</div>'})})}});L.simpleGraticule=function(a){return new L.SimpleGraticule(a)};L.Map.addInitHook(function(){this.options.simpleGraticule&&(this.options.simpleGraticule=(new L.simpleGraticule).addTo(this))});L.SnapGrid=L.LayerGroup.extend({options:{interval:20,showOriginLabel:!1,redraw:"move",hidden:!1,zoomIntervals:[]},lineStyle:{stroke:!0,color:"red",opacity:0.3,weight:1,clickable:!1,dashArray:"8,2"},initialize:function(a){L.LayerGroup.prototype.initialize.call(this);
L.Util.setOptions(this,a)},onAdd:function(a){this._map=a;var b=this.redraw();this._map.on("viewreset "+this.options.redraw,b.redraw,b);this.eachLayer(a.addLayer,a)},onRemove:function(a){a.off("viewreset "+this.options.redraw,this.map);this.eachLayer(this.removeLayer,this);this.options.simpleGraticule=!1},hide:function(){this.options.hidden=!0;this.redraw()},show:function(){this.options.hidden=!1;this.redraw()},redraw:function(){this._bounds=this._map.getBounds().pad(0);this.clearLayers();if(!this.options.hidden){var a=
this.getLineCounts();300>a.x+a.y&&this.constructLines(this.getMins(),this.getLineCounts());this.options.showOriginLabel&&this.addLayer(this.addOriginLabel())}return this},getLineCounts:function(){var a=Math.cos(this._bounds.getCenter().lat*Math.PI/180),b=6378137*Math.PI,c=this.options.interval,a=180*c/(b*a),b=180*c/b;return{x:Math.ceil((this._bounds.getEast()-this._bounds.getWest())/a),y:Math.ceil((this._bounds.getNorth()-this._bounds.getSouth())/b)}},getMins:function(){var a=Math.cos(this._bounds.getCenter().lat*
Math.PI/180),b=6378137*Math.PI,c=this.options.interval,a=180*c/(b*a),b=180*c/b;return{x:Math.round((this._bounds.getWest()-Math.round(this._bounds.getWest()))/a)*a+Math.round(this._bounds.getWest()),y:Math.round(this._bounds.getSouth()/b)*b}},constructLines:function(a,b){for(var c=Array(b.x+b.y),e=Array(b.x+b.y),f=Math.cos(this._bounds.getCenter().lat*Math.PI/180),d=6378137*Math.PI,g=this.options.interval,f=180*g/(d*f),d=180*g/d,g=0;g<=b.x;g++){var h=a.x+g*f;c[g]=this.buildXLine(h);this.options.showOriginLabel&&
(e[g]=this.buildLabel("gridlabel-horiz",h))}for(f=0;f<=b.y;f++)h=a.y+f*d,c[f+g]=this.buildYLine(h),this.options.showOriginLabel&&(e[f+g]=this.buildLabel("gridlabel-vert",h));c.forEach(this.addLayer,this);this.options.showOriginLabel&&e.forEach(this.addLayer,this);this.eachLayer(function(a){a.bringToBack()})},buildXLine:function(a){var b=new L.LatLng(this._bounds.getSouth(),a);a=new L.LatLng(this._bounds.getNorth(),a);return new L.Polyline([b,a],this.lineStyle)},buildYLine:function(a){var b=new L.LatLng(a,
this._bounds.getWest());a=new L.LatLng(a,this._bounds.getEast());return new L.Polyline([b,a],this.lineStyle)},buildLabel:function(a,b){var c=this._map.getBounds().pad(-0),c="gridlabel-horiz"===a?new L.LatLng(c.getCenter().lng,b):new L.LatLng(b,c.getCenter().lat);return L.marker(c,{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-snap-grid-label",html:'<div class="'+a+'">'+b+"</div>"})})},addOriginLabel:function(){return L.marker([0,0],{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-snap-grid-label",
html:'<div class="gridlabel-horiz">(0,0)</div>'})})}});L.snapGrid=function(a){return new L.SnapGrid(a)};L.Map.addInitHook(function(){this.options.snapGrid&&(this.options.snapGrid=(new L.snapGrid).addTo(this))});(function(a){var b;if("function"===typeof define&&define.amd)define(["leaflet"],a);else if("undefined"!==typeof module)b=require("leaflet"),module.exports=a(b);else{if("undefined"===typeof G.L)throw Error("Leaflet must be loaded first");a(G.L)}})(function(a){a.Map.mergeOptions({contextmenu:!0,
contextmenuWidth:140,contextmenuItems:[{text:"Center map here",callback:function(a){this.panTo(a.latlng)}}]});a.Map.ContextMenu=a.Handler.extend({_touchstart:a.Browser.msPointer?"MSPointerDown":a.Browser.pointer?"pointerdown":"touchstart",statics:{BASE_CLS:"leaflet-contextmenu"},initialize:function(b){a.Handler.prototype.initialize.call(this,b);this._map=b;this._items=[];this._visible=!1;var c=this._container=a.DomUtil.create("div",a.Map.ContextMenu.BASE_CLS,b._container);c.style.zIndex=1E4;c.style.position=
"absolute";b.options.contextmenuWidth&&(c.style.width=b.options.contextmenuWidth+"px");this._createItems();a.DomEvent.on(c,"click",a.DomEvent.stop).on(c,"mousedown",a.DomEvent.stop).on(c,"dblclick",a.DomEvent.stop).on(c,"contextmenu",a.DomEvent.stop)},addHooks:function(){a.DomEvent.on(r,a.Browser.touch?this._touchstart:"mousedown",this._onMouseDown,this).on(r,"keydown",this._onKeyDown,this);this._map.on({contextmenu:this._show,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide},this);
a.DomEvent.on(this._map.getContainer(),"mouseleave",this._hide,this)},removeHooks:function(){a.DomEvent.off(r,a.Browser.touch?this._touchstart:"mousedown",this._onMouseDown,this).off(r,"keydown",this._onKeyDown,this);this._map.off({contextmenu:this._show,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide},this);a.DomEvent.off(this._map.getContainer(),"mouseleave",this._hide,this)},showAt:function(b,c){b instanceof a.LatLng&&(b=this._map.latLngToContainerPoint(b));this._showAtPoint(b,c)},
hide:function(){this._hide()},addItem:function(a){return this.insertItem(a)},insertItem:function(a,b){b=b!==t?b:this._items.length;var c=this._createItem(this._container,a,b);this._items.push(c);this._sizeChanged=!0;this._map.fire("contextmenu.additem",{contextmenu:this,el:c.el,index:b});return c.el},removeItem:function(b){var c=this._container;isNaN(b)||(b=c.children[b]);b&&(this._removeItem(a.Util.stamp(b)),this._sizeChanged=!0,this._map.fire("contextmenu.removeitem",{contextmenu:this,el:b}))},
removeAllItems:function(){for(var b;this._container.children.length;)b=this._container.children[0],this._removeItem(a.Util.stamp(b))},hideAllItems:function(){var a,b,c;b=0;for(c=this._items.length;b<c;b++)a=this._items[b],a.el.style.display="none"},showAllItems:function(){var a,b,c;b=0;for(c=this._items.length;b<c;b++)a=this._items[b],a.el.style.display=""},setDisabled:function(b,c){var e=this._container,d=a.Map.ContextMenu.BASE_CLS+"-item";isNaN(b)||(b=e.children[b]);b&&a.DomUtil.hasClass(b,d)&&
(c?(a.DomUtil.addClass(b,d+"-disabled"),this._map.fire("contextmenu.disableitem",{contextmenu:this,el:b})):(a.DomUtil.removeClass(b,d+"-disabled"),this._map.fire("contextmenu.enableitem",{contextmenu:this,el:b})))},isVisible:function(){return this._visible},_createItems:function(){var a=this._map.options.contextmenuItems,b,c;b=0;for(c=a.length;b<c;b++)this._items.push(this._createItem(this._container,a[b]))},_createItem:function(b,c,e){if(c.separator||"-"===c)return this._createSeparator(b,e);var d=
a.Map.ContextMenu.BASE_CLS+"-item";b=this._insertElementAt("a",c.disabled?d+" "+d+"-disabled":d,b,e);e=this._createEventHandler(b,c.callback,c.context,c.hideOnSelect);d="";c.icon?d='<img class="'+a.Map.ContextMenu.BASE_CLS+'-icon" src="'+c.icon+'"/>':c.iconCls&&(d='<span class="'+a.Map.ContextMenu.BASE_CLS+"-icon "+c.iconCls+'"></span>');b.innerHTML=d+c.text;b.href="#";a.DomEvent.on(b,"mouseover",this._onItemMouseOver,this).on(b,"mouseout",this._onItemMouseOut,this).on(b,"mousedown",a.DomEvent.stopPropagation).on(b,
"click",e);return{id:a.Util.stamp(b),el:b,callback:e}},_removeItem:function(b){var c,e,d;e=0;for(d=this._items.length;e<d;e++)if(c=this._items[e],c.id===b)return b=c.el,c.callback&&a.DomEvent.off(b,"mouseover",this._onItemMouseOver,this).off(b,"mouseover",this._onItemMouseOut,this).off(b,"mousedown",a.DomEvent.stopPropagation).off(b,"click",c.callback),this._container.removeChild(b),this._items.splice(e,1),c;return null},_createSeparator:function(b,c){var e=this._insertElementAt("div",a.Map.ContextMenu.BASE_CLS+
"-separator",b,c);return{id:a.Util.stamp(e),el:e}},_createEventHandler:function(b,c,e,d){var f=this,g=this._map,r=a.Map.ContextMenu.BASE_CLS+"-item-disabled";d=d!==t?d:!0;return function(){a.DomUtil.hasClass(b,r)||(d&&f._hide(),c&&c.call(e||g,f._showLocation),f._map.fire("contextmenu:select",{contextmenu:f,el:b}))}},_insertElementAt:function(a,b,c,e){var d;a=r.createElement(a);a.className=b;e!==t&&(d=c.children[e]);d?c.insertBefore(a,d):c.appendChild(a);return a},_show:function(a){this._showAtPoint(a.containerPoint)},
_showAtPoint:function(b,c){if(this._items.length){var e=this._map,d=e.containerPointToLayerPoint(b),e=e.layerPointToLatLng(d),f={contextmenu:this};c&&(f=a.extend(c,f));this._showLocation={latlng:e,layerPoint:d,containerPoint:b};this._setPosition(b);this._visible?this._setPosition(b):(this._container.style.display="block",this._visible=!0);this._map.fire("contextmenu.show",f)}},_hide:function(){this._visible&&(this._visible=!1,this._container.style.display="none",this._map.fire("contextmenu.hide",
{contextmenu:this}))},_setPosition:function(b){var c=this._map.getSize(),e=this._container,d=this._getElementSize(e),f;this._map.options.contextmenuAnchor&&(f=a.point(this._map.options.contextmenuAnchor),b=b.add(f));e._leaflet_pos=b;b.x+d.x>c.x?(e.style.left="auto",e.style.right=Math.max(c.x-b.x,0)+"px"):(e.style.left=Math.max(b.x,0)+"px",e.style.right="auto");b.y+d.y>c.y?(e.style.top="auto",e.style.bottom=Math.max(c.y-b.y,0)+"px"):(e.style.top=Math.max(b.y,0)+"px",e.style.bottom="auto")},_getElementSize:function(a){var b=
this._size,c=a.style.display;if(!b||this._sizeChanged)b={},a.style.left="-999999px",a.style.right="auto",a.style.display="block",b.x=a.offsetWidth,b.y=a.offsetHeight,a.style.left="auto",a.style.display=c,this._sizeChanged=!1;return b},_onMouseDown:function(){this._hide()},_onKeyDown:function(a){27===a.keyCode&&this._hide()},_onItemMouseOver:function(b){a.DomUtil.addClass(b.target||b.srcElement,"over")},_onItemMouseOut:function(b){a.DomUtil.removeClass(b.target||b.srcElement,"over")}});a.Map.addInitHook("addHandler",
"contextmenu",a.Map.ContextMenu);a.Mixin.ContextMenu={bindContextMenu:function(b){a.setOptions(this,b);this._initContextMenu();return this},unbindContextMenu:function(){this.off("contextmenu",this._showContextMenu,this);return this},_initContextMenu:function(){this._items=[];this.on("contextmenu",this._showContextMenu,this)},_showContextMenu:function(a){var b,c,e;if(this._map.contextmenu){b=this._map.mouseEventToContainerPoint(a.originalEvent);this.options.contextmenuInheritItems||this._map.contextmenu.hideAllItems();
c=0;for(e=this.options.contextmenuItems.length;c<e;c++)a=this.options.contextmenuItems[c],this._items.push(this._map.contextmenu.insertItem(a,a.index));this._map.once("contextmenu.hide",this._hideContextMenu,this);this._map.contextmenu.showAt(b,{relatedTarget:this})}},_hideContextMenu:function(){var a,b;a=0;for(b=this._items.length;a<b;a++)this._map.contextmenu.removeItem(this._items[a]);this._items.length=0;this.options.contextmenuInheritItems||this._map.contextmenu.showAllItems()}};var b=[a.Marker,
a.Path],c={contextmenu:!1,contextmenuItems:[],contextmenuInheritItems:!0},e,f,d,g=function(){this.options.contextmenu&&this._initContextMenu()};f=0;for(d=b.length;f<d;f++)e=b[f],e.prototype.options?e.mergeOptions(c):e.prototype.options=c,e.addInitHook(g),e.include(a.Mixin.ContextMenu);return a.Map.ContextMenu});L.Control.SlideMenu=L.Control.extend({options:{isOpen:!1,position:"topright",width:"100%",height:"40px",delay:"0",closeButtonIcon:"fa-angle-double-up",menuButtonIcon:"fa-angle-double-down"},
contents:'<span class="leaflet-top-menu-spacer">&nbsp;</span>,<a class="leaflet-top-menu-link"><b> Load </b></a>,<a class="leaflet-top-menu-link"><b> Save </b></a>,<a class="leaflet-top-menu-link"><b> SVG </b></a>,<a class="leaflet-top-menu-link"><b> PNG </b></a>,<a class="leaflet-top-menu-link"><b> JPG </b></a>,<a class="leaflet-top-menu-link"><b> Options </b></a>'.split(","),initialize:function(a,b){b&&L.Util.setOptions(this,b);this._innerHTML=a?a:this.contents.join("");this._startPosition=0;this._isLeftPosition=
"topleft"===this.options.position||"buttomleft"===this.options.position?!0:!1},onAdd:function(a){this._map=a;this._startPosition=-parseInt(this.options.width,10);this.options.width.indexOf("%")+1&&(this._startPosition=this._startPosition*a.getSize().x*0.01);this._container=L.DomUtil.create("div","leaflet-control-slidemenu leaflet-bar leaflet-control");this.showlink=L.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",this._container);this.showlink.title="Menu";0<this.options.menuButtonIcon.length?
L.DomUtil.create("span","fa "+this.options.menuButtonIcon,this.showlink):L.DomUtil.create("span","fa fa-bars",this.showlink);this._menu=L.DomUtil.create("div","leaflet-menu",r.getElementsByClassName("leaflet-container")[0]);this._menu.style.width=this.options.width;this._menu.style.height=this.options.height;this.closeButton=L.DomUtil.create("span","leaflet-menu-close-button fa",this._menu);0<this.options.closeButtonIcon.length?(this._isLeftPosition=!0,this._menu.style.left="-"+this.options.width,
this.closeButton.style["float"]="right",L.DomUtil.addClass(this.closeButton,this.options.closeButtonIcon)):this._isLeftPosition?(this._menu.style.left="-"+this.options.width,this.closeButton.style["float"]="right",L.DomUtil.addClass(this.closeButton,"fa-chevron-left")):(this.closeButton.style["float"]="left",this._menu.style.right="-"+this.options.width,L.DomUtil.addClass(this.closeButton,"fa-chevron-right"));this._contents=L.DomUtil.create("div","leaflet-menu-contents",this._menu);this._contents.innerHTML=
this._innerHTML;L.DomEvent.addListener(this._contents.getElementsByTagName("A")[0],"click",function(){var a=this._map.RSWEIndoor.options.dialogs.loadDialog._isOpen;this._map.RSWEIndoor.options.dialogs.loadDialog.open();a&&this._map.RSWEIndoor.options.dialogs.loadDialog.close()},this);L.DomEvent.addListener(this._contents.getElementsByTagName("A")[1],"click",function(){var a=this._map.RSWEIndoor.options.dialogs.saveDialog._isOpen;this._map.RSWEIndoor.options.dialogs.saveDialog.open();a&&this._map.RSWEIndoor.options.dialogs.saveDialog.close()},
this);L.DomEvent.addListener(this._contents.getElementsByTagName("A")[2],"click",function(){var a=this._map.RSWEIndoor.options.dialogs.saveSVGDialog._isOpen;this._map.RSWEIndoor.options.dialogs.saveSVGDialog.open();a&&this._map.RSWEIndoor.options.dialogs.saveSVGDialog.close()},this);L.DomEvent.addListener(this._contents.getElementsByTagName("A")[3],"click",function(){var a=this._map.RSWEIndoor.options.dialogs.savePNGDialog._isOpen;this._map.RSWEIndoor.options.dialogs.savePNGDialog.open();a&&this._map.RSWEIndoor.options.dialogs.savePNGDialog.close()},
this);L.DomEvent.addListener(this._contents.getElementsByTagName("A")[4],"click",function(){var a=this._map.RSWEIndoor.options.dialogs.saveJPGDialog._isOpen;this._map.RSWEIndoor.options.dialogs.saveJPGDialog.open();a&&this._map.RSWEIndoor.options.dialogs.saveJPGDialog.close()},this);L.DomEvent.addListener(this._contents.getElementsByTagName("A")[5],"click",function(){var a=this._map.RSWEIndoor.options.dialogs.optionsDialog._isOpen;this._map.RSWEIndoor.options.dialogs.optionsDialog.open();a&&this._map.RSWEIndoor.options.dialogs.optionsDialog.close()},
this);L.DomEvent.disableClickPropagation(this._menu);L.DomEvent.on(this.showlink,"click",function(){this.showlink.style.display="none";this.closeButton.style.display="block";this._animate(this._menu,this._startPosition,0,!0)},this).on(this.closeButton,"click",function(){this.showlink.style.display="block";this.closeButton.style.display="none";this._animate(this._menu,0,this._startPosition,!1)},this);this.options.isOpen?this._animate(this._menu,this._startPosition,0,!0):this._animate(this._menu,0,
this._startPosition,!1);return this._container},setContents:function(a){this._innerHTML=a},_animate:function(a,b,c,e){this.options.isOpen=e;e||(this._startPosition=-parseInt(this.options.width,10),this.options.width.indexOf("%")+1&&(this._startPosition=this._startPosition*this._map.getSize().x*0.01),this._menu.style.width=this.options.width,b=0,c=this._startPosition);0<this.options.delay?(e?b>c:b<c)||(this._isLeftPosition?a.style.left=b+"px":a.style.right=b+"px",setTimeout(function(a){var d=e?b+10:
b-10;b.indexOf("%")+1&&(d+="%");a._animate(a._menu,d,c,e)},this.options.delay,this)):(this._isLeftPosition?a.style.left=c+"px":a.style.right=c+"px",this._map.getSize().x===-c&&(this._isLeftPosition?a.style.left="-100%":a.style.right="100%"))}});L.control.slideMenu=function(a,b){return new L.Control.SlideMenu(a,b)};L.Control.RSWEIndoor=L.Control.extend({options:{position:"topleft",contextmenu:!0,contextmenuWidth:140,contextmenuItems:[{text:"Center map here",callback:function(a){this._map.panTo(a.latlng)}}],
layers:[],roomProps:[],roomWallsProps:[],controlLayerGrp:{},drawnWallsLayerGrp:{},fitBondsAfterLoad:!0,showSizeArrows:!0,dontShowSmallSizeLabels:0.5,wallWidth:0.1,pixelsPerMeter:100,snapOptions:{displaySnapGrid:!0,gridStep:0.1,snapWallsToGrid:!0,snapWindowsToGrid:!1,snapDoorsToGrid:!1,snapWallsToObjects:!1,snapWindowsToObjects:!0,snapDoorsToObjects:!0,snapLayersArray:[]},dialogs:{optionsDialog:function(){return new L.Control.Dialog.Options},saveDialog:function(){return new L.Control.Dialog.Save},
loadDialog:function(){return new L.Control.Dialog.Load},saveSVGDialog:function(){return new L.Control.Dialog.SaveSVG},savePNGDialog:function(){return new L.Control.Dialog.SavePNG},saveJPGDialog:function(){return new L.Control.Dialog.SaveJPG}}},DeleteRoom:function(a){var b,c,e;for(c=0;c<this.options.layers.length;c++)if(a===this.options.layers[c].controlLayer){for(e=0;e<this.options.roomWallsProps[c].length;e++)delete this.options.roomWallsProps[c][e];for(e=0;e<this.options.layers[c].roomWalls.length;e++)b=
this.options.layers[c].roomWalls[e],this.options.drawnWallsLayerGrp.removeLayer(b._leaflet_id);this.options.controlLayerGrp.removeLayer(a._leaflet_id);this.options.layers[c].roomWalls.length=0;this.options.layers.splice(c,1);this.options.roomProps.splice(c,1);this.options.roomWallsProps.splice(c,1);break}b=0;for(c=this.options.snapOptions.snapLayersArray.length;b<c;b++)if(L.stamp(a)===L.stamp(this.options.snapOptions.snapLayersArray[b])){this.options.snapOptions.snapLayersArray.splice(b,1);break}},
RedrawRoom:function(a,b){var c="undefined";a instanceof L.Rectangle?c="rectangle":a instanceof L.Polygon?c="polygon":a instanceof L.Polyline?c="polyline":a instanceof L.Circle?c="circle":a instanceof L.Marker&&(c="marker");b&&(a.options.layerType=b);if("circle"===c)this.options.controlLayerGrp.addLayer(a);else if("marker"===c)a.bindPopup("A popup!"),this.options.controlLayerGrp.addLayer(a),a.snapediting=new L.Handler.MarkerSnap(map,a),a.snapediting.addGuideLayer(this.options.controlLayerGrp),a.snapediting.enable();
else{for(var e=0.5*this.options.wallWidth,f=this.options.dontShowSmallSizeLabels,d,g,h=0,q=0,n,m,z,y,h=0;h<this.options.layers.length;h++)if(a===this.options.layers[h].controlLayer){for(n=0;n<this.options.layers[h].roomWalls.length;n++)d=this.options.layers[h].roomWalls[n],this.options.drawnWallsLayerGrp.removeLayer(d._leaflet_id);this.options.layers[h].roomWalls.length=0;break}var r=a._latlngs,M=Math.sqrt(2),E=r.length,p=0,s=0,B,H,k,l,A,C,D,u,v,w,x,F,G,X,I,J,K,Q,T,U,R,V,W,O,P,N,Z=function(a,b){return function(){this.ChangeWallType(a,
b)}};if(1<E){for(n=0;n<E-1;n++)k=new L.LatLng(r[n%E].lat,r[n%E].lng),l=new L.LatLng(r[(n+1)%E].lat,r[(n+1)%E].lng),p=l.distanceTo(k),1E-12>Math.abs(p)&&(r.splice(),r.splice(n+1,1),n--,E--);m=[];for(n=0;n<E;n++)if(k=new L.LatLng(r[n%E].lat,r[n%E].lng),l=new L.LatLng(r[(n+1)%E].lat,r[(n+1)%E].lng),q=n,!(n>E-2&&"polyline"===c)){z=0===n&&"polyline"===c?new L.LatLng(k.lat+k.lat-l.lat,k.lng+k.lng-l.lng):new L.LatLng(r[(n-1+E)%E].lat,r[(n-1+E)%E].lng);A=n===E-2&&"polyline"===c?new L.LatLng(l.lat+l.lat-k.lat,
l.lng+l.lng-k.lng):new L.LatLng(r[(n+2)%E].lat,r[(n+2)%E].lng);d=Math.cos(k.lat*Math.PI/180);H=Math.cos(l.lat*Math.PI/180);p=l.distanceTo(k);u=new L.LatLng(k.lat+e/p*(l.lng-k.lng)*d,k.lng-e/p/d*(l.lat-k.lat));v=new L.LatLng(k.lat-e/p*(l.lng-k.lng)*d,k.lng+e/p/d*(l.lat-k.lat));w=new L.LatLng(l.lat+e/p*(l.lng-k.lng)*H,l.lng-e/p/H*(l.lat-k.lat));x=new L.LatLng(l.lat-e/p*(l.lng-k.lng)*H,l.lng+e/p/H*(l.lat-k.lat));p=A.distanceTo(l);F=new L.LatLng(l.lat+e/p*(A.lng-l.lng)*H,l.lng-e/p/H*(A.lat-l.lat));C=
new L.LatLng(l.lat-e/p*(A.lng-l.lng)*H,l.lng+e/p/H*(A.lat-l.lat));y=(l.lng-k.lng)*(A.lat-l.lat)-(A.lng-l.lng)*(l.lat-k.lat);B=(F.lng-w.lng)*(A.lat-l.lat)-(A.lng-l.lng)*(F.lat-w.lat);1E-12<Math.abs(y)?(F=new L.LatLng(B/y*(l.lat-k.lat)+w.lat,B/y*(l.lng-k.lng)+w.lng),p=l.distanceTo(F),s=l.distanceTo(w),p>s*M&&(F.lat=l.lat+s/p*(F.lat-l.lat)*M,F.lng=l.lng+s/p*(F.lng-l.lng)*M)):F=new L.LatLng(w.lat,w.lng);y=(l.lng-k.lng)*(A.lat-l.lat)-(A.lng-l.lng)*(l.lat-k.lat);B=(C.lng-x.lng)*(A.lat-l.lat)-(A.lng-l.lng)*
(C.lat-x.lat);1E-12<Math.abs(y)?(A=new L.LatLng(B/y*(l.lat-k.lat)+x.lat,B/y*(l.lng-k.lng)+x.lng),p=l.distanceTo(A),s=l.distanceTo(x),p>s*M&&(A.lat=l.lat+s/p*(A.lat-l.lat)*M,A.lng=l.lng+s/p*(A.lng-l.lng)*M)):A=new L.LatLng(x.lat,x.lng);p=k.distanceTo(z);C=new L.LatLng(k.lat+e/p*(k.lng-z.lng)*d,k.lng-e/p/d*(k.lat-z.lat));D=new L.LatLng(k.lat-e/p*(k.lng-z.lng)*d,k.lng+e/p/d*(k.lat-z.lat));y=(k.lng-z.lng)*(l.lat-k.lat)-(l.lng-k.lng)*(k.lat-z.lat);B=(u.lng-C.lng)*(l.lat-k.lat)-(l.lng-k.lng)*(u.lat-C.lat);
1E-12<Math.abs(y)?(C=new L.LatLng(B/y*(k.lat-z.lat)+C.lat,B/y*(k.lng-z.lng)+C.lng),p=k.distanceTo(C),s=k.distanceTo(u),p>s*M&&(C.lat=k.lat+s/p*(C.lat-k.lat)*M,C.lng=k.lng+s/p*(C.lng-k.lng)*M)):C=new L.LatLng(C.lat,C.lng);y=(k.lng-z.lng)*(l.lat-k.lat)-(l.lng-k.lng)*(k.lat-z.lat);B=(v.lng-D.lng)*(l.lat-k.lat)-(l.lng-k.lng)*(v.lat-D.lat);1E-12<Math.abs(y)?(B=new L.LatLng(B/y*(k.lat-z.lat)+D.lat,B/y*(k.lng-z.lng)+D.lng),p=k.distanceTo(B),s=k.distanceTo(v),p>s*M&&(B.lat=k.lat+s/p*(B.lat-k.lat)*M,B.lng=
k.lng+s/p*(B.lng-k.lng)*M)):B=new L.LatLng(D.lat,D.lng);this.options.layers[h]===t&&(this.options.layers[h]={});this.options.roomProps[h]===t&&this.options.roomProps.push({});y=this.options.roomProps[h];y.layerClass=c;y.layerClassOptions=a.options;y.layerLatlngs=a.getLatLngs();this.options.roomWallsProps[h]===t&&this.options.roomWallsProps.push([]);z=this.options.roomWallsProps[h];z[q]||(z[q]={wallType:"wall"},"wall"===b&&(z[q].wallType="wall"),"window"===b&&(z[q].wallType="window"),"door"===b&&(z[q].wallType=
"door1"));N=z[q].wallType;p=new L.LatLng(1*k.lat+0*l.lat,1*k.lng+0*l.lng);s=new L.LatLng(0*k.lat+1*l.lat,0*k.lng+1*l.lng);D=new L.LatLng(1*u.lat+0*w.lat,1*u.lng+0*w.lng);I=new L.LatLng(1*v.lat+0*x.lat,1*v.lng+0*x.lng);J=new L.LatLng(0*u.lat+1*w.lat,0*u.lng+1*w.lng);K=new L.LatLng(0*v.lat+1*x.lat,0*v.lng+1*x.lng);T=new L.LatLng(p.lat+0.5*(s.lng-p.lng)*d,p.lng-0.5/d*(s.lat-p.lat));U=new L.LatLng(p.lat-0.5*(s.lng-p.lng)*d,p.lng+0.5/d*(s.lat-p.lat));V=new L.LatLng(s.lat+0.5*(s.lng-p.lng)*H,s.lng-0.5/
H*(s.lat-p.lat));W=new L.LatLng(s.lat-0.5*(s.lng-p.lng)*H,s.lng+0.5/H*(s.lat-p.lat));Q=new L.LatLng(p.lat+0.5*(s.lng-p.lng)*Math.sqrt(3)*d+0.5*(s.lat-p.lat),p.lng-(s.lat-p.lat)*(0.5*Math.sqrt(3)/d)+0.5*(s.lng-p.lng));R=new L.LatLng(p.lat-0.5*(s.lng-p.lng)*Math.sqrt(3)*d+0.5*(s.lat-p.lat),p.lng+(s.lat-p.lat)*(0.5*Math.sqrt(3)/d)+0.5*(s.lng-p.lng));H=new L.LatLng(k.lat+0.5*(v.lng-u.lng)*Math.sqrt(3)*d+0.25*(v.lat-u.lat),k.lng-(v.lat-u.lat)*(0.5*Math.sqrt(3)/d)+0.25*(v.lng-u.lng));G=new L.LatLng(k.lat-
0.5*(u.lng-v.lng)*Math.sqrt(3)*d+0.25*(u.lat-v.lat),k.lng+(u.lat-v.lat)*(0.5*Math.sqrt(3)/d)+0.25*(u.lng-v.lng));X=new L.LatLng(l.lat-0.5*(x.lng-w.lng)*Math.sqrt(3)*d-0.25*(x.lat-w.lat),l.lng+(x.lat-w.lat)*(0.5*Math.sqrt(3)/d)-0.25*(x.lng-w.lng));d=new L.LatLng(l.lat+0.5*(w.lng-x.lng)*Math.sqrt(3)*d-0.25*(w.lat-x.lat),l.lng-(w.lat-x.lat)*(0.5*Math.sqrt(3)/d)-0.25*(w.lng-x.lng));O=new L.LatLng(0.5*(u.lat+w.lat),0.5*(u.lng+w.lng));P=new L.LatLng(0.5*(v.lat+x.lat),0.5*(v.lng+x.lng));new L.LatLng(0.5*
(k.lat+l.lat),0.5*(k.lng+l.lng));new L.LatLng(O.lat+v.lat-u.lat,O.lng+v.lng-u.lng);new L.LatLng(P.lat+u.lat-v.lat,P.lng+u.lng-v.lng);this.options.controlLayerGrp.addLayer(a);for(var S=0,Y=this.options.snapOptions.snapLayersArray.length;S<Y&&L.stamp(a)!==L.stamp(this.options.snapOptions.snapLayersArray[S]);S++);S===Y&&this.options.snapOptions.snapLayersArray.push(a);"wall"===N?(this._map.RSWEIndoor.options.showSizeArrows&&(p=l.distanceTo(k),p>f&&(g=new L.Polyline([k,l],{color:"#FFFFFF",weight:1,opacity:1,
fillOpacity:1}),g.options.layerType="size-arrows",this.options.drawnWallsLayerGrp.addLayer(g),m.push(g),g=new L.Polygon([H,G,k],{color:"#FFFFFF",weight:1,opacity:1,fillOpacity:1}),g.options.layerType="size-arrows",this.options.drawnWallsLayerGrp.addLayer(g),m.push(g),g=new L.Polygon([X,d,l],{color:"#FFFFFF",weight:1,opacity:1,fillOpacity:1}),g.options.layerType="size-arrows",this.options.drawnWallsLayerGrp.addLayer(g),m.push(g),g=O.lat>P.lat?new L.ScalableText(" "+(p+0.0010).toFixed(1)+" m ",P,O):
new L.ScalableText(" "+(p+0.0010).toFixed(1)+" m ",O,P),g.options.layerType="size-text",this.options.drawnWallsLayerGrp.addLayer(g),m.push(g))),d=new L.Polygon([u,w,x,v],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([l,F,w],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([l,A,x],{color:"#000000",
weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([k,C,u],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([k,B,v],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),g=new L.Polygon([u,w,x,v],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),
g.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(g),m.push(g)):"gap"===N?(d=new L.Polygon([v,I,D,u],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([x,K,J,w],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([D,I,K,J],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),d.options.layerType=
"wall",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([l,F,w],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([l,A,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([k,C,u],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),
m.push(d),d=new L.Polygon([k,B,v],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),g=new L.Polygon([u,w,x,v],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),g.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(g),m.push(g)):"window"===N?(d=new L.Polygon([u,D,I,v],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),
d=new L.Polygon([x,K,J,w],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([l,F,w],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([l,A,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([k,C,u],
{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([k,B,v],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([D,I,K,J],{fillColor:"#ffffff",color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Curve(["M",[D.lat,
D.lng],"L",[J.lat,J.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Curve(["M",[I.lat,I.lng],"L",[K.lat,K.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Curve(["M",[p.lat,p.lng],"L",[s.lat,s.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(d),
m.push(d),g=new L.Polygon([u,w,x,v],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),g.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(g),m.push(g)):"door1"===N?(d=new L.Polygon([u,D,I,v],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([x,K,J,w],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),
d=new L.Polygon([l,F,w],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([l,A,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([k,C,u],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([k,B,v],{color:"#000000",
weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([D,I,K,J],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Curve(["M",[p.lat,p.lng],"L",[Q.lat,Q.lng],"Q",[V.lat,V.lng],[s.lat,s.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),g=new L.Polygon([u,
w,x,v],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),g.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(g),m.push(g)):"door2"===N?(d=new L.Polygon([u,D,I,v],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([x,K,J,w],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([l,F,w],{color:"#000000",
weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([l,A,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([k,C,u],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([k,B,v],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),
d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([D,I,K,J],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Curve(["M",[p.lat,p.lng],"L",[R.lat,R.lng],"Q",[W.lat,W.lng],[s.lat,s.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),g=new L.Polygon([u,w,x,v],{color:"#000000",weight:1,
opacity:0,fillOpacity:0}),g.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(g),m.push(g)):"door3"===N?(d=new L.Polygon([u,D,I,v],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([x,K,J,w],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([l,F,w],{color:"#000000",weight:1,opacity:1,
fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([l,A,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([k,C,u],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([k,B,v],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType=
"door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([D,I,K,J],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Curve(["M",[s.lat,s.lng],"L",[Q.lat,Q.lng],"Q",[T.lat,T.lng],[p.lat,p.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),g=new L.Polygon([u,w,x,v],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),
this.options.drawnWallsLayerGrp.addLayer(g),g.options.layerType="control",m.push(g)):"door4"===N&&(d=new L.Polygon([u,D,I,v],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([x,K,J,w],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([l,F,w],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType=
"door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([l,A,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([k,C,u],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Polygon([k,B,v],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),
m.push(d),d=new L.Polygon([D,I,K,J],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),d=new L.Curve(["M",[s.lat,s.lng],"L",[R.lat,R.lng],"Q",[U.lat,U.lng],[p.lat,p.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),d.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(d),m.push(d),g=new L.Polygon([u,w,x,v],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),g.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(g),
m.push(g));this.options.controlLayerGrp.bringToBack();if(g)g.on("contextmenu",Z(h,q),this)}this.options.roomWallsProps[h]=z;this.options.roomProps[h]=y;this.options.layers[h]={controlLayer:a,roomWalls:m}}this.options.drawnWallsLayerGrp.eachLayer(function(a){"size-arrows"===a.options.layerType&&a.bringToFront()});this.options.drawnWallsLayerGrp.eachLayer(function(a){"size-text"===a.options.layerType&&a.bringToFront()});this.options.drawnWallsLayerGrp.eachLayer(function(a){"window"===a.options.layerType&&
a.bringToFront()});this.options.drawnWallsLayerGrp.eachLayer(function(a){"door"===a.options.layerType&&a.bringToFront()});this.options.drawnWallsLayerGrp.eachLayer(function(a){"control"===a.options.layerType&&a.bringToFront()})}},ChangeWallType:function(a,b){if(this.options.layers[a].controlLayer&&this.options.roomWallsProps[a]){var c=this.options.roomWallsProps[a];if("wall"===c[b].wallType)c[b].wallType="gap";else if("gap"===c[b].wallType)c[b].wallType="wall";else if("door1"===c[b].wallType)c[b].wallType=
"door2";else if("door2"===c[b].wallType)c[b].wallType="door4";else if("door4"===c[b].wallType)c[b].wallType="door3";else if("door3"===c[b].wallType)c[b].wallType="door1";else return;this.RedrawRoom(this.options.layers[a].controlLayer,"undefined")}},SetSnapOptions:function(){this._map.drawControl.setDrawingOptions({wall:{snapType:"wall",gridStep:this.options.snapOptions.gridStep,snapToGrid:this.options.snapOptions.snapWallsToGrid,snapToObjects:this.options.snapOptions.snapWallsToObjects,guideLayers:this.options.snapOptions.snapLayersArray,
snapDistance:6},window:{snapType:"window",gridStep:this.options.snapOptions.gridStep,snapToGrid:this.options.snapOptions.snapWindowsToGrid,snapToObjects:this.options.snapOptions.snapWindowsToObjects,guideLayers:this.options.snapOptions.snapLayersArray,snapDistance:6},door:{snapType:"door",gridStep:this.options.snapOptions.gridStep,snapToGrid:this.options.snapOptions.snapDoorsToGrid,snapToObjects:this.options.snapOptions.snapDoorsToObjects,guideLayers:this.options.snapOptions.snapLayersArray,snapDistance:6}})},
getPNGData:function(a){var b=new Image;b.w=this.getSVGSize().x;b.h=this.getSVGSize().y;if(0===b.w&&0===b.h)return a("");var c=L.Util.base64Encode(this.getSVGData());b.onload=function(){var c=r.createElement("canvas");c.width=b.w;c.height=b.h;var f=c.getContext("2d");f.beginPath();f.rect(0,0,b.w,b.h);f.fillStyle="white";f.fill();f.drawImage(b,0,0);c=c.toDataURL("image/png");return a(c.replace(/^data:image\/(png|jpg|jpeg);base64,/,""))};b.src="data:image/svg+xml;base64,"+c},getJPGData:function(a){var b=
new Image;b.w=this.getSVGSize().x;b.h=this.getSVGSize().y;if(0===b.w&&0===b.h)return a("");var c=L.Util.base64Encode(this.getSVGData());b.onload=function(){var c=r.createElement("canvas");c.width=b.w;c.height=b.h;var f=c.getContext("2d");f.beginPath();f.rect(0,0,b.w,b.h);f.fillStyle="white";f.fill();f.drawImage(b,0,0);c=c.toDataURL("image/jpeg",1);return a(c.replace(/^data:image\/(png|jpg|jpeg);base64,/,""))};b.src="data:image/svg+xml;base64,"+c},getSVGSize:function(){var a=!0,b;for(b in this.options.drawnWallsLayerGrp._layers)if(this.options.drawnWallsLayerGrp._layers.hasOwnProperty(b)){a=
!1;break}if(a)return{x:0,y:0};var a=this.options.drawnWallsLayerGrp.getBounds(),c=Math.cos(a.getCenter().lat*Math.PI/180);b=6378137*Math.PI;var e=1/this.options.pixelsPerMeter,c=180*e/(b*c);b=180*e/b;return{x:Math.round((a.getEast()-a.getWest())/c+1),y:Math.round((-a.getSouth()+a.getNorth())/b)+1}},getSVGData:function(){var a=!0,b;for(b in this.options.drawnWallsLayerGrp._layers)if(this.options.drawnWallsLayerGrp._layers.hasOwnProperty(b)){a=!1;break}if(a)return"";var c=this.options.drawnWallsLayerGrp.getBounds(),
a=Math.cos(c.getCenter().lat*Math.PI/180);b=6378137*Math.PI;var e=1/this.options.pixelsPerMeter,f=180*e/(b*a),d=180*e/b,g=this,h="",h=h+('<svg width="'+(function(a){return Math.round((a-c.getWest())/f)}(c.getEast())+1)+'" height="'+(function(a){return Math.round((-a+c.getNorth())/d)}(c.getSouth())+1)+'" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">\r\n');this.options.drawnWallsLayerGrp.eachLayer(function(a){"wall"===a.options.layerType&&(h+=g.layerToSVG(a))});this.options.drawnWallsLayerGrp.eachLayer(function(a){"size-arrows"===
a.options.layerType&&(h+=g.layerToSVG(a))});this.options.drawnWallsLayerGrp.eachLayer(function(a){"size-text"===a.options.layerType&&(h+=g.layerToSVG(a))});this.options.drawnWallsLayerGrp.eachLayer(function(a){"window"===a.options.layerType&&(h+=g.layerToSVG(a))});this.options.drawnWallsLayerGrp.eachLayer(function(a){"door"===a.options.layerType&&(h+=g.layerToSVG(a))});return h+="</svg>"},layerToSVG:function(a){var b=this.options.drawnWallsLayerGrp.getBounds(),c=Math.cos(b.getCenter().lat*Math.PI/
180),e=6378137*Math.PI,f=1/this.options.pixelsPerMeter,d=180*f/(e*c),g=180*f/e,c=function(a){return Math.round((a-b.getWest())/d)},e=function(a){return Math.round((-a+b.getNorth())/g)},h,q,n,m=f="";if(0!==a.options.opacity&&"control"!==a.options.layerType){var r="",t="";for(h in a._path.attributes)if(a._path.attributes.hasOwnProperty(h)){n=a._path.attributes[h].name;var G=a._path.attributes[h].value;"fill"===n&&a instanceof L.Polygon&&"door"===a.options.layerType&&(G="#ffffff");"stroke-opacity"===
n&&a instanceof L.Polygon&&(G="0");"class"!==n&&"d"!==n&&(t+=" "+n+'="'+G+'"')}if(a instanceof L.Polygon&&("wall"===a.options.layerType||"window"===a.options.layerType||"door"===a.options.layerType)){h=0;for(q=a._latlngs.length;h<q;h++)n=a._latlngs[h],f+=(h?" L":"M")+c(n.lng)+" "+e(n.lat),m+=(h?" L":"M")+(c(n.lng)+1)+" "+(e(n.lat)+1);r+="<g><path "+t+' d="'+(f+" Z")+'"/></g>\r\n';return r+="<g><path "+t+' d="'+(m+" Z")+'"/></g>\r\n'}if(a instanceof L.Polygon&&"size-arrows"===a.options.layerType){h=
0;for(q=a._latlngs.length;h<q;h++)n=a._latlngs[h],f+=(h?" L":"M")+c(n.lng)+".5 "+e(n.lat)+".5";f+=" Z";return r+="<g><path "+t+' d="'+f+'"/></g>\r\n'}if(!(a instanceof L.Polygon)&&a instanceof L.Polyline){h=0;for(q=a._latlngs.length;h<q;h++)n=a._latlngs[h],f+=(h?" L":"M")+c(n.lng)+".5 "+e(n.lat)+".5";return r="<g><path "+t+' d="'+f+'"/></g>\r\n'}if(a instanceof L.Curve){for(h=0;h<a._coords.length;h++)if(n=a._coords[h],"string"===typeof n||n instanceof String)q=n,f+=" "+q;else switch(q){case "H":f+=
""+e(n[0])+".5 ";break;case "V":f+=c(n[1])+".5 ";break;default:f+=c(n[1])+".5 "+e(n[0])+".5 "}return r="<g><path "+t+' d="'+f+'"/></g>\r\n'}a instanceof L.ScalableText&&(q=a._textNode.getAttribute("font-size").replace("px",""),f=a._textNode.getComputedTextLength(),m=Math.cos(a.bindPoint.lat*Math.PI/180),m=180*Math.atan2(-a.bindPoint.lat+a.heightPoint.lat,(a.bindPoint.lng-a.heightPoint.lng)*m)/Math.PI-90,c="translate("+c(a.bindPoint.lng)+".5 "+e(a.bindPoint.lat)+".5) rotate("+m+")",a.options.center&&
(c=c+" translate("+-0.5*f+")"),r='<g><g transform="'+c+'"><rect x="-2" y="-10" height="10" fill="black" width="'+12*f/q+'"/><text fill="white" text-anchor="start" y="-1" font-size="12px" font-family="Arial">'+a._text+"</text></g></g>\r\n");return r}},getData:function(){return JSON.stringify({roomProps:this.options.roomProps,roomWallsProps:this.options.roomWallsProps})},loadData:function(a){a||(a='{"roomProps":[],"roomWallsProps":[]}');var b;try{b=JSON.parse(a)}catch(c){return!1}this.options.roomProps=
[];this.options.roomWallsProps=[];this.options.layers=[];this.options.drawnWallsLayerGrp.clearLayers();this.options.controlLayerGrp.clearLayers();this.options.roomProps=b.roomProps;this.options.roomWallsProps=b.roomWallsProps;this.options.roomProps.forEach(function(a){var b;"polyline"===a.layerClass&&(b=new L.Polyline(a.layerLatlngs,a.layerClassOptions));"polygon"===a.layerClass&&(b=new L.Polygon(a.layerLatlngs,a.layerClassOptions));b&&(b.addTo(this._map),b.setStyle({opacity:0}),this.options.controlLayerGrp.addLayer(b),
this.RedrawRoom(b))},this);this.options.fitBondsAfterLoad&&this.fitBounds();this._map.fire("close_all_dialogs");return!0},fitBounds:function(){var a;this.options.controlLayerGrp.eachLayer(function(b){a=a?a.extend(b.getBounds()):b.getBounds()});a&&this._map.fitBounds(a)},RSWEinit:function(){var a=this._map;if(!a)throw Error("Leaflet has not properly initialized");var b;a.doubleClickZoom.disable();a.RSWEIndoor.options.controlLayerGrp=a.drawControl._toolbars.edit.options.featureGroup;a.RSWEIndoor.options.drawnWallsLayerGrp=
new L.FeatureGroup;a.addLayer(a.RSWEIndoor.options.drawnWallsLayerGrp);a.options.snapGrid.options.interval=a.RSWEIndoor.options.snapOptions.gridStep;a.RSWEIndoor.options.snapOptions.displaySnapGrid?a.options.snapGrid.show():a.options.snapGrid.hide();a.RSWEIndoor.SetSnapOptions();for(var c in this.options.dialogs)this.options.dialogs[c]=this.options.dialogs[c](),this._map.addControl(this.options.dialogs[c]);a.on("close_all_dialogs",function(){for(var b in this.RSWEIndoor.options.dialogs)this.RSWEIndoor.options.dialogs[b].close(),
this.addControl(this.RSWEIndoor.options.dialogs[b]);a.drawControl._toolbars.draw.disable();a.drawControl._toolbars.edit.disable()});a.on("draw:drawstart",function(c){b=c.layer;"marker"===c.layerType&&(b._mouseMarker.snapediting!==t&&(b._mouseMarker.snapediting.disable(),delete b._mouseMarker.snapediting),b._mouseMarker.snapediting=new L.Handler.MarkerSnap(a,b._mouseMarker),b._mouseMarker.snapediting._snapper._guides=a.RSWEIndoor.options.snapOptions.snapLayersArray,b._mouseMarker.snapediting.enable());
if("wall"===c.layerType||"window"===c.layerType||"door"===c.layerType)a.RSWEIndoor.SetSnapOptions(),b._poly.snapediting=new L.Handler.PolylineSnap(a,b._poly),b._poly.snapediting._snapper._guides=a.RSWEIndoor.options.snapOptions.snapLayersArray,b._poly.snapediting._snapper.options.gridStep=a.RSWEIndoor.options.snapOptions.gridStep,"wall"===c.layerType&&(b._poly.snapediting._snapper.options.snapToGrid=a.RSWEIndoor.options.snapOptions.snapWallsToGrid,b._poly.snapediting._snapper.options.snapToObjects=
a.RSWEIndoor.options.snapOptions.snapWallsToObjects),"window"===c.layerType&&(b._poly.snapediting._snapper.options.snapToGrid=a.RSWEIndoor.options.snapOptions.snapWindowsToGrid,b._poly.snapediting._snapper.options.snapToObjects=a.RSWEIndoor.options.snapOptions.snapWindowsToObjects),"door"===c.layerType&&(b._poly.snapediting._snapper.options.snapToGrid=a.RSWEIndoor.options.snapOptions.snapDoorsToGrid,b._poly.snapediting._snapper.options.snapToObjects=a.RSWEIndoor.options.snapOptions.snapDoorsToObjects),
b._poly.snapediting.enable()});a.on("draw:editstart_after",function(){a.RSWEIndoor.options.controlLayerGrp.eachLayer(function(b){b.setStyle({opacity:0.6});b.editing._poly!==t&&b.snapediting===t&&(a.removeLayer(b.editing._markerGroup),b.snapediting=new L.Handler.PolylineSnap(a,b),b.snapediting._snapper._guides=a.RSWEIndoor.options.snapOptions.snapLayersArray,b.snapediting._snapper.options.gridStep=a.RSWEIndoor.options.snapOptions.gridStep,"wall"===b.options.layerType&&(b.snapediting._snapper.options.snapToGrid=
a.RSWEIndoor.options.snapOptions.snapWallsToGrid,b.snapediting._snapper.options.snapToObjects=a.RSWEIndoor.options.snapOptions.snapWallsToObjects),"window"===b.options.layerType&&(b.snapediting._snapper.options.snapToGrid=a.RSWEIndoor.options.snapOptions.snapWindowsToGrid,b.snapediting._snapper.options.snapToObjects=a.RSWEIndoor.options.snapOptions.snapWindowsToObjects),"door"===b.options.layerType&&(b.snapediting._snapper.options.snapToGrid=a.RSWEIndoor.options.snapOptions.snapDoorsToGrid,b.snapediting._snapper.options.snapToObjects=
a.RSWEIndoor.options.snapOptions.snapDoorsToObjects),b.snapediting.enable())},a)});a.on("draw:editstop",function(){a.RSWEIndoor.options.controlLayerGrp.eachLayer(function(a){a.setStyle({opacity:0});a.editing._poly!==t&&a.snapediting!==t&&(a.snapediting.disable(),delete a.snapediting)},a)});a.on("revert-edited",function(b){a.RSWEIndoor.RedrawRoom(b.layer)});a.on("edit",function(b){a.RSWEIndoor.RedrawRoom(b.layer)});a.on("draw:deleted",function(a){a=a.layers._layers;for(var b in a)this.RSWEIndoor.DeleteRoom(a[b])});
a.on("draw:created",function(b){b.layer.setStyle({opacity:0});a.RSWEIndoor.RedrawRoom(b.layer,b.layerType)});a.on("redraw:all",function(){a.RSWEIndoor.options.controlLayerGrp.eachLayer(function(b){a.RSWEIndoor.RedrawRoom(b)})})}});L.Map.addInitHook(function(){if(this.options.RSWEIndoor){var a=new L.FeatureGroup;this.addLayer(a);this.drawControl=new L.Control.Draw({edit:{featureGroup:a}});this.addControl(this.drawControl);this.RSWEIndoor=new L.Control.RSWEIndoor;this.RSWEIndoor._map=this;this.slideMenu=
L.control.slideMenu("",{});this.addControl(this.slideMenu);this.graphicScaleControl=L.control.graphicScale().addTo(this);this.options.simpleGraticule=(new L.simpleGraticule).addTo(this);this.options.snapGrid=(new L.snapGrid).addTo(this);this.RSWEIndoor.RSWEinit()}});L.Control.Dialog=L.Control.extend({options:{size:[300,300],minSize:[100,100],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},initialize:function(a){L.setOptions(this,a);this._attributions={}},onAdd:function(a){this._initLayout();
this._map=a;this.update();this.options.initOpen||this.close();return this._container},open:function(){if(this._map)return this._container.style.visibility="",this._map.fire("dialog:opened",this),this},close:function(){this._container.style.visibility="hidden";this._map.fire("dialog:closed",this);return this},destroy:function(){if(!this._map)return this;this.removeFrom(this._map);if(this.onRemove)this.onRemove(this._map);this._map.fire("dialog:destroyed",this);return this},setLocation:function(a){a=
a||[250,250];this.options.anchor[0]=0;this.options.anchor[1]=0;this._oldMousePos.x=0;this._oldMousePos.y=0;this._move(a[0],a[1]);return this},setSize:function(a){a=a||[300,300];this.options.size[0]=0;this.options.size[1]=0;this._oldMousePos.x=0;this._oldMousePos.y=0;this._resize(a[0],a[1]);return this},lock:function(){this._resizerNode.style.visibility="hidden";this._grabberNode.style.visibility="hidden";this._closeNode.style.visibility="hidden";this._map.fire("dialog:locked",this);return this},unlock:function(){this._resizerNode.style.visibility=
"";this._grabberNode.style.visibility="";this._closeNode.style.visibility="";this._map.fire("dialog:unlocked",this);return this},freeze:function(){this._resizerNode.style.visibility="hidden";this._grabberNode.style.visibility="hidden";this._map.fire("dialog:frozen",this);return this},unfreeze:function(){this._resizerNode.style.visibility="";this._grabberNode.style.visibility="";this._map.fire("dialog:unfrozen",this);return this},setContent:function(a){this._content=a;this.update();return this},getContent:function(){return this._content},
getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._container.style.visibility="",this._map.fire("dialog:updated",this))},_initLayout:function(){var a=this._container=L.DomUtil.create("div","leaflet-control-dialog");a.style.width=this.options.size[0]+"px";a.style.height=this.options.size[1]+"px";a.style.left=this.options.anchor[0]+"px";a.style.top=this.options.anchor[1]+"px";var b=L.DomEvent.stopPropagation;
L.DomEvent.on(a,"click",b).on(a,"mousedown",b).on(a,"touchstart",b).on(a,"dblclick",b).on(a,"mousewheel",b).on(a,"contextmenu",b).on(a,"MozMousePixelScroll",b);var b=this._innerContainer=L.DomUtil.create("div","leaflet-control-dialog-inner"),c=this._grabberNode=L.DomUtil.create("div","leaflet-control-dialog-grabber");c.innerHTML="<b>&#8689;</b>";L.DomEvent.on(c,"mousedown",this._handleMoveStart,this);var e=this._closeNode=L.DomUtil.create("div","leaflet-control-dialog-close");e.innerHTML="<b>X</b>";
L.DomEvent.on(e,"click",this._handleClose,this);var f=this._resizerNode=L.DomUtil.create("div","leaflet-control-dialog-resizer");f.innerHTML="<b>&#8690;</b>";L.DomEvent.on(f,"mousedown",this._handleResizeStart,this);var d=this._contentNode=L.DomUtil.create("div","leaflet-control-dialog-contents");a.appendChild(b);b.appendChild(d);b.appendChild(c);b.appendChild(e);b.appendChild(f);this._oldMousePos={x:0,y:0}},_handleClose:function(){this.close()},_handleResizeStart:function(a){this._oldMousePos.x=
a.clientX;this._oldMousePos.y=a.clientY;L.DomEvent.on(this._map,"mousemove",this._handleMouseMove,this);L.DomEvent.on(this._map,"mouseup",this._handleMouseUp,this);this._map.fire("dialog:resizestart",this);this._resizing=!0},_handleMoveStart:function(a){this._oldMousePos.x=a.clientX;this._oldMousePos.y=a.clientY;L.DomEvent.on(this._map,"mousemove",this._handleMouseMove,this);L.DomEvent.on(this._map,"mouseup",this._handleMouseUp,this);this._map.fire("dialog:movestart",this);this._moving=!0},_handleMouseMove:function(a){var b=
a.originalEvent.clientX-this._oldMousePos.x,c=a.originalEvent.clientY-this._oldMousePos.y;a.originalEvent.stopPropagation&&a.originalEvent.stopPropagation();a.originalEvent.preventDefault&&a.originalEvent.preventDefault();this._resizing&&this._resize(b,c);this._moving&&this._move(b,c)},_handleMouseUp:function(){L.DomEvent.off(this._map,"mousemove",this._handleMouseMove,this);L.DomEvent.off(this._map,"mouseup",this._handleMouseUp,this);this._resizing&&(this._resizing=!1,this._map.fire("dialog:resizeend",
this));this._moving&&(this._moving=!1,this._map.fire("dialog:moveend",this))},_move:function(a,b){var c=this.options.anchor[1]+b;this.options.anchor[0]+=a;this.options.anchor[1]=c;this._container.style.left=this.options.anchor[0]+"px";this._container.style.top=this.options.anchor[1]+"px";this._map.fire("dialog:moving",this);this._oldMousePos.y+=b;this._oldMousePos.x+=a},_resize:function(a,b){var c=this.options.size[0]+a,e=this.options.size[1]+b;c<=this.options.maxSize[0]&&c>=this.options.minSize[0]&&
(this.options.size[0]=c,this._container.style.width=this.options.size[0]+"px",this._oldMousePos.x+=a);e<=this.options.maxSize[1]&&e>=this.options.minSize[1]&&(this.options.size[1]=e,this._container.style.height=this.options.size[1]+"px",this._oldMousePos.y+=b);this._map.fire("dialog:resizing",this)},_updateContent:function(){if(this._content){var a=this._contentNode,b="function"===typeof this._content?this._content(this):this._content;if("string"===typeof b)a.innerHTML=b;else{for(;a.hasChildNodes();)a.removeChild(a.firstChild);
a.appendChild(b)}}},_updateLayout:function(){this._container.style.width=this.options.size[0]+"px";this._container.style.height=this.options.size[1]+"px";this._container.style.left=this.options.anchor[0]+"px";this._container.style.top=this.options.anchor[1]+"px"}});L.control.dialog=function(a){return new L.Control.Dialog(a)};L.Control.Dialog.Options=L.Control.Dialog.extend({options:{size:[320,190],minSize:[320,190],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,
this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},
_selectTab:function(a){for(var b=this._getTabCount(),c=0;c<b;c++){var e=this._getTab(c),f=this._getTabTitle(c);a!==c?(e.setAttribute("class","dialog-tab"),f.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),f.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.6*a.x),Math.floor(0.6*a.y)];this.options.size=[Math.max(this.options.size[0],
this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])];this.options.anchor=[Math.floor(0.5*(a.x-this.options.size[0])),Math.floor(0.5*(a.y-this.options.size[1]))];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),c=0;c<b;c++)L.DomEvent.addListener(this._getTabTitle(c),"click",a(c),this);this._dlgCreateControls();this.options.initOpen?this.open():this.close();
return this._container},close:function(){this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">View Options</li>;<li class="dialog-tab-title">Edit Options</li>;<li class="dialog-tab-title">Snap Options</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>View Options</h3></div></div>;<div class="dialog-tab"><div class="dialog-tab-content"><h3>Edit Options</h3></div></div>;<div class="dialog-tab"><div class="dialog-tab-content"><h3>Snap Options</h3></div></div>;</div>;</div>;'.split(";"),
_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))this._map.options.simpleGraticule!==t&&(b=L.DomUtil.create("div","display-grid-control"),a.appendChild(b),b.innerHTML=!1===this._map.options.simpleGraticule.options.hidden?'<label><input type="checkbox" checked name="simpleGraticule" value="1" />Display Measure Grid</label>':'<label><input type="checkbox" name="simpleGraticule" value="1" />Display Measure Grid</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",
function(a){a.target.checked?this._map.options.simpleGraticule.show():this._map.options.simpleGraticule.hide()},this)),this._map.options.graphicScaleControl!==t&&(b=L.DomUtil.create("div","display-graphicscale-control"),a.appendChild(b),b.innerHTML="none"===this._map.options.graphicScaleControl.style.display?'<label><input type="checkbox" name="graphicScaleControl" value="1" />Display Ruler</label>':'<label><input type="checkbox" checked name="graphicScaleControl" value="1" />Display Ruler</label>',
L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.options.graphicScaleControl.style.display=a.target.checked?"block":"none"},this)),this._map.RSWEIndoor.options.fitBondsAfterLoad!==t&&(b=L.DomUtil.create("div","display-fitbonds-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.fitBondsAfterLoad?'<label><input type="checkbox" checked name="fitBondsAfterLoad" value="1" />Fit Bonds After Load</label>':'<label><input type="checkbox" name="fitBondsAfterLoad" value="1" />Fit Bonds After Load</label>',
L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.fitBondsAfterLoad=a.target.checked?!0:!1},this)),this._map.RSWEIndoor.options.showSizeArrows!==t&&(b=L.DomUtil.create("div","display-showSizeArrows-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.showSizeArrows?'<label><input type="checkbox" checked name="showSizeArrows" value="1" />Show Size Arrows</label>':'<label><input type="checkbox" name="showSizeArrows" value="1" />Show Size Arrows</label>',
L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.showSizeArrows=a.target.checked?!0:!1;this._map.fire("redraw:all")},this)),this._map.RSWEIndoor.options.dontShowSmallSizeLabels!==t&&(b=L.DomUtil.create("div","dontShowSmallSizeLabels-control"),a.appendChild(b),b.innerHTML='<label><input type="text" name="dontShowSmallSizeLabels" /> Dont Show Wall Size Labels Smaller Than(meters)</label>',b.firstChild.firstElementChild.setAttribute("value",this._map.RSWEIndoor.options.dontShowSmallSizeLabels),
L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){if(a.target.value){var b=a.target.value.replace(RegExp(",","g"),".");isNaN(b)?a.target.value=this._map.RSWEIndoor.options.dontShowSmallSizeLabels:(this._map.RSWEIndoor.options.dontShowSmallSizeLabels=b,a.target.value=b,this._map.fire("redraw:all"))}},this));(a=this._getTabContainer(1))&&this._map.RSWEIndoor.options.wallWidth!==t&&(b=L.DomUtil.create("div","wallwidth-control"),a.appendChild(b),b.innerHTML='<label><input type="text" name="wallWidthControl" /> Wall Width (meters)</label>',
b.firstChild.firstElementChild.setAttribute("value",this._map.RSWEIndoor.options.wallWidth),L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){if(a.target.value){var b=a.target.value.replace(RegExp(",","g"),".");isNaN(b)?a.target.value=this._map.RSWEIndoor.options.wallWidth:(this._map.RSWEIndoor.options.wallWidth=b,a.target.value=b,this._map.fire("redraw:all"))}},this));if(a=this._getTabContainer(2))this._map.RSWEIndoor.options.snapOptions.displaySnapGrid!==t&&(b=L.DomUtil.create("div",
"display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.options.snapGrid.options.hidden?'<label><input type="checkbox" name="displaySnapGrid" value="1" /> Display Snap Grid</label>':'<label><input type="checkbox" checked name="displaySnapGrid" value="1" /> Display Snap Grid</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){a.target.checked?(this._map.options.snapGrid.show(),this._map.RSWEIndoor.options.snapOptions.displaySnapGrid=!0):(this._map.options.snapGrid.hide(),
this._map.RSWEIndoor.options.snapOptions.displaySnapGrid=!1)},this)),this._map.RSWEIndoor.options.snapOptions.gridStep!==t&&(b=L.DomUtil.create("div","snap-grid-step-options-control"),a.appendChild(b),b.innerHTML='<label><input type="text" name=snapgridstep" />Snap Grid Step (meters)</label>',b.firstChild.firstElementChild.setAttribute("value",this._map.RSWEIndoor.options.snapOptions.gridStep),L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){if(a.target.value){var b=this.value.replace(RegExp(",",
"g"),".");isNaN(b)?a.target.value=this._map.RSWEIndoor.options.snapOptions.gridStep:(b=+b,this._map.RSWEIndoor.options.snapOptions.gridStep=b,a.target.value=b,this._map.options.snapGrid.options.interval=b,this._map.RSWEIndoor.SetSnapOptions(),this._map.options.snapGrid.redraw(),this._map.RSWEIndoor.options.controlLayer.eachLayer(function(a){a.snapediting!==t&&a.snapediting._snapper!==t&&(a.snapediting._snapper.options.gridStep=b)}))}},this)),this._map.RSWEIndoor.options.snapOptions.snapWallsToGrid!==
t&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapWallsToGrid?'<label><input type="checkbox" checked name="snapWallsToGrid" value="1" /> Snap Walls To Grid</label>':'<label><input type="checkbox" name="snapWallsToGrid" value="1" /> Snap Walls To Grid</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapWallsToGrid=a.target.checked?
!0:!1;this._map.RSWEIndoor.SetSnapOptions()},this)),this._map.RSWEIndoor.options.snapOptions.snapWallsToObjects!==t&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapWallsToObjects?'<label><input type="checkbox" checked name="snapWallsToObjects" value="1" /> Snap Walls To Objects</label>':'<label><input type="checkbox" name="snapWallsToObjects" value="1" /> Snap Walls To Objects</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,
"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapWallsToObjects=a.target.checked?!0:!1;this._map.RSWEIndoor.SetSnapOptions()},this)),this._map.RSWEIndoor.options.snapOptions.snapWindowsToGrid!==t&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapWindowsToGrid?'<label><input type="checkbox" checked name="snapWindowsToGrid" value="1" /> Snap Windows To Grid</label>':'<label><input type="checkbox" name="snapWindowsToGrid" value="1" /> Snap Windows To Grid</label>',
L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapWindowsToGrid=a.target.checked?!0:!1;this._map.RSWEIndoor.SetSnapOptions()},this)),this._map.RSWEIndoor.options.snapOptions.snapWindowsToObjects!==t&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapWindowsToObjects?'<label><input type="checkbox" checked name="snapWindowsToObjects" value="1" /> Snap Windows To Objects</label>':
'<label><input type="checkbox" name="snapWindowsToObjects" value="1" /> Snap Windows To Objects</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapWindowsToObjects=a.target.checked?!0:!1;this._map.RSWEIndoor.SetSnapOptions()},this)),this._map.RSWEIndoor.options.snapOptions.snapDoorsToGrid!==t&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapDoorsToGrid?
'<label><input type="checkbox" checked name="snapDoorsToGrid" value="1" /> Snap Doors To Grid</label>':'<label><input type="checkbox" name="snapDoorsToGrid" value="1" /> Snap Doors To Grid</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapDoorsToGrid=a.target.checked?!0:!1;this._map.RSWEIndoor.SetSnapOptions()},this)),this._map.RSWEIndoor.options.snapOptions.snapDoorsToObjects!==t&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),
a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapDoorsToObjects?'<label><input type="checkbox" checked name="snapDoorsToObjects" value="1" /> Snap Doors To Objects</label>':'<label><input type="checkbox" name="snapDoorsToObjects" value="1" /> Snap Doors To Objects</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapDoorsToObjects=a.target.checked?!0:!1;this._map.RSWEIndoor.SetSnapOptions()},
this))}});L.control.dialog.options=function(a){return new L.Control.Dialog.Options(a)};L.Control.Dialog.Load=L.Control.Dialog.extend({options:{size:[300,150],minSize:[300,150],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},msgDiv:{},_isOpen:!1,initialize:function(){L.setOptions(this,this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},
_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},_selectTab:function(a){for(var b=this._getTabCount(),c=0;c<b;c++){var e=this._getTab(c),f=this._getTabTitle(c);a!==c?(e.setAttribute("class","dialog-tab"),f.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),f.setAttribute("class",
"dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.size=[Math.max(this.options.size[0],this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])];this.options.anchor=[Math.floor(0.5*(a.x-this.options.size[0])),Math.floor(0.5*(a.y-this.options.size[1]))];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");
this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),c=0;c<b;c++)L.DomEvent.addListener(this._getTabTitle(c),"click",a(c),this);this._dlgCreateControls();this.options.initOpen?this.open():this.close();return this._container},close:function(){this.msgDiv.innerHTML="";this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">Load Drawing From File</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content" ><h3>Load Drawing From File</h3></div></div>;</div>;</div>;'.split(";"),
_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))b=L.DomUtil.create("div","save-file-name"),a.appendChild(b),G.File&&G.FileReader&&G.FileList&&G.Blob?(b.innerHTML='<div></div><input type="file" name="file" /><output id="list"></output>',this.msgDiv=b.getElementsByTagName("DIV")[0],this.InputName=b.getElementsByTagName("INPUT")[0],L.DomEvent.addListener(this.InputName,"change",function(a){this.handleFileSelect(a)},this)):b.innerHTML="<div>Sorry. The File APIs are not fully supported in this browser.</div>"},
handleFileSelect:function(a){var b=a.target.files;b.length?(a=new FileReader,a.thisDlg=this,a.onloadend=function(a){a.target.readyState===FileReader.DONE&&(a.target.thisDlg.InputName.value="",a.target.thisDlg._map.RSWEIndoor.loadData(a.target.result)?a.target.thisDlg.close():a.target.thisDlg.msgDiv.innerHTML="ERROR loading data!  Please check file contents.")},b=b[0].slice(0,b[0].size),a.readAsBinaryString(b)):this.msgDiv.innerHTML="Please select a file!"}});L.control.dialog.load=function(a){return new L.Control.Dialog.Load(a)};
L.Control.Dialog.Save=L.Control.Dialog.extend({options:{size:[320,200],minSize:[320,200],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},
_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},_selectTab:function(a){for(var b=this._getTabCount(),c=0;c<b;c++){var e=this._getTab(c),f=this._getTabTitle(c);a!==c?(e.setAttribute("class","dialog-tab"),f.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),f.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,
a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.size=[Math.max(this.options.size[0],this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])];this.options.anchor=[Math.floor(0.5*(a.x-this.options.size[0])),Math.floor(0.5*(a.y-this.options.size[1]))];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),
c=0;c<b;c++)L.DomEvent.addListener(this._getTabTitle(c),"click",a(c),this);this._dlgCreateControls();this.options.initOpen?this.open():this.close();return this._container},close:function(){this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">Save Drawing As</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Save Drawing As</h3></div></div>;</div>;</div>;'.split(";"),
saveAsText:function(){var a=this.options.saveALink,b="RSWE.json";this.options.InputName.value&&(b=this.options.InputName.value);a.download=b;b=this._map.RSWEIndoor.getData();a.href="data:text/plain;base64,"+L.Util.base64Encode(b);a.click();this.close()},_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))b=L.DomUtil.create("div","save-file-name"),a.appendChild(b),b.innerHTML='<a href="" download="" style="display:none;"></a><label><input type="text" name="saveFileName" placeholder="Enter file name"/></label>&nbsp;<input type="button" value="Save drawing to file"/><br><br><i>Your drawing will be saved into system "Download" folder.</i>',
this.options.saveALink=b.firstChild,this.options.InputName=b.getElementsByTagName("INPUT")[0],this.options.InputButton=b.getElementsByTagName("INPUT")[1],L.DomEvent.addListener(this.options.InputButton,"click",function(){this.saveAsText()},this)}});L.control.dialog.save=function(a){return new L.Control.Dialog.Save(a)};L.Control.Dialog.SaveSVG=L.Control.Dialog.extend({options:{size:[320,200],minSize:[320,200],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,
this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},
_selectTab:function(a){for(var b=this._getTabCount(),c=0;c<b;c++){var e=this._getTab(c),f=this._getTabTitle(c);a!==c?(e.setAttribute("class","dialog-tab"),f.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),f.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.size=[Math.max(this.options.size[0],
this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])];this.options.anchor=[Math.floor(0.5*(a.x-this.options.size[0])),Math.floor(0.5*(a.y-this.options.size[1]))];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),c=0;c<b;c++)L.DomEvent.addListener(this._getTabTitle(c),"click",a(c),this);this._dlgCreateControls();this.options.initOpen?this.open():this.close();
return this._container},close:function(){this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">Save Data As SVG</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Save Data As SVG</h3></div></div>;</div>;</div>;'.split(";"),
saveAsSVG:function(){var a=this.options.saveALink,b="RSWE.svg";this.options.InputName.value&&(b=this.options.InputName.value);a.download=b;b=this._map.RSWEIndoor.getSVGData();a.href="data:image/svg+xml;base64,"+L.Util.base64Encode(b);a.click();this.close()},_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))b=L.DomUtil.create("div","save-file-name"),a.appendChild(b),b.innerHTML='<a href="" download="" style="display:none;"></a><label><input type="text" name="saveFileName" placeholder="Enter file name"/></label>&nbsp;<input type="button" value="Save data to SVG file"/><br><br><i>Your drawing will be saved into system "Download" folder.</i>',
this.options.saveALink=b.firstChild,this.options.InputName=b.getElementsByTagName("INPUT")[0],this.options.InputButton=b.getElementsByTagName("INPUT")[1],L.DomEvent.addListener(this.options.InputButton,"click",function(){this.saveAsSVG()},this)}});L.control.dialog.save=function(a){return new L.Control.Dialog.Save(a)};L.Control.Dialog.SavePNG=L.Control.Dialog.extend({options:{size:[320,200],minSize:[320,200],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,
this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},
_selectTab:function(a){for(var b=this._getTabCount(),c=0;c<b;c++){var e=this._getTab(c),f=this._getTabTitle(c);a!==c?(e.setAttribute("class","dialog-tab"),f.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),f.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.size=[Math.max(this.options.size[0],
this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])];this.options.anchor=[Math.floor(0.5*(a.x-this.options.size[0])),Math.floor(0.5*(a.y-this.options.size[1]))];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),c=0;c<b;c++)L.DomEvent.addListener(this._getTabTitle(c),"click",a(c),this);this._dlgCreateControls();this.options.initOpen?this.open():this.close();
return this._container},close:function(){this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">Save Data As PNG</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Save SVG Data As</h3></div></div>;</div>;</div>;'.split(";"),
saveAsPNG:function(){var a=this.options.saveALink,b="RSWE.png";this.options.InputName.value&&(b=this.options.InputName.value);a.download=b;var c=this;this._map.RSWEIndoor.getPNGData(function(b){a.href="data:image/png;base64,"+b;a.click();c.close()})},_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))b=L.DomUtil.create("div","save-file-name"),a.appendChild(b),b.innerHTML='<a href="" download="" style="display:none;"></a><label><input type="text" name="saveFileName" placeholder="Enter file name"/></label>&nbsp;<input type="button" value="Save data to PNG file"/><br><br><i>Your drawing will be saved into system "Download" folder.</i>',
this.options.saveALink=b.firstChild,this.options.InputName=b.getElementsByTagName("INPUT")[0],this.options.InputButton=b.getElementsByTagName("INPUT")[1],L.DomEvent.addListener(this.options.InputButton,"click",function(){this.saveAsPNG()},this)}});L.control.dialog.save=function(a){return new L.Control.Dialog.Save(a)};L.Control.Dialog.SaveJPG=L.Control.Dialog.extend({options:{size:[320,200],minSize:[320,200],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,
this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},
_selectTab:function(a){for(var b=this._getTabCount(),c=0;c<b;c++){var e=this._getTab(c),f=this._getTabTitle(c);a!==c?(e.setAttribute("class","dialog-tab"),f.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),f.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.size=[Math.max(this.options.size[0],
this.options.minSize[0]),Math.max(this.options.size[1],this.options.minSize[1])];this.options.anchor=[Math.floor(0.5*(a.x-this.options.size[0])),Math.floor(0.5*(a.y-this.options.size[1]))];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),c=0;c<b;c++)L.DomEvent.addListener(this._getTabTitle(c),"click",a(c),this);this._dlgCreateControls();this.options.initOpen?this.open():this.close();
return this._container},close:function(){this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">Save Data As JPG</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Save Data As JPG</h3></div></div>;</div>;</div>;'.split(";"),
saveAsJPG:function(){var a=this.options.saveALink,b="RSWE.jpg";this.options.InputName.value&&(b=this.options.InputName.value);a.download=b;var c=this;this._map.RSWEIndoor.getJPGData(function(b){a.href="data:image/jpeg;base64,"+b;a.click();c.close()})},_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))b=L.DomUtil.create("div","save-file-name"),a.appendChild(b),b.innerHTML='<a href="" download="" style="display:none;"></a><label><input type="text" name="saveFileName" placeholder="Enter file name"/></label>&nbsp;<input type="button" value="Save data to JPG file"/><br><br><i>Your drawing will be saved into system "Download" folder.</i>',
this.options.saveALink=b.firstChild,this.options.InputName=b.getElementsByTagName("INPUT")[0],this.options.InputButton=b.getElementsByTagName("INPUT")[1],L.DomEvent.addListener(this.options.InputButton,"click",function(){this.saveAsJPG()},this)}});L.control.dialog.save=function(a){return new L.Control.Dialog.Save(a)}})(window,document);
