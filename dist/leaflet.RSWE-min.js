(function(K,s,r){(function(){L.Control.FullScreen=L.Control.extend({options:{position:"topleft",title:"Full Screen",titleCancel:"Exit Full Screen",forceSeparateButton:!1,forcePseudoFullscreen:!1},onAdd:function(a){var b="leaflet-control-zoom-fullscreen",d="";a=a.zoomControl&&!this.options.forceSeparateButton?a.zoomControl._container:L.DomUtil.create("div","leaflet-bar");this.options.content?d=this.options.content:b+=" fullscreen-icon";this._createButton(this.options.title,b,d,a,this.toggleFullScreen,
this);this._map.on("enterFullscreen exitFullscreen",this._toggleTitle,this);return a},_createButton:function(b,d,e,m,p,h){this.link=L.DomUtil.create("a",d,m);this.link.href="#";this.link.title=b;this.link.innerHTML=e;L.DomEvent.addListener(this.link,"click",L.DomEvent.stopPropagation).addListener(this.link,"click",L.DomEvent.preventDefault).addListener(this.link,"click",p,h);L.DomEvent.addListener(m,a.fullScreenEventName,L.DomEvent.stopPropagation).addListener(m,a.fullScreenEventName,L.DomEvent.preventDefault).addListener(m,
a.fullScreenEventName,this._handleEscKey,h);L.DomEvent.addListener(s,a.fullScreenEventName,L.DomEvent.stopPropagation).addListener(s,a.fullScreenEventName,L.DomEvent.preventDefault).addListener(s,a.fullScreenEventName,this._handleEscKey,h);return this.link},toggleFullScreen:function(){var b=this._map;b._exitFired=!1;b._isFullscreen?(a.supportsFullScreen&&!this.options.forcePseudoFullscreen?a.cancelFullScreen(b._container):L.DomUtil.removeClass(b._container,"leaflet-pseudo-fullscreen"),b.invalidateSize(),
b.fire("exitFullscreen"),b._exitFired=!0,b._isFullscreen=!1):(a.supportsFullScreen&&!this.options.forcePseudoFullscreen?a.requestFullScreen(b._container):L.DomUtil.addClass(b._container,"leaflet-pseudo-fullscreen"),b.invalidateSize(),b.fire("enterFullscreen"),b._isFullscreen=!0)},_toggleTitle:function(){this.link.title=this._map._isFullscreen?this.options.title:this.options.titleCancel},_handleEscKey:function(){var b=this._map;a.isFullScreen(b)||b._exitFired||(b.fire("exitFullscreen"),b._exitFired=
!0,b._isFullscreen=!1)}});L.control.fullscreen=function(a){return new L.Control.FullScreen(a)};L.Map.addInitHook(function(){L.extend(this.options,{fullscreenControl:!0,fullscreenControlOptions:{position:"topleft"}});this.options.fullscreenControl&&(this.fullscreenControl=L.control.fullscreen(this.options.fullscreenControlOptions),this.addControl(this.fullscreenControl))});var a={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",
prefix:""},b=["webkit","moz","o","ms","khtml"];if("undefined"!==typeof s.exitFullscreen)a.supportsFullScreen=!0;else for(var d=0,e=b.length;d<e;d++)if(a.prefix=b[d],"undefined"!==typeof s[a.prefix+"CancelFullScreen"]){a.supportsFullScreen=!0;break}a.supportsFullScreen&&(a.fullScreenEventName=a.prefix+"fullscreenchange",a.isFullScreen=function(){switch(this.prefix){case "":return s.fullScreen;case "webkit":return s.webkitIsFullScreen;default:return s[this.prefix+"FullScreen"]}},a.requestFullScreen=
function(a){return""===this.prefix?a.requestFullscreen():a[this.prefix+"RequestFullScreen"]()},a.cancelFullScreen=function(){return""===this.prefix?s.exitFullscreen():s[this.prefix+"CancelFullScreen"]()});"undefined"!==typeof jQuery&&(jQuery.fn.requestFullScreen=function(){return this.each(function(){var b=jQuery(this);a.supportsFullScreen&&a.requestFullScreen(b)})});K.fullScreenApi=a})();L.Util=L.extend(L.Util||{},{base64Encode:function(a){var b,d,e,c,f=0,g="";do b=a.charCodeAt(f++),d=a.charCodeAt(f++),
e=a.charCodeAt(f++),c=b<<16|d<<8|e,b=c>>18&63,d=c>>12&63,e=c>>6&63,c&=63,g+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c);while(f<a.length);switch(a.length%3){case 1:g=g.slice(0,-2)+"==";break;case 2:g=g.slice(0,-1)+"="}return g}});L.Curve=
L.Path.extend({options:{},initialize:function(a,b){L.setOptions(this,b);this._setPath(a)},getPath:function(){return this._coords},setPath:function(a){this._setPath(a);return this.redraw()},getBounds:function(){return this._bounds},_setPath:function(a){this._coords=a;this._bounds=this._computeBounds()},_computeBounds:function(){for(var a=new L.LatLngBounds,b,d,e,c,f,g,m=0;m<this._coords.length;m++)e=this._coords[m],"string"===typeof e||e instanceof String?d=e:"H"===d?(a.extend([b.lat,e[0]]),b=new L.latLng(b.lat,
e[0])):"V"===d?(a.extend([e[0],b.lng]),b=new L.latLng(e[0],b.lng)):"C"===d?(f=new L.latLng(e[0],e[1]),e=this._coords[++m],c=new L.latLng(e[0],e[1]),e=this._coords[++m],e=new L.latLng(e[0],e[1]),a.extend(f),a.extend(c),a.extend(e),e.controlPoint1=f,e.controlPoint2=c,b=e):"S"===d?(c=new L.latLng(e[0],e[1]),e=this._coords[++m],e=new L.latLng(e[0],e[1]),f=b,b.controlPoint2&&(f=b.lat-b.controlPoint2.lat,g=b.lng-b.controlPoint2.lng,f=new L.latLng(b.lat+f,b.lng+g)),a.extend(f),a.extend(c),a.extend(e),e.controlPoint1=
f,e.controlPoint2=c,b=e):"Q"===d?(c=new L.latLng(e[0],e[1]),e=this._coords[++m],e=new L.latLng(e[0],e[1]),a.extend(c),a.extend(e),e.controlPoint=c,b=e):"T"===d?(e=new L.latLng(e[0],e[1]),c=b,b.controlPoint&&(f=b.lat-b.controlPoint.lat,g=b.lng-b.controlPoint.lng,c=new L.latLng(b.lat+f,b.lng+g)),a.extend(c),a.extend(e),e.controlPoint=c,b=e):(a.extend(e),b=new L.latLng(e[0],e[1]));return a},getCenter:function(){return this._bounds.getCenter()},_update:function(){this._map&&this._updatePath()},_project:function(){var a,
b,d,e;this._points=[];for(var c=0;c<this._coords.length;c++)if(a=this._coords[c],"string"===typeof a||a instanceof String)this._points.push(a),d=a;else{switch(a.length){case 2:e=this._map.latLngToLayerPoint(a);b=a;break;case 1:"H"===d?(e=this._map.latLngToLayerPoint([b[0],a[0]]),b=[b[0],a[0]]):(e=this._map.latLngToLayerPoint([a[0],b[1]]),b=[a[0],b[1]])}this._points.push(e)}},getPathString:function(){this._project();return this._curvePointsToPath(this._points)},_curvePointsToPath:function(a){var b,
d,e="";if(a)for(var c=0;c<a.length;c++)if(b=a[c],"string"===typeof b||b instanceof String)d=b,e+=d;else switch(d){case "H":e+=b.x+" ";break;case "V":e+=b.y+" ";break;default:e+=b.x+" "+b.y+" "}return e||"M0 0"}});L.curve=function(a,b){return new L.Curve(a,b)};L.drawVersion="0.2.4-dev";L.drawLocal={draw:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},undo:{title:"Delete last point drawn",text:"Delete last point"},buttons:{polyline:"Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",
circle:"Draw a circle",marker:"Draw a marker",wall:"Draw a wall",window:"Draw a window",door:"Draw a door"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle."},radius:"Radius"},marker:{tooltip:{start:"Click map to place marker."}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing line.",
cont:"Click to continue drawing line.",end:"Click last point to finish line."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},simpleshape:{tooltip:{end:"Release mouse to finish drawing."}},wall:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing wall.",cont:"Click to continue drawing wall.",end:"Click last point to finish wall."}},window:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing window.",
cont:"Click to continue drawing window.",end:"Click last point to finish window."}},door:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing door.",cont:"Click to continue drawing door.",end:"Click last point to finish door."}}}},edit:{toolbar:{actions:{save:{title:"Apply changes.",text:"Apply"},cancel:{title:"Cancel editing, discards all changes.",text:"Cancel"}},buttons:{edit:"Edit layers.",editDisabled:"No layers to edit.",remove:"Delete layers.",removeDisabled:"No layers to delete."}},
handlers:{edit:{tooltip:{text:"Drag handles, or marker to edit feature.",subtext:"Click cancel to undo changes."}},remove:{tooltip:{text:"Click on a feature to remove"}}}}};L.Draw={};L.Draw.Feature=L.Handler.extend({includes:L.Mixin.Events,initialize:function(a,b){this._map=a;this._container=a._container;this._overlayPane=a._panes.overlayPane;this._popupPane=a._panes.popupPane;b&&b.shapeOptions&&(b.shapeOptions=L.Util.extend({},this.options.shapeOptions,b.shapeOptions));L.setOptions(this,b)},enable:function(){this._enabled||
(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire("draw:drawstart",{layerType:this.type,layer:this}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire("draw:drawstop",{layerType:this.type,layer:this}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var a=this._map;a&&(L.DomUtil.disableTextSelection(),a.getContainer().focus(),this._tooltip=new L.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",
this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(a){L.setOptions(this,a)},_fireCreatedEvent:function(a){this._map.fire("draw:created",{layer:a,layerType:this.type})},_cancelDrawing:function(a){27===a.keyCode&&this.disable()}});L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,
repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4E3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2E3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(a,b){this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error;
b&&b.drawError&&(b.drawError=L.Util.extend({},this.options.drawError,b.drawError));this.type=L.Draw.Polyline.TYPE;L.Draw.Feature.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this);this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),
{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mousedown",this._onMouseDown,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this).on("mouseup",this._onMouseUp,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this);this._clearHideErrorTimeout();this._cleanUpShape();this._map.removeLayer(this._markerGroup);delete this._markerGroup;
delete this._markers;this._map.removeLayer(this._poly);delete this._poly;this._mouseMarker.off("mousedown",this._onMouseDown,this);this._map.removeLayer(this._mouseMarker);delete this._mouseMarker;this._clearGuides();this._map.off("mousemove",this._onMouseMove,this).off("zoomend",this._onZoomEnd,this);this._map.off("mouseup",this._onMouseUp,this)},deleteLastVertex:function(){if(!(1>=this._markers.length)){var a=this._markers.pop(),b=this._poly,d=this._poly.spliceLatLngs(b.getLatLngs().length-1,1)[0];
this._markerGroup.removeLayer(a);2>b.getLatLngs().length&&this._map.removeLayer(b);this._vertexChanged(d,!1)}},addVertex:function(a){0<this._markers.length&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(a)?this._showErrorTooltip():(this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(a)),this._poly.addLatLng(a),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._vertexChanged(a,!0))},_finishShape:function(){var a=this._poly.newLatLngIntersects(this._poly.getLatLngs()[0],
!0);!this.options.allowIntersection&&a||!this._shapeIsValid()?this._showErrorTooltip():(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_shapeIsValid:function(){return!0},_onZoomEnd:function(){this._updateGuide()},_onMouseMove:function(a){var b=a.layerPoint,d=a.latlng;this._currentLatLng=d;this._updateTooltip(d);this._updateGuide(b);this._mouseMarker.setLatLng(d);L.DomEvent.preventDefault(a.originalEvent)},_vertexChanged:function(a,b){this._updateStartHandler();this._updateFinishHandler();
this._updateRunningMeasure(a,b);this._clearGuides();this._updateTooltip()},_onMouseDown:function(a){var b=a.originalEvent;this._mouseDownOrigin=L.point(b.clientX,b.clientY);this._latlngOrigin=a.latlng},_onMouseUp:function(a){if(this._mouseDownOrigin){this._latlngOrigin&&(a.latlng=this._latlngOrigin);var b=L.point(a.originalEvent.clientX,a.originalEvent.clientY).distanceTo(this._mouseDownOrigin);Math.abs(b)<9*(K.devicePixelRatio||1)&&this.addVertex(a.latlng)}this._latlngOrigin=this._mouseDownOrigin=
null},_updateStartHandler:function(){},_updateFinishHandler:function(){var a=0;this._markers!==r&&(a=this._markers.length);if(1<a)this._markers[a-1].on("click",this._finishShape,this);2<a&&this._markers[a-2].off("click",this._finishShape,this)},_createMarker:function(a){a=new L.Marker(a,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});this._markerGroup.addLayer(a);this._map.fire("draw:createmarker",{marker:a,layer:this});return a},_updateGuide:function(a){var b=0;this._markers!==
r&&(b=this._markers.length);0<b&&(a=a||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[b-1].getLatLng()),a))},_updateTooltip:function(a){if(this._tooltip){var b=this._getTooltipText();a&&this._tooltip.updatePosition(a);this._errorShown||this._tooltip.updateContent(b)}},_drawGuide:function(a,b){var d=Math.floor(Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))),e=this.options.guidelineDistance,c=this.options.maxGuideLineLength,
e=d>c?d-c:e,f;this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));for(;e<d;e+=this.options.guidelineDistance)c=e/d,c={x:Math.floor(a.x*(1-c)+c*b.x),y:Math.floor(a.y*(1-c)+c*b.y)},f=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),f.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(f,c)},_updateGuideColor:function(a){if(this._guidesContainer)for(var b=
0,d=this._guidesContainer.childNodes.length;b<d;b++)this._guidesContainer.childNodes[b].style.backgroundColor=a},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var a=this.options.showLength,b=0;this._markers!==r&&(b=this._markers.length);0===b?a={text:L.drawLocal.draw.handlers.polyline.tooltip.start}:(a=a?this._getMeasurementString():"",a=1===this._markers.length?
{text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:a}:{text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:a});return a},_updateRunningMeasure:function(a,b){var d=0;this._markers!==r&&(d=this._markers.length);1>=d?this._measurementRunningTotal=0:(d=a.distanceTo(this._markers[d-(b?2:1)].getLatLng()),this._measurementRunningTotal+=d*(b?1:-1))},_getMeasurementString:function(){var a=this._currentLatLng,b=this._markers[this._markers.length-1].getLatLng(),a=this._measurementRunningTotal+
a.distanceTo(b);return L.GeometryUtil.readableDistance(a,this.options.metric)},_showErrorTooltip:function(){this._errorShown=!0;this._tooltip.showAsError().updateContent({text:this.options.drawError.message});this._updateGuideColor(this.options.drawError.color);this._poly.setStyle({color:this.options.drawError.color});this._clearHideErrorTimeout();this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=
!1;this._clearHideErrorTimeout();this._tooltip.removeError().updateContent(this._getTooltipText());this._updateGuideColor(this.options.shapeOptions.color);this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_cleanUpShape:function(){1<this._markers.length&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var a=
new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,a)}});L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!1,fillColor:null,fillOpacity:0.2,clickable:!0},toolbarIcon:{className:"leaflet-draw-draw-polygon",tooltip:L.drawLocal.draw.toolbar.buttons.polygon}},initialize:function(a,b){L.Draw.Polyline.prototype.initialize.call(this,
a,b);this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var a=this._markers.length;if(1===a)this._markers[0].on("click",this._finishShape,this);2<a&&(this._markers[a-1].on("dblclick",this._finishShape,this),3<a&&this._markers[a-2].off("dblclick",this._finishShape,this))},_getTooltipText:function(){var a,b;0===this._markers.length?a=L.drawLocal.draw.handlers.polygon.tooltip.start:3>this._markers.length?a=L.drawLocal.draw.handlers.polygon.tooltip.cont:(a=L.drawLocal.draw.handlers.polygon.tooltip.end,
b=this._getMeasurementString());return{text:a,subtext:b}},_getMeasurementString:function(){var a=this._area;return a?L.GeometryUtil.readableArea(a,this.options.metric):null},_shapeIsValid:function(){return 3<=this._markers.length},_vertexChanged:function(a,b){var d;!this.options.allowIntersection&&this.options.showArea&&(d=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(d));L.Draw.Polyline.prototype._vertexChanged.call(this,a,b)},_cleanUpShape:function(){var a=this._markers.length;
0<a&&(this._markers[0].off("click",this._finishShape,this),2<a&&this._markers[a-1].off("dblclick",this._finishShape,this))}});L.SimpleShape={};L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:!1},initialize:function(a,b){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end;L.Draw.Feature.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this);this._map&&((this._mapDraggable=this._map.dragging.enabled())&&this._map.dragging.disable(),
this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this);this._map&&(this._mapDraggable&&this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this),L.DomEvent.off(s,"mouseup",this._onMouseUp,this),this._shape&&
(this._map.removeLayer(this._shape),delete this._shape));this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(a){this._isDrawing=!0;this._startLatLng=a.latlng;L.DomEvent.on(s,"mouseup",this._onMouseUp,this).preventDefault(a.originalEvent)},_onMouseMove:function(a){a=a.latlng;this._tooltip.updatePosition(a);this._isDrawing&&(this._tooltip.updateContent(this._getTooltipText()),this._drawShape(a))},_onMouseUp:function(){this._shape&&this._fireCreatedEvent();
this.disable();this.options.repeatMode&&this.enable()}});L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!1,fillColor:null,fillOpacity:0.5,clickable:!0},metric:!0},initialize:function(a,b){this.type=L.Draw.Rectangle.TYPE;this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start;L.Draw.SimpleShape.prototype.initialize.call(this,a,b)},_drawShape:function(a){this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,
a)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,a),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var a=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,a)},_getTooltipText:function(){var a=L.Draw.SimpleShape.prototype._getTooltipText.call(this),b;this._shape&&(b=this._shape.getLatLngs(),b=L.GeometryUtil.geodesicArea(b),b=L.GeometryUtil.readableArea(b,this.options.metric));
return{text:a.text,subtext:b}}});L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!0,fillColor:null,fillOpacity:0.2,clickable:!0},showRadius:!0,metric:!0,toolbarIcon:{className:"leaflet-draw-draw-circle",tooltip:L.drawLocal.draw.toolbar.buttons.circle}},initialize:function(a,b){this.type=L.Draw.Circle.TYPE;this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start;L.Draw.SimpleShape.prototype.initialize.call(this,
a,b)},_drawShape:function(a){this._shape?this._shape.setRadius(this._startLatLng.distanceTo(a)):(this._shape=new L.Circle(this._startLatLng,this._startLatLng.distanceTo(a),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var a=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,a)},_onMouseMove:function(a){var b=a.latlng;a=this.options.showRadius;var d=this.options.metric;
this._tooltip.updatePosition(b);this._isDrawing&&(this._drawShape(b),b=this._shape.getRadius().toFixed(1),this._tooltip.updateContent({text:this._endLabelText,subtext:a?L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(b,d):""}))}});L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2E3,toolbarIcon:{className:"leaflet-draw-draw-marker",tooltip:L.drawLocal.draw.toolbar.buttons.marker}},initialize:function(a,
b){this.type=L.Draw.Marker.TYPE;L.Draw.Feature.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this);this._map&&(this._tooltip.updateContent({text:L.drawLocal.draw.handlers.marker.tooltip.start}),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),
this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this);this._map&&(this._marker&&(this._marker.off("click",this._onClick,this),this._map.off("click",this._onClick,this).removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(a){a=a.latlng;this._tooltip.updatePosition(a);
this._mouseMarker.setLatLng(a);this._marker?(a=this._mouseMarker.getLatLng(),this._marker.setLatLng(a)):(this._marker=new L.Marker(a,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset}),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_onClick:function(){this._fireCreatedEvent();this.disable();this.options.repeatMode&&this.enable()},_fireCreatedEvent:function(){var a=new L.Marker(this._marker.getLatLng(),{icon:this.options.icon});
L.Draw.Feature.prototype._fireCreatedEvent.call(this,a)}});L.Draw.Wall=L.Draw.Polyline.extend({statics:{TYPE:"wall"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4E3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2E3,toolbarIcon:{className:"leaflet-draw-draw-polyline",
tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(a,b){L.Draw.Polyline.prototype.initialize.call(this,a,b);this.type="wall"},_updateStartHandler:function(){var a=0;this._markers!==r&&(a=this._markers.length);if(3===a)this._markers[0].on("click",this._closeShape,this)},_closeShape:function(){this.Poly=L.Polygon;this._finishShape();this.Poly=L.Polyline}});L.Draw.Window=L.Draw.Polyline.extend({statics:{TYPE:"window"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",
timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4E3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2E3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(a,b){L.Draw.Polyline.prototype.initialize.call(this,a,b);this.type="window"},_updateFinishHandler:function(){var a=
this._markers.length;1<a&&(this._markers[a-1].on("click",this._finishShape,this),this._finishShape())}});L.Draw.Door=L.Draw.Polyline.extend({statics:{TYPE:"door"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4E3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:0.5,fill:!1,clickable:!0},metric:!0,showLength:!0,
zIndexOffset:2E3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(a,b){L.Draw.Polyline.prototype.initialize.call(this,a,b);this.type="door"},_updateFinishHandler:function(){var a=this._markers.length;1<a&&(this._markers[a-1].on("click",this._finishShape,this),this._finishShape())}});L.Edit=L.Edit||{};L.Edit.Marker=L.Handler.extend({initialize:function(a,b){this._marker=a;L.setOptions(this,b)},addHooks:function(){var a=this._marker;
a.dragging.enable();a.on("dragend",this._onDragEnd,a);this._toggleMarkerHighlight()},removeHooks:function(){var a=this._marker;a.dragging.disable();a.off("dragend",this._onDragEnd,a);this._toggleMarkerHighlight()},_onDragEnd:function(a){a.target.edited=!0},_toggleMarkerHighlight:function(){if(this._icon){var a=this._icon;a.style.display="none";L.DomUtil.hasClass(a,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(a,"leaflet-edit-marker-selected"),this._offsetMarker(a,-4)):(L.DomUtil.addClass(a,
"leaflet-edit-marker-selected"),this._offsetMarker(a,4));a.style.display=""}},_offsetMarker:function(a,b){var d=parseInt(a.style.marginTop,10)-b,e=parseInt(a.style.marginLeft,10)-b;a.style.marginTop=d+"px";a.style.marginLeft=e+"px"}});L.Marker.addInitHook(function(){L.Edit.Marker&&(this.editing=new L.Edit.Marker(this),this.options.editable&&this.editing.enable())});L.Edit=L.Edit||{};L.Edit.Poly=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"})},
initialize:function(a,b){this._poly=a;L.setOptions(this,b)},addHooks:function(){var a=this._poly;a.setStyle(a.options.editing);this._poly._map&&(this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){var a=this._poly;a.setStyle(a.options.original);a._map&&(a._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers();this._initMarkers()},_initMarkers:function(){this._markerGroup||
(this._markerGroup=new L.LayerGroup);this._markers=[];var a=this._poly._latlngs,b,d,e;b=0;for(d=a.length;b<d;b++)e=this._createMarker(a[b],b),e.on("click",this._onMarkerClick,this),this._markers.push(e);b=0;for(a=d-1;b<d;a=b++)if(0!==b||L.Polygon&&this._poly instanceof L.Polygon)a=this._markers[a],e=this._markers[b],this._createMiddleMarker(a,e),this._updatePrevNext(a,e)},_createMarker:function(a,b){var d=new L.Marker(a,{draggable:!0,icon:this.options.icon});d._origLatLng=a;d._index=b;d.on("drag",
this._onMarkerDrag,this);d.on("dragend",this._fireEdit,this);this._markerGroup.addLayer(d);return d},_removeMarker:function(a){var b=a._index;this._markerGroup.removeLayer(a);this._markers.splice(b,1);this._poly.spliceLatLngs(b,1);this._updateIndexes(b,-1);a.off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("click",this._onMarkerClick,this)},_fireEdit:function(){this._poly.edited=!0;this._poly.fire("edit");this._poly._map.fire("edit",{layer:this._poly})},_onMarkerDrag:function(a){a=
a.target;L.extend(a._origLatLng,a._latlng);a._middleLeft&&a._middleLeft.setLatLng(this._getMiddleLatLng(a._prev,a));a._middleRight&&a._middleRight.setLatLng(this._getMiddleLatLng(a,a._next));this._poly.redraw()},_onMarkerClick:function(a){a=a.target;this._poly._latlngs.length<(L.Polygon&&this._poly instanceof L.Polygon?4:3)||(this._removeMarker(a),this._updatePrevNext(a._prev,a._next),a._middleLeft&&this._markerGroup.removeLayer(a._middleLeft),a._middleRight&&this._markerGroup.removeLayer(a._middleRight),
a._prev&&a._next?this._createMiddleMarker(a._prev,a._next):a._prev?a._next||(a._prev._middleRight=null):a._next._middleLeft=null,this._fireEdit())},_updateIndexes:function(a,b){this._markerGroup.eachLayer(function(d){d._index>a&&(d._index+=b)})},_createMiddleMarker:function(a,b){var d=this._getMiddleLatLng(a,b),e=this._createMarker(d),c,f,g;e.setOpacity(0.6);a._middleRight=b._middleLeft=e;f=function(){var m=b._index;e._index=m;e.off("click",c,this).on("click",this._onMarkerClick,this);d.lat=e.getLatLng().lat;
d.lng=e.getLatLng().lng;this._poly.spliceLatLngs(m,0,d);this._markers.splice(m,0,e);e.setOpacity(1);this._updateIndexes(m,1);b._index++;this._updatePrevNext(a,e);this._updatePrevNext(e,b);this._poly.fire("editstart")};g=function(){e.off("dragstart",f,this);e.off("dragend",g,this);this._createMiddleMarker(a,e);this._createMiddleMarker(e,b)};c=function(){f.call(this);g.call(this);this._fireEdit()};e.on("click",c,this).on("dragstart",f,this).on("dragend",g,this);this._markerGroup.addLayer(e)},_updatePrevNext:function(a,
b){a&&(a._next=b);b&&(b._prev=a)},_getMiddleLatLng:function(a,b){var d=this._poly._map,e=d.project(a.getLatLng()),c=d.project(b.getLatLng());return d.unproject(e._add(c)._divideBy(2))}});L.Polyline.addInitHook(function(){this.editing||(L.Edit.Poly&&(this.editing=new L.Edit.Poly(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))});
L.Edit=L.Edit||{};L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"})},initialize:function(a,b){this._shape=a;L.Util.setOptions(this,b)},addHooks:function(){var a=this._shape;a.setStyle(a.options.editing);a._map&&(this._map=a._map,this._markerGroup||this._initMarkers(),
this._map.addLayer(this._markerGroup))},removeHooks:function(){var a=this._shape;a.setStyle(a.options.original);if(a._map){this._unbindMarker(this._moveMarker);for(var a=0,b=this._resizeMarkers.length;a<b;a++)this._unbindMarker(this._resizeMarkers[a]);this._resizeMarkers=null;this._map.removeLayer(this._markerGroup);delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers();this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup);
this._createMoveMarker();this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(a,b){var d=new L.Marker(a,{draggable:!0,icon:b,zIndexOffset:10});this._bindMarker(d);this._markerGroup.addLayer(d);return d},_bindMarker:function(a){a.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this)},_unbindMarker:function(a){a.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,
this).off("dragend",this._onMarkerDragEnd,this)},_onMarkerDragStart:function(a){a.target.setOpacity(0);this._shape.fire("editstart")},_fireEdit:function(){this._shape.edited=!0;this._shape.fire("edit");this._shape._map.fire("edit",{layer:this._shape})},_onMarkerDrag:function(a){a=a.target;var b=a.getLatLng();a===this._moveMarker?this._move(b):this._resize(b);this._shape.redraw()},_onMarkerDragEnd:function(a){a.target.setOpacity(1);this._fireEdit()},_move:function(){},_resize:function(){}});L.Edit=
L.Edit||{};L.Edit.Rectangle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var a=this._shape.getBounds().getCenter();this._moveMarker=this._createMarker(a,this.options.moveIcon)},_createResizeMarker:function(){var a=this._getCorners();this._resizeMarkers=[];for(var b=0,d=a.length;b<d;b++)this._resizeMarkers.push(this._createMarker(a[b],this.options.resizeIcon)),this._resizeMarkers[b]._cornerIndex=b},_onMarkerDragStart:function(a){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,
a);var b=this._getCorners();a=a.target._cornerIndex;this._oppositeCorner=b[(a+2)%4];this._toggleCornerMarkers(0,a)},_onMarkerDragEnd:function(a){var b=a.target,d;b===this._moveMarker&&(d=this._shape.getBounds(),d=d.getCenter(),b.setLatLng(d));this._toggleCornerMarkers(1);this._repositionCornerMarkers();L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,a)},_move:function(a){for(var b=this._shape.getLatLngs(),d=this._shape.getBounds().getCenter(),e,c=[],f=0,g=b.length;f<g;f++)e=[b[f].lat-d.lat,
b[f].lng-d.lng],c.push([a.lat+e[0],a.lng+e[1]]);this._shape.setLatLngs(c);this._repositionCornerMarkers()},_resize:function(a){this._shape.setBounds(L.latLngBounds(a,this._oppositeCorner));a=this._shape.getBounds();this._moveMarker.setLatLng(a.getCenter())},_getCorners:function(){var a=this._shape.getBounds(),b=a.getNorthWest(),d=a.getNorthEast(),e=a.getSouthEast(),a=a.getSouthWest();return[b,d,e,a]},_toggleCornerMarkers:function(a){for(var b=0,d=this._resizeMarkers.length;b<d;b++)this._resizeMarkers[b].setOpacity(a)},
_repositionCornerMarkers:function(){for(var a=this._getCorners(),b=0,d=this._resizeMarkers.length;b<d;b++)this._resizeMarkers[b].setLatLng(a[b])}});L.Rectangle.addInitHook(function(){L.Edit.Rectangle&&(this.editing=new L.Edit.Rectangle(this),this.options.editable&&this.editing.enable())});L.Edit=L.Edit||{};L.Edit.Circle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var a=this._shape.getLatLng();this._moveMarker=this._createMarker(a,this.options.moveIcon)},_createResizeMarker:function(){var a=
this._shape.getLatLng(),a=this._getResizeMarkerPoint(a);this._resizeMarkers=[];this._resizeMarkers.push(this._createMarker(a,this.options.resizeIcon))},_getResizeMarkerPoint:function(a){var b=this._shape._radius*Math.cos(Math.PI/4);a=this._map.project(a);return this._map.unproject([a.x+b,a.y-b])},_move:function(a){var b=this._getResizeMarkerPoint(a);this._resizeMarkers[0].setLatLng(b);this._shape.setLatLng(a)},_resize:function(a){a=this._moveMarker.getLatLng().distanceTo(a);this._shape.setRadius(a)}});
L.Circle.addInitHook(function(){L.Edit.Circle&&(this.editing=new L.Edit.Circle(this),this.options.editable&&this.editing.enable());this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()});this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()})});L.LatLngUtil={cloneLatLngs:function(a){for(var b=[],d=0,e=a.length;d<e;d++)b.push(this.cloneLatLng(a[d]));return b},cloneLatLng:function(a){return L.latLng(a.lat,a.lng)}};L.GeometryUtil=
L.extend(L.GeometryUtil||{},{geodesicArea:function(a){var b=a.length,d=0,e=L.LatLng.DEG_TO_RAD,c,f;if(2<b){for(var g=0;g<b;g++)c=a[g],f=a[(g+1)%b],d+=(f.lng-c.lng)*e*(2+Math.sin(c.lat*e)+Math.sin(f.lat*e));d=40680631590769*d/2}return Math.abs(d)},readableArea:function(a,b){var d;b?d=1E4<=a?(1E-4*a).toFixed(2)+" ha":a.toFixed(2)+" m&sup2;":(a/=0.836127,d=3097600<=a?(a/3097600).toFixed(2)+" mi&sup2;":4840<=a?(a/4840).toFixed(2)+" acres":Math.ceil(a)+" yd&sup2;");return d},distance:function(a,b,d){return a.latLngToLayerPoint(b).distanceTo(a.latLngToLayerPoint(d))},
distanceSegment:function(a,b,d,e){b=a.latLngToLayerPoint(b);d=a.latLngToLayerPoint(d);a=a.latLngToLayerPoint(e);return L.LineUtil.pointToSegmentDistance(b,d,a)},readableDistance:function(a,b){var d;"imperial"!==b?d=1E3<a?(a/1E3).toFixed(2)+" km":Math.round(100*a)/100+" m":(a*=1.09361,d=1760<a?(a/1760).toFixed(2)+" miles":Math.round(100*a)/100+" yd");return d},belongsSegment:function(a,b,d,e){e=e===r?0.2:e;var c=b.distanceTo(d);return(b.distanceTo(a)+a.distanceTo(d)-c)/c<e},length:function(a){a=L.GeometryUtil.accumulatedLengths(a);
return 0<a.length?a[a.length-1]:0},accumulatedLengths:function(a){"function"===typeof a.getLatLngs&&(a=a.getLatLngs());if(0===a.length)return[];for(var b=0,d=[0],e=0,c=a.length-1;e<c;e++)b+=a[e].distanceTo(a[e+1]),d.push(b);return d},closestOnSegment:function(a,b,d,e){var c=a.getMaxZoom();Infinity===c&&(c=a.getZoom());b=a.project(b,c);d=a.project(d,c);e=a.project(e,c);e=L.LineUtil.closestPointOnSegment(b,d,e);return a.unproject(e,c)},closest:function(a,b,d,e){"function"!==typeof b.getLatLngs&&(b=
L.polyline(b));var c=b.getLatLngs().slice(0),f=Infinity,g,m=null,p=Infinity;if(e){b=0;for(e=c.length;b<e;b++)g=c[b],p=L.GeometryUtil.distance(a,d,g),p<f&&(f=p,m=g);return m?{latlng:m,distance:p}:null}b instanceof L.Polygon&&c.push(c[0]);b=0;for(e=c.length;b<e-1;b++){g=c[b];var h=c[b+1],p=L.GeometryUtil.distanceSegment(a,d,g,h);p<=f&&(f=p,m=L.GeometryUtil.closestOnSegment(a,d,g,h))}return m?{latlng:m,distance:f}:null},closestLayer:function(a,b,d){for(var e=Infinity,c=null,f=null,g=Infinity,m=0,p=b.length;m<
p;m++){var h=b[m];if("function"===typeof h.getLatLng)f=h.getLatLng(),g=L.GeometryUtil.distance(a,d,f);else if(f=L.GeometryUtil.closest(a,h,d))g=f.distance;g<e&&(e=g,c={layer:h,latlng:f.latlng,distance:g})}return c},closestLayerSnap:function(a,b,d,e,c){e="number"===typeof e?e:Infinity;c="boolean"===typeof c?c:!0;b=L.GeometryUtil.closestLayer(a,b,d);if(!b||b.distance>e)return null;c&&"function"===typeof b.layer.getLatLngs&&(c=L.GeometryUtil.closest(a,b.layer,b.latlng,!0),c.distance<e&&(b.latlng=c.latlng,
b.distance=L.GeometryUtil.distance(a,c.latlng,d)));return b},interpolateOnPointSegment:function(a,b,d){return L.point(a.x*(1-d)+d*b.x,a.y*(1-d)+d*b.y)},interpolateOnLine:function(a,b,d){b=b instanceof L.Polyline?b.getLatLngs():b;var e=b.length;if(2>e)return null;if(0===d)return{latLng:b[0]instanceof L.LatLng?b[0]:L.latLng(b[0]),predecessor:-1};if(1===d)return{latLng:b[b.length-1]instanceof L.LatLng?b[b.length-1]:L.latLng(b[b.length-1]),predecessor:b.length-2};d=Math.max(Math.min(d,1),0);var c=a.getMaxZoom();
Infinity===c&&(c=a.getZoom());for(var f=[],g=0,m=0;m<e;m++)f[m]=a.project(b[m],c),0<m&&(g+=f[m-1].distanceTo(f[m]));d*=g;var g=f[0],m=f[1],p=0,h=g.distanceTo(m);for(b=1;b<e&&h<d;b++)g=m,p=h,m=f[b],h+=g.distanceTo(m);e=L.GeometryUtil.interpolateOnPointSegment(g,m,0!==h-p?(d-p)/(h-p):0);return{latLng:a.unproject(e,c),predecessor:b-2}},locateOnLine:function(a,b,d){var e=b.getLatLngs();if(d.equals(e[0]))return 0;if(d.equals(e[e.length-1]))return 1;a=L.GeometryUtil.closest(a,b,d,!1);for(var c=L.GeometryUtil.accumulatedLengths(e),
f=c[c.length-1],g=0,m=!1,p=0,h=e.length-1;p<h;p++){var v=e[p],z=e[p+1],g=c[p];if(L.GeometryUtil.belongsSegment(a,v,z)){g+=v.distanceTo(a);m=!0;break}}if(!m)throw"Could not interpolate "+d.toString()+" within "+b.toString();return g/f},reverse:function(a){return L.polyline(a.getLatLngs().slice(0).reverse())},extract:function(a,b,d,e){if(d>e)return L.GeometryUtil.extract(a,L.GeometryUtil.reverse(b),1-d,1-e);d=Math.max(Math.min(d,1),0);e=Math.max(Math.min(e,1),0);var c=b.getLatLngs(),f=L.GeometryUtil.interpolateOnLine(a,
b,d),g=L.GeometryUtil.interpolateOnLine(a,b,e);if(d===e)return[L.GeometryUtil.interpolateOnLine(a,b,e).latLng];-1===f.predecessor&&(f.predecessor=0);-1===g.predecessor&&(g.predecessor=0);a=c.slice(f.predecessor+1,g.predecessor+1);a.unshift(f.latLng);a.push(g.latLng);return a},isBefore:function(a,b){if(!b)return!1;var d=a.getLatLngs(),e=b.getLatLngs();return d[d.length-1].equals(e[0])},isAfter:function(a,b){if(!b)return!1;var d=a.getLatLngs(),e=b.getLatLngs();return d[0].equals(e[e.length-1])},startsAtExtremity:function(a,
b){if(!b)return!1;var d=a.getLatLngs(),e=b.getLatLngs(),d=d[0];return d.equals(e[0])||d.equals(e[e.length-1])},computeAngle:function(a,b){return 180*Math.atan2(b.y-a.y,b.x-a.x)/Math.PI},computeSlope:function(a,b){var d=(b.y-a.y)/(b.x-a.x);return{a:d,b:a.y-d*a.x}},rotatePoint:function(a,b,d,e){var c=a.getMaxZoom();Infinity===c&&(c=a.getZoom());d=d*Math.PI/180;b=a.project(b,c);var f=a.project(e,c);e=Math.cos(d)*(b.x-f.x)-Math.sin(d)*(b.y-f.y)+f.x;d=Math.sin(d)*(b.x-f.x)+Math.cos(d)*(b.y-f.y)+f.y;return a.unproject(new L.Point(e,
d),c)}});L.Util.extend(L.LineUtil,{segmentsIntersect:function(a,b,d,e){return this._checkCounterclockwise(a,d,e)!==this._checkCounterclockwise(b,d,e)&&this._checkCounterclockwise(a,b,d)!==this._checkCounterclockwise(a,b,e)},_checkCounterclockwise:function(a,b,d){return(d.y-a.y)*(b.x-a.x)>(b.y-a.y)*(d.x-a.x)}});L.Polyline.include({intersects:function(){var a=this._originalPoints,b=a?a.length:0,d,e;if(this._tooFewPointsForIntersection())return!1;for(b-=1;3<=b;b--)if(d=a[b-1],e=a[b],this._lineSegmentsIntersectsRange(d,
e,b-2))return!0;return!1},newLatLngIntersects:function(a,b){return this._map?this.newPointIntersects(this._map.latLngToLayerPoint(a),b):!1},newPointIntersects:function(a,b){var d=this._originalPoints,e=d?d.length:0,d=d?d[e-1]:null,e=e-2;return this._tooFewPointsForIntersection(1)?!1:this._lineSegmentsIntersectsRange(d,a,e,b?1:0)},_tooFewPointsForIntersection:function(a){var b=this._originalPoints,b=b?b.length:0;return!this._originalPoints||3>=b+(a||0)},_lineSegmentsIntersectsRange:function(a,b,d,
e){var c=this._originalPoints,f;e=e||0;for(var g=d;g>e;g--)if(d=c[g-1],f=c[g],L.LineUtil.segmentsIntersect(a,b,d,f))return!0;return!1}});L.Polygon.include({intersects:function(){var a=this._originalPoints,b;if(this._tooFewPointsForIntersection())return!1;if(L.Polyline.prototype.intersects.call(this))return!0;b=a.length;return this._lineSegmentsIntersectsRange(a[b-1],a[0],b-2,1)}});L.GeometryUtil=L.extend(L.GeometryUtil||{},{closestGridSnap:function(a,b,d,e){if(d===r||1E-11>d)return null;e="number"===
typeof e?e:Infinity;var c=Math.cos(b.lat*Math.PI/180),f=6378137*Math.PI,c=180*d/(f*c),g=180*d/f,f=Math.round((b.lat-Math.round(b.lat))/c)*c+Math.round(b.lat),c=Math.round(b.lng/g)*g,g={};g.latlng=new L.LatLng(f,c);g.distance=a.latLngToLayerPoint(b).distanceTo(a.latLngToLayerPoint(g.latlng));g.GridStep=d;return!g||g.distance>e?null:g}});L.Control.Draw=L.Control.extend({options:{position:"topleft",draw:{},edit:!1},initialize:function(a){if("0.7">L.version)throw Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");
L.Control.prototype.initialize.call(this,a);this._toolbars={};L.DrawToolbar&&this.options.draw&&(a=new L.DrawToolbar(this.options.draw),this._toolbars[L.DrawToolbar.TYPE]=a,this._toolbars[L.DrawToolbar.TYPE].on("enable",this._toolbarEnabled,this));L.EditToolbar&&this.options.edit&&(a=new L.EditToolbar(this.options.edit),this._toolbars[L.EditToolbar.TYPE]=a,this._toolbars[L.EditToolbar.TYPE].on("enable",this._toolbarEnabled,this))},onAdd:function(a){var b=L.DomUtil.create("div","leaflet-draw"),d=!1,
e,c;for(c in this._toolbars)this._toolbars.hasOwnProperty(c)&&(e=this._toolbars[c].addToolbar(a))&&(d||(L.DomUtil.hasClass(e,"leaflet-draw-toolbar-top")||L.DomUtil.addClass(e.childNodes[0],"leaflet-draw-toolbar-top"),d=!0),b.appendChild(e));return b},onRemove:function(){for(var a in this._toolbars)this._toolbars.hasOwnProperty(a)&&this._toolbars[a].removeToolbar()},setDrawingOptions:function(a){for(var b in this._toolbars)this._toolbars[b]instanceof L.DrawToolbar&&this._toolbars[b].setOptions(a)},
_toolbarEnabled:function(a){a=a.target;for(var b in this._toolbars)this._toolbars[b]!==a&&this._toolbars[b].disable()}});L.Map.mergeOptions({drawControlTooltips:!0,drawControl:!1});L.Map.addInitHook(function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))});L.Toolbar=L.Class.extend({includes:[L.Mixin.Events],initialize:function(a){L.setOptions(this,a);this._modes={};this._actionButtons=[];this._activeMode=null},enabled:function(){return null!==this._activeMode},
disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(a){var b=L.DomUtil.create("div","leaflet-draw-section"),d=0,e=this._toolbarClass||"",c=this.getModeHandlers(a);this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-bar");this._map=a;for(a=0;a<c.length;a++)c[a].enabled&&this._initModeHandler(c[a].handler,this._toolbarContainer,d++,e,c[a].title);if(d)return this._lastButtonIndex=--d,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),
b.appendChild(this._toolbarContainer),b.appendChild(this._actionsContainer),b},removeToolbar:function(){for(var a in this._modes)this._modes.hasOwnProperty(a)&&(this._disposeButton(this._modes[a].button,this._modes[a].handler.enable,this._modes[a].handler),this._modes[a].handler.disable(),this._modes[a].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};a=0;for(var b=this._actionButtons.length;a<b;a++)this._disposeButton(this._actionButtons[a].button,
this._actionButtons[a].callback,this);this._actionButtons=[];this._actionsContainer=null},_initModeHandler:function(a,b,d,e,c){var f=a.type;this._modes[f]={};this._modes[f].handler=a;this._modes[f].button=this._createButton({title:c,className:e+"-"+f,container:b,callback:this._modes[f].handler.enable,context:this._modes[f].handler});this._modes[f].buttonIndex=d;this._modes[f].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_createButton:function(a){var b=
L.DomUtil.create("a",a.className||"",a.container);b.href="#";a.text&&(b.innerHTML=a.text);a.title&&(b.title=a.title);L.DomEvent.on(b,"click",L.DomEvent.stopPropagation).on(b,"mousedown",L.DomEvent.stopPropagation).on(b,"dblclick",L.DomEvent.stopPropagation).on(b,"click",L.DomEvent.preventDefault).on(b,"click",a.callback,a.context);return b},_disposeButton:function(a,b){L.DomEvent.off(a,"click",L.DomEvent.stopPropagation).off(a,"mousedown",L.DomEvent.stopPropagation).off(a,"dblclick",L.DomEvent.stopPropagation).off(a,
"click",L.DomEvent.preventDefault).off(a,"click",b)},_handlerActivated:function(a){this.disable();this._activeMode=this._modes[a.handler];L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled");this._showActionsToolbar();this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar();L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled");this._activeMode=null;this.fire("disable")},_createActions:function(a){var b=this._actionsContainer;
a=this.getActions(a);var d=a.length,e,c;c=0;for(e=this._actionButtons.length;c<e;c++)this._disposeButton(this._actionButtons[c].button,this._actionButtons[c].callback);for(this._actionButtons=[];b.firstChild;)b.removeChild(b.firstChild);for(c=0;c<d;c++)"enabled"in a[c]&&!a[c].enabled||(e=L.DomUtil.create("li","",b),e=this._createButton({title:a[c].title,text:a[c].text,container:e,callback:a[c].callback,context:a[c].context}),this._actionButtons.push({button:e,callback:a[c].callback}))},_showActionsToolbar:function(){var a=
this._activeMode.buttonIndex,b=this._lastButtonIndex,d=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler);this._actionsContainer.style.top=d+"px";0===a&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top"));a===b&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom"));this._actionsContainer.style.display=
"block"},_hideActionsToolbar:function(){this._actionsContainer.style.display="none";L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop");L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom");L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top");L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom")}});L.Tooltip=L.Class.extend({initialize:function(a){this._map=a;this._popupPane=a._panes.popupPane;this._container=
a.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null;this._singleLineLabel=!1},dispose:function(){this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(a){if(!this._container)return this;a.subtext=a.subtext||"";0!==a.subtext.length||this._singleLineLabel?0<a.subtext.length&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,
"leaflet-draw-tooltip-single"),this._singleLineLabel=!0);this._container.innerHTML=(0<a.subtext.length?'<span class="leaflet-draw-tooltip-subtext">'+a.subtext+"</span><br />":"")+"<span>"+a.text+"</span>";return this},updatePosition:function(a){a=this._map.latLngToLayerPoint(a);var b=this._container;this._container&&(b.style.visibility="inherit",L.DomUtil.setPosition(b,a));return this},showAsError:function(){this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip");return this},
removeError:function(){this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip");return this}});L.DrawToolbar=L.Toolbar.extend({statics:{TYPE:"draw"},options:{wall:{},window:{},door:{}},initialize:function(a){for(var b in this.options)this.options.hasOwnProperty(b)&&a[b]&&(a[b]=L.extend({},this.options[b],a[b]));this._toolbarClass="leaflet-draw-draw";L.Toolbar.prototype.initialize.call(this,a)},getModeHandlers:function(a){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(a,
this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(a,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(a,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Draw.Circle(a,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(a,
this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker},{enabled:this.options.wall,handler:new L.Draw.Wall(a,this.options.wall),title:L.drawLocal.draw.toolbar.buttons.wall},{enabled:this.options.window,handler:new L.Draw.Window(a,this.options.window),title:L.drawLocal.draw.toolbar.buttons.window},{enabled:this.options.door,handler:new L.Draw.Door(a,this.options.door),title:L.drawLocal.draw.toolbar.buttons.door}]},getActions:function(){return[{title:L.drawLocal.draw.toolbar.actions.title,
text:L.drawLocal.draw.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(a){L.setOptions(this,a);for(var b in this._modes)this._modes.hasOwnProperty(b)&&a.hasOwnProperty(b)&&this._modes[b].handler.setOptions(a[b])}});L.EditToolbar=L.Toolbar.extend({statics:{TYPE:"edit"},options:{edit:{selectedPathOptions:{color:"#fe57a1",opacity:0.6,dashArray:"10, 10",fill:!1,fillColor:"#fe57a1",fillOpacity:0.1,maintainColor:!1}},remove:{},featureGroup:null},initialize:function(a){a.edit&&
("undefined"===typeof a.edit.selectedPathOptions&&(a.edit.selectedPathOptions=this.options.edit.selectedPathOptions),a.edit.selectedPathOptions=L.extend({},this.options.edit.selectedPathOptions,a.edit.selectedPathOptions));a.remove&&(a.remove=L.extend({},this.options.remove,a.remove));this._toolbarClass="leaflet-draw-edit";L.Toolbar.prototype.initialize.call(this,a);this._selectedFeatureCount=0},getModeHandlers:function(a){var b=this.options.featureGroup;return[{enabled:this.options.edit,handler:new L.EditToolbar.Edit(a,
{featureGroup:b,selectedPathOptions:this.options.edit.selectedPathOptions}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:this.options.remove,handler:new L.EditToolbar.Delete(a,{featureGroup:b}),title:L.drawLocal.edit.toolbar.buttons.remove}]},getActions:function(){return[{title:L.drawLocal.edit.toolbar.actions.save.title,text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,
callback:this.disable,context:this}]},addToolbar:function(a){a=L.Toolbar.prototype.addToolbar.call(this,a);this._checkDisabled();this.options.featureGroup.on("layeradd layerremove",this._checkDisabled,this);return a},removeToolbar:function(){this.options.featureGroup.off("layeradd layerremove",this._checkDisabled,this);L.Toolbar.prototype.removeToolbar.call(this)},disable:function(){this.enabled()&&(this._activeMode.handler.revertLayers(),L.Toolbar.prototype.disable.call(this))},_save:function(){this._activeMode.handler.save();
this._activeMode.handler.disable()},_checkDisabled:function(){var a=0!==this.options.featureGroup.getLayers().length,b;this.options.edit&&(b=this._modes[L.EditToolbar.Edit.TYPE].button,a?L.DomUtil.removeClass(b,"leaflet-disabled"):L.DomUtil.addClass(b,"leaflet-disabled"),b.setAttribute("title",a?L.drawLocal.edit.toolbar.buttons.edit:L.drawLocal.edit.toolbar.buttons.editDisabled));this.options.remove&&(b=this._modes[L.EditToolbar.Delete.TYPE].button,a?L.DomUtil.removeClass(b,"leaflet-disabled"):L.DomUtil.addClass(b,
"leaflet-disabled"),b.setAttribute("title",a?L.drawLocal.edit.toolbar.buttons.remove:L.drawLocal.edit.toolbar.buttons.removeDisabled))}});L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},includes:L.Mixin.Events,initialize:function(a,b){L.Handler.prototype.initialize.call(this,a);L.setOptions(this,b);this._featureGroup=b.featureGroup;if(!(this._featureGroup instanceof L.FeatureGroup))throw Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={};this.type=L.EditToolbar.Edit.TYPE},
enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:editstart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this),this._map.fire("draw:editstart_after",{handler:this.type}))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,
this),L.Handler.prototype.disable.call(this),this._map.fire("draw:editstop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var a=this._map;a&&(a.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._tooltip=new L.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&
(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._featureGroup.eachLayer(function(a){this._revertLayer(a)},this)},save:function(){var a=new L.LayerGroup;this._featureGroup.eachLayer(function(b){b.edited&&(a.addLayer(b),b.edited=!1)});this._map.fire("draw:edited",{layers:a})},_backupLayer:function(a){var b=L.Util.stamp(a);this._uneditedLayerProps[b]||
(a instanceof L.Polyline||a instanceof L.Polygon||a instanceof L.Rectangle?this._uneditedLayerProps[b]={latlngs:L.LatLngUtil.cloneLatLngs(a.getLatLngs())}:a instanceof L.Circle?this._uneditedLayerProps[b]={latlng:L.LatLngUtil.cloneLatLng(a.getLatLng()),radius:a.getRadius()}:a instanceof L.Marker&&(this._uneditedLayerProps[b]={latlng:L.LatLngUtil.cloneLatLng(a.getLatLng())}))},_revertLayer:function(a){var b=L.Util.stamp(a);a.edited=!1;this._uneditedLayerProps.hasOwnProperty(b)&&(a instanceof L.Polyline||
a instanceof L.Polygon||a instanceof L.Rectangle?a.setLatLngs(this._uneditedLayerProps[b].latlngs):a instanceof L.Circle?(a.setLatLng(this._uneditedLayerProps[b].latlng),a.setRadius(this._uneditedLayerProps[b].radius)):a instanceof L.Marker&&a.setLatLng(this._uneditedLayerProps[b].latlng),a.fire("revert-edited",{layer:a}),a._map&&a._map.fire("revert-edited",{layer:a}))},_enableLayerEdit:function(a){a=a.layer||a.target||a;var b;if(!a.editing)return!1;this._backupLayer(a);this.options.selectedPathOptions&&
(b=L.Util.extend({},this.options.selectedPathOptions),b.maintainColor&&(b.color=a.options.color,b.fillColor=a.options.fillColor),a.options.original=L.extend({},a.options),a.options.editing=b);a.editing.enable()},_disableLayerEdit:function(a){a=a.layer||a.target||a;if(!a.editing)return!1;a.edited=!1;a.editing.disable();delete a.options.editing;delete a.options.original},_onMouseMove:function(a){this._tooltip.updatePosition(a.latlng)},_hasAvailableLayers:function(){return 0!==this._featureGroup.getLayers().length}});
L.EditToolbar.Delete=L.Handler.extend({statics:{TYPE:"remove"},options:{icon:new L.DivIcon({iconSize:new L.Point(26,26),className:"leaflet-div-icon leaflet-delete-icon"})},includes:L.Mixin.Events,initialize:function(a,b){L.Handler.prototype.initialize.call(this,a);L.Util.setOptions(this,b);this._deletableLayers=this.options.featureGroup;if(!(this._deletableLayers instanceof L.FeatureGroup))throw Error("options.featureGroup must be a L.FeatureGroup");this.type=L.EditToolbar.Delete.TYPE},enable:function(){!this._enabled&&
this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:deletestart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disable:function(){this._enabled&&(this._deletableLayers.off("layeradd",this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this),L.Handler.prototype.disable.call(this),this._map.fire("draw:deletestop",
{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var a=this._map;a&&(a.getContainer().focus(),this._deletableLayers.eachLayer(this._enableLayerDelete,this),this._deletedLayers=new L.LayerGroup,this._tooltip=new L.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.remove.tooltip.text}),this._map.on("mousemove",this._onMouseMove,this),this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup))},removeHooks:function(){this._map&&
(this._deletableLayers.eachLayer(this._disableLayerDelete,this),this._deletedLayers=null,this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},revertLayers:function(){this._deletedLayers.eachLayer(function(a){this._deletableLayers.addLayer(a);a.fire("revert-deleted",{layer:a});this._map.fire("revert-edited",{layer:a})},this)},save:function(){this._map.fire("draw:deleted",
{layers:this._deletedLayers})},_enableLayerDelete:function(a){(a.layer||a.target||a).on("click",this._removeLayer,this)},_disableLayerDelete:function(a){a=a.layer||a.target||a;a.off("click",this._removeLayer,this);this._deletedLayers.removeLayer(a)},_removeLayer:function(a){a=a.layer||a.target||a;this._deletableLayers.removeLayer(a);this._deletedLayers.addLayer(a);a.fire("deleted")},_onMouseMove:function(a){this._tooltip.updatePosition(a.latlng)},_hasAvailableLayers:function(){return 0!==this._deletableLayers.getLayers().length},
_initMarkers:function(){var a=this;this._markerGroup||(this._markerGroup=new L.LayerGroup);this._markers=[];var b,d,e;this._deletableLayers.eachLayer(function(c){if(c.editing._poly!==r&&!(2>c.editing._poly._latlngs.length)){b=c.editing._poly._latlngs[0];d=new L.LatLng(b.lat,b.lng);var f=new L.Marker(d,{draggable:!1,icon:a.options.icon});f.setOpacity(0.6);f._origLatLng=d;e=function(){a._removeLayer({layer:c});f.setOpacity(1)};f.on("click",e);a._markerGroup.addLayer(f)}})}});L.Handler.MarkerSnap=L.Handler.extend({options:{snapType:"undefined",
gridStep:0.1,snapDistance:6,snapToGrid:!0,snapToObjects:!0,snapVertices:!0},initialize:function(a,b,d){function e(){this._buffer=a.layerPointToLatLng(new L.Point(0,0)).lat-a.layerPointToLatLng(new L.Point(this.options.snapDistance,0)).lat}L.Handler.prototype.initialize.call(this,a);this._markers=[];this._guides=[];2!==arguments.length||b instanceof L.Class||(d=b,b=null);L.Util.setOptions(this,d||{});b&&(b.dragging||(b.dragging=new L.Handler.MarkerDrag(b)),b.dragging.enable(),this.watchMarker(b));
a.on("zoomend",e,this);a.whenReady(e,this);e.call(this)},enable:function(){this.disable();for(var a=0;a<this._markers.length;a++)this.watchMarker(this._markers[a])},disable:function(){for(var a=0;a<this._markers.length;a++)this.unwatchMarker(this._markers[a])},watchMarker:function(a){-1===this._markers.indexOf(a)&&this._markers.push(a);a.on("move",this._snapMarker,this)},unwatchMarker:function(a){a.off("move",this._snapMarker,this);delete a.snap},addGuideLayer:function(a){for(var b=0,d=this._guides.length;b<
d&&L.stamp(a)!==L.stamp(this._guides[b]);b++);this._guides.push(a);return this._guides},addGuideLayersFromGroup:function(a){a.eachLayer(this.addGuideLayer,this);return this._guides},removeGuideLayer:function(a){for(var b=0,d=this._guides.length;b<d;b++)if(L.stamp(a)===L.stamp(this._guides[b])){this._guides.splice(b,1);break}return this._guides},_snapMarker:function(a){function b(a){if(a._layers!==r&&"function"!==typeof a.searchBuffer)for(var c in a._layers)b(a._layers[c]);else"function"===typeof a.searchBuffer?
e=e.concat(a.searchBuffer(d,this._buffer)):e.push(a)}a=a.target;var d=a.getLatLng(),e=[],c=null;if(this.options.snapToGrid&&(c=this._findClosestGridSnap(this._map,d,this.options.gridStep,this.options.snapDistance),null!==c)){this._updateSnap(a,a,c.latlng);return}if(this.options.snapToObjects){for(var c=0,f=this._guides.length;c<f;c++){var g=this._guides[c];g.snapediting!==r&&a._leaflet_id in g.snapediting._markerGroup._layers||b.call(this,g)}c=this._findClosestLayerSnap(this._map,e,d,this.options.snapDistance,
this.options.snapVertices)}c=c||{layer:null,latlng:null};this._updateSnap(a,c.layer,c.latlng)},_findClosestLayerSnap:function(a,b,d,e,c){return L.GeometryUtil.closestLayerSnap(a,b,d,e,c)},_findClosestGridSnap:function(a,b,d,e){return L.GeometryUtil.closestGridSnap(a,b,d,e)},_updateSnap:function(a,b,d){b&&d?(a._latlng=L.latLng(d),a.update(),a.snap!==b&&(a.snap=b,a._icon&&L.DomUtil.addClass(a._icon,"marker-snapped"),a.fire("snap",{layer:b,latlng:d}))):(a.snap&&(a._icon&&L.DomUtil.removeClass(a._icon,
"marker-snapped"),a.fire("unsnap",{layer:a.snap})),delete a.snap)}});L.Handler.PolylineSnap=L.Edit.Poly.extend({initialize:function(a,b,d){var e=this;L.Edit.Poly.prototype.initialize.call(this,b,d);this._snapper=new L.Handler.MarkerSnap(a,d);b.on("remove",function(){e._snapper.disable()})},addGuideLayer:function(a){this._snapper.addGuideLayer(a);return this._snapper._guides},addGuideLayersFromGroup:function(a){a.eachLayer(this.addGuideLayer,this);return this._snapper._guides},removeGuideLayer:function(a){this._snapper.removeGuideLayer(a);
return this._snapper._guides},_createMarker:function(a,b){var d=L.Edit.Poly.prototype._createMarker.call(this,a,b);if(b===r)d.on("dragstart",function(){this._snapper.watchMarker(d)},this);else this._snapper.watchMarker(d);return d}});L.Draw.Feature.SnapMixin={_snapInitialize:function(){this.on("enabled",this._snapOnEnabled,this);this.on("disabled",this._snapOnDisabled,this)},_snapOnEnabled:function(){if(this.options.guideLayers)if(this._mouseMarker){this._map.off("layeradd",this._snapOnEnabled,this);
this._snapper||(this._snapper=new L.Handler.MarkerSnap(this._map),L.Util.setOptions(this._snapper,this.options));for(var a=0,b=this.options.guideLayers.length;a<b;a++)this._snapper.addGuideLayer(this.options.guideLayers[a]);var d=this._mouseMarker;this._snapper.watchMarker(d);var e=d.options.icon;d.on("snap",function(){d.setIcon(this.options.icon);d.setOpacity(1)},this);d.on("unsnap",function(){d.setIcon(e);d.setOpacity(0)},this);d.on("click",this._snapOnClick,this)}else this._map.on("layeradd",this._snapOnEnabled,
this)},_snapOnClick:function(a){if(this._markers){var b=this._markers[this._markers.length-1];this._mouseMarker.snap&&(a&&(b.setLatLng(a.target._latlng),this._poly&&(this._poly._latlngs[this._poly._latlngs.length-1]=a.target._latlng,this._poly.redraw())),L.DomUtil.addClass(b._icon,"marker-snapped"))}},_snapOnDisabled:function(){delete this._snapper}};L.Draw.Feature.include(L.Draw.Feature.SnapMixin);L.Draw.Feature.addInitHook("_snapInitialize");L.Control.GraphicScale=L.Control.extend({options:{position:"bottomleft",
updateWhenIdle:!1,minUnitWidth:30,maxUnitsWidth:240,fill:"fill",showSubunits:!0,doubleLine:!1,labelPlacement:"auto"},onAdd:function(a){this._map=a;this._possibleUnitsNum=[3,5,2,4];this._possibleUnitsNumLen=this._possibleUnitsNum.length;this._possibleDivisions=[1,0.5,0.25,0.2];this._possibleDivisionsLen=this._possibleDivisions.length;this._possibleDivisionsSub={1:{num:2,division:0.5},"0.5":{num:5,division:0.1},"0.25":{num:5,division:0.05},"0.2":{num:2,division:0.1}};this._scaleInner=this._buildScale();
this._scale=this._addScale(this._scaleInner);this._setStyle(this.options);a.on(this.options.updateWhenIdle?"moveend":"move",this._update,this);a.whenReady(this._update,this);return a.options.graphicScaleControl=this._scale},onRemove:function(a){a.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScale:function(a){var b=L.DomUtil.create("div");b.className="leaflet-control-graphicscale";b.appendChild(a);return b},_setStyle:function(a){var b=["leaflet-control-graphicscale-inner"];
a.fill&&"nofill"!==a.fill&&(b.push("filled"),b.push("filled-"+a.fill));a.showSubunits&&b.push("showsubunits");a.doubleLine&&b.push("double");b.push("labelPlacement-"+a.labelPlacement);this._scaleInner.className=b.join(" ")},_buildScale:function(){var a=s.createElement("div");a.className="leaflet-control-graphicscale-inner";var b=L.DomUtil.create("div","subunits",a),d=L.DomUtil.create("div","units",a);this._units=[];this._unitsLbls=[];this._subunits=[];for(var e=0;5>e;e++){var c=this._buildDivision(0===
e%2);d.appendChild(c);this._units.push(c);var f=this._buildDivisionLbl();c.appendChild(f);this._unitsLbls.push(f);c=this._buildDivision(1===e%2);b.appendChild(c);this._subunits.unshift(c)}this._zeroLbl=L.DomUtil.create("div","label zeroLabel");this._zeroLbl.innerHTML="0";this._units[0].appendChild(this._zeroLbl);this._subunitsLbl=L.DomUtil.create("div","label subunitsLabel");this._subunitsLbl.innerHTML="?";this._subunits[4].appendChild(this._subunitsLbl);return a},_buildDivision:function(a){var b=
L.DomUtil.create("div","division"),d=L.DomUtil.create("div","line");b.appendChild(d);var e=L.DomUtil.create("div","line2");b.appendChild(e);a&&d.appendChild(L.DomUtil.create("div","fill"));a||e.appendChild(L.DomUtil.create("div","fill"));return b},_buildDivisionLbl:function(){return L.DomUtil.create("div","label divisionLabel")},_update:function(){var a=this._map.getBounds(),b=a.getCenter().lat,a=6378137*Math.PI*Math.cos(b*Math.PI/180)*(a.getNorthEast().lng-a.getSouthWest().lng)/180;0<this._map.getSize().x&&
this._updateScale(a,this.options)},_updateScale:function(a,b){var d=this._getBestScale(a,b.minUnitWidth,b.maxUnitsWidth);this._render(d)},_getBestScale:function(a,b,d){a=this._getPossibleUnits(a,b,this._map.getSize().x);d=this._getPossibleScales(a,d);d.sort(function(a,b){return b.score-a.score});d=d[0];d.subunits=this._getSubunits(d);return d},_getSubunits:function(a){var b=this._possibleDivisionsSub[a.unit.unitDivision],d={};d.subunitDivision=b.division;d.subunitMeters=a.unit.unitMeters/a.unit.unitDivision*
b.division;d.subunitPx=a.unit.unitPx/a.unit.unitDivision*b.division;return{subunit:d,numSubunits:b.num,total:b.num*d.subunitMeters}},_getPossibleScales:function(a,b){for(var d=[],e=Number.POSITIVE_INFINITY,c,f=0;f<this._possibleUnitsNumLen;f++)for(var g=this._possibleUnitsNum[f],m=0.5*(this._possibleUnitsNumLen-f),p=0;p<a.length;p++){var h=a[p],v=h.unitPx*g,z={unit:h,totalWidthPx:v,numUnits:g,score:0},r=1-(b-v)/b,r=3*r,r=h.unitScore+m+r;if(0.25===h.unitDivision&&3===g||0.5===h.unitDivision&&3===g||
0.25===h.unitDivision&&5===g)r-=2;z.score=r;v<b&&d.push(z);v<e&&(e=v,c=z)}d.length||d.push(c);return d},_getPossibleUnits:function(a,b,d){for(var e,c=[],f=(Math.floor(a)+"").length;-2<f;f--){e=Math.pow(10,f);for(var g=0;g<this._possibleDivisionsLen;g++){var m=e*this._possibleDivisions[g],p=m/a*d;if(p<b)return c;c.push({unitMeters:m,unitPx:p,unitDivision:this._possibleDivisions[g],unitScore:this._possibleDivisionsLen-g})}}return c},_render:function(a){this._renderPart(a.unit.unitPx,a.unit.unitMeters,
a.numUnits,this._units,this._unitsLbls);this._renderPart(a.subunits.subunit.subunitPx,a.subunits.subunit.subunitMeters,a.subunits.numSubunits,this._subunits);a=this._getDisplayUnit(a.subunits.total);this._subunitsLbl.innerHTML=""+a.amount+a.unit},_renderPart:function(a,b,d,e,c){b=this._getDisplayUnit(b);for(var f=0;f<this._units.length;f++){var g=e[f];f<d?(g.style.width=a+"px",g.className="division"):(g.style.width=0,g.className="division hidden");if(c){var g=c[f],m=["label","divisionLabel"];if(f<
d){var p;p=1>b.amount?((f+1)*b.amount).toFixed(2):((f+1)*b.amount).toFixed(0);f===d-1?(p+=b.unit,m.push("labelLast")):m.push("labelSub");g.innerHTML=p}g.className=m.join(" ")}}},_getDisplayUnit:function(a){1>a&&(a=a.toFixed(2));var b=1E3>a?"m":"km";return{unit:b,amount:"km"===b?a/1E3:a}}});L.Map.mergeOptions({graphicScaleControl:!1});L.control.graphicScale=function(a){return new L.Control.GraphicScale(a)};L.Map.addInitHook(function(){this.options.graphicScaleControl&&(this.graphicScaleControl=L.control.graphicScale({doubleLine:!1,
fill:"fill",showSubunits:!0}).addTo(this))});L.SimpleGraticule=L.LayerGroup.extend({options:{interval:20,showOriginLabel:!1,redraw:"move",hidden:!1,zoomIntervals:[{start:0,end:3,interval:5E6},{start:4,end:5,interval:5E5},{start:6,end:7,interval:2E5},{start:8,end:9,interval:1E5},{start:10,end:10,interval:3E4},{start:11,end:11,interval:1E4},{start:12,end:12,interval:6E3},{start:13,end:13,interval:3E3},{start:14,end:14,interval:2E3},{start:15,end:15,interval:1E3},{start:16,end:16,interval:500},{start:17,
end:17,interval:250},{start:18,end:19,interval:100},{start:20,end:20,interval:30},{start:21,end:21,interval:10},{start:22,end:22,interval:6},{start:23,end:23,interval:3},{start:24,end:24,interval:2},{start:25,end:25,interval:1},{start:26,end:26,interval:0.5},{start:27,end:27,interval:0.2},{start:28,end:28,interval:0.1},{start:29,end:29,interval:0.06},{start:30,end:31,interval:0.04},{start:32,end:41,interval:0.02}]},lineStyle:{stroke:!0,color:"#111",opacity:0.6,weight:1,clickable:!1},initialize:function(a){L.LayerGroup.prototype.initialize.call(this);
L.Util.setOptions(this,a)},onAdd:function(a){this._map=a;var b=this.redraw();this._map.on("viewreset "+this.options.redraw,b.redraw,b);this.eachLayer(a.addLayer,a)},onRemove:function(a){a.off("viewreset "+this.options.redraw,this.map);this.eachLayer(this.removeLayer,this);this.options.simpleGraticule=!1},hide:function(){this.options.hidden=!0;this.redraw()},show:function(){this.options.hidden=!1;this.redraw()},redraw:function(){this._bounds=this._map.getBounds().pad(0);this.clearLayers();if(!this.options.hidden){for(var a=
this._map.getZoom(),b=0;b<this.options.zoomIntervals.length;b++)if(a>=this.options.zoomIntervals[b].start&&a<=this.options.zoomIntervals[b].end){this.options.interval=this.options.zoomIntervals[b].interval;break}this.constructLines(this.getMins(),this.getLineCounts());this.options.showOriginLabel&&this.addLayer(this.addOriginLabel())}return this},getLineCounts:function(){var a=Math.cos(this._bounds.getCenter().lat*Math.PI/180),b=6378137*Math.PI,d=this.options.interval,a=180*d/(b*a),b=180*d/b;return{x:Math.ceil((this._bounds.getEast()-
this._bounds.getWest())/a),y:Math.ceil((this._bounds.getNorth()-this._bounds.getSouth())/b)}},getMins:function(){var a=Math.cos(this._bounds.getCenter().lat*Math.PI/180),b=6378137*Math.PI,d=this.options.interval,a=180*d/(b*a),b=180*d/b;return{x:Math.round((this._bounds.getWest()-Math.round(this._bounds.getWest()))/a)*a+Math.round(this._bounds.getWest()),y:Math.round(this._bounds.getSouth()/b)*b}},constructLines:function(a,b){for(var d=Array(b.x+b.y),e=Array(b.x+b.y),c=Math.cos(this._bounds.getCenter().lat*
Math.PI/180),f=6378137*Math.PI,g=this.options.interval,c=180*g/(f*c),f=180*g/f,g=0;g<=b.x;g++){var m=a.x+g*c;d[g]=this.buildXLine(m);this.options.showOriginLabel||(e[g]=this.buildLabel("gridlabel-horiz",m))}for(c=0;c<=b.y;c++)m=a.y+c*f,d[c+g]=this.buildYLine(m),this.options.showOriginLabel||(e[c+g]=this.buildLabel("gridlabel-vert",m));d.forEach(this.addLayer,this);this.options.showOriginLabel||e.forEach(this.addLayer,this)},buildXLine:function(a){var b=new L.LatLng(this._bounds.getSouth(),a);a=new L.LatLng(this._bounds.getNorth(),
a);return new L.Polyline([b,a],this.lineStyle)},buildYLine:function(a){var b=new L.LatLng(a,this._bounds.getWest());a=new L.LatLng(a,this._bounds.getEast());return new L.Polyline([b,a],this.lineStyle)},buildLabel:function(a,b){var d=this._map.getBounds().pad(-0),d="gridlabel-horiz"===a?new L.LatLng(d.getCenter().lng,b):new L.LatLng(b,d.getCenter().lat);return L.marker(d,{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-grid-label",html:'<div class="'+a+'">'+b+"</div>"})})},addOriginLabel:function(){return L.marker([0,
0],{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-grid-label",html:'<div class="gridlabel-horiz">(0,0)</div>'})})}});L.simpleGraticule=function(a){return new L.SimpleGraticule(a)};L.Map.addInitHook(function(){this.options.simpleGraticule&&(this.options.simpleGraticule=(new L.simpleGraticule).addTo(this))});L.SnapGrid=L.LayerGroup.extend({options:{interval:20,showOriginLabel:!1,redraw:"move",hidden:!1,zoomIntervals:[]},lineStyle:{stroke:!0,color:"red",opacity:0.3,weight:1,clickable:!1,
dashArray:"8,2"},initialize:function(a){L.LayerGroup.prototype.initialize.call(this);L.Util.setOptions(this,a)},onAdd:function(a){this._map=a;var b=this.redraw();this._map.on("viewreset "+this.options.redraw,b.redraw,b);this.eachLayer(a.addLayer,a)},onRemove:function(a){a.off("viewreset "+this.options.redraw,this.map);this.eachLayer(this.removeLayer,this);this.options.simpleGraticule=!1},hide:function(){this.options.hidden=!0;this.redraw()},show:function(){this.options.hidden=!1;this.redraw()},redraw:function(){this._bounds=
this._map.getBounds().pad(0);this.clearLayers();if(!this.options.hidden){var a=this.getLineCounts();300>a.x+a.y&&this.constructLines(this.getMins(),this.getLineCounts());this.options.showOriginLabel&&this.addLayer(this.addOriginLabel())}return this},getLineCounts:function(){var a=Math.cos(this._bounds.getCenter().lat*Math.PI/180),b=6378137*Math.PI,d=this.options.interval,a=180*d/(b*a),b=180*d/b;return{x:Math.ceil((this._bounds.getEast()-this._bounds.getWest())/a),y:Math.ceil((this._bounds.getNorth()-
this._bounds.getSouth())/b)}},getMins:function(){var a=Math.cos(this._bounds.getCenter().lat*Math.PI/180),b=6378137*Math.PI,d=this.options.interval,a=180*d/(b*a),b=180*d/b;return{x:Math.round((this._bounds.getWest()-Math.round(this._bounds.getWest()))/a)*a+Math.round(this._bounds.getWest()),y:Math.round(this._bounds.getSouth()/b)*b}},constructLines:function(a,b){for(var d=Array(b.x+b.y),e=Array(b.x+b.y),c=Math.cos(this._bounds.getCenter().lat*Math.PI/180),f=6378137*Math.PI,g=this.options.interval,
c=180*g/(f*c),f=180*g/f,g=0;g<=b.x;g++){var m=a.x+g*c;d[g]=this.buildXLine(m);this.options.showOriginLabel||(e[g]=this.buildLabel("gridlabel-horiz",m))}for(c=0;c<=b.y;c++)m=a.y+c*f,d[c+g]=this.buildYLine(m),this.options.showOriginLabel||(e[c+g]=this.buildLabel("gridlabel-vert",m));d.forEach(this.addLayer,this);this.options.showOriginLabel&&e.forEach(this.addLayer,this)},buildXLine:function(a){var b=new L.LatLng(this._bounds.getSouth(),a);a=new L.LatLng(this._bounds.getNorth(),a);return new L.Polyline([b,
a],this.lineStyle)},buildYLine:function(a){var b=new L.LatLng(a,this._bounds.getWest());a=new L.LatLng(a,this._bounds.getEast());return new L.Polyline([b,a],this.lineStyle)},buildLabel:function(a,b){var d=this._map.getBounds().pad(-0),d="gridlabel-horiz"===a?new L.LatLng(d.getCenter().lng,b):new L.LatLng(b,d.getCenter().lat);return L.marker(d,{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-snap-grid-label",html:'<div class="'+a+'">'+b+"</div>"})})},addOriginLabel:function(){return L.marker([0,
0],{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-snap-grid-label",html:'<div class="gridlabel-horiz">(0,0)</div>'})})}});L.snapGrid=function(a){return new L.SnapGrid(a)};L.Map.addInitHook(function(){this.options.snapGrid&&(this.options.snapGrid=(new L.snapGrid).addTo(this))});(function(a){var b;if("function"===typeof define&&define.amd)define(["leaflet"],a);else if("undefined"!==typeof module)b=require("leaflet"),module.exports=a(b);else{if("undefined"===typeof K.L)throw Error("Leaflet must be loaded first");
a(K.L)}})(function(a){a.Map.mergeOptions({contextmenu:!0,contextmenuWidth:140,contextmenuItems:[{text:"Center map here",callback:function(a){this.panTo(a.latlng)}}]});a.Map.ContextMenu=a.Handler.extend({_touchstart:a.Browser.msPointer?"MSPointerDown":a.Browser.pointer?"pointerdown":"touchstart",statics:{BASE_CLS:"leaflet-contextmenu"},initialize:function(b){a.Handler.prototype.initialize.call(this,b);this._map=b;this._items=[];this._visible=!1;var c=this._container=a.DomUtil.create("div",a.Map.ContextMenu.BASE_CLS,
b._container);c.style.zIndex=1E4;c.style.position="absolute";b.options.contextmenuWidth&&(c.style.width=b.options.contextmenuWidth+"px");this._createItems();a.DomEvent.on(c,"click",a.DomEvent.stop).on(c,"mousedown",a.DomEvent.stop).on(c,"dblclick",a.DomEvent.stop).on(c,"contextmenu",a.DomEvent.stop)},addHooks:function(){a.DomEvent.on(s,a.Browser.touch?this._touchstart:"mousedown",this._onMouseDown,this).on(s,"keydown",this._onKeyDown,this);this._map.on({contextmenu:this._show,mousedown:this._hide,
movestart:this._hide,zoomstart:this._hide},this);a.DomEvent.on(this._map.getContainer(),"mouseleave",this._hide,this)},removeHooks:function(){a.DomEvent.off(s,a.Browser.touch?this._touchstart:"mousedown",this._onMouseDown,this).off(s,"keydown",this._onKeyDown,this);this._map.off({contextmenu:this._show,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide},this);a.DomEvent.off(this._map.getContainer(),"mouseleave",this._hide,this)},showAt:function(b,c){b instanceof a.LatLng&&(b=this._map.latLngToContainerPoint(b));
this._showAtPoint(b,c)},hide:function(){this._hide()},addItem:function(a){return this.insertItem(a)},insertItem:function(a,b){b=b!==r?b:this._items.length;var c=this._createItem(this._container,a,b);this._items.push(c);this._sizeChanged=!0;this._map.fire("contextmenu.additem",{contextmenu:this,el:c.el,index:b});return c.el},removeItem:function(b){var c=this._container;isNaN(b)||(b=c.children[b]);b&&(this._removeItem(a.Util.stamp(b)),this._sizeChanged=!0,this._map.fire("contextmenu.removeitem",{contextmenu:this,
el:b}))},removeAllItems:function(){for(var b;this._container.children.length;)b=this._container.children[0],this._removeItem(a.Util.stamp(b))},hideAllItems:function(){var a,b,c;b=0;for(c=this._items.length;b<c;b++)a=this._items[b],a.el.style.display="none"},showAllItems:function(){var a,b,c;b=0;for(c=this._items.length;b<c;b++)a=this._items[b],a.el.style.display=""},setDisabled:function(b,c){var d=this._container,e=a.Map.ContextMenu.BASE_CLS+"-item";isNaN(b)||(b=d.children[b]);b&&a.DomUtil.hasClass(b,
e)&&(c?(a.DomUtil.addClass(b,e+"-disabled"),this._map.fire("contextmenu.disableitem",{contextmenu:this,el:b})):(a.DomUtil.removeClass(b,e+"-disabled"),this._map.fire("contextmenu.enableitem",{contextmenu:this,el:b})))},isVisible:function(){return this._visible},_createItems:function(){var a=this._map.options.contextmenuItems,b,c;b=0;for(c=a.length;b<c;b++)this._items.push(this._createItem(this._container,a[b]))},_createItem:function(b,c,d){if(c.separator||"-"===c)return this._createSeparator(b,d);
var e=a.Map.ContextMenu.BASE_CLS+"-item";b=this._insertElementAt("a",c.disabled?e+" "+e+"-disabled":e,b,d);d=this._createEventHandler(b,c.callback,c.context,c.hideOnSelect);e="";c.icon?e='<img class="'+a.Map.ContextMenu.BASE_CLS+'-icon" src="'+c.icon+'"/>':c.iconCls&&(e='<span class="'+a.Map.ContextMenu.BASE_CLS+"-icon "+c.iconCls+'"></span>');b.innerHTML=e+c.text;b.href="#";a.DomEvent.on(b,"mouseover",this._onItemMouseOver,this).on(b,"mouseout",this._onItemMouseOut,this).on(b,"mousedown",a.DomEvent.stopPropagation).on(b,
"click",d);return{id:a.Util.stamp(b),el:b,callback:d}},_removeItem:function(b){var c,d,e;d=0;for(e=this._items.length;d<e;d++)if(c=this._items[d],c.id===b)return b=c.el,c.callback&&a.DomEvent.off(b,"mouseover",this._onItemMouseOver,this).off(b,"mouseover",this._onItemMouseOut,this).off(b,"mousedown",a.DomEvent.stopPropagation).off(b,"click",c.callback),this._container.removeChild(b),this._items.splice(d,1),c;return null},_createSeparator:function(b,c){var d=this._insertElementAt("div",a.Map.ContextMenu.BASE_CLS+
"-separator",b,c);return{id:a.Util.stamp(d),el:d}},_createEventHandler:function(b,c,d,e){var f=this,g=this._map,s=a.Map.ContextMenu.BASE_CLS+"-item-disabled";e=e!==r?e:!0;return function(){a.DomUtil.hasClass(b,s)||(e&&f._hide(),c&&c.call(d||g,f._showLocation),f._map.fire("contextmenu:select",{contextmenu:f,el:b}))}},_insertElementAt:function(a,b,c,d){var e;a=s.createElement(a);a.className=b;d!==r&&(e=c.children[d]);e?c.insertBefore(a,e):c.appendChild(a);return a},_show:function(a){this._showAtPoint(a.containerPoint)},
_showAtPoint:function(b,c){if(this._items.length){var d=this._map,e=d.containerPointToLayerPoint(b),d=d.layerPointToLatLng(e),f={contextmenu:this};c&&(f=a.extend(c,f));this._showLocation={latlng:d,layerPoint:e,containerPoint:b};this._setPosition(b);this._visible?this._setPosition(b):(this._container.style.display="block",this._visible=!0);this._map.fire("contextmenu.show",f)}},_hide:function(){this._visible&&(this._visible=!1,this._container.style.display="none",this._map.fire("contextmenu.hide",
{contextmenu:this}))},_setPosition:function(b){var c=this._map.getSize(),d=this._container,e=this._getElementSize(d),f;this._map.options.contextmenuAnchor&&(f=a.point(this._map.options.contextmenuAnchor),b=b.add(f));d._leaflet_pos=b;b.x+e.x>c.x?(d.style.left="auto",d.style.right=Math.max(c.x-b.x,0)+"px"):(d.style.left=Math.max(b.x,0)+"px",d.style.right="auto");b.y+e.y>c.y?(d.style.top="auto",d.style.bottom=Math.max(c.y-b.y,0)+"px"):(d.style.top=Math.max(b.y,0)+"px",d.style.bottom="auto")},_getElementSize:function(a){var b=
this._size,c=a.style.display;if(!b||this._sizeChanged)b={},a.style.left="-999999px",a.style.right="auto",a.style.display="block",b.x=a.offsetWidth,b.y=a.offsetHeight,a.style.left="auto",a.style.display=c,this._sizeChanged=!1;return b},_onMouseDown:function(){this._hide()},_onKeyDown:function(a){27===a.keyCode&&this._hide()},_onItemMouseOver:function(b){a.DomUtil.addClass(b.target||b.srcElement,"over")},_onItemMouseOut:function(b){a.DomUtil.removeClass(b.target||b.srcElement,"over")}});a.Map.addInitHook("addHandler",
"contextmenu",a.Map.ContextMenu);a.Mixin.ContextMenu={bindContextMenu:function(b){a.setOptions(this,b);this._initContextMenu();return this},unbindContextMenu:function(){this.off("contextmenu",this._showContextMenu,this);return this},_initContextMenu:function(){this._items=[];this.on("contextmenu",this._showContextMenu,this)},_showContextMenu:function(a){var b,c,d;if(this._map.contextmenu){b=this._map.mouseEventToContainerPoint(a.originalEvent);this.options.contextmenuInheritItems||this._map.contextmenu.hideAllItems();
c=0;for(d=this.options.contextmenuItems.length;c<d;c++)a=this.options.contextmenuItems[c],this._items.push(this._map.contextmenu.insertItem(a,a.index));this._map.once("contextmenu.hide",this._hideContextMenu,this);this._map.contextmenu.showAt(b,{relatedTarget:this})}},_hideContextMenu:function(){var a,b;a=0;for(b=this._items.length;a<b;a++)this._map.contextmenu.removeItem(this._items[a]);this._items.length=0;this.options.contextmenuInheritItems||this._map.contextmenu.showAllItems()}};var b=[a.Marker,
a.Path],d={contextmenu:!1,contextmenuItems:[],contextmenuInheritItems:!0},e,c,f,g=function(){this.options.contextmenu&&this._initContextMenu()};c=0;for(f=b.length;c<f;c++)e=b[c],e.prototype.options?e.mergeOptions(d):e.prototype.options=d,e.addInitHook(g),e.include(a.Mixin.ContextMenu);return a.Map.ContextMenu});L.Control.SlideMenu=L.Control.extend({options:{isOpen:!1,position:"topright",width:"100%",height:"40px",delay:"0",closeButtonIcon:"fa-angle-double-up",menuButtonIcon:"fa-angle-double-down"},
contents:'<span class="leaflet-top-menu-spacer">&nbsp;</span>,<a class="leaflet-top-menu-link"><b> Load </b></a>,<a class="leaflet-top-menu-link"><b> Save </b></a>,<a class="leaflet-top-menu-link"><b> SVG </b></a>,<a class="leaflet-top-menu-link"><b> PNG </b></a>,<a class="leaflet-top-menu-link"><b> JPG </b></a>,<a class="leaflet-top-menu-link"><b> Options </b></a>'.split(","),initialize:function(a,b){b&&L.Util.setOptions(this,b);this._innerHTML=a?a:this.contents.join("");this._startPosition=0;this._isLeftPosition=
"topleft"===this.options.position||"buttomleft"===this.options.position?!0:!1},onAdd:function(a){this._map=a;this._startPosition=-parseInt(this.options.width,10);this.options.width.indexOf("%")+1&&(this._startPosition=this._startPosition*a.getSize().x*0.01);this._container=L.DomUtil.create("div","leaflet-control-slidemenu leaflet-bar leaflet-control");a=L.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",this._container);a.title="Menu";0<this.options.menuButtonIcon.length?L.DomUtil.create("span",
"fa "+this.options.menuButtonIcon,a):L.DomUtil.create("span","fa fa-bars",a);this._menu=L.DomUtil.create("div","leaflet-menu",s.getElementsByClassName("leaflet-container")[0]);this._menu.style.width=this.options.width;this._menu.style.height=this.options.height;var b=L.DomUtil.create("span","leaflet-menu-close-button fa",this._menu);0<this.options.closeButtonIcon.length?(this._isLeftPosition=!0,this._menu.style.left="-"+this.options.width,b.style["float"]="right",L.DomUtil.addClass(b,this.options.closeButtonIcon)):
this._isLeftPosition?(this._menu.style.left="-"+this.options.width,b.style["float"]="right",L.DomUtil.addClass(b,"fa-chevron-left")):(b.style["float"]="left",this._menu.style.right="-"+this.options.width,L.DomUtil.addClass(b,"fa-chevron-right"));this._contents=L.DomUtil.create("div","leaflet-menu-contents",this._menu);this._contents.innerHTML=this._innerHTML;L.DomEvent.addListener(this._contents.getElementsByTagName("A")[0],"click",function(){this._map.RSWEIndoor.options.dialogs.loadDialog.open()},
this);L.DomEvent.addListener(this._contents.getElementsByTagName("A")[1],"click",function(){this._map.RSWEIndoor.options.dialogs.saveDialog.open()},this);L.DomEvent.addListener(this._contents.getElementsByTagName("A")[2],"click",function(){this._map.RSWEIndoor.options.dialogs.saveSVGDialog.open()},this);L.DomEvent.addListener(this._contents.getElementsByTagName("A")[3],"click",function(){this._map.RSWEIndoor.options.dialogs.savePNGDialog.open()},this);L.DomEvent.addListener(this._contents.getElementsByTagName("A")[4],
"click",function(){this._map.RSWEIndoor.options.dialogs.saveJPGDialog.open()},this);L.DomEvent.addListener(this._contents.getElementsByTagName("A")[5],"click",function(){this._map.RSWEIndoor.options.dialogs.optionsDialog.open()},this);L.DomEvent.disableClickPropagation(this._menu);L.DomEvent.on(a,"click",L.DomEvent.stopPropagation).on(a,"click",function(){this._animate(this._menu,this._startPosition,0,!0)},this).on(b,"click",L.DomEvent.stopPropagation).on(b,"click",function(){this._animate(this._menu,
0,this._startPosition,!1)},this);this.options.isOpen?this._animate(this._menu,this._startPosition,0,!0):this._animate(this._menu,0,this._startPosition,!1);return this._container},setContents:function(a){this._innerHTML=a},_animate:function(a,b,d,e){this.options.isOpen=e;e||(this._startPosition=-parseInt(this.options.width,10),this.options.width.indexOf("%")+1&&(this._startPosition=this._startPosition*this._map.getSize().x*0.01),this._menu.style.width=this.options.width,b=0,d=this._startPosition);
0<this.options.delay?(e?b>d:b<d)||(this._isLeftPosition?a.style.left=b+"px":a.style.right=b+"px",setTimeout(function(a){var f=e?b+10:b-10;b.indexOf("%")+1&&(f+="%");a._animate(a._menu,f,d,e)},this.options.delay,this)):(this._isLeftPosition?a.style.left=d+"px":a.style.right=d+"px",this._map.getSize().x===-d&&(this._isLeftPosition?a.style.left="-100%":a.style.right="100%"))}});L.control.slideMenu=function(a,b){return new L.Control.SlideMenu(a,b)};L.Control.RSWEIndoor=L.Control.extend({options:{position:"topleft",
contextmenu:!0,contextmenuWidth:140,contextmenuItems:[{text:"Center map here",callback:function(a){this._map.panTo(a.latlng)}}],layers:[],roomProps:[],roomWallsProps:[],controlLayerGrp:{},drawnWallsLayerGrp:{},fitBondsAfterLoad:!0,wallWidth:0.1,pixelsPerMeter:100,snapOptions:{displaySnapGrid:!0,gridStep:0.1,snapWallsToGrid:!0,snapWindowsToGrid:!1,snapDoorsToGrid:!1,snapWallsToObjects:!1,snapWindowsToObjects:!0,snapDoorsToObjects:!0,snapLayersArray:[]},dialogs:{optionsDialog:function(){return new L.Control.Dialog.Options},
saveDialog:function(){return new L.Control.Dialog.Save},loadDialog:function(){return new L.Control.Dialog.Load},saveSVGDialog:function(){return new L.Control.Dialog.SaveSVG},savePNGDialog:function(){return new L.Control.Dialog.SavePNG},saveJPGDialog:function(){return new L.Control.Dialog.SaveJPG}}},DeleteRoom:function(a){var b,d,e;for(d=0;d<this.options.layers.length;d++)if(a===this.options.layers[d].controlLayer){for(e=0;e<this.options.roomWallsProps[d].length;e++)delete this.options.roomWallsProps[d][e];
for(e=0;e<this.options.layers[d].roomWalls.length;e++)b=this.options.layers[d].roomWalls[e],this.options.drawnWallsLayerGrp.removeLayer(b._leaflet_id);this.options.controlLayerGrp.removeLayer(a._leaflet_id);this.options.layers[d].roomWalls.length=0;this.options.layers.splice(d,1);this.options.roomProps.splice(d,1);this.options.roomWallsProps.splice(d,1);break}b=0;for(d=this.options.snapOptions.snapLayersArray.length;b<d;b++)if(L.stamp(a)===L.stamp(this.options.snapOptions.snapLayersArray[b])){this.options.snapOptions.snapLayersArray.splice(b,
1);break}},RedrawRoom:function(a,b){var d="undefined";a instanceof L.Rectangle?d="rectangle":a instanceof L.Polygon?d="polygon":a instanceof L.Polyline?d="polyline":a instanceof L.Circle?d="circle":a instanceof L.Marker&&(d="marker");b&&(a.options.layerType=b);if("circle"===d)this.options.controlLayerGrp.addLayer(a);else if("marker"===d)a.bindPopup("A popup!"),this.options.controlLayerGrp.addLayer(a),a.snapediting=new L.Handler.MarkerSnap(map,a),a.snapediting.addGuideLayer(this.options.controlLayerGrp),
a.snapediting.enable();else{for(var e=0.5*this.options.wallWidth,c,f,g=0,m=0,p,h,v,z,g=0;g<this.options.layers.length;g++)if(a===this.options.layers[g].controlLayer){for(p=0;p<this.options.layers[g].roomWalls.length;p++)c=this.options.layers[g].roomWalls[p],this.options.drawnWallsLayerGrp.removeLayer(c._leaflet_id);this.options.layers[g].roomWalls.length=0;break}var s=a._latlngs,M=Math.sqrt(2),E=s.length,n=0,q=0,A,D,F,k,l,y,B,C,w,x,t,u,G,H,I,J,K,O,P,Q,S=function(a,b){return function(){this.ChangeWallType(a,
b)}};if(1<E){for(p=0;p<E-1;p++)k=new L.LatLng(s[p%E].lat,s[p%E].lng),l=new L.LatLng(s[(p+1)%E].lat,s[(p+1)%E].lng),n=l.distanceTo(k),1E-12>Math.abs(n)&&(s.splice(),s.splice(p+1,1),p--,E--);h=[];for(p=0;p<E;p++)if(k=new L.LatLng(s[p%E].lat,s[p%E].lng),l=new L.LatLng(s[(p+1)%E].lat,s[(p+1)%E].lng),m=p,!(p>E-2&&"polyline"===d)){v=0===p&&"polyline"===d?new L.LatLng(k.lat+k.lat-l.lat,k.lng+k.lng-l.lng):new L.LatLng(s[(p-1+E)%E].lat,s[(p-1+E)%E].lng);y=p===E-2&&"polyline"===d?new L.LatLng(l.lat+l.lat-k.lat,
l.lng+l.lng-k.lng):new L.LatLng(s[(p+2)%E].lat,s[(p+2)%E].lng);D=Math.cos(k.lat*Math.PI/180);F=Math.cos(l.lat*Math.PI/180);n=l.distanceTo(k);w=new L.LatLng(k.lat+e/n*(l.lng-k.lng)*D,k.lng-e/n/D*(l.lat-k.lat));x=new L.LatLng(k.lat-e/n*(l.lng-k.lng)*D,k.lng+e/n/D*(l.lat-k.lat));t=new L.LatLng(l.lat+e/n*(l.lng-k.lng)*F,l.lng-e/n/F*(l.lat-k.lat));u=new L.LatLng(l.lat-e/n*(l.lng-k.lng)*F,l.lng+e/n/F*(l.lat-k.lat));n=y.distanceTo(l);G=new L.LatLng(l.lat+e/n*(y.lng-l.lng)*F,l.lng-e/n/F*(y.lat-l.lat));B=
new L.LatLng(l.lat-e/n*(y.lng-l.lng)*F,l.lng+e/n/F*(y.lat-l.lat));z=(l.lng-k.lng)*(y.lat-l.lat)-(y.lng-l.lng)*(l.lat-k.lat);A=(G.lng-t.lng)*(y.lat-l.lat)-(y.lng-l.lng)*(G.lat-t.lat);1E-12<Math.abs(z)?(G=new L.LatLng(A/z*(l.lat-k.lat)+t.lat,A/z*(l.lng-k.lng)+t.lng),n=l.distanceTo(G),q=l.distanceTo(t),n>q*M&&(G.lat=l.lat+q/n*(G.lat-l.lat)*M,G.lng=l.lng+q/n*(G.lng-l.lng)*M)):G=new L.LatLng(t.lat,t.lng);z=(l.lng-k.lng)*(y.lat-l.lat)-(y.lng-l.lng)*(l.lat-k.lat);A=(B.lng-u.lng)*(y.lat-l.lat)-(y.lng-l.lng)*
(B.lat-u.lat);1E-12<Math.abs(z)?(y=new L.LatLng(A/z*(l.lat-k.lat)+u.lat,A/z*(l.lng-k.lng)+u.lng),n=l.distanceTo(y),q=l.distanceTo(u),n>q*M&&(y.lat=l.lat+q/n*(y.lat-l.lat)*M,y.lng=l.lng+q/n*(y.lng-l.lng)*M)):y=new L.LatLng(u.lat,u.lng);n=k.distanceTo(v);B=new L.LatLng(k.lat+e/n*(k.lng-v.lng)*D,k.lng-e/n/D*(k.lat-v.lat));C=new L.LatLng(k.lat-e/n*(k.lng-v.lng)*D,k.lng+e/n/D*(k.lat-v.lat));z=(k.lng-v.lng)*(l.lat-k.lat)-(l.lng-k.lng)*(k.lat-v.lat);A=(w.lng-B.lng)*(l.lat-k.lat)-(l.lng-k.lng)*(w.lat-B.lat);
1E-12<Math.abs(z)?(B=new L.LatLng(A/z*(k.lat-v.lat)+B.lat,A/z*(k.lng-v.lng)+B.lng),n=k.distanceTo(B),q=k.distanceTo(w),n>q*M&&(B.lat=k.lat+q/n*(B.lat-k.lat)*M,B.lng=k.lng+q/n*(B.lng-k.lng)*M)):B=new L.LatLng(B.lat,B.lng);z=(k.lng-v.lng)*(l.lat-k.lat)-(l.lng-k.lng)*(k.lat-v.lat);A=(x.lng-C.lng)*(l.lat-k.lat)-(l.lng-k.lng)*(x.lat-C.lat);1E-12<Math.abs(z)?(A=new L.LatLng(A/z*(k.lat-v.lat)+C.lat,A/z*(k.lng-v.lng)+C.lng),n=k.distanceTo(A),q=k.distanceTo(x),n>q*M&&(A.lat=k.lat+q/n*(A.lat-k.lat)*M,A.lng=
k.lng+q/n*(A.lng-k.lng)*M)):A=new L.LatLng(C.lat,C.lng);this.options.layers[g]===r&&(this.options.layers[g]={});this.options.roomProps[g]===r&&this.options.roomProps.push({});z=this.options.roomProps[g];z.layerClass=d;z.layerClassOptions=a.options;z.layerLatlngs=a.getLatLngs();this.options.roomWallsProps[g]===r&&this.options.roomWallsProps.push([]);v=this.options.roomWallsProps[g];v[m]||(v[m]={wallType:"wall"},"wall"===b&&(v[m].wallType="wall"),"window"===b&&(v[m].wallType="window"),"door"===b&&(v[m].wallType=
"door1"));c=v[m].wallType;n=new L.LatLng(1*k.lat+0*l.lat,1*k.lng+0*l.lng);q=new L.LatLng(0*k.lat+1*l.lat,0*k.lng+1*l.lng);C=new L.LatLng(1*w.lat+0*t.lat,1*w.lng+0*t.lng);H=new L.LatLng(1*x.lat+0*u.lat,1*x.lng+0*u.lng);I=new L.LatLng(0*w.lat+1*t.lat,0*w.lng+1*t.lng);J=new L.LatLng(0*x.lat+1*u.lat,0*x.lng+1*u.lng);K=new L.LatLng(n.lat+0.5*(q.lng-n.lng)*D,n.lng-0.5/D*(q.lat-n.lat));O=new L.LatLng(n.lat-0.5*(q.lng-n.lng)*D,n.lng+0.5/D*(q.lat-n.lat));P=new L.LatLng(q.lat+0.5*(q.lng-n.lng)*F,q.lng-0.5/
F*(q.lat-n.lat));Q=new L.LatLng(q.lat-0.5*(q.lng-n.lng)*F,q.lng+0.5/F*(q.lat-n.lat));F=new L.LatLng(n.lat+0.5*(q.lng-C.lng)*Math.sqrt(3)*D+0.5*(q.lat-n.lat),n.lng-(q.lat-n.lat)*(0.5*Math.sqrt(3)/D)+0.5*(q.lng-n.lng));D=new L.LatLng(n.lat-0.5*(q.lng-n.lng)*Math.sqrt(3)*D+0.5*(q.lat-n.lat),n.lng+(q.lat-n.lat)*(0.5*Math.sqrt(3)/D)+0.5*(q.lng-n.lng));this.options.controlLayerGrp.addLayer(a);for(var N=0,R=this.options.snapOptions.snapLayersArray.length;N<R&&L.stamp(a)!==L.stamp(this.options.snapOptions.snapLayersArray[N]);N++);
N===R&&this.options.snapOptions.snapLayersArray.push(a);"wall"===c?(c=new L.Polygon([w,t,u,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([l,G,t],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([l,y,u],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType=
"wall",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([k,B,w],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([k,A,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),f=new L.Polygon([w,t,u,x],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),
f.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(f),f.bringToFront(),h.push(f)):"gap"===c?(c=new L.Polygon([x,H,C,w],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([u,J,I,t],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([C,H,J,I],{color:"#dddddd",
weight:1,opacity:1,fillOpacity:1}),c.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([l,G,t],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([l,y,u],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([k,B,w],
{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([k,A,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="wall",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),f=new L.Polygon([w,t,u,x],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),f.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(f),f.bringToFront(),h.push(f)):
"window"===c?(c=new L.Polygon([w,C,H,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([u,J,I,t],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([l,G,t],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(c),
c.bringToBack(),h.push(c),c=new L.Polygon([l,y,u],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([k,B,w],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([k,A,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(c),
c.bringToBack(),h.push(c),c=new L.Polygon([C,H,J,I],{fillColor:"#ffffff",color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToFront(),h.push(c),c=new L.Curve(["M",[C.lat,C.lng],"L",[I.lat,I.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToFront(),h.push(c),c=new L.Curve(["M",[H.lat,H.lng],"L",[J.lat,J.lng]],{color:"#000000",weight:1,
opacity:1,fillOpacity:1}),c.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToFront(),h.push(c),c=new L.Curve(["M",[n.lat,n.lng],"L",[q.lat,q.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="window",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToFront(),h.push(c),f=new L.Polygon([w,t,u,x],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),f.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(f),f.bringToFront(),h.push(f)):
"door1"===c?(c=new L.Polygon([w,C,H,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([u,J,I,t],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([l,G,t],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),
c.bringToBack(),h.push(c),c=new L.Polygon([l,y,u],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([k,B,w],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([k,A,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),
c.bringToBack(),h.push(c),c=new L.Polygon([C,H,J,I],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToFront(),h.push(c),c=new L.Curve(["M",[n.lat,n.lng],"L",[F.lat,F.lng],"Q",[P.lat,P.lng],[q.lat,q.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToFront(),h.push(c),f=new L.Polygon([w,t,u,x],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),
f.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(f),f.bringToFront(),h.push(f)):"door2"===c?(c=new L.Polygon([w,C,H,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([u,J,I,t],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([l,G,t],{color:"#000000",
weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([l,y,u],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([k,B,w],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([k,A,x],
{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([C,H,J,I],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToFront(),h.push(c),c=new L.Curve(["M",[n.lat,n.lng],"L",[D.lat,D.lng],"Q",[Q.lat,Q.lng],[q.lat,q.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),
c.bringToFront(),h.push(c),f=new L.Polygon([w,t,u,x],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),f.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(f),f.bringToFront(),h.push(f)):"door3"===c?(c=new L.Polygon([w,C,H,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([u,J,I,t],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),
c.bringToBack(),h.push(c),c=new L.Polygon([l,G,t],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([l,y,u],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([k,B,w],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),
c.bringToBack(),h.push(c),c=new L.Polygon([k,A,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([C,H,J,I],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToFront(),h.push(c),c=new L.Curve(["M",[q.lat,q.lng],"L",[F.lat,F.lng],"Q",[K.lat,K.lng],[n.lat,n.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),
c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToFront(),h.push(c),f=new L.Polygon([w,t,u,x],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),this.options.drawnWallsLayerGrp.addLayer(f),f.options.layerType="control",f.bringToFront(),h.push(f)):"door4"===c&&(c=new L.Polygon([w,C,H,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([u,J,I,t],{color:"#000000",
weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([l,G,t],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([l,y,u],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([k,B,w],
{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([k,A,x],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToBack(),h.push(c),c=new L.Polygon([C,H,J,I],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToFront(),h.push(c),c=new L.Curve(["M",
[q.lat,q.lng],"L",[D.lat,D.lng],"Q",[O.lat,O.lng],[n.lat,n.lng]],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),c.options.layerType="door",this.options.drawnWallsLayerGrp.addLayer(c),c.bringToFront(),h.push(c),f=new L.Polygon([w,t,u,x],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),f.options.layerType="control",this.options.drawnWallsLayerGrp.addLayer(f),f.bringToFront(),h.push(f));this.options.controlLayerGrp.bringToBack();f.on("contextmenu",S(g,m),this)}this.options.roomWallsProps[g]=
v;this.options.roomProps[g]=z;this.options.layers[g]={controlLayer:a,roomWalls:h}}this.options.drawnWallsLayerGrp.addTo(this._map)}},ChangeWallType:function(a,b){if(this.options.layers[a].controlLayer&&this.options.roomWallsProps[a]){var d=this.options.roomWallsProps[a];if("wall"===d[b].wallType)d[b].wallType="gap";else if("gap"===d[b].wallType)d[b].wallType="wall";else if("door1"===d[b].wallType)d[b].wallType="door2";else if("door2"===d[b].wallType)d[b].wallType="door4";else if("door4"===d[b].wallType)d[b].wallType=
"door3";else if("door3"===d[b].wallType)d[b].wallType="door1";else return;this.RedrawRoom(this.options.layers[a].controlLayer,"undefined")}},SetSnapOptions:function(){this._map.drawControl.setDrawingOptions({wall:{snapType:"wall",gridStep:this.options.snapOptions.gridStep,snapToGrid:this.options.snapOptions.snapWallsToGrid,snapToObjects:this.options.snapOptions.snapWallsToObjects,guideLayers:this.options.snapOptions.snapLayersArray,snapDistance:6},window:{snapType:"window",gridStep:this.options.snapOptions.gridStep,
snapToGrid:this.options.snapOptions.snapWindowsToGrid,snapToObjects:this.options.snapOptions.snapWindowsToObjects,guideLayers:this.options.snapOptions.snapLayersArray,snapDistance:6},door:{snapType:"door",gridStep:this.options.snapOptions.gridStep,snapToGrid:this.options.snapOptions.snapDoorsToGrid,snapToObjects:this.options.snapOptions.snapDoorsToObjects,guideLayers:this.options.snapOptions.snapLayersArray,snapDistance:6}})},getPNGData:function(a){var b=new Image,d=L.Util.base64Encode(this.getSVGData());
b.w=this.getSVGSize().x;b.h=this.getSVGSize().y;b.onload=function(){var d=s.createElement("canvas");d.width=b.w;d.height=b.h;var c=d.getContext("2d");c.beginPath();c.rect(0,0,b.w,b.h);c.fillStyle="white";c.fill();c.drawImage(b,0,0);d=d.toDataURL("image/png");return a(d.replace(/^data:image\/(png|jpg|jpeg);base64,/,""))};b.src="data:image/svg+xml;base64,"+d},getJPGData:function(a){var b=new Image,d=L.Util.base64Encode(this.getSVGData());b.w=this.getSVGSize().x;b.h=this.getSVGSize().y;b.onload=function(){var d=
s.createElement("canvas");d.width=b.w;d.height=b.h;var c=d.getContext("2d");c.beginPath();c.rect(0,0,b.w,b.h);c.fillStyle="white";c.fill();c.drawImage(b,0,0);d=d.toDataURL("image/jpeg",1);return a(d.replace(/^data:image\/(png|jpg|jpeg);base64,/,""))};b.src="data:image/svg+xml;base64,"+d},getSVGSize:function(){var a=this.options.drawnWallsLayerGrp.getBounds(),b=Math.cos(a.getCenter().lat*Math.PI/180),d=6378137*Math.PI,e=1/this.options.pixelsPerMeter,b=180*e/(d*b),d=180*e/d;return{x:Math.round((a.getEast()-
a.getWest())/b+1),y:Math.round((-a.getSouth()+a.getNorth())/d)+1}},getSVGData:function(){var a=this.options.drawnWallsLayerGrp.getBounds(),b=Math.cos(a.getCenter().lat*Math.PI/180),d=6378137*Math.PI,e=1/this.options.pixelsPerMeter,c=180*e/(d*b),f=180*e/d,g=function(b){return Math.round((b-a.getWest())/c)},m=function(b){return Math.round((-b+a.getNorth())/f)},p="",p=p+('<svg width="'+(g(a.getEast())+1)+'" height="'+(m(a.getSouth())+1)+'" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">\r\n');
this.options.drawnWallsLayerGrp.eachLayer(function(a){var b,c="",d="";if(0!==a.options.opacity&&"control"!==a.options.layerType){var e="<g><path ";for(b in a._path.attributes)if(a._path.attributes.hasOwnProperty(b)){var f=a._path.attributes[b].name,n=a._path.attributes[b].value;"fill"===f&&a instanceof L.Polygon&&"door"===a.options.layerType&&(n="#ffffff");"stroke-opacity"===f&&a instanceof L.Polygon&&(n="0");"class"!==f&&"d"!==f&&(e+=" "+f+'="'+n+'"')}if(a instanceof L.Polygon){f=0;for(n=a._latlngs.length;f<
n;f++)b=a._latlngs[f],c+=(f?" L":"M")+g(b.lng)+" "+m(b.lat),d+=(f?" L":"M")+(g(b.lng)+1)+" "+(m(b.lat)+1);c+=" Z";p+=e+' d="'+c+'"/></g>\r\n';p+=e+' d="'+(d+" Z")+'"/></g>\r\n'}if(a instanceof L.Curve){for(var q,d=0;d<a._coords.length;d++)if(b=a._coords[d],"string"===typeof b||b instanceof String)q=b,c+=" "+q;else switch(q){case "H":c+=""+m(b[0])+".5 ";break;case "V":c+=g(b[1])+".5 ";break;default:c+=g(b[1])+".5 "+m(b[0])+".5 "}p+=e+' d="'+c+'"/></g>\r\n'}}});return p+="</svg>"},getData:function(){return JSON.stringify({roomProps:this.options.roomProps,
roomWallsProps:this.options.roomWallsProps})},loadData:function(a){a||(a='{"roomProps":[],"roomWallsProps":[]}');var b;try{b=JSON.parse(a)}catch(d){return!1}this.options.roomProps=[];this.options.roomWallsProps=[];this.options.layers=[];this.options.drawnWallsLayerGrp.clearLayers();this.options.controlLayerGrp.clearLayers();this.options.roomProps=b.roomProps;this.options.roomWallsProps=b.roomWallsProps;this.options.roomProps.forEach(function(a){var b;"polyline"===a.layerClass&&(b=new L.Polyline(a.layerLatlngs,
a.layerClassOptions));"polygon"===a.layerClass&&(b=new L.Polygon(a.layerLatlngs,a.layerClassOptions));b&&(b.addTo(this._map),b.setStyle({opacity:0}),this.options.controlLayerGrp.addLayer(b),this.RedrawRoom(b))},this);this.options.fitBondsAfterLoad&&this.fitBounds();this._map.fire("close_all_dialogs");return!0},fitBounds:function(){var a;this.options.controlLayerGrp.eachLayer(function(b){a=a?a.extend(b.getBounds()):b.getBounds()});a&&this._map.fitBounds(a)},RSWEinit:function(){var a=this._map;if(!a)throw Error("Leaflet has not properly initialized");
var b;a.RSWEIndoor.options.controlLayerGrp=a.drawControl._toolbars.edit.options.featureGroup;a.RSWEIndoor.options.drawnWallsLayerGrp=new L.FeatureGroup;a.addLayer(a.RSWEIndoor.options.drawnWallsLayerGrp);a.options.snapGrid.options.interval=a.RSWEIndoor.options.snapOptions.gridStep;a.RSWEIndoor.options.snapOptions.displaySnapGrid?a.options.snapGrid.show():a.options.snapGrid.hide();a.RSWEIndoor.SetSnapOptions();for(var d in this.options.dialogs)this.options.dialogs[d]=this.options.dialogs[d](),this._map.addControl(this.options.dialogs[d]);
a.on("close_all_dialogs",function(){for(var b in this.RSWEIndoor.options.dialogs)this.RSWEIndoor.options.dialogs[b].close(),this.addControl(this.RSWEIndoor.options.dialogs[b]);a.drawControl._toolbars.draw.disable();a.drawControl._toolbars.edit.disable()});a.on("draw:drawstart",function(d){b=d.layer;"marker"===d.layerType&&(b._mouseMarker.snapediting!==r&&(b._mouseMarker.snapediting.disable(),delete b._mouseMarker.snapediting),b._mouseMarker.snapediting=new L.Handler.MarkerSnap(a,b._mouseMarker),b._mouseMarker.snapediting._snapper._guides=
a.RSWEIndoor.options.snapOptions.snapLayersArray,b._mouseMarker.snapediting.enable());if("wall"===d.layerType||"window"===d.layerType||"door"===d.layerType)a.RSWEIndoor.SetSnapOptions(),b._poly.snapediting=new L.Handler.PolylineSnap(a,b._poly),b._poly.snapediting._snapper._guides=a.RSWEIndoor.options.snapOptions.snapLayersArray,b._poly.snapediting._snapper.options.gridStep=a.RSWEIndoor.options.snapOptions.gridStep,"wall"===d.layerType&&(b._poly.snapediting._snapper.options.snapToGrid=a.RSWEIndoor.options.snapOptions.snapWallsToGrid,
b._poly.snapediting._snapper.options.snapToObjects=a.RSWEIndoor.options.snapOptions.snapWallsToObjects),"window"===d.layerType&&(b._poly.snapediting._snapper.options.snapToGrid=a.RSWEIndoor.options.snapOptions.snapWindowsToGrid,b._poly.snapediting._snapper.options.snapToObjects=a.RSWEIndoor.options.snapOptions.snapWindowsToObjects),"door"===d.layerType&&(b._poly.snapediting._snapper.options.snapToGrid=a.RSWEIndoor.options.snapOptions.snapDoorsToGrid,b._poly.snapediting._snapper.options.snapToObjects=
a.RSWEIndoor.options.snapOptions.snapDoorsToObjects),b._poly.snapediting.enable()});a.on("draw:editstart_after",function(){a.RSWEIndoor.options.controlLayerGrp.eachLayer(function(b){b.setStyle({opacity:0.6});b.editing._poly!==r&&b.snapediting===r&&(a.removeLayer(b.editing._markerGroup),b.snapediting=new L.Handler.PolylineSnap(a,b),b.snapediting._snapper._guides=a.RSWEIndoor.options.snapOptions.snapLayersArray,b.snapediting._snapper.options.gridStep=a.RSWEIndoor.options.snapOptions.gridStep,"wall"===
b.layerType&&(b.snapediting._snapper.options.snapToGrid=a.RSWEIndoor.options.snapOptions.snapWallsToGrid,b.snapediting._snapper.options.snapToObjects=a.RSWEIndoor.options.snapOptions.snapWallsToObjects),"window"===b.layerType&&(b.snapediting._snapper.options.snapToGrid=a.RSWEIndoor.options.snapOptions.snapWindowsToGrid,b.snapediting._snapper.options.snapToObjects=a.RSWEIndoor.options.snapOptions.snapWindowsToObjects),"door"===b.layerType&&(b.snapediting._snapper.options.snapToGrid=a.RSWEIndoor.options.snapOptions.snapDoorsToGrid,
b.snapediting._snapper.options.snapToObjects=a.RSWEIndoor.options.snapOptions.snapDoorsToObjects),b.snapediting.enable())},a)});a.on("draw:editstop",function(){a.RSWEIndoor.options.controlLayerGrp.eachLayer(function(a){a.setStyle({opacity:0});a.editing._poly!==r&&a.snapediting!==r&&(a.snapediting.disable(),delete a.snapediting)},a)});a.on("revert-edited",function(b){a.RSWEIndoor.RedrawRoom(b.layer)});a.on("edit",function(b){a.RSWEIndoor.RedrawRoom(b.layer)});a.on("draw:deleted",function(a){a=a.layers._layers;
for(var b in a)this.RSWEIndoor.DeleteRoom(a[b])});a.on("draw:created",function(b){b.layer.setStyle({opacity:0});a.RSWEIndoor.RedrawRoom(b.layer,b.layerType)});a.on("redraw:all",function(){a.RSWEIndoor.options.controlLayerGrp.eachLayer(function(b){a.RSWEIndoor.RedrawRoom(b)})})}});L.Map.addInitHook(function(){if(this.options.RSWEIndoor){var a=new L.FeatureGroup;this.addLayer(a);this.drawControl=new L.Control.Draw({edit:{featureGroup:a}});this.addControl(this.drawControl);this.RSWEIndoor=new L.Control.RSWEIndoor;
this.RSWEIndoor._map=this;this.slideMenu=L.control.slideMenu("",{});this.addControl(this.slideMenu);this.graphicScaleControl=L.control.graphicScale().addTo(this);this.options.simpleGraticule=(new L.simpleGraticule).addTo(this);this.options.snapGrid=(new L.snapGrid).addTo(this);this.RSWEIndoor.RSWEinit()}});L.Control.Dialog=L.Control.extend({options:{size:[300,300],minSize:[100,100],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},initialize:function(a){L.setOptions(this,a);this._attributions=
{}},onAdd:function(a){this._initLayout();this._map=a;this.update();this.options.initOpen||this.close();return this._container},open:function(){if(this._map)return this._container.style.visibility="",this._map.fire("dialog:opened",this),this},close:function(){this._container.style.visibility="hidden";this._map.fire("dialog:closed",this);return this},destroy:function(){if(!this._map)return this;this.removeFrom(this._map);if(this.onRemove)this.onRemove(this._map);this._map.fire("dialog:destroyed",this);
return this},setLocation:function(a){a=a||[250,250];this.options.anchor[0]=0;this.options.anchor[1]=0;this._oldMousePos.x=0;this._oldMousePos.y=0;this._move(a[0],a[1]);return this},setSize:function(a){a=a||[300,300];this.options.size[0]=0;this.options.size[1]=0;this._oldMousePos.x=0;this._oldMousePos.y=0;this._resize(a[0],a[1]);return this},lock:function(){this._resizerNode.style.visibility="hidden";this._grabberNode.style.visibility="hidden";this._closeNode.style.visibility="hidden";this._map.fire("dialog:locked",
this);return this},unlock:function(){this._resizerNode.style.visibility="";this._grabberNode.style.visibility="";this._closeNode.style.visibility="";this._map.fire("dialog:unlocked",this);return this},freeze:function(){this._resizerNode.style.visibility="hidden";this._grabberNode.style.visibility="hidden";this._map.fire("dialog:frozen",this);return this},unfreeze:function(){this._resizerNode.style.visibility="";this._grabberNode.style.visibility="";this._map.fire("dialog:unfrozen",this);return this},
setContent:function(a){this._content=a;this.update();return this},getContent:function(){return this._content},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._container.style.visibility="",this._map.fire("dialog:updated",this))},_initLayout:function(){var a=this._container=L.DomUtil.create("div","leaflet-control-dialog");a.style.width=this.options.size[0]+"px";a.style.height=this.options.size[1]+
"px";a.style.left=this.options.anchor[0]+"px";a.style.top=this.options.anchor[1]+"px";var b=L.DomEvent.stopPropagation;L.DomEvent.on(a,"click",b).on(a,"mousedown",b).on(a,"touchstart",b).on(a,"dblclick",b).on(a,"mousewheel",b).on(a,"contextmenu",b).on(a,"MozMousePixelScroll",b);var b=this._innerContainer=L.DomUtil.create("div","leaflet-control-dialog-inner"),d=this._grabberNode=L.DomUtil.create("div","leaflet-control-dialog-grabber");d.innerHTML="<b>&#8689;</b>";L.DomEvent.on(d,"mousedown",this._handleMoveStart,
this);var e=this._closeNode=L.DomUtil.create("div","leaflet-control-dialog-close");e.innerHTML="<b>X</b>";L.DomEvent.on(e,"click",this._handleClose,this);var c=this._resizerNode=L.DomUtil.create("div","leaflet-control-dialog-resizer");c.innerHTML="<b>&#8690;</b>";L.DomEvent.on(c,"mousedown",this._handleResizeStart,this);var f=this._contentNode=L.DomUtil.create("div","leaflet-control-dialog-contents");a.appendChild(b);b.appendChild(f);b.appendChild(d);b.appendChild(e);b.appendChild(c);this._oldMousePos=
{x:0,y:0}},_handleClose:function(){this.close()},_handleResizeStart:function(a){this._oldMousePos.x=a.clientX;this._oldMousePos.y=a.clientY;L.DomEvent.on(this._map,"mousemove",this._handleMouseMove,this);L.DomEvent.on(this._map,"mouseup",this._handleMouseUp,this);this._map.fire("dialog:resizestart",this);this._resizing=!0},_handleMoveStart:function(a){this._oldMousePos.x=a.clientX;this._oldMousePos.y=a.clientY;L.DomEvent.on(this._map,"mousemove",this._handleMouseMove,this);L.DomEvent.on(this._map,
"mouseup",this._handleMouseUp,this);this._map.fire("dialog:movestart",this);this._moving=!0},_handleMouseMove:function(a){var b=a.originalEvent.clientX-this._oldMousePos.x,d=a.originalEvent.clientY-this._oldMousePos.y;a.originalEvent.stopPropagation&&a.originalEvent.stopPropagation();a.originalEvent.preventDefault&&a.originalEvent.preventDefault();this._resizing&&this._resize(b,d);this._moving&&this._move(b,d)},_handleMouseUp:function(){L.DomEvent.off(this._map,"mousemove",this._handleMouseMove,this);
L.DomEvent.off(this._map,"mouseup",this._handleMouseUp,this);this._resizing&&(this._resizing=!1,this._map.fire("dialog:resizeend",this));this._moving&&(this._moving=!1,this._map.fire("dialog:moveend",this))},_move:function(a,b){var d=this.options.anchor[1]+b;this.options.anchor[0]+=a;this.options.anchor[1]=d;this._container.style.left=this.options.anchor[0]+"px";this._container.style.top=this.options.anchor[1]+"px";this._map.fire("dialog:moving",this);this._oldMousePos.y+=b;this._oldMousePos.x+=a},
_resize:function(a,b){var d=this.options.size[0]+a,e=this.options.size[1]+b;d<=this.options.maxSize[0]&&d>=this.options.minSize[0]&&(this.options.size[0]=d,this._container.style.width=this.options.size[0]+"px",this._oldMousePos.x+=a);e<=this.options.maxSize[1]&&e>=this.options.minSize[1]&&(this.options.size[1]=e,this._container.style.height=this.options.size[1]+"px",this._oldMousePos.y+=b);this._map.fire("dialog:resizing",this)},_updateContent:function(){if(this._content){var a=this._contentNode,
b="function"===typeof this._content?this._content(this):this._content;if("string"===typeof b)a.innerHTML=b;else{for(;a.hasChildNodes();)a.removeChild(a.firstChild);a.appendChild(b)}}},_updateLayout:function(){this._container.style.width=this.options.size[0]+"px";this._container.style.height=this.options.size[1]+"px";this._container.style.left=this.options.anchor[0]+"px";this._container.style.top=this.options.anchor[1]+"px"}});L.control.dialog=function(a){return new L.Control.Dialog(a)};L.Control.Dialog.Options=
L.Control.Dialog.extend({options:{size:[300,300],minSize:[100,100],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},
_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},_selectTab:function(a){for(var b=this._getTabCount(),d=0;d<b;d++){var e=this._getTab(d),c=this._getTabTitle(d);a!==d?(e.setAttribute("class","dialog-tab"),c.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),c.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,
a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.6*a.x),Math.floor(0.6*a.y)];this.options.maxSize=[Math.floor(0.6*a.x),Math.floor(0.6*a.y)];this.options.anchor=[Math.floor(0.2*a.x),Math.floor(0.2*a.y)];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),d=0;d<b;d++)L.DomEvent.addListener(this._getTabTitle(d),"click",a(d),this);this._dlgCreateControls();this.options.initOpen?
this.open():this.close();return this._container},close:function(){this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">View Options</li>;<li class="dialog-tab-title">Edit Options</li>;<li class="dialog-tab-title">Snap Options</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>View Options</h3></div></div>;<div class="dialog-tab"><div class="dialog-tab-content"><h3>Edit Options</h3></div></div>;<div class="dialog-tab"><div class="dialog-tab-content"><h3>Snap Options</h3></div></div>;</div>;</div>;'.split(";"),
_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))this._map.options.simpleGraticule!==r&&(b=L.DomUtil.create("div","display-grid-control"),a.appendChild(b),b.innerHTML=!1===this._map.options.simpleGraticule.options.hidden?'<label><input type="checkbox" checked name="simpleGraticule" value="1" />Display Measure Grid</label>':'<label><input type="checkbox" name="simpleGraticule" value="1" />Display Measure Grid</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",
function(a){a.target.checked?this._map.options.simpleGraticule.show():this._map.options.simpleGraticule.hide()},this)),this._map.options.graphicScaleControl!==r&&(b=L.DomUtil.create("div","display-graphicscale-control"),a.appendChild(b),b.innerHTML="none"===this._map.options.graphicScaleControl.style.display?'<label><input type="checkbox" name="graphicScaleControl" value="1" />Display Ruler</label>':'<label><input type="checkbox" checked name="graphicScaleControl" value="1" />Display Ruler</label>',
L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.options.graphicScaleControl.style.display=a.target.checked?"block":"none"},this)),this._map.RSWEIndoor.options.fitBondsAfterLoad!==r&&(b=L.DomUtil.create("div","display-graphicscale-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.fitBondsAfterLoad?'<label><input type="checkbox" checked name="fitBondsAfterLoad" value="1" />Fit Bonds After Load</label>':'<label><input type="checkbox" name="fitBondsAfterLoad" value="1" />Fit Bonds After Load</label>',
L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.fitBondsAfterLoad=a.target.checked?!0:!1},this));(a=this._getTabContainer(1))&&this._map.RSWEIndoor.options.wallWidth!==r&&(b=L.DomUtil.create("div","wallwidth-control"),a.appendChild(b),b.innerHTML='<label><input type="text" name="wallWidthControl" /> Wall Width (meters)</label>',b.firstChild.firstElementChild.setAttribute("value",this._map.RSWEIndoor.options.wallWidth),L.DomEvent.addListener(b.firstChild.firstElementChild,
"change",function(a){if(a.target.value){var b=a.target.value.replace(RegExp(",","g"),".");isNaN(b)?a.target.value=this._map.RSWEIndoor.options.wallWidth:(this._map.RSWEIndoor.options.wallWidth=b,a.target.value=b,this._map.fire("redraw:all"))}},this));if(a=this._getTabContainer(2))this._map.RSWEIndoor.options.snapOptions.displaySnapGrid!==r&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.options.snapGrid.options.hidden?'<label><input type="checkbox" name="displaySnapGrid" value="1" /> Display Snap Grid</label>':
'<label><input type="checkbox" checked name="displaySnapGrid" value="1" /> Display Snap Grid</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){a.target.checked?(this._map.options.snapGrid.show(),this._map.RSWEIndoor.options.snapOptions.displaySnapGrid=!0):(this._map.options.snapGrid.hide(),this._map.RSWEIndoor.options.snapOptions.displaySnapGrid=!1)},this)),this._map.RSWEIndoor.options.snapOptions.gridStep!==r&&(b=L.DomUtil.create("div","snap-grid-step-options-control"),
a.appendChild(b),b.innerHTML='<label><input type="text" name=snapgridstep" /> Snap Grid Step (meters)</label>',b.firstChild.firstElementChild.setAttribute("value",this._map.RSWEIndoor.options.snapOptions.gridStep),L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){if(a.target.value){var b=this.value.replace(RegExp(",","g"),".");isNaN(b)?a.target.value=this._map.RSWEIndoor.options.snapOptions.gridStep:(b=+b,this._map.RSWEIndoor.options.snapOptions.gridStep=b,a.target.value=
b,this._map.options.snapGrid.options.interval=b,this._map.RSWEIndoor.SetSnapOptions(),this._map.options.snapGrid.redraw(),this._map.RSWEIndoor.options.controlLayer.eachLayer(function(a){a.snapediting!==r&&a.snapediting._snapper!==r&&(a.snapediting._snapper.options.gridStep=b)}))}},this)),this._map.RSWEIndoor.options.snapOptions.snapWallsToGrid!==r&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapWallsToGrid?
'<label><input type="checkbox" checked name="snapWallsToGrid" value="1" /> Snap Walls To Grid</label>':'<label><input type="checkbox" name="snapWallsToGrid" value="1" /> Snap Walls To Grid</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapWallsToGrid=a.target.checked?!0:!1;this._map.RSWEIndoor.SetSnapOptions()},this)),this._map.RSWEIndoor.options.snapOptions.snapWallsToObjects!==r&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),
a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapWallsToObjects?'<label><input type="checkbox" checked name="snapWallsToObjects" value="1" /> Snap Walls To Objects</label>':'<label><input type="checkbox" name="snapWallsToObjects" value="1" /> Snap Walls To Objects</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapWallsToObjects=a.target.checked?!0:!1;this._map.RSWEIndoor.SetSnapOptions()},
this)),this._map.RSWEIndoor.options.snapOptions.snapWindowsToGrid!==r&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapWindowsToGrid?'<label><input type="checkbox" checked name="snapWindowsToGrid" value="1" /> Snap Windows To Grid</label>':'<label><input type="checkbox" name="snapWindowsToGrid" value="1" /> Snap Windows To Grid</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapWindowsToGrid=
a.target.checked?!0:!1;this._map.RSWEIndoor.SetSnapOptions()},this)),this._map.RSWEIndoor.options.snapOptions.snapWindowsToObjects!==r&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapWindowsToObjects?'<label><input type="checkbox" checked name="snapWindowsToObjects" value="1" /> Snap Windows To Objects</label>':'<label><input type="checkbox" name="snapWindowsToObjects" value="1" /> Snap Windows To Objects</label>',
L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapWindowsToObjects=a.target.checked?!0:!1;this._map.RSWEIndoor.SetSnapOptions()},this)),this._map.RSWEIndoor.options.snapOptions.snapDoorsToGrid!==r&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapDoorsToGrid?'<label><input type="checkbox" checked name="snapDoorsToGrid" value="1" /> Snap Doors To Grid</label>':
'<label><input type="checkbox" name="snapDoorsToGrid" value="1" /> Snap Doors To Grid</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapDoorsToGrid=a.target.checked?!0:!1;this._map.RSWEIndoor.SetSnapOptions()},this)),this._map.RSWEIndoor.options.snapOptions.snapDoorsToObjects!==r&&(b=L.DomUtil.create("div","display-snap-grid-options-control"),a.appendChild(b),b.innerHTML=!0===this._map.RSWEIndoor.options.snapOptions.snapDoorsToObjects?
'<label><input type="checkbox" checked name="snapDoorsToObjects" value="1" /> Snap Doors To Objects</label>':'<label><input type="checkbox" name="snapDoorsToObjects" value="1" /> Snap Doors To Objects</label>',L.DomEvent.addListener(b.firstChild.firstElementChild,"change",function(a){this._map.RSWEIndoor.options.snapOptions.snapDoorsToObjects=a.target.checked?!0:!1;this._map.RSWEIndoor.SetSnapOptions()},this))}});L.control.dialog.options=function(a){return new L.Control.Dialog.Options(a)};L.Control.Dialog.Load=
L.Control.Dialog.extend({options:{size:[300,300],minSize:[100,100],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},msgDiv:{},_isOpen:!1,initialize:function(){L.setOptions(this,this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},
_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},_selectTab:function(a){for(var b=this._getTabCount(),d=0;d<b;d++){var e=this._getTab(d),c=this._getTabTitle(d);a!==d?(e.setAttribute("class","dialog-tab"),c.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),c.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,
a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.maxSize=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.anchor=[Math.floor(0.25*a.x),Math.floor(0.25*a.y)];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),d=0;d<b;d++)L.DomEvent.addListener(this._getTabTitle(d),"click",a(d),this);this._dlgCreateControls();this.options.initOpen?
this.open():this.close();return this._container},close:function(){this.msgDiv.innerHTML="";this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">Load Drawing From File</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content" ><h3>Load Drawing From File</h3></div></div>;</div>;</div>;'.split(";"),
_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))b=L.DomUtil.create("div","save-file-name"),a.appendChild(b),K.File&&K.FileReader&&K.FileList&&K.Blob?(b.innerHTML='<div></div><input type="file" name="file" /><output id="list"></output>',this.msgDiv=b.getElementsByTagName("DIV")[0],this.InputName=b.getElementsByTagName("INPUT")[0],L.DomEvent.addListener(this.InputName,"change",function(a){this.handleFileSelect(a)},this)):b.innerHTML="<div>Sorry. The File APIs are not fully supported in this browser.</div>"},
handleFileSelect:function(a){var b=a.target.files;b.length?(a=new FileReader,a.thisDlg=this,a.onloadend=function(a){a.target.readyState===FileReader.DONE&&(a.target.thisDlg.InputName.value="",a.target.thisDlg._map.RSWEIndoor.loadData(a.target.result)?a.target.thisDlg.close():a.target.thisDlg.msgDiv.innerHTML="ERROR loading data!  Please check file contents.")},b=b[0].slice(0,b[0].size),a.readAsBinaryString(b)):this.msgDiv.innerHTML="Please select a file!"}});L.control.dialog.load=function(a){return new L.Control.Dialog.Load(a)};
L.Control.Dialog.Save=L.Control.Dialog.extend({options:{size:[300,300],minSize:[100,100],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},
_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},_selectTab:function(a){for(var b=this._getTabCount(),d=0;d<b;d++){var e=this._getTab(d),c=this._getTabTitle(d);a!==d?(e.setAttribute("class","dialog-tab"),c.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),c.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,
a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.maxSize=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.anchor=[Math.floor(0.25*a.x),Math.floor(0.25*a.y)];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),d=0;d<b;d++)L.DomEvent.addListener(this._getTabTitle(d),"click",a(d),this);this._dlgCreateControls();this.options.initOpen?
this.open():this.close();return this._container},close:function(){this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">Save Drawing As</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Save Drawing As</h3></div></div>;</div>;</div>;'.split(";"),
saveAsText:function(){var a=this.options.saveALink,b="RSWE.json";this.options.InputName.value&&(b=this.options.InputName.value);a.download=b;b=this._map.RSWEIndoor.getData();a.href="data:text/plain;base64,"+L.Util.base64Encode(b);a.click();this.close()},_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))b=L.DomUtil.create("div","save-file-name"),a.appendChild(b),b.innerHTML='<a href="" download="" style="display:none;"></a><label><input type="text" name="saveFileName" placeholder="Enter file name"/></label>&nbsp;<input type="button" value="Save drawing to file"/><br><br><i>Your drawing will be saved into system "Download" folder.</i>',
this.options.saveALink=b.firstChild,this.options.InputName=b.getElementsByTagName("INPUT")[0],this.options.InputButton=b.getElementsByTagName("INPUT")[1],L.DomEvent.addListener(this.options.InputButton,"click",function(){this.saveAsText()},this)}});L.control.dialog.save=function(a){return new L.Control.Dialog.Save(a)};L.Control.Dialog.SaveSVG=L.Control.Dialog.extend({options:{size:[300,300],minSize:[100,100],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,
this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},
_selectTab:function(a){for(var b=this._getTabCount(),d=0;d<b;d++){var e=this._getTab(d),c=this._getTabTitle(d);a!==d?(e.setAttribute("class","dialog-tab"),c.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),c.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.maxSize=[Math.floor(0.5*
a.x),Math.floor(0.5*a.y)];this.options.anchor=[Math.floor(0.25*a.x),Math.floor(0.25*a.y)];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),d=0;d<b;d++)L.DomEvent.addListener(this._getTabTitle(d),"click",a(d),this);this._dlgCreateControls();this.options.initOpen?this.open():this.close();return this._container},close:function(){this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},
open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">Save Data As SVG</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Save Data As SVG</h3></div></div>;</div>;</div>;'.split(";"),saveAsSVG:function(){var a=this.options.saveALink,b="RSWE.svg";this.options.InputName.value&&
(b=this.options.InputName.value);a.download=b;b=this._map.RSWEIndoor.getSVGData();a.href="data:image/svg+xml;base64,"+L.Util.base64Encode(b);a.click();this.close()},_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))b=L.DomUtil.create("div","save-file-name"),a.appendChild(b),b.innerHTML='<a href="" download="" style="display:none;"></a><label><input type="text" name="saveFileName" placeholder="Enter file name"/></label>&nbsp;<input type="button" value="Save data to SVG file"/><br><br><i>Your drawing will be saved into system "Download" folder.</i>',
this.options.saveALink=b.firstChild,this.options.InputName=b.getElementsByTagName("INPUT")[0],this.options.InputButton=b.getElementsByTagName("INPUT")[1],L.DomEvent.addListener(this.options.InputButton,"click",function(){this.saveAsSVG()},this)}});L.control.dialog.save=function(a){return new L.Control.Dialog.Save(a)};L.Control.Dialog.SavePNG=L.Control.Dialog.extend({options:{size:[300,300],minSize:[100,100],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,
this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},
_selectTab:function(a){for(var b=this._getTabCount(),d=0;d<b;d++){var e=this._getTab(d),c=this._getTabTitle(d);a!==d?(e.setAttribute("class","dialog-tab"),c.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),c.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.maxSize=[Math.floor(0.5*
a.x),Math.floor(0.5*a.y)];this.options.anchor=[Math.floor(0.25*a.x),Math.floor(0.25*a.y)];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),d=0;d<b;d++)L.DomEvent.addListener(this._getTabTitle(d),"click",a(d),this);this._dlgCreateControls();this.options.initOpen?this.open():this.close();return this._container},close:function(){this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},
open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">Save Data As PNG</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Save SVG Data As</h3></div></div>;</div>;</div>;'.split(";"),saveAsPNG:function(){var a=this.options.saveALink,b="RSWE.png";this.options.InputName.value&&
(b=this.options.InputName.value);a.download=b;var d=this;this._map.RSWEIndoor.getPNGData(function(b){a.href="data:image/png;base64,"+b;a.click();d.close()})},_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))b=L.DomUtil.create("div","save-file-name"),a.appendChild(b),b.innerHTML='<a href="" download="" style="display:none;"></a><label><input type="text" name="saveFileName" placeholder="Enter file name"/></label>&nbsp;<input type="button" value="Save data to PNG file"/><br><br><i>Your drawing will be saved into system "Download" folder.</i>',
this.options.saveALink=b.firstChild,this.options.InputName=b.getElementsByTagName("INPUT")[0],this.options.InputButton=b.getElementsByTagName("INPUT")[1],L.DomEvent.addListener(this.options.InputButton,"click",function(){this.saveAsPNG()},this)}});L.control.dialog.save=function(a){return new L.Control.Dialog.Save(a)};L.Control.Dialog.SaveJPG=L.Control.Dialog.extend({options:{size:[300,300],minSize:[100,100],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,
this.options);L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a]},_getTabTitle:function(a){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[a]},_getTabContainer:function(a){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[a].childNodes[0]},
_selectTab:function(a){for(var b=this._getTabCount(),d=0;d<b;d++){var e=this._getTab(d),c=this._getTabTitle(d);a!==d?(e.setAttribute("class","dialog-tab"),c.setAttribute("class","dialog-tab-title")):(e.setAttribute("class","dialog-tab selected"),c.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(a){this._container=L.Control.Dialog.prototype.onAdd.call(this,a);this._map=a;a=a.getSize();this.options.size=[Math.floor(0.5*a.x),Math.floor(0.5*a.y)];this.options.maxSize=[Math.floor(0.5*
a.x),Math.floor(0.5*a.y)];this.options.anchor=[Math.floor(0.25*a.x),Math.floor(0.25*a.y)];this._isOpen=!1;L.setOptions(this,this.options);a=this.contents.join("");this.setContent(a);a=function(a){return function(){this._selectTab(a)}};for(var b=this._getTabCount(),d=0;d<b;d++)L.DomEvent.addListener(this._getTabTitle(d),"click",a(d),this);this._dlgCreateControls();this.options.initOpen?this.open():this.close();return this._container},close:function(){this._isOpen=!1;L.Control.Dialog.prototype.close.call(this)},
open:function(){this._map.fire("close_all_dialogs");this._isOpen=!0;L.Control.Dialog.prototype.open.call(this)},contents:'<div class="dialog-container">;<ul class="dialog-tabs-title">;<li class="dialog-tab-title selected-li">Save Data As JPG</li>;</ul>;<div class="dialog-tabs">;<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Save Data As JPG</h3></div></div>;</div>;</div>;'.split(";"),saveAsJPG:function(){var a=this.options.saveALink,b="RSWE.jpg";this.options.InputName.value&&
(b=this.options.InputName.value);a.download=b;var d=this;this._map.RSWEIndoor.getJPGData(function(b){a.href="data:image/jpeg;base64,"+b;a.click();d.close()})},_dlgCreateControls:function(){var a,b;if(a=this._getTabContainer(0))b=L.DomUtil.create("div","save-file-name"),a.appendChild(b),b.innerHTML='<a href="" download="" style="display:none;"></a><label><input type="text" name="saveFileName" placeholder="Enter file name"/></label>&nbsp;<input type="button" value="Save data to JPG file"/><br><br><i>Your drawing will be saved into system "Download" folder.</i>',
this.options.saveALink=b.firstChild,this.options.InputName=b.getElementsByTagName("INPUT")[0],this.options.InputButton=b.getElementsByTagName("INPUT")[1],L.DomEvent.addListener(this.options.InputButton,"click",function(){this.saveAsJPG()},this)}});L.control.dialog.save=function(a){return new L.Control.Dialog.Save(a)}})(window,document);
